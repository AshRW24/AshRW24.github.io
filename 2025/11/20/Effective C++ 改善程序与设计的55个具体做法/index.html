<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Effective C++ æ”¹å–„ç¨‹åºä¸è®¾è®¡çš„55ä¸ªå…·ä½“åšæ³• | çœŸæ–°é•‡ä¹‹å°æ™ºã®ä¿®è¡Œå·¥åŠ</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<meta name="generator" content="Hexo 8.1.1"></head>
<body>
  <div id="reading-progress-bar"></div>
  
  <div class="floating-bubble" style="width: 100px; height: 100px; top: 10%; left: 10%; background: rgba(255, 107, 157, 0.2);"></div>
  <div class="floating-bubble" style="width: 150px; height: 150px; top: 40%; right: 10%; background: rgba(255, 217, 61, 0.2); animation-delay: 2s;"></div>
  <div class="floating-bubble" style="width: 80px; height: 80px; bottom: 20%; left: 30%; background: rgba(78, 205, 196, 0.2); animation-delay: 4s;"></div>

  <header>
    <div class="container">
      <h1 class="site-title"><a href="/">çœŸæ–°é•‡ä¹‹å°æ™ºã®ä¿®è¡Œå·¥åŠ</a> <img src="https://img.icons8.com/color/48/pikachu-pokemon.png" alt="Pikachu" style="vertical-align: bottom; width: 40px;"></h1>
      <p class="site-motto">æ‚Ÿå·²å¾€ä¹‹ä¸è°ï¼ŒçŸ¥æ¥è€…ä¹‹å¯è¿½ ğŸƒ</p>
      <nav>
        <a href="/"><i class="fas fa-home"></i> é¦–é¡µ</a>
        <a href="/archives"><i class="fas fa-clock"></i> æ—¶é—´è½´</a>
        <a href="/categories/tech"><i class="fas fa-code"></i> æŠ€æœ¯ä¿®ç»ƒ</a>
        <a href="/categories/reading"><i class="fas fa-book"></i> è¯»ä¹¦ç¬”è®°</a>
        <a href="/about/"><i class="fas fa-user"></i> å…³äºæˆ‘</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="main-layout">
  <article class="content-wrap post-content">
    <header style="text-align: center; margin-bottom: 2rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Effective C++ æ”¹å–„ç¨‹åºä¸è®¾è®¡çš„55ä¸ªå…·ä½“åšæ³•</h1>
      <div class="post-meta">
        <span><i class="far fa-calendar"></i> 2025-11-20</span>
        
          <span style="background: rgba(78, 205, 196, 0.1); color: var(--accent-green);"><i class="far fa-folder"></i> 
            
              æŠ€æœ¯, 
            
              C++, 
            
              é˜…è¯», 
            
              è¯»ä¹¦ç¬”è®°
            
          </span>
        
        
          <span style="background: rgba(255, 217, 61, 0.1); color: #e6b31e;"><i class="fas fa-tags"></i> 
            
              #C++ 
            
              #è¯»ä¹¦ç¬”è®° 
            
              #æœ€ä½³å®è·µ 
            
          </span>
        
      </div>
    </header>

    <div class="entry-content">
      <p>ã€ŠEffective C++ã€‹æ˜¯ Scott Meyers çš„ç»å…¸ä¹‹ä½œï¼Œè¢«èª‰ä¸ºC++ç¨‹åºå‘˜çš„å¿…è¯»åœ£ç»ã€‚è¿™æœ¬ä¹¦ä¸ä»…ä»…æ˜¯è¯­æ³•å±‚é¢çš„è®²è§£ï¼Œæ›´å¤šçš„æ˜¯å…³äºå¦‚ä½•â€æ­£ç¡®â€ã€â€é«˜æ•ˆâ€åœ°ä½¿ç”¨C++çš„æ€ç»´æ¨¡å¼ã€‚</p>
<p>ä¹¦ä¸­çš„55ä¸ªæ¡æ¬¾æ¶µç›–äº†ä»åŸºç¡€è¯­æ³•åˆ°é«˜çº§æ¨¡æ¿ç¼–ç¨‹çš„æ–¹æ–¹é¢é¢ã€‚ä¸å…¶è¯´å®ƒæ˜¯æ•™ç¨‹ï¼Œä¸å¦‚è¯´å®ƒæ˜¯ä¸€æœ¬â€é¿å‘æŒ‡å—â€å’Œâ€æœ€ä½³å®è·µæ‰‹å†Œâ€ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘å¯¹è¿™55ä¸ªå…·ä½“åšæ³•çš„æ·±åº¦æ€»ç»“ä¸æ€è€ƒï¼Œæ—¨åœ¨æç‚¼å‡ºæœ€æ ¸å¿ƒçš„ç¼–ç¨‹æ™ºæ…§ï¼Œæ‘’å¼ƒå†—ä½™çš„åºŸè¯ï¼Œç›´å‡»C++å¼€å‘çš„ç—›ç‚¹ã€‚</p>
<span id="more"></span>

<h2 id="æ¡æ¬¾01ï¼š-è§†C-ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦"><a href="#æ¡æ¬¾01ï¼š-è§†C-ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦" class="headerlink" title="æ¡æ¬¾01ï¼š è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦"></a>æ¡æ¬¾01ï¼š è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦</h2><blockquote>
<p><em>View C++ as a federation of languages</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ"><a href="#æ ¸å¿ƒç†å¿µ" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>C++ä¸æ˜¯ä¸€é—¨å•çº¯çš„è¯­è¨€ï¼Œè€Œæ˜¯ç”±å››ä¸ªç›¸äº’å…³è”ä½†å„æœ‰ç‰¹è‰²çš„<strong>å­è¯­è¨€</strong>ç»„æˆçš„è”é‚¦ã€‚ç†è§£è¿™ç§åˆ†å±‚ç»“æ„æ˜¯æŒæ¡ç°ä»£C++çš„å…³é”®ï¼Œå› ä¸º<strong>é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™ä¼šæ ¹æ®ä½ ä½¿ç”¨çš„C++å­è¯­è¨€éƒ¨åˆ†è€Œå˜åŒ–</strong>ã€‚è®¤è¯†åˆ°è¿™å››ä¸ªå­è¯­è¨€çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œèƒ½å¸®åŠ©ä½ åœ¨ä¸åŒæƒ…å¢ƒä¸‹é€‰æ‹©æœ€åˆé€‚çš„ç¼–ç¨‹é£æ ¼å’ŒæŠ€æœ¯ã€‚</p>
<h3 id="æ·±åº¦è§£æ"><a href="#æ·±åº¦è§£æ" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-Cè¯­è¨€å­é›†ï¼ˆC-Sublanguageï¼‰"><a href="#1-Cè¯­è¨€å­é›†ï¼ˆC-Sublanguageï¼‰" class="headerlink" title="1. Cè¯­è¨€å­é›†ï¼ˆC Sublanguageï¼‰"></a>1. <strong>Cè¯­è¨€å­é›†ï¼ˆC Sublanguageï¼‰</strong></h4><p><strong>æ ¸å¿ƒç‰¹å¾ï¼š</strong></p>
<ul>
<li>åŸºç¡€çš„å—ç»“æ„ã€è¯­å¥ã€é¢„å¤„ç†å™¨</li>
<li>å†…ç½®æ•°æ®ç±»å‹ï¼ˆintã€charã€doubleç­‰ï¼‰</li>
<li>æ•°ç»„å’ŒæŒ‡é’ˆçš„åŸºæœ¬æ“ä½œ</li>
<li>æ§åˆ¶æµç»“æ„ï¼ˆifã€whileã€forç­‰ï¼‰</li>
</ul>
<p><strong>å®è·µå»ºè®®ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… Cé£æ ¼ä»£ç çš„æœ€ä½³å®è·µ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* arr, <span class="type">size_t</span> size)</span> </span>&#123;  <span class="comment">// æ˜¾å¼ä¼ é€’å¤§å°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç† arr[i]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é¿å…çš„Cé£æ ¼é—®é¢˜</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX(a, b) ((a) &gt; (b) ? (a) : (b))  <span class="comment">// ç”¨constæˆ–templateæ›¿ä»£</span></span></span><br><span class="line"><span class="type">char</span> buffer[<span class="number">100</span>];  <span class="comment">// è€ƒè™‘ä½¿ç”¨std::arrayæˆ–std::vector</span></span><br></pre></td></tr></table></figure>

<p><strong>é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>ä¸Cåº“äº¤äº’</li>
<li>åº•å±‚æ€§èƒ½å…³é”®ä»£ç </li>
<li>åµŒå…¥å¼ç³»ç»Ÿç¼–ç¨‹</li>
</ul>
<h4 id="2-é¢å‘å¯¹è±¡C-ï¼ˆObject-Oriented-C-ï¼‰"><a href="#2-é¢å‘å¯¹è±¡C-ï¼ˆObject-Oriented-C-ï¼‰" class="headerlink" title="2. é¢å‘å¯¹è±¡C++ï¼ˆObject-Oriented C++ï¼‰"></a>2. <strong>é¢å‘å¯¹è±¡C++ï¼ˆObject-Oriented C++ï¼‰</strong></h4><p><strong>æ ¸å¿ƒç‰¹å¾ï¼š</strong></p>
<ul>
<li>ç±»ï¼ˆclassesï¼‰ã€å¯¹è±¡ï¼ˆobjectsï¼‰</li>
<li>å°è£…ï¼ˆencapsulationï¼‰ã€ç»§æ‰¿ï¼ˆinheritanceï¼‰ã€å¤šæ€ï¼ˆpolymorphismï¼‰</li>
<li>è™šå‡½æ•°ã€åŠ¨æ€ç»‘å®š</li>
</ul>
<p><strong>å®è·µå»ºè®®ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;           <span class="comment">// è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;        <span class="comment">// çº¯è™šå‡½æ•°å®šä¹‰æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">Shape</span>() = <span class="keyword">default</span>;                    <span class="comment">// ä¿æŠ¤æ„é€ ï¼Œé˜²æ­¢ç›´æ¥å®ä¾‹åŒ–</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius_;                       <span class="comment">// å°è£…æ•°æ®æˆå‘˜</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Circle</span><span class="params">(<span class="type">double</span> r)</span> : radius_(r) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;          <span class="comment">// æ˜ç¡®æ ‡è®°override</span></span><br><span class="line">        <span class="comment">// ç»˜åˆ¶åœ†å½¢</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14159</span> * radius_ * radius_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ€çš„å¨åŠ›</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawShapes</span><span class="params">(<span class="type">const</span> std::vector&lt;std::unique_ptr&lt;Shape&gt;&gt;&amp; shapes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; shape : shapes) &#123;</span><br><span class="line">        shape-&gt;<span class="built_in">draw</span>();                    <span class="comment">// è¿è¡Œæ—¶å¤šæ€</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>å¤§å‹ç³»ç»Ÿè®¾è®¡</li>
<li>éœ€è¦å¤šæ€å’Œç»§æ‰¿çš„åœºæ™¯</li>
<li>é¢å‘å¯¹è±¡å»ºæ¨¡</li>
</ul>
<h4 id="3-æ¨¡æ¿C-ï¼ˆTemplate-C-ï¼‰"><a href="#3-æ¨¡æ¿C-ï¼ˆTemplate-C-ï¼‰" class="headerlink" title="3. æ¨¡æ¿C++ï¼ˆTemplate C++ï¼‰"></a>3. <strong>æ¨¡æ¿C++ï¼ˆTemplate C++ï¼‰</strong></h4><p><strong>æ ¸å¿ƒç‰¹å¾ï¼š</strong></p>
<ul>
<li>æ¨¡æ¿ï¼ˆtemplatesï¼‰</li>
<li>æ³›å‹ç¼–ç¨‹ï¼ˆgeneric programmingï¼‰</li>
<li>ç¼–è¯‘æ—¶è®¡ç®—å’Œç±»å‹æ¨å¯¼</li>
<li>å…ƒç¼–ç¨‹æŠ€æœ¯</li>
</ul>
<p><strong>å®è·µå»ºè®®ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ç°ä»£æ¨¡æ¿ç¼–ç¨‹å®è·µ</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Arithmetic = std::is_arithmetic_v&lt;T&gt;;  <span class="comment">// C++20æ¦‚å¿µ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;Arithmetic T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> T <span class="title">square</span><span class="params">(T value)</span> </span>&#123;                 <span class="comment">// constexprå‡½æ•°æ¨¡æ¿</span></span><br><span class="line">    <span class="keyword">return</span> value * value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SFINAEå’Œç±»å‹ç‰¹æ€§</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">typename</span> std::<span class="type">enable_if_t</span>&lt;std::is_integral_v&lt;T&gt;, T&gt;</span><br><span class="line"><span class="built_in">safe_divide</span>(T a, T b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯å˜å‚æ•°æ¨¡æ¿</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">(Args&amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> <span class="built_in">T</span>(std::forward&lt;Args&gt;(args)...));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘æ—¶è®¡ç®—</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> N&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Factorial</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> value = N * Factorial&lt;N<span class="number">-1</span>&gt;::value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Factorial</span>&lt;<span class="number">0</span>&gt; &#123;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> value = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>åº“è®¾è®¡ï¼ˆå¦‚STLï¼‰</li>
<li>æ€§èƒ½å…³é”®çš„æ³›å‹ä»£ç </li>
<li>ç¼–è¯‘æ—¶è®¡ç®—éœ€æ±‚</li>
</ul>
<h4 id="4-STLï¼ˆStandard-Template-Libraryï¼‰"><a href="#4-STLï¼ˆStandard-Template-Libraryï¼‰" class="headerlink" title="4. STLï¼ˆStandard Template Libraryï¼‰"></a>4. <strong>STLï¼ˆStandard Template Libraryï¼‰</strong></h4><p><strong>æ ¸å¿ƒç‰¹å¾ï¼š</strong></p>
<ul>
<li>å®¹å™¨ï¼ˆcontainersï¼‰</li>
<li>è¿­ä»£å™¨ï¼ˆiteratorsï¼‰  </li>
<li>ç®—æ³•ï¼ˆalgorithmsï¼‰</li>
<li>å‡½æ•°å¯¹è±¡ï¼ˆfunction objectsï¼‰</li>
</ul>
<p><strong>å®è·µå»ºè®®ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… STLæœ€ä½³å®è·µ</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSTL</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®¹å™¨é€‰æ‹©ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å®¹å™¨</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç®—æ³•ä¼˜äºæ‰‹å†™å¾ªç¯</span></span><br><span class="line">    <span class="comment">// è®¡ç®—æ€»å’Œ</span></span><br><span class="line">    <span class="type">int</span> sum = std::<span class="built_in">accumulate</span>(data.<span class="built_in">begin</span>(), data.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å…ƒç´ </span></span><br><span class="line">    <span class="keyword">auto</span> it = std::<span class="built_in">find_if</span>(data.<span class="built_in">begin</span>(), data.<span class="built_in">end</span>(), </span><br><span class="line">                          [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x &gt; <span class="number">5</span>; &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å˜æ¢æ•°æ®</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; squares;</span><br><span class="line">    squares.<span class="built_in">reserve</span>(data.<span class="built_in">size</span>());  <span class="comment">// é¢„åˆ†é…å†…å­˜</span></span><br><span class="line">    std::<span class="built_in">transform</span>(data.<span class="built_in">begin</span>(), data.<span class="built_in">end</span>(), </span><br><span class="line">                   std::<span class="built_in">back_inserter</span>(squares),</span><br><span class="line">                   [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * x; &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ’åºå’Œå»é‡</span></span><br><span class="line">    std::<span class="built_in">sort</span>(data.<span class="built_in">begin</span>(), data.<span class="built_in">end</span>(), std::<span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">    data.<span class="built_in">erase</span>(std::<span class="built_in">unique</span>(data.<span class="built_in">begin</span>(), data.<span class="built_in">end</span>()), data.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å‡½æ•°å¯¹è±¡</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MultiplyBy</span> &#123;</span><br><span class="line">    <span class="type">int</span> factor;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MultiplyBy</span><span class="params">(<span class="type">int</span> f)</span> : factor(f) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x * factor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>é€‚ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ•°æ®å¤„ç†å’Œç®—æ³•å®ç°</li>
<li>é«˜æ•ˆçš„å®¹å™¨ä½¿ç”¨</li>
<li>å‡½æ•°å¼ç¼–ç¨‹é£æ ¼</li>
</ul>
<h4 id="5-å­è¯­è¨€é—´çš„äº¤äº’å’Œè½¬æ¢"><a href="#5-å­è¯­è¨€é—´çš„äº¤äº’å’Œè½¬æ¢" class="headerlink" title="5. å­è¯­è¨€é—´çš„äº¤äº’å’Œè½¬æ¢"></a>5. <strong>å­è¯­è¨€é—´çš„äº¤äº’å’Œè½¬æ¢</strong></h4><p><strong>æ··åˆä½¿ç”¨çš„æ™ºæ…§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»¼åˆè¿ç”¨å››ä¸ªå­è¯­è¨€çš„ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">double</span>&gt; data_;              <span class="comment">// STLå®¹å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Cé£æ ¼æ¥å£å…¼å®¹</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">loadFromCArray</span><span class="params">(<span class="type">const</span> <span class="type">double</span>* arr, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">        data_.<span class="built_in">assign</span>(arr, arr + size);      <span class="comment">// STL + C</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¢å‘å¯¹è±¡è®¾è®¡</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">DataProcessor</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¨¡æ¿æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Predicate&gt;</span></span><br><span class="line"><span class="function">    <span class="type">size_t</span> <span class="title">countIf</span><span class="params">(Predicate pred)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">count_if</span>(data_.<span class="built_in">begin</span>(), data_.<span class="built_in">end</span>(), pred);  <span class="comment">// STLç®—æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–Cé£æ ¼æ•°ç»„ï¼ˆå…¼å®¹æ€§ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">double</span>* <span class="title">getCArray</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_.<span class="built_in">data</span>();                <span class="comment">// STLåˆ°Cçš„æ¡¥æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StatisticsProcessor</span> : <span class="keyword">public</span> DataProcessor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;               <span class="comment">// OOPè™šå‡½æ•°</span></span><br><span class="line">        <span class="comment">// ä½¿ç”¨STLç®—æ³•è¿›è¡Œç»Ÿè®¡è®¡ç®—</span></span><br><span class="line">        <span class="keyword">auto</span> minmax = std::<span class="built_in">minmax_element</span>(data_.<span class="built_in">begin</span>(), data_.<span class="built_in">end</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¨¡æ¿å’Œlambdaç»“åˆ</span></span><br><span class="line">        <span class="type">double</span> avg = std::<span class="built_in">accumulate</span>(data_.<span class="built_in">begin</span>(), data_.<span class="built_in">end</span>(), <span class="number">0.0</span>) / data_.<span class="built_in">size</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Cé£æ ¼çš„æ€§èƒ½å…³é”®éƒ¨åˆ†</span></span><br><span class="line">        <span class="type">double</span> variance = <span class="number">0.0</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">double</span>* raw_data = data_.<span class="built_in">data</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; data_.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="type">double</span> diff = raw_data[i] - avg;</span><br><span class="line">            variance += diff * diff;</span><br><span class="line">        &#125;</span><br><span class="line">        variance /= data_.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-é€‰æ‹©åˆé€‚å­è¯­è¨€çš„æŒ‡å¯¼åŸåˆ™"><a href="#6-é€‰æ‹©åˆé€‚å­è¯­è¨€çš„æŒ‡å¯¼åŸåˆ™" class="headerlink" title="6. é€‰æ‹©åˆé€‚å­è¯­è¨€çš„æŒ‡å¯¼åŸåˆ™"></a>6. <strong>é€‰æ‹©åˆé€‚å­è¯­è¨€çš„æŒ‡å¯¼åŸåˆ™</strong></h4><p><strong>æ€§èƒ½ä¼˜å…ˆçš„åœºæ™¯ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cå­è¯­è¨€ï¼šåº•å±‚æ“ä½œï¼Œç›´æ¥å†…å­˜è®¿é—®</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fastMemoryCopy</span><span class="params">(<span class="type">void</span>* dest, <span class="type">const</span> <span class="type">void</span>* src, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">memcpy</span>(dest, src, size);  <span class="comment">// Cæ ‡å‡†åº“å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Template C++ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="type">size_t</span> N&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> std::array&lt;<span class="type">int</span>, N&gt; <span class="title">generateSequence</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::array&lt;<span class="type">int</span>, N&gt; result&#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        result[i] = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç»´æŠ¤æ€§ä¼˜å…ˆçš„åœºæ™¯ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OOPï¼šæ¸…æ™°çš„æ¥å£å’ŒèŒè´£åˆ†ç¦»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DocumentManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">saveDocument</span><span class="params">(<span class="type">const</span> Document&amp; doc)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::unique_ptr&lt;Document&gt; <span class="title">loadDocument</span><span class="params">(<span class="type">const</span> std::string&amp; path)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// STLï¼šè¡¨è¾¾åŠ›å¼ºçš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processDocuments</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; paths)</span> </span>&#123;</span><br><span class="line">    std::for_each(std::execution::par_unseq,  <span class="comment">// C++17å¹¶è¡Œç®—æ³•</span></span><br><span class="line">                  paths.<span class="built_in">begin</span>(), paths.<span class="built_in">end</span>(),</span><br><span class="line">                  [](<span class="type">const</span> std::string&amp; path) &#123;</span><br><span class="line">                      <span class="comment">// å¤„ç†æ¯ä¸ªæ–‡æ¡£</span></span><br><span class="line">                  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>æ ¸å¿ƒè®¤çŸ¥ï¼š</strong></p>
<ol>
<li><strong>C++æ˜¯å››ç§å­è¯­è¨€çš„è”é‚¦</strong>ï¼Œæ¯ç§éƒ½æœ‰å…¶æœ€ä½³å®è·µ</li>
<li><strong>é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™ä¼šæ ¹æ®ä½¿ç”¨çš„å­è¯­è¨€è€Œå˜åŒ–</strong></li>
<li><strong>ç†è§£ä½•æ—¶ä½¿ç”¨å“ªç§å­è¯­è¨€æ˜¯C++é«˜æ‰‹çš„æ ‡å¿—</strong></li>
</ol>
<p><strong>å®ç”¨æŒ‡å¯¼ï¼š</strong></p>
<ul>
<li><strong>æ€§èƒ½å…³é”®</strong>ï¼šä¼˜å…ˆè€ƒè™‘Cå­è¯­è¨€å’Œæ¨¡æ¿</li>
<li><strong>å¤§å‹ç³»ç»Ÿ</strong>ï¼šé¢å‘å¯¹è±¡è®¾è®¡æä¾›ç»“æ„åŒ–</li>
<li><strong>åº“å¼€å‘</strong>ï¼šæ¨¡æ¿æä¾›æ³›å‹å’Œå¤ç”¨æ€§</li>
<li><strong>æ•°æ®å¤„ç†</strong>ï¼šSTLæä¾›é«˜æ•ˆç®—æ³•</li>
</ul>
<p><strong>åˆ‡æ¢åŸåˆ™ï¼š</strong></p>
<ul>
<li>åœ¨åŒä¸€ä¸ªç¨‹åºä¸­å¯ä»¥è‡ªç”±åˆ‡æ¢å­è¯­è¨€</li>
<li>æ ¹æ®å…·ä½“é—®é¢˜é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·</li>
<li>é¿å…ä¸ºäº†ä½¿ç”¨æŸç§èŒƒå¼è€Œå¼ºè¡Œä½¿ç”¨</li>
</ul>
<p><strong>è®°ä½ï¼šC++é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™è§†çŠ¶å†µè€Œå˜åŒ–ï¼Œå–å†³äºä½ ä½¿ç”¨C++çš„å“ªä¸€éƒ¨åˆ†ã€‚æŒæ¡è¿™ç§çµæ´»æ€§ï¼Œæ˜¯æˆä¸ºC++ä¸“å®¶çš„ç¬¬ä¸€æ­¥ã€‚</strong></p>
<h2 id="æ¡æ¬¾02ï¼š-å°½é‡ä»¥constï¼Œ-enum-inline-æ›¿æ¢-define"><a href="#æ¡æ¬¾02ï¼š-å°½é‡ä»¥constï¼Œ-enum-inline-æ›¿æ¢-define" class="headerlink" title="æ¡æ¬¾02ï¼š å°½é‡ä»¥constï¼Œ enum, inline æ›¿æ¢ #define"></a>æ¡æ¬¾02ï¼š å°½é‡ä»¥constï¼Œ enum, inline æ›¿æ¢ #define</h2><blockquote>
<p><em>Prefer consts, enums, and inlines to #defines</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-1"><a href="#æ ¸å¿ƒç†å¿µ-1" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><code>#define</code> å®å®šä¹‰æ˜¯<strong>é¢„å¤„ç†å™¨</strong>æ“ä½œï¼Œä¸å— C++ è¯­è¨€è§„åˆ™çº¦æŸï¼Œå¯èƒ½å¯¼è‡´<strong>è°ƒè¯•å›°éš¾</strong>ã€<strong>ç±»å‹ä¸å®‰å…¨</strong>ã€<strong>ä½œç”¨åŸŸæ±¡æŸ“</strong>ç­‰é—®é¢˜ã€‚ä½¿ç”¨ <code>const</code>ã€<code>enum</code> å’Œ <code>inline</code> å¯ä»¥æä¾›<strong>ç±»å‹å®‰å…¨</strong>ã€<strong>ä½œç”¨åŸŸæ§åˆ¶</strong>å’Œ<strong>æ›´å¥½çš„è°ƒè¯•ä½“éªŒ</strong>ï¼ŒåŒæ—¶ä¿æŒç›¸åŒæˆ–æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h3 id="æ·±åº¦è§£æ-1"><a href="#æ·±åº¦è§£æ-1" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-define-çš„é—®é¢˜æ ¹æº"><a href="#1-define-çš„é—®é¢˜æ ¹æº" class="headerlink" title="1. #define çš„é—®é¢˜æ ¹æº"></a>1. <strong>#define çš„é—®é¢˜æ ¹æº</strong></h4><p><strong>é¢„å¤„ç†å™¨ vs ç¼–è¯‘å™¨</strong></p>
<ul>
<li><code>#define</code> åœ¨é¢„å¤„ç†é˜¶æ®µæ–‡æœ¬æ›¿æ¢ï¼Œç¼–è¯‘å™¨çœ‹ä¸åˆ°åŸå§‹ç¬¦å·å</li>
<li>è°ƒè¯•æ—¶ç¬¦å·è¡¨ä¸­æ²¡æœ‰å®åï¼Œåªæœ‰æ›¿æ¢åçš„å€¼</li>
<li>é”™è¯¯ä¿¡æ¯ä¸­æ˜¾ç¤ºçš„æ˜¯æ›¿æ¢åçš„å†…å®¹ï¼Œä¸æ˜¯åŸå§‹å®å</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ASPECT_RATIO 1.653</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨çœ‹åˆ°çš„æ˜¯ï¼š</span></span><br><span class="line"><span class="type">double</span> area = width * height * <span class="number">1.653</span>;  <span class="comment">// è€Œä¸æ˜¯ ASPECT_RATIO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒè¯•æ—¶çš„é—®é¢˜ï¼š</span></span><br><span class="line"><span class="comment">// 1. ç¬¦å·è¡¨ä¸­æ²¡æœ‰ ASPECT_RATIO</span></span><br><span class="line"><span class="comment">// 2. é”™è¯¯ä¿¡æ¯ä¸­åªæ˜¾ç¤º 1.653</span></span><br><span class="line"><span class="comment">// 3. æ— æ³•è·Ÿè¸ª ASPECT_RATIO çš„ä½¿ç”¨</span></span><br></pre></td></tr></table></figure>

<h4 id="2-å¸¸é‡æ›¿ä»£ï¼šconst-å¯¹è±¡"><a href="#2-å¸¸é‡æ›¿ä»£ï¼šconst-å¯¹è±¡" class="headerlink" title="2. å¸¸é‡æ›¿ä»£ï¼šconst å¯¹è±¡"></a>2. <strong>å¸¸é‡æ›¿ä»£ï¼šconst å¯¹è±¡</strong></h4><p><strong>åŸºæœ¬å¸¸é‡æ›¿ä»£</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸æ¨èï¼šä½¿ç”¨ #define</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ASPECT_RATIO 1.653</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.14159</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ¨èï¼šä½¿ç”¨ const å¯¹è±¡</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> ASPECT_RATIO = <span class="number">1.653</span>;    <span class="comment">// ç±»å‹å®‰å…¨ï¼Œå¯è°ƒè¯•</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="number">3.14159</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_SIZE = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜åŠ¿å¯¹æ¯”ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>#define</th>
<th>const</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç±»å‹æ£€æŸ¥</strong></td>
<td>âŒ æ— </td>
<td>âœ… æœ‰</td>
</tr>
<tr>
<td><strong>ä½œç”¨åŸŸ</strong></td>
<td>âŒ å…¨å±€</td>
<td>âœ… å¯æ§</td>
</tr>
<tr>
<td><strong>è°ƒè¯•å‹å¥½</strong></td>
<td>âŒ ç¬¦å·è¡¨æ— è®°å½•</td>
<td>âœ… ä¿ç•™ç¬¦å·ä¿¡æ¯</td>
</tr>
<tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td>âŒ å¯èƒ½å¤šæ¬¡å¤åˆ¶</td>
<td>âœ… é€šå¸¸åªæœ‰ä¸€ä»½</td>
</tr>
<tr>
<td><strong>ç¼–è¯‘æ—¶æ£€æŸ¥</strong></td>
<td>âŒ æ— </td>
<td>âœ… æœ‰</td>
</tr>
</tbody></table>
<h4 id="3-ç±»ä½œç”¨åŸŸå¸¸é‡"><a href="#3-ç±»ä½œç”¨åŸŸå¸¸é‡" class="headerlink" title="3. ç±»ä½œç”¨åŸŸå¸¸é‡"></a>3. <strong>ç±»ä½œç”¨åŸŸå¸¸é‡</strong></h4><p><strong>ç±»å†…å¸¸é‡çš„æ­£ç¡®å®šä¹‰</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GamePlayer</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NumTurns = <span class="number">5</span>;     <span class="comment">// å£°æ˜å¼ï¼ˆdeclarationï¼‰</span></span><br><span class="line">    <span class="type">int</span> scores[NumTurns];              <span class="comment">// ä½¿ç”¨è¯¥å¸¸é‡</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å®ç°æ–‡ä»¶ä¸­å®šä¹‰ï¼ˆdefinitionï¼‰</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> GamePlayer::NumTurns;       <span class="comment">// å®šä¹‰å¼ï¼Œæ— éœ€é‡å¤èµ‹å€¼</span></span><br></pre></td></tr></table></figure>

<p><strong>æ—§ç¼–è¯‘å™¨çš„å¤„ç†æ–¹æ³•</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CostEstimate</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">double</span> FudgeFactor;   <span class="comment">// å£°æ˜å¼</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å®ç°æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> CostEstimate::FudgeFactor = <span class="number">1.35</span>;  <span class="comment">// å®šä¹‰å¼</span></span><br></pre></td></tr></table></figure>

<h4 id="4-enum-hack-æŠ€å·§"><a href="#4-enum-hack-æŠ€å·§" class="headerlink" title="4. enum hack æŠ€å·§"></a>4. <strong>enum hack æŠ€å·§</strong></h4><p>å½“éœ€è¦<strong>ç¼–è¯‘æ—¶å¸¸é‡</strong>ä¸”ä¸æƒ³ä¸ºå¸¸é‡åˆ†é…å†…å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ enumï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GamePlayer</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">enum</span> &#123; NumTurns = <span class="number">5</span> &#125;;             <span class="comment">// enum hack</span></span><br><span class="line">    <span class="type">int</span> scores[NumTurns];              <span class="comment">// ç¼–è¯‘æ—¶å¸¸é‡ï¼Œä¸å å†…å­˜</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// enum hack çš„ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="comment">// 1. ä¸èƒ½å–åœ°å€ï¼ˆå’Œ #define ç±»ä¼¼ï¼‰</span></span><br><span class="line"><span class="comment">// 2. ä¸ä¼šå¯¼è‡´éå¿…è¦çš„å†…å­˜åˆ†é…</span></span><br><span class="line"><span class="comment">// 3. æ˜¯åˆæ³•çš„ç¼–è¯‘æ—¶å¸¸é‡</span></span><br></pre></td></tr></table></figure>

<p><strong>enum hack vs const vs #define</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NUM_TURNS_MACRO 5              <span class="comment">// å¯èƒ½åœ¨å¤šå¤„å¤åˆ¶</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> NUM_TURNS_CONST = <span class="number">5</span>;         <span class="comment">// å¯èƒ½åˆ†é…å†…å­˜</span></span><br><span class="line"><span class="keyword">enum</span> &#123; NUM_TURNS_ENUM = <span class="number">5</span> &#125;;          <span class="comment">// ä¸åˆ†é…å†…å­˜ï¼Œä¸èƒ½å–åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> array1[NUM_TURNS_MACRO];          <span class="comment">// âœ… æœ‰æ•ˆ</span></span><br><span class="line"><span class="type">int</span> array2[NUM_TURNS_CONST];          <span class="comment">// âœ… æœ‰æ•ˆï¼ˆC++11åï¼‰</span></span><br><span class="line"><span class="type">int</span> array3[NUM_TURNS_ENUM];           <span class="comment">// âœ… æœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å–åœ°å€æµ‹è¯•</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* p1 = &amp;NUM_TURNS_CONST;     <span class="comment">// âœ… æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">// const int* p2 = &amp;NUM_TURNS_ENUM;   // âŒ é”™è¯¯ï¼šä¸èƒ½å–åœ°å€</span></span><br><span class="line"><span class="comment">// const int* p3 = &amp;NUM_TURNS_MACRO;  // âŒ é”™è¯¯ï¼šä¸æ˜¯å¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<h4 id="5-å‡½æ•°å¼å®çš„æ›¿ä»£ï¼šinline-å‡½æ•°"><a href="#5-å‡½æ•°å¼å®çš„æ›¿ä»£ï¼šinline-å‡½æ•°" class="headerlink" title="5. å‡½æ•°å¼å®çš„æ›¿ä»£ï¼šinline å‡½æ•°"></a>5. <strong>å‡½æ•°å¼å®çš„æ›¿ä»£ï¼šinline å‡½æ•°</strong></h4><p><strong>å®å‡½æ•°çš„é—®é¢˜</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é—®é¢˜é‡é‡çš„å®å‡½æ•°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CALL_WITH_MAX(a, b) f((a) &gt; (b) ? (a) : (b))</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">5</span>, b = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">CALL_WITH_MAX</span>(++a, b);          <span class="comment">// a è¢«é€’å¢äº†ä¸¤æ¬¡ï¼</span></span><br><span class="line"><span class="built_in">CALL_WITH_MAX</span>(++a, b + <span class="number">10</span>);     <span class="comment">// a è¢«é€’å¢äº†ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>

<p>å±•å¼€åçš„ç»“æœï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">f</span>((++a) &gt; (b) ? (++a) : (b));           <span class="comment">// ++a æ‰§è¡Œäº†ä¸¤æ¬¡</span></span><br><span class="line"><span class="built_in">f</span>((++a) &gt; (b + <span class="number">10</span>) ? (++a) : (b + <span class="number">10</span>)); <span class="comment">// ++a æ‰§è¡Œäº†ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>

<p><strong>inline å‡½æ•°çš„è§£å†³æ–¹æ¡ˆ</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ç±»å‹å®‰å…¨çš„ inline å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">callWithMax</span><span class="params">(<span class="type">const</span> T&amp; a, <span class="type">const</span> T&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">f</span>(a &gt; b ? a : b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">5</span>, b = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">callWithMax</span>(++a, b);            <span class="comment">// è¡Œä¸ºå¯é¢„æµ‹ï¼ša åªé€’å¢ä¸€æ¬¡</span></span><br><span class="line"><span class="built_in">callWithMax</span>(++a, b + <span class="number">10</span>);       <span class="comment">// è¡Œä¸ºå¯é¢„æµ‹ï¼ša åªé€’å¢ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure>

<h4 id="6-å¤æ‚å®çš„-inline-æ›¿ä»£"><a href="#6-å¤æ‚å®çš„-inline-æ›¿ä»£" class="headerlink" title="6. å¤æ‚å®çš„ inline æ›¿ä»£"></a>6. <strong>å¤æ‚å®çš„ inline æ›¿ä»£</strong></h4><p><strong>å¤šè¯­å¥å®çš„é—®é¢˜</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å¤æ‚å®ï¼šå®¹æ˜“å‡ºé”™</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEBUG_PRINT(str) do &#123; \</span></span><br><span class="line"><span class="meta">    std::cout &lt;&lt; <span class="string">&quot;DEBUG: &quot;</span> &lt;&lt; str &lt;&lt; std::endl; \</span></span><br><span class="line"><span class="meta">    log_to_file(str); \</span></span><br><span class="line"><span class="meta">&#125; while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ—¶çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    <span class="built_in">DEBUG_PRINT</span>(<span class="string">&quot;message&quot;</span>);  <span class="comment">// çœ‹èµ·æ¥æ²¡é—®é¢˜</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">other_action</span>();          <span class="comment">// ä½†å¯èƒ½ä¸ä¼šå¦‚æœŸæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p><strong>inline å‡½æ•°æ›¿ä»£</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ç±»å‹å®‰å…¨çš„ inline å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">debugPrint</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;DEBUG: &quot;</span> &lt;&lt; str &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">log_to_file</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ—¶æ›´å®‰å…¨</span></span><br><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    <span class="built_in">debugPrint</span>(<span class="string">&quot;message&quot;</span>);   <span class="comment">// è¡Œä¸ºæ˜ç¡®</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">other_action</span>();          <span class="comment">// ç¡®å®šä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<h4 id="7-æ€§èƒ½å¯¹æ¯”åˆ†æ"><a href="#7-æ€§èƒ½å¯¹æ¯”åˆ†æ" class="headerlink" title="7. æ€§èƒ½å¯¹æ¯”åˆ†æ"></a>7. <strong>æ€§èƒ½å¯¹æ¯”åˆ†æ</strong></h4><p><strong>ç¼–è¯‘æ—¶å¸¸é‡æ€§èƒ½</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§èƒ½æµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> CONST_VALUE = <span class="number">1000000</span>;</span><br><span class="line"><span class="keyword">enum</span> &#123; ENUM_VALUE = <span class="number">1000000</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MACRO_VALUE 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°ä»£ç¼–è¯‘å™¨ä¼˜åŒ–åï¼Œæ€§èƒ½å‡ ä¹ç›¸åŒ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; CONST_VALUE; ++i) &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ENUM_VALUE; ++i) &#123; <span class="comment">/* ... */</span> &#125;  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; MACRO_VALUE; ++i) &#123; <span class="comment">/* ... */</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>inline å‡½æ•° vs å®æ€§èƒ½</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inline å‡½æ•°é€šå¸¸ç”Ÿæˆç›¸åŒæˆ–æ›´å¥½çš„æ±‡ç¼–ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">square</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x * x; &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SQUARE(x) ((x) * (x))</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> result1 = <span class="built_in">square</span>(a);     <span class="comment">// ç±»å‹å®‰å…¨ï¼Œæ€§èƒ½ç›¸åŒ</span></span><br><span class="line"><span class="type">int</span> result2 = <span class="built_in">SQUARE</span>(a);     <span class="comment">// ç±»å‹ä¸å®‰å…¨ï¼Œæ€§èƒ½ç›¸åŒ</span></span><br></pre></td></tr></table></figure>

<h4 id="8-æœ€ä½³å®è·µæŒ‡å—"><a href="#8-æœ€ä½³å®è·µæŒ‡å—" class="headerlink" title="8. æœ€ä½³å®è·µæŒ‡å—"></a>8. <strong>æœ€ä½³å®è·µæŒ‡å—</strong></h4><p><strong>å¸¸é‡é€‰æ‹©ç­–ç•¥</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. ç®€å•æ•°å€¼å¸¸é‡ï¼šä¼˜å…ˆ const</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="number">3.14159265359</span>;</span><br><span class="line"><span class="type">const</span> std::string COMPANY_NAME = <span class="string">&quot;TechCorp&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ•°ç»„å¤§å°ç­‰ç¼–è¯‘æ—¶å¸¸é‡ï¼šè€ƒè™‘ enum hack</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Buffer</span> &#123;</span><br><span class="line">    <span class="keyword">enum</span> &#123; BUFFER_SIZE = <span class="number">1024</span> &#125;;</span><br><span class="line">    <span class="type">char</span> data[BUFFER_SIZE];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ç±»å‹ç›¸å…³å¸¸é‡ï¼šä½¿ç”¨ const æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">numeric_limits</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">bool</span> is_signed = std::is_signed&lt;T&gt;::value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ç°ä»£ C++ çš„æ”¹è¿›</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++11 åŠä»¥åçš„æœ€ä½³å®è·µ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> VALUE = <span class="number">42</span>;        <span class="comment">// constexpr æ›¿ä»£ enum hack</span></span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">double</span> PI = <span class="number">3.14159</span>;   <span class="comment">// ç¼–è¯‘æ—¶æµ®ç‚¹å¸¸é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;        <span class="comment">// constexpr å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> VALUE * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17 inline å˜é‡</span></span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">constexpr</span> <span class="type">int</span> GLOBAL_CONSTANT = <span class="number">100</span>;  <span class="comment">// å¤´æ–‡ä»¶ä¸­çš„å…¨å±€å¸¸é‡</span></span><br></pre></td></tr></table></figure>

<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä½¿ç”¨ <code>const</code>ã€<code>enum</code> å’Œ <code>inline</code> æ›¿ä»£ <code>#define</code> æ˜¯ç°ä»£ C++ çš„åŸºæœ¬åŸåˆ™ï¼Œå¸¦æ¥å¤šé‡å¥½å¤„ï¼š</p>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œé¿å…éšå¼è½¬æ¢é”™è¯¯</li>
<li><strong>ä½œç”¨åŸŸæ§åˆ¶</strong>ï¼šé¿å…å…¨å±€å‘½åç©ºé—´æ±¡æŸ“</li>
<li><strong>è°ƒè¯•å‹å¥½</strong>ï¼šä¿ç•™ç¬¦å·ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•å’Œé”™è¯¯å®šä½</li>
<li><strong>æ€§èƒ½ç­‰ä»·</strong>ï¼šç°ä»£ç¼–è¯‘å™¨ä¼˜åŒ–ä¸‹æ€§èƒ½ç›¸åŒæˆ–æ›´å¥½</li>
<li><strong>è¯­ä¹‰æ¸…æ™°</strong>ï¼šæ˜ç¡®è¡¨è¾¾è®¾è®¡æ„å›¾</li>
</ul>
<p><strong>é€‰æ‹©æŒ‡å—ï¼š</strong></p>
<ul>
<li><strong>ç®€å•å¸¸é‡</strong>ï¼šä½¿ç”¨ <code>const</code> æˆ– <code>constexpr</code></li>
<li><strong>ç¼–è¯‘æ—¶æ•´æ•°å¸¸é‡</strong>ï¼šä¼˜å…ˆ <code>constexpr</code>ï¼Œè€ƒè™‘ <code>enum hack</code></li>
<li><strong>å‡½æ•°å¼æ“ä½œ</strong>ï¼šä½¿ç”¨ <code>inline</code> å‡½æ•°æˆ– lambda</li>
<li><strong>å¤æ‚é€»è¾‘</strong>ï¼šé¿å…å®ï¼Œä½¿ç”¨æ¨¡æ¿å’Œ inline å‡½æ•°</li>
</ul>
<p>è®°ä½ï¼š<strong>é¢„å¤„ç†å™¨æ˜¯ä¸ºé‚£äº›ä¸æ‡‚è¯­è¨€æœ¬èº«çš„å·¥å…·å‡†å¤‡çš„</strong>ï¼Œå°½é‡ä½¿ç”¨è¯­è¨€æœ¬èº«çš„ç‰¹æ€§æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚</p>
<h2 id="æ¡æ¬¾03-å°½é‡ä½¿ç”¨const"><a href="#æ¡æ¬¾03-å°½é‡ä½¿ç”¨const" class="headerlink" title="æ¡æ¬¾03:  å°½é‡ä½¿ç”¨const"></a>æ¡æ¬¾03:  å°½é‡ä½¿ç”¨const</h2><blockquote>
<p><em>Use const whenever possible</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-2"><a href="#æ ¸å¿ƒç†å¿µ-2" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><code>const</code>æ˜¯C++ä¸­æœ€å¼ºå¤§çš„å…³é”®å­—ä¹‹ä¸€ï¼Œå®ƒä¸ä»…èƒ½å¸®åŠ©ç¼–è¯‘å™¨æ£€æµ‹é”™è¯¯ç”¨æ³•ï¼Œæ›´æ˜¯è¡¨è¾¾è®¾è®¡æ„å›¾ã€æå‡ä»£ç å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§çš„é‡è¦å·¥å…·ã€‚å°†æŸäº›ä¸œè¥¿å£°æ˜ä¸º<code>const</code>å¯ä»¥åœ¨ç¼–è¯‘æœŸå°±å‘ç°æ½œåœ¨é—®é¢˜ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯ã€‚ç†è§£<code>const</code>çš„å„ç§ç”¨æ³•å’Œæœ€ä½³å®è·µï¼Œæ˜¯å†™å‡ºå¥å£®C++ä»£ç çš„åŸºç¡€ã€‚</p>
<h3 id="æ·±åº¦è§£æ-2"><a href="#æ·±åº¦è§£æ-2" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-constçš„åŸºæœ¬è¯­æ³•è§„åˆ™"><a href="#1-constçš„åŸºæœ¬è¯­æ³•è§„åˆ™" class="headerlink" title="1. constçš„åŸºæœ¬è¯­æ³•è§„åˆ™"></a>1. <strong>constçš„åŸºæœ¬è¯­æ³•è§„åˆ™</strong></h4><p><strong>æŒ‡é’ˆå’Œconstçš„ç»„åˆï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span>* ptr1;        <span class="comment">// ptr1æ˜¯æŒ‡å‘const intçš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> <span class="type">const</span>* ptr2;        <span class="comment">// ç­‰åŒäºptr1ï¼ŒæŒ‡å‘const intçš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span>* <span class="type">const</span> ptr3 = &amp;x;   <span class="comment">// ptr3æ˜¯æŒ‡å‘intçš„constæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* <span class="type">const</span> ptr4 = &amp;x;  <span class="comment">// ptr4æ˜¯æŒ‡å‘const intçš„constæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»æ³•æŠ€å·§ï¼šä»å³å¾€å·¦è¯»</span></span><br><span class="line"><span class="comment">// const int* ptr1 â†’ ptr1æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘const int</span></span><br><span class="line"><span class="comment">// int* const ptr3 â†’ ptr3æ˜¯constæŒ‡é’ˆï¼ŒæŒ‡å‘int</span></span><br></pre></td></tr></table></figure>

<p><strong>è®°å¿†å£è¯€ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœconståœ¨*å·¦è¾¹ï¼Œæ‰€æŒ‡ç‰©æ˜¯å¸¸é‡</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* p1;    <span class="comment">// æ‰€æŒ‡çš„intæ˜¯const</span></span><br><span class="line"><span class="type">int</span> <span class="type">const</span>* p2;    <span class="comment">// åŒä¸Š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœconståœ¨*å³è¾¹ï¼ŒæŒ‡é’ˆè‡ªèº«æ˜¯å¸¸é‡  </span></span><br><span class="line"><span class="type">int</span>* <span class="type">const</span> p3;    <span class="comment">// æŒ‡é’ˆp3æ˜¯const</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤è¾¹éƒ½æœ‰const</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* <span class="type">const</span> p4;  <span class="comment">// æŒ‡é’ˆå’Œæ‰€æŒ‡ç‰©éƒ½æ˜¯const</span></span><br></pre></td></tr></table></figure>

<h4 id="2-conståœ¨å‡½æ•°å‚æ•°ä¸­çš„åº”ç”¨"><a href="#2-conståœ¨å‡½æ•°å‚æ•°ä¸­çš„åº”ç”¨" class="headerlink" title="2. conståœ¨å‡½æ•°å‚æ•°ä¸­çš„åº”ç”¨"></a>2. <strong>conståœ¨å‡½æ•°å‚æ•°ä¸­çš„åº”ç”¨</strong></h4><p><strong>å€¼ä¼ é€’å‚æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å¯¹äºå†…ç½®ç±»å‹ï¼Œconst valueå‚æ•°æ„ä¹‰ä¸å¤§</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func1</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x)</span></span>;     <span class="comment">// å‡½æ•°å†…éƒ¨ä¸èƒ½ä¿®æ”¹xï¼Œä½†è°ƒç”¨è€…ä¸å—å½±å“</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func1</span><span class="params">(<span class="type">int</span> x)</span></span>;           <span class="comment">// å¯¹è°ƒç”¨è€…è€Œè¨€ï¼Œæ•ˆæœç›¸åŒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½†å¯ä»¥é¿å…å‡½æ•°å†…éƒ¨æ„å¤–ä¿®æ”¹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processValue</span><span class="params">(<span class="type">const</span> <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// value = 100;  // ç¼–è¯‘é”™è¯¯ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">return</span> value * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¼•ç”¨å’ŒæŒ‡é’ˆå‚æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… constå¼•ç”¨ï¼šé«˜æ•ˆä¸”å®‰å…¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printString</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;  <span class="comment">// ä¸æ‹·è´ï¼Œä¸ä¿®æ”¹</span></span><br><span class="line">    std::cout &lt;&lt; str &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// str += &quot;modified&quot;;  // ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… constæŒ‡é’ˆå‚æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(<span class="type">const</span> <span class="type">int</span>* arr, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// åªè¯»è®¿é—®</span></span><br><span class="line">        <span class="comment">// arr[i] = 0;  // ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æŒ‡é’ˆæœ¬èº«æ˜¯const</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processBuffer</span><span class="params">(<span class="type">char</span>* <span class="type">const</span> buffer, <span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// buffer = nullptr;  // ç¼–è¯‘é”™è¯¯ï¼Œä¸èƒ½æ”¹å˜æŒ‡é’ˆ</span></span><br><span class="line">    buffer[<span class="number">0</span>] = <span class="string">&#x27;A&#x27;</span>;      <span class="comment">// å¯ä»¥ä¿®æ”¹æ‰€æŒ‡å†…å®¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-constè¿”å›å€¼çš„åº”ç”¨"><a href="#3-constè¿”å›å€¼çš„åº”ç”¨" class="headerlink" title="3. constè¿”å›å€¼çš„åº”ç”¨"></a>3. <strong>constè¿”å›å€¼çš„åº”ç”¨</strong></h4><p><strong>è¿”å›constå¯¹è±¡é˜²æ­¢è¯¯ç”¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_, denominator_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… è¿”å›constå¯¹è±¡ï¼Œé˜²æ­¢(a*b)=cè¿™æ ·çš„è¯¯ç”¨</span></span><br><span class="line">    <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(numerator_ * rhs.numerator_, </span><br><span class="line">                       denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testRational</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">b</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">c</span><span class="params">(<span class="number">5</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ å¦‚æœoperator*ä¸è¿”å›constï¼Œè¿™æ ·çš„ä»£ç å¯èƒ½ç¼–è¯‘é€šè¿‡ä½†é€»è¾‘é”™è¯¯</span></span><br><span class="line">    <span class="comment">// (a * b) = c;  // ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½ç»™constå¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ç”¨æ³•</span></span><br><span class="line">    Rational result = a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿”å›constå¼•ç”¨çš„åœºæ™¯ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… constç‰ˆæœ¬è¿”å›constå¼•ç”¨</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text_[position];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… non-constç‰ˆæœ¬è¿”å›non-constå¼•ç”¨</span></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) &#123;</span><br><span class="line">        <span class="keyword">return</span> text_[position];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateConstReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">TextBlock <span class="title">tb</span><span class="params">(<span class="string">&quot;Hello&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> TextBlock <span class="title">ctb</span><span class="params">(<span class="string">&quot;World&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> c1 = tb[<span class="number">0</span>];      <span class="comment">// è°ƒç”¨non-constç‰ˆæœ¬</span></span><br><span class="line">    <span class="type">char</span> c2 = ctb[<span class="number">0</span>];     <span class="comment">// è°ƒç”¨constç‰ˆæœ¬</span></span><br><span class="line">    </span><br><span class="line">    tb[<span class="number">0</span>] = <span class="string">&#x27;h&#x27;</span>;          <span class="comment">// å¯ä»¥ä¿®æ”¹</span></span><br><span class="line">    <span class="comment">// ctb[0] = &#x27;w&#x27;;      // ç¼–è¯‘é”™è¯¯ï¼šconstå¯¹è±¡ä¸èƒ½ä¿®æ”¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-constæˆå‘˜å‡½æ•°"><a href="#4-constæˆå‘˜å‡½æ•°" class="headerlink" title="4. constæˆå‘˜å‡½æ•°"></a>4. <strong>constæˆå‘˜å‡½æ•°</strong></h4><p><strong>åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_;</span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">int</span> access_count_;  <span class="comment">// mutableæˆå‘˜å¯ä»¥åœ¨constå‡½æ•°ä¸­ä¿®æ”¹</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> x = <span class="number">0</span>, <span class="type">int</span> y = <span class="number">0</span>) : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y), <span class="built_in">access_count_</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… constæˆå‘˜å‡½æ•°ï¼šä¸ä¿®æ”¹å¯¹è±¡çŠ¶æ€</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getX</span><span class="params">()</span> <span class="type">const</span> </span>&#123; </span><br><span class="line">        ++access_count_;  <span class="comment">// mutableæˆå‘˜å¯ä»¥ä¿®æ”¹</span></span><br><span class="line">        <span class="keyword">return</span> x_; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getY</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">distance</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">sqrt</span>(x_ * x_ + y_ * y_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… non-constæˆå‘˜å‡½æ•°ï¼šå¯ä»¥ä¿®æ”¹å¯¹è±¡çŠ¶æ€</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; x_ = x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setY</span><span class="params">(<span class="type">int</span> y)</span> </span>&#123; y_ = y; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ç¤ºä¾‹ï¼šconstå‡½æ•°ä¸­ä¿®æ”¹æˆå‘˜</span></span><br><span class="line">    <span class="comment">// void badConstFunction() const &#123;</span></span><br><span class="line">    <span class="comment">//     x_ = 100;  // ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateConstMemberFunctions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Point <span class="title">p</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> Point <span class="title">cp</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constå¯¹è±¡åªèƒ½è°ƒç”¨constæˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> x1 = p.<span class="built_in">getX</span>();    <span class="comment">// è°ƒç”¨constç‰ˆæœ¬</span></span><br><span class="line">    <span class="type">int</span> x2 = cp.<span class="built_in">getX</span>();   <span class="comment">// è°ƒç”¨constç‰ˆæœ¬</span></span><br><span class="line">    </span><br><span class="line">    p.<span class="built_in">setX</span>(<span class="number">10</span>);           <span class="comment">// å¯ä»¥ä¿®æ”¹</span></span><br><span class="line">    <span class="comment">// cp.setX(20);       // ç¼–è¯‘é”™è¯¯ï¼šconstå¯¹è±¡ä¸èƒ½è°ƒç”¨non-constå‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-bitwise-const-vs-logical-const"><a href="#5-bitwise-const-vs-logical-const" class="headerlink" title="5. bitwise const vs logical const"></a>5. <strong>bitwise const vs logical const</strong></h4><p><strong>bitwise constnessï¼ˆç¼–è¯‘å™¨çš„è§‚ç‚¹ï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* pText_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TextBlock</span>(<span class="type">const</span> <span class="type">char</span>* text) &#123;</span><br><span class="line">        pText_ = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(text) + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">strcpy</span>(pText_, text);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">TextBlock</span>() &#123; <span class="keyword">delete</span>[] pText_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… bitwise constï¼šä¸ä¿®æ”¹ä»»ä½•æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pText_[position];  <span class="comment">// è¿”å›å¼•ç”¨ï¼Œå…è®¸ä¿®æ”¹æ‰€æŒ‡å†…å®¹ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateBitwiseConst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">const</span> TextBlock <span class="title">tb</span><span class="params">(<span class="string">&quot;Hello&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">char</span>&amp; c = tb[<span class="number">0</span>];  <span class="comment">// è·å¾—å¼•ç”¨</span></span><br><span class="line">    c = <span class="string">&#x27;h&#x27;</span>;          <span class="comment">// ä¿®æ”¹äº†&quot;const&quot;å¯¹è±¡çš„å†…å®¹ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>logical constnessï¼ˆç¨‹åºå‘˜çš„è§‚ç‚¹ï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CTextBlock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">char</span>* pText_;           <span class="comment">// mutableå…è®¸åœ¨constå‡½æ•°ä¸­ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">bool</span> lengthIsValid_;    <span class="comment">// ç¼“å­˜çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">size_t</span> textLength_;     <span class="comment">// ç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CTextBlock</span>(<span class="type">const</span> <span class="type">char</span>* text) : <span class="built_in">lengthIsValid_</span>(<span class="literal">false</span>) &#123;</span><br><span class="line">        pText_ = <span class="keyword">new</span> <span class="type">char</span>[<span class="built_in">strlen</span>(text) + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">strcpy</span>(pText_, text);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">CTextBlock</span>() &#123; <span class="keyword">delete</span>[] pText_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… logical constï¼šæ¦‚å¿µä¸Šä¸ä¿®æ”¹å¯¹è±¡ï¼Œä½†å¯èƒ½ä¿®æ”¹ç¼“å­˜</span></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!lengthIsValid_) &#123;</span><br><span class="line">            textLength_ = <span class="built_in">strlen</span>(pText_);  <span class="comment">// ä¿®æ”¹mutableæˆå‘˜</span></span><br><span class="line">            lengthIsValid_ = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> textLength_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… constç‰ˆæœ¬ï¼šçœŸæ­£çš„åªè¯»è®¿é—®</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pText_[position];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… non-constç‰ˆæœ¬ï¼šå…è®¸ä¿®æ”¹</span></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) &#123;</span><br><span class="line">        lengthIsValid_ = <span class="literal">false</span>;  <span class="comment">// ä¿®æ”¹åç¼“å­˜å¤±æ•ˆ</span></span><br><span class="line">        <span class="keyword">return</span> pText_[position];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-é¿å…constå’Œnon-constæˆå‘˜å‡½æ•°çš„ä»£ç é‡å¤"><a href="#6-é¿å…constå’Œnon-constæˆå‘˜å‡½æ•°çš„ä»£ç é‡å¤" class="headerlink" title="6. é¿å…constå’Œnon-constæˆå‘˜å‡½æ•°çš„ä»£ç é‡å¤"></a>6. <strong>é¿å…constå’Œnon-constæˆå‘˜å‡½æ•°çš„ä»£ç é‡å¤</strong></h4><p><strong>âŒ é”™è¯¯åšæ³•ï¼šä»£ç é‡å¤</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚çš„è¾¹ç•Œæ£€æŸ¥å’Œæ—¥å¿—è®°å½•</span></span><br><span class="line">        <span class="keyword">if</span> (position &gt;= text_.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Index out of range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logAccess</span>(position);</span><br><span class="line">        <span class="keyword">return</span> text_[position];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) &#123;</span><br><span class="line">        <span class="comment">// é‡å¤çš„å¤æ‚é€»è¾‘ï¼</span></span><br><span class="line">        <span class="keyword">if</span> (position &gt;= text_.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Index out of range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logAccess</span>(position);</span><br><span class="line">        <span class="keyword">return</span> text_[position];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>âœ… æ­£ç¡®åšæ³•ï¼šnon-constè°ƒç”¨const</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text_;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">logAccess</span><span class="params">(<span class="type">size_t</span> position)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ—¥å¿—è®°å½•é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// constç‰ˆæœ¬ï¼šå®ç°æ‰€æœ‰é€»è¾‘</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (position &gt;= text_.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Index out of range&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">logAccess</span>(position);</span><br><span class="line">        <span class="keyword">return</span> text_[position];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// non-constç‰ˆæœ¬ï¼šè°ƒç”¨constç‰ˆæœ¬</span></span><br><span class="line">    <span class="type">char</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> position) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">const_cast</span>&lt;<span class="type">char</span>&amp;&gt;(           <span class="comment">// ç§»é™¤è¿”å›å€¼çš„const</span></span><br><span class="line">            <span class="keyword">static_cast</span>&lt;<span class="type">const</span> TextBlock&amp;&gt;   <span class="comment">// ä¸º*thisåŠ ä¸Šconst</span></span><br><span class="line">                (*<span class="keyword">this</span>)[position]           <span class="comment">// è°ƒç”¨constç‰ˆæœ¬</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>const_castçš„å®‰å…¨ä½¿ç”¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å®‰å…¨ï¼šä»constç‰ˆæœ¬ä¸­ç§»é™¤const</span></span><br><span class="line"><span class="type">char</span>&amp; TextBlock::<span class="keyword">operator</span>[](<span class="type">size_t</span> position) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">const_cast</span>&lt;<span class="type">char</span>&amp;&gt;(</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;<span class="type">const</span> TextBlock&amp;&gt;(*<span class="keyword">this</span>)[position]</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ å±é™©ï¼šä¸è¦è®©constç‰ˆæœ¬è°ƒç”¨non-constç‰ˆæœ¬</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>&amp; TextBlock::<span class="keyword">operator</span>[](<span class="type">size_t</span> position) <span class="type">const</span> &#123;</span><br><span class="line">    <span class="comment">// return (*this)[position];  // å¯èƒ½ä¿®æ”¹å¯¹è±¡çŠ¶æ€ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-conståœ¨STLä¸­çš„åº”ç”¨"><a href="#7-conståœ¨STLä¸­çš„åº”ç”¨" class="headerlink" title="7. conståœ¨STLä¸­çš„åº”ç”¨"></a>7. <strong>conståœ¨STLä¸­çš„åº”ç”¨</strong></h4><p><strong>è¿­ä»£å™¨å’Œconstï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSTLConst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt; cvec = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constè¿­ä»£å™¨ï¼šè¿­ä»£å™¨æœ¬èº«æ˜¯const</span></span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;::iterator iter = vec.<span class="built_in">begin</span>();</span><br><span class="line">    *iter = <span class="number">10</span>;     <span class="comment">// å¯ä»¥ä¿®æ”¹æ‰€æŒ‡å…ƒç´ </span></span><br><span class="line">    <span class="comment">// ++iter;      // ç¼–è¯‘é”™è¯¯ï¼šè¿­ä»£å™¨æœ¬èº«æ˜¯const</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// const_iteratorï¼šæ‰€æŒ‡å…ƒç´ æ˜¯const</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;::const_iterator cIter = vec.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="comment">// *cIter = 20; // ç¼–è¯‘é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹æ‰€æŒ‡å…ƒç´ </span></span><br><span class="line">    ++cIter;        <span class="comment">// å¯ä»¥ç§»åŠ¨è¿­ä»£å™¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constå®¹å™¨åªèƒ½ä½¿ç”¨const_iterator</span></span><br><span class="line">    <span class="keyword">auto</span> it = cvec.<span class="built_in">begin</span>();  <span class="comment">// è‡ªåŠ¨æ¨å¯¼ä¸ºconst_iterator</span></span><br><span class="line">    <span class="comment">// *it = 100;            // ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç®—æ³•ä¸­çš„constä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Iterator&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printRange</span><span class="params">(Iterator first, Iterator last)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = first; it != last; ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// åªè¯»è®¿é—®</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-ç°ä»£C-ä¸­çš„constå¢å¼º"><a href="#8-ç°ä»£C-ä¸­çš„constå¢å¼º" class="headerlink" title="8. ç°ä»£C++ä¸­çš„constå¢å¼º"></a>8. <strong>ç°ä»£C++ä¸­çš„constå¢å¼º</strong></h4><p><strong>constexprï¼šç¼–è¯‘æ—¶å¸¸é‡</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++11/14/17ä¸­çš„constexpr</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">square</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> arr_size = <span class="number">10</span>;</span><br><span class="line">std::array&lt;<span class="type">int</span>, square(5)&gt; arr;  <span class="comment">// ç¼–è¯‘æ—¶è®¡ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">Point</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> : x_(x), y_(y) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">getX</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">getY</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">distanceSquared</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x_ * x_ + y_ * y_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> Point <span class="title">origin</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> dist = origin.<span class="built_in">distanceSquared</span>();</span><br></pre></td></tr></table></figure>

<p><strong>autoå’Œconstï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateAutoConst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> x = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">auto</span> y = x;            <span class="comment">// yçš„ç±»å‹æ˜¯intï¼ˆä¸¢å¤±constï¼‰</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> z = x;      <span class="comment">// zçš„ç±»å‹æ˜¯const int</span></span><br><span class="line">    <span class="keyword">auto</span>&amp; w = x;           <span class="comment">// wçš„ç±»å‹æ˜¯const int&amp;</span></span><br><span class="line">    </span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span>&amp; elem = vec[<span class="number">0</span>];  <span class="comment">// é¿å…æ‹·è´çš„å®‰å…¨è®¿é—®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>constçš„æ ¸å¿ƒä»·å€¼ï¼š</strong></p>
<ol>
<li><strong>ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹</strong>ï¼šåœ¨ç¼–è¯‘æœŸå‘ç°æ½œåœ¨é—®é¢˜</li>
<li><strong>æ¥å£å¥‘çº¦</strong>ï¼šæ˜ç¡®è¡¨è¾¾å‡½æ•°çš„æ„å›¾å’Œé™åˆ¶</li>
<li><strong>ä¼˜åŒ–æœºä¼š</strong>ï¼šå¸®åŠ©ç¼–è¯‘å™¨ç”Ÿæˆæ›´é«˜æ•ˆçš„ä»£ç </li>
<li><strong>ä»£ç å®‰å…¨æ€§</strong>ï¼šé˜²æ­¢æ„å¤–ä¿®æ”¹</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>å°½å¯èƒ½ä½¿ç”¨const</strong>ï¼šå‚æ•°ã€è¿”å›å€¼ã€æˆå‘˜å‡½æ•°</li>
<li><strong>constå¼•ç”¨ä¼ å‚</strong>ï¼šé¿å…æ‹·è´çš„åŒæ—¶ä¿è¯å®‰å…¨</li>
<li><strong>mutableå¤„ç†ç¼“å­˜</strong>ï¼šåœ¨logical constä¸­ä½¿ç”¨</li>
<li><strong>const_castè°¨æ…ä½¿ç”¨</strong>ï¼šä»…åœ¨å¿…è¦æ—¶ä»constç‰ˆæœ¬ä¸­ç§»é™¤const</li>
<li><strong>STLç®—æ³•ä¼˜å…ˆä½¿ç”¨const_iterator</strong></li>
</ul>
<p><strong>è®°ä½ä¸‰ä¸ªè¦ç‚¹ï¼š</strong></p>
<ul>
<li>å°†æŸäº›ä¸œè¥¿å£°æ˜ä¸ºconstå¯å¸®åŠ©ç¼–è¯‘å™¨ä¾¦æµ‹å‡ºé”™è¯¯ç”¨æ³•</li>
<li>ç¼–è¯‘å™¨å¼ºåˆ¶å®æ–½bitwise constnessï¼Œä½†ä½ ç¼–å†™ç¨‹åºæ—¶åº”è¯¥ä½¿ç”¨â€æ¦‚å¿µä¸Šçš„å¸¸é‡â€ï¼ˆconceptual constnessï¼‰  </li>
<li>å½“constå’Œnon-constæˆå‘˜å‡½æ•°æœ‰ç€å®è´¨ç­‰ä»·çš„å®ç°æ—¶ï¼Œä»¤non-constç‰ˆæœ¬è°ƒç”¨constç‰ˆæœ¬å¯é¿å…ä»£ç é‡å¤</li>
</ul>
<h2 id="æ¡æ¬¾04ï¼š-ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆè¢«åˆå§‹åŒ–"><a href="#æ¡æ¬¾04ï¼š-ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆè¢«åˆå§‹åŒ–" class="headerlink" title="æ¡æ¬¾04ï¼š ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆè¢«åˆå§‹åŒ–"></a>æ¡æ¬¾04ï¼š ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆè¢«åˆå§‹åŒ–</h2><blockquote>
<p><em>Make sure that objects are initialized before theyâ€™re used</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-3"><a href="#æ ¸å¿ƒç†å¿µ-3" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨C++ä¸­ï¼Œå¯¹è±¡çš„åˆå§‹åŒ–æ˜¯ä¸€ä¸ªå®¹æ˜“è¢«å¿½è§†ä½†æå…¶é‡è¦çš„é—®é¢˜ã€‚<strong>æœªåˆå§‹åŒ–çš„å¯¹è±¡å¯èƒ½åŒ…å«éšæœºæ•°æ®ï¼Œå¯¼è‡´ç¨‹åºè¡Œä¸ºä¸ç¡®å®š</strong>ã€‚æŒæ¡æ­£ç¡®çš„åˆå§‹åŒ–æŠ€æœ¯ä¸ä»…èƒ½é¿å…è¿è¡Œæ—¶é”™è¯¯ï¼Œè¿˜èƒ½æå‡ç¨‹åºæ€§èƒ½ã€‚ç†è§£åˆå§‹åŒ–ä¸èµ‹å€¼çš„åŒºåˆ«ã€æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„é‡è¦æ€§ï¼Œä»¥åŠé™æ€å¯¹è±¡çš„åˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼Œæ˜¯å†™å‡ºå¯é C++ä»£ç çš„åŸºç¡€ã€‚</p>
<h3 id="æ·±åº¦è§£æ-3"><a href="#æ·±åº¦è§£æ-3" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å†…ç½®ç±»å‹çš„æ‰‹å·¥åˆå§‹åŒ–"><a href="#1-å†…ç½®ç±»å‹çš„æ‰‹å·¥åˆå§‹åŒ–" class="headerlink" title="1. å†…ç½®ç±»å‹çš„æ‰‹å·¥åˆå§‹åŒ–"></a>1. <strong>å†…ç½®ç±»å‹çš„æ‰‹å·¥åˆå§‹åŒ–</strong></h4><p><strong>é—®é¢˜æ ¹æºï¼šC++ä¸ä¿è¯å†…ç½®ç±»å‹çš„åˆå§‹åŒ–</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©ï¼šæœªåˆå§‹åŒ–çš„å†…ç½®ç±»å‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateUninitializedBuiltins</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x;              <span class="comment">// æœªåˆå§‹åŒ–ï¼åŒ…å«åƒåœ¾å€¼</span></span><br><span class="line">    <span class="type">double</span> y;           <span class="comment">// æœªåˆå§‹åŒ–ï¼åŒ…å«åƒåœ¾å€¼</span></span><br><span class="line">    <span class="type">char</span>* ptr;          <span class="comment">// æœªåˆå§‹åŒ–ï¼å¯èƒ½æŒ‡å‘ä»»ä½•åœ°æ–¹</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡ï¼šæœªå®šä¹‰è¡Œä¸º</span></span><br><span class="line">    <span class="comment">// std::cout &lt;&lt; x &lt;&lt; std::endl;  // å±é™©ï¼</span></span><br><span class="line">    <span class="comment">// if (ptr != nullptr) &#123; ... &#125;   // å±é™©ï¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šæ‰‹å·¥åˆå§‹åŒ–å†…ç½®ç±»å‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProperInitialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>;                          <span class="comment">// ç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">    <span class="type">double</span> y&#123;<span class="number">0.0</span>&#125;;                      <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–ï¼ˆC++11ï¼‰</span></span><br><span class="line">    <span class="type">char</span>* ptr = <span class="literal">nullptr</span>;                <span class="comment">// ç©ºæŒ‡é’ˆåˆå§‹åŒ–</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="type">int</span> arr1[<span class="number">10</span>] = &#123;&#125;;                  <span class="comment">// å…¨éƒ¨åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    <span class="type">int</span> arr2[<span class="number">10</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;          <span class="comment">// å‰3ä¸ªæŒ‡å®šå€¼ï¼Œå…¶ä½™ä¸º0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// C++11ç»Ÿä¸€åˆå§‹åŒ–</span></span><br><span class="line">    <span class="type">int</span> z&#123;<span class="number">42</span>&#125;;                          <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–ï¼Œé˜²æ­¢çª„åŒ–è½¬æ¢</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;  <span class="comment">// å®¹å™¨çš„åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆå§‹åŒ– vs èµ‹å€¼çš„æ€§èƒ½å·®å¼‚ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">performanceComparison</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// âŒ ä½æ•ˆï¼šå…ˆé»˜è®¤åˆå§‹åŒ–ï¼Œå†èµ‹å€¼</span></span><br><span class="line">    std::string name;           <span class="comment">// é»˜è®¤æ„é€ </span></span><br><span class="line">    name = <span class="string">&quot;John Doe&quot;</span>;          <span class="comment">// èµ‹å€¼æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… é«˜æ•ˆï¼šç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">    <span class="function">std::string <span class="title">name2</span><span class="params">(<span class="string">&quot;John Doe&quot;</span>)</span></span>;     <span class="comment">// ç›´æ¥æ„é€ </span></span><br><span class="line">    std::string name3&#123;<span class="string">&quot;Jane Doe&quot;</span>&#125;;     <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„ä¼˜åŠ¿"><a href="#2-æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„ä¼˜åŠ¿" class="headerlink" title="2. æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„ä¼˜åŠ¿"></a>2. <strong>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„ä¼˜åŠ¿</strong></h4><p><strong>åŸºæœ¬æ¦‚å¿µï¼šåˆå§‹åŒ– vs èµ‹å€¼</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    <span class="type">int</span> age_;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> id_;              <span class="comment">// constæˆå‘˜å¿…é¡»åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–</span></span><br><span class="line">    std::string&amp; nickname_;     <span class="comment">// å¼•ç”¨æˆå‘˜å¿…é¡»åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯åšæ³•ï¼šåœ¨æ„é€ å‡½æ•°ä½“å†…èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> age, <span class="type">int</span> id, std::string&amp; nick) </span><br><span class="line">        : <span class="built_in">id_</span>(id), <span class="built_in">nickname_</span>(nick) &#123;  <span class="comment">// constå’Œå¼•ç”¨æˆå‘˜å¿…é¡»åœ¨è¿™é‡Œåˆå§‹åŒ–</span></span><br><span class="line">        name_ = name;                 <span class="comment">// è¿™æ˜¯èµ‹å€¼ï¼Œä¸æ˜¯åˆå§‹åŒ–ï¼</span></span><br><span class="line">        age_ = age;                   <span class="comment">// è¿™æ˜¯èµ‹å€¼ï¼Œä¸æ˜¯åˆå§‹åŒ–ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> age, <span class="type">int</span> id, std::string&amp; nick)</span><br><span class="line">        : <span class="built_in">name_</span>(name),          <span class="comment">// åˆå§‹åŒ–ï¼Œç›´æ¥è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">          <span class="built_in">age_</span>(age),            <span class="comment">// åˆå§‹åŒ–ï¼Œç›´æ¥èµ‹å€¼</span></span><br><span class="line">          <span class="built_in">id_</span>(id),              <span class="comment">// constæˆå‘˜çš„å”¯ä¸€åˆå§‹åŒ–æ–¹å¼</span></span><br><span class="line">          <span class="built_in">nickname_</span>(nick) &#123;     <span class="comment">// å¼•ç”¨æˆå‘˜çš„å”¯ä¸€åˆå§‹åŒ–æ–¹å¼</span></span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°ä½“å¯ä»¥ä¸ºç©ºï¼Œæˆ–åŒ…å«å…¶ä»–é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ€§èƒ½åˆ†æï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExpensiveObject</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExpensiveObject</span>() &#123; </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Default constructor called\n&quot;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ExpensiveObject</span>(<span class="type">const</span> std::string&amp; data) : <span class="built_in">data_</span>(data) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Parameterized constructor called\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ExpensiveObject</span>(<span class="type">const</span> ExpensiveObject&amp; other) : <span class="built_in">data_</span>(other.data_) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Copy constructor called\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ExpensiveObject&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ExpensiveObject&amp; other) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Assignment operator called\n&quot;</span>;</span><br><span class="line">        data_ = other.data_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ExpensiveObject obj_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ ä½æ•ˆç‰ˆæœ¬ï¼šå…ˆé»˜è®¤æ„é€ ï¼Œå†èµ‹å€¼</span></span><br><span class="line">    <span class="built_in">Container</span>(<span class="type">const</span> ExpensiveObject&amp; obj) &#123;</span><br><span class="line">        obj_ = obj;  <span class="comment">// è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° + èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… é«˜æ•ˆç‰ˆæœ¬ï¼šç›´æ¥åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">Container</span>(<span class="type">const</span> ExpensiveObject&amp; obj) : <span class="built_in">obj_</span>(obj) &#123;</span><br><span class="line">        <span class="comment">// åªè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-æˆå‘˜åˆå§‹åŒ–é¡ºåºçš„é‡è¦æ€§"><a href="#3-æˆå‘˜åˆå§‹åŒ–é¡ºåºçš„é‡è¦æ€§" class="headerlink" title="3. æˆå‘˜åˆå§‹åŒ–é¡ºåºçš„é‡è¦æ€§"></a>3. <strong>æˆå‘˜åˆå§‹åŒ–é¡ºåºçš„é‡è¦æ€§</strong></h4><p><strong>è§„åˆ™ï¼šæˆå‘˜åˆå§‹åŒ–é¡ºåºç”±å£°æ˜é¡ºåºå†³å®š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OrderMatters</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> first_;</span><br><span class="line">    <span class="type">int</span> second_;</span><br><span class="line">    <span class="type">int</span> third_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ æ··ä¹±çš„åˆå§‹åŒ–é¡ºåºï¼ˆè™½ç„¶èƒ½ç¼–è¯‘ï¼Œä½†å®¹æ˜“è¯¯å¯¼ï¼‰</span></span><br><span class="line">    <span class="built_in">OrderMatters</span>(<span class="type">int</span> val) </span><br><span class="line">        : <span class="built_in">third_</span>(val),          <span class="comment">// å®é™…ç¬¬ä¸‰ä¸ªåˆå§‹åŒ–</span></span><br><span class="line">          <span class="built_in">first_</span>(val),          <span class="comment">// å®é™…ç¬¬ä¸€ä¸ªåˆå§‹åŒ–</span></span><br><span class="line">          <span class="built_in">second_</span>(first_ + <span class="number">1</span>) &#123; <span class="comment">// å®é™…ç¬¬äºŒä¸ªåˆå§‹åŒ–ï¼Œä½¿ç”¨å·²åˆå§‹åŒ–çš„first_</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šæŒ‰å£°æ˜é¡ºåºåˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">OrderMatters</span>(<span class="type">int</span> val)</span><br><span class="line">        : <span class="built_in">first_</span>(val),          <span class="comment">// ç¬¬ä¸€ä¸ªåˆå§‹åŒ–</span></span><br><span class="line">          <span class="built_in">second_</span>(first_ + <span class="number">1</span>),  <span class="comment">// ç¬¬äºŒä¸ªåˆå§‹åŒ–ï¼Œå®‰å…¨ä½¿ç”¨first_</span></span><br><span class="line">          <span class="built_in">third_</span>(second_ * <span class="number">2</span>) &#123; <span class="comment">// ç¬¬ä¸‰ä¸ªåˆå§‹åŒ–ï¼Œå®‰å…¨ä½¿ç”¨second_</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DangerousOrder</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> size_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ å±é™©ï¼šä½¿ç”¨æœªåˆå§‹åŒ–çš„æˆå‘˜</span></span><br><span class="line">    <span class="built_in">DangerousOrder</span>(<span class="type">int</span> s) </span><br><span class="line">        : <span class="built_in">data_</span>(size_, <span class="number">0</span>),      <span class="comment">// size_è¿˜æœªåˆå§‹åŒ–ï¼æœªå®šä¹‰è¡Œä¸º</span></span><br><span class="line">          <span class="built_in">size_</span>(s) &#123;            <span class="comment">// size_åœ¨data_ä¹‹åæ‰åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®‰å…¨ï¼šé‡æ–°æ’åˆ—å£°æ˜é¡ºåºï¼Œæˆ–ä½¿ç”¨å‚æ•°</span></span><br><span class="line">    <span class="built_in">DangerousOrder</span>(<span class="type">int</span> s)</span><br><span class="line">        : <span class="built_in">size_</span>(s),             <span class="comment">// å…ˆåˆå§‹åŒ–size_</span></span><br><span class="line">          <span class="built_in">data_</span>(size_, <span class="number">0</span>) &#123;     <span class="comment">// å†ä½¿ç”¨size_åˆå§‹åŒ–data_</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ–è€…ç›´æ¥ä½¿ç”¨å‚æ•°</span></span><br><span class="line">    <span class="built_in">DangerousOrder</span>(<span class="type">int</span> s)</span><br><span class="line">        : <span class="built_in">size_</span>(s),</span><br><span class="line">          <span class="built_in">data_</span>(s, <span class="number">0</span>) &#123;         <span class="comment">// ç›´æ¥ä½¿ç”¨å‚æ•°s</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-ä¸åŒç±»å‹å¯¹è±¡çš„åˆå§‹åŒ–ç­–ç•¥"><a href="#4-ä¸åŒç±»å‹å¯¹è±¡çš„åˆå§‹åŒ–ç­–ç•¥" class="headerlink" title="4. ä¸åŒç±»å‹å¯¹è±¡çš„åˆå§‹åŒ–ç­–ç•¥"></a>4. <strong>ä¸åŒç±»å‹å¯¹è±¡çš„åˆå§‹åŒ–ç­–ç•¥</strong></h4><p><strong>åŸºæœ¬ç±»å‹å’Œç®€å•å¯¹è±¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BasicTypes</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> count_;</span><br><span class="line">    <span class="type">double</span> ratio_;</span><br><span class="line">    <span class="type">bool</span> flag_;</span><br><span class="line">    <span class="type">char</span> buffer_[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… ç›´æ¥åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">BasicTypes</span>() </span><br><span class="line">        : <span class="built_in">count_</span>(<span class="number">0</span>),</span><br><span class="line">          <span class="built_in">ratio_</span>(<span class="number">1.0</span>),</span><br><span class="line">          <span class="built_in">flag_</span>(<span class="literal">false</span>),</span><br><span class="line">          buffer_&#123;&#125; &#123;           <span class="comment">// æ•°ç»„åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å‚æ•°åŒ–æ„é€ </span></span><br><span class="line">    <span class="built_in">BasicTypes</span>(<span class="type">int</span> count, <span class="type">double</span> ratio, <span class="type">bool</span> flag)</span><br><span class="line">        : <span class="built_in">count_</span>(count),</span><br><span class="line">          <span class="built_in">ratio_</span>(ratio),</span><br><span class="line">          <span class="built_in">flag_</span>(flag),</span><br><span class="line">          buffer_&#123;&#125; &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å®¹å™¨å’Œå¤æ‚å¯¹è±¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexTypes</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; numbers_;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; scores_;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; ptr_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… å®¹å™¨çš„é«˜æ•ˆåˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">ComplexTypes</span>() </span><br><span class="line">        : numbers_&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;,              <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">          scores_&#123;&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">95</span>&#125;, &#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">87</span>&#125;&#125;,  <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">          <span class="built_in">ptr_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">42</span>)) &#123;     <span class="comment">// æ™ºèƒ½æŒ‡é’ˆåˆå§‹åŒ– (C++14)</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ä»å‚æ•°åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">ComplexTypes</span>(<span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; nums)</span><br><span class="line">        : <span class="built_in">numbers_</span>(nums),                       <span class="comment">// æ‹·è´æ„é€ </span></span><br><span class="line">          <span class="built_in">scores_</span>(),                            <span class="comment">// é»˜è®¤æ„é€ </span></span><br><span class="line">          <span class="built_in">ptr_</span>(<span class="literal">nullptr</span>) &#123;                       <span class="comment">// æ˜ç¡®åˆå§‹åŒ–ä¸ºnullptr</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç§»åŠ¨æ„é€ ç‰ˆæœ¬</span></span><br><span class="line">    <span class="built_in">ComplexTypes</span>(std::vector&lt;<span class="type">int</span>&gt;&amp;&amp; nums)</span><br><span class="line">        : <span class="built_in">numbers_</span>(std::<span class="built_in">move</span>(nums)),            <span class="comment">// ç§»åŠ¨æ„é€ </span></span><br><span class="line">          <span class="built_in">scores_</span>(),</span><br><span class="line">          <span class="built_in">ptr_</span>(<span class="literal">nullptr</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-è§£å†³è·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–é¡ºåºé—®é¢˜"><a href="#5-è§£å†³è·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–é¡ºåºé—®é¢˜" class="headerlink" title="5. è§£å†³è·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–é¡ºåºé—®é¢˜"></a>5. <strong>è§£å†³è·¨ç¼–è¯‘å•å…ƒçš„åˆå§‹åŒ–é¡ºåºé—®é¢˜</strong></h4><p><strong>é—®é¢˜æè¿°ï¼šé™æ€å¯¹è±¡åˆå§‹åŒ–é¡ºåºä¸ç¡®å®š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// File1.cpp</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystem</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">createDirectory</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç›®å½•çš„å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">FileSystem theFileSystem;  <span class="comment">// å…¨å±€å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// File2.cpp  </span></span><br><span class="line"><span class="keyword">extern</span> FileSystem theFileSystem;  <span class="comment">// å£°æ˜å¤–éƒ¨å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Directory</span>(<span class="type">const</span> std::string&amp; name) &#123;</span><br><span class="line">        theFileSystem.<span class="built_in">createDirectory</span>(name);  <span class="comment">// å¯èƒ½åœ¨theFileSystemåˆå§‹åŒ–å‰è°ƒç”¨ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Directory <span class="title">tempDir</span><span class="params">(<span class="string">&quot;/tmp&quot;</span>)</span></span>;  <span class="comment">// å…¨å±€å¯¹è±¡ï¼Œå¯èƒ½åœ¨theFileSystemä¹‹å‰åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure>

<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼šLocal Staticå¯¹è±¡</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä½¿ç”¨å‡½æ•°å†…çš„staticå¯¹è±¡ä¿è¯åˆå§‹åŒ–é¡ºåº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystem</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">createDirectory</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">FileSystem&amp; <span class="title">theFileSystem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> FileSystem fs;   <span class="comment">// local staticå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> fs;              <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–ï¼Œä¹‹åç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Directory</span>(<span class="type">const</span> std::string&amp; name) &#123;</span><br><span class="line">        <span class="built_in">theFileSystem</span>().<span class="built_in">createDirectory</span>(name);  <span class="comment">// å®‰å…¨ï¼šç¡®ä¿fså·²åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Directory&amp; <span class="title">tempDir</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> Directory <span class="title">dir</span><span class="params">(<span class="string">&quot;/tmp&quot;</span>)</span></span>;  <span class="comment">// ä¹Ÿä½¿ç”¨local static</span></span><br><span class="line">    <span class="keyword">return</span> dir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å•ä¾‹æ¨¡å¼çš„æ­£ç¡®å®ç°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Singleton</span>() = <span class="keyword">default</span>;                      <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Singleton</span>(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;      <span class="comment">// ç¦æ­¢æ‹·è´</span></span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;  <span class="comment">// ç¦æ­¢èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Singleton&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> Singleton instance;              <span class="comment">// çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼ˆC++11ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">someFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Singleton::<span class="built_in">getInstance</span>().<span class="built_in">doSomething</span>();     <span class="comment">// å®‰å…¨è®¿é—®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-ç°ä»£C-çš„åˆå§‹åŒ–æŠ€æœ¯"><a href="#6-ç°ä»£C-çš„åˆå§‹åŒ–æŠ€æœ¯" class="headerlink" title="6. ç°ä»£C++çš„åˆå§‹åŒ–æŠ€æœ¯"></a>6. <strong>ç°ä»£C++çš„åˆå§‹åŒ–æŠ€æœ¯</strong></h4><p><strong>ç»Ÿä¸€åˆå§‹åŒ–è¯­æ³•ï¼ˆC++11ï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernInitialization</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">    std::vector&lt;<span class="type">double</span>&gt; data_;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; table_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… ä½¿ç”¨&#123;&#125;ç»Ÿä¸€åˆå§‹åŒ–è¯­æ³•</span></span><br><span class="line">    <span class="built_in">ModernInitialization</span>()</span><br><span class="line">        : value_&#123;<span class="number">42</span>&#125;,                           <span class="comment">// é˜²æ­¢çª„åŒ–è½¬æ¢</span></span><br><span class="line">          data_&#123;<span class="number">1.1</span>, <span class="number">2.2</span>, <span class="number">3.3</span>&#125;,               <span class="comment">// åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">          table_&#123;&#123;<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>&#125;, &#123;<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>&#125;&#125; &#123;   <span class="comment">// åµŒå¥—åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… é˜²æ­¢çª„åŒ–è½¬æ¢</span></span><br><span class="line">    <span class="built_in">ModernInitialization</span>(<span class="type">double</span> d)</span><br><span class="line">        : value_&#123;<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(d)&#125;,          <span class="comment">// æ˜¾å¼è½¬æ¢</span></span><br><span class="line">          data_&#123;d&#125;,</span><br><span class="line">          table_&#123;&#125; &#123;</span><br><span class="line">        <span class="comment">// int value_&#123;d&#125;;  // ç¼–è¯‘é”™è¯¯ï¼šçª„åŒ–è½¬æ¢</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DelegatingConstructor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_, z_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ä¸»æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">DelegatingConstructor</span>(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z) : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y), <span class="built_in">z_</span>(z) &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘</span></span><br><span class="line">        <span class="built_in">validate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å§”æ‰˜æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">DelegatingConstructor</span>() : <span class="built_in">DelegatingConstructor</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å§”æ‰˜ç»™ä¸»æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">DelegatingConstructor</span>(<span class="type">int</span> x) : <span class="built_in">DelegatingConstructor</span>(x, <span class="number">0</span>, <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å§”æ‰˜ç»™ä¸»æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">validate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x_ &lt; <span class="number">0</span> || y_ &lt; <span class="number">0</span> || z_ &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Values must be non-negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>é»˜è®¤æˆå‘˜åˆå§‹åŒ–ï¼ˆC++11ï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultMemberInitialization</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> count_ = <span class="number">0</span>;                             <span class="comment">// é»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line">    std::string name_ = <span class="string">&quot;Unknown&quot;</span>;              <span class="comment">// é»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;           <span class="comment">// é»˜è®¤åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">    <span class="type">bool</span> flag_&#123;<span class="literal">false</span>&#125;;                          <span class="comment">// é»˜è®¤åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">    <span class="built_in">DefaultMemberInitialization</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¦†ç›–éƒ¨åˆ†é»˜è®¤å€¼</span></span><br><span class="line">    <span class="built_in">DefaultMemberInitialization</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;</span><br><span class="line">        <span class="comment">// count_, data_, flag_ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¦†ç›–æ‰€æœ‰å€¼</span></span><br><span class="line">    <span class="built_in">DefaultMemberInitialization</span>(<span class="type">int</span> count, <span class="type">const</span> std::string&amp; name, <span class="type">bool</span> flag)</span><br><span class="line">        : <span class="built_in">count_</span>(count), <span class="built_in">name_</span>(name), <span class="built_in">flag_</span>(flag) &#123;</span><br><span class="line">        <span class="comment">// data_ä»ä½¿ç”¨é»˜è®¤å€¼&#123;1, 2, 3&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-ç‰¹æ®Šæƒ…å†µçš„å¤„ç†"><a href="#7-ç‰¹æ®Šæƒ…å†µçš„å¤„ç†" class="headerlink" title="7. ç‰¹æ®Šæƒ…å†µçš„å¤„ç†"></a>7. <strong>ç‰¹æ®Šæƒ…å†µçš„å¤„ç†</strong></h4><p><strong>constå’Œå¼•ç”¨æˆå‘˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConstAndRefMembers</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> id_;                  <span class="comment">// constæˆå‘˜</span></span><br><span class="line">    <span class="type">int</span>&amp; external_value_;           <span class="comment">// å¼•ç”¨æˆå‘˜</span></span><br><span class="line">    <span class="type">const</span> std::string&amp; name_;       <span class="comment">// constå¼•ç”¨æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å¿…é¡»åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–constå’Œå¼•ç”¨æˆå‘˜</span></span><br><span class="line">    <span class="built_in">ConstAndRefMembers</span>(<span class="type">int</span> id, <span class="type">int</span>&amp; ext_val, <span class="type">const</span> std::string&amp; name)</span><br><span class="line">        : <span class="built_in">id_</span>(id),                  <span class="comment">// constæˆå‘˜çš„å”¯ä¸€åˆå§‹åŒ–æœºä¼š</span></span><br><span class="line">          <span class="built_in">external_value_</span>(ext_val), <span class="comment">// å¼•ç”¨æˆå‘˜çš„å”¯ä¸€åˆå§‹åŒ–æœºä¼š</span></span><br><span class="line">          <span class="built_in">name_</span>(name) &#123;             <span class="comment">// constå¼•ç”¨æˆå‘˜çš„å”¯ä¸€åˆå§‹åŒ–æœºä¼š</span></span><br><span class="line">        <span class="comment">// åœ¨æ„é€ å‡½æ•°ä½“å†…æ— æ³•åˆå§‹åŒ–constå’Œå¼•ç”¨æˆå‘˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>åŸºç±»åˆå§‹åŒ–ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> base_value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Base</span>(<span class="type">int</span> value) : <span class="built_in">base_value_</span>(value) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base constructor called with &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getBaseValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> base_value_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> derived_value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… åŸºç±»å¿…é¡»åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">Derived</span>(<span class="type">int</span> base_val, <span class="type">double</span> derived_val)</span><br><span class="line">        : <span class="built_in">Base</span>(base_val),           <span class="comment">// åŸºç±»åˆå§‹åŒ–å¿…é¡»æ”¾åœ¨æœ€å‰é¢</span></span><br><span class="line">          <span class="built_in">derived_value_</span>(derived_val) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived constructor called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šä¸èƒ½åœ¨æ„é€ å‡½æ•°ä½“å†…åˆå§‹åŒ–åŸºç±»</span></span><br><span class="line">    <span class="comment">// Derived(int base_val, double derived_val) &#123;</span></span><br><span class="line">    <span class="comment">//     Base(base_val);  // é”™è¯¯ï¼</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>åˆå§‹åŒ–çš„ä¸‰ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š</strong></p>
<ol>
<li><strong>æ‰‹å·¥åˆå§‹åŒ–å†…ç½®ç±»å‹</strong>ï¼šC++ä¸ä¿è¯å†…ç½®ç±»å‹çš„åˆå§‹åŒ–</li>
<li><strong>ä¼˜å…ˆä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨</strong>ï¼šæ•ˆç‡æ›´é«˜ï¼ŒæŸäº›æƒ…å†µä¸‹æ˜¯å”¯ä¸€é€‰æ‹©</li>
<li><strong>è§£å†³é™æ€å¯¹è±¡åˆå§‹åŒ–é¡ºåº</strong>ï¼šä½¿ç”¨local staticå¯¹è±¡</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>æ€»æ˜¯åˆå§‹åŒ–å†…ç½®ç±»å‹å˜é‡</strong></li>
<li><strong>åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</strong></li>
<li><strong>æŒ‰æˆå‘˜å£°æ˜é¡ºåºç¼–å†™åˆå§‹åŒ–åˆ—è¡¨</strong></li>
<li><strong>ç”¨local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡</strong></li>
<li><strong>åˆ©ç”¨ç°ä»£C++çš„åˆå§‹åŒ–è¯­æ³•æé«˜ä»£ç å®‰å…¨æ€§</strong></li>
</ul>
<p><strong>è®°ä½ä¸‰ä¸ªè¦ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸ºå†…ç½®å‹å¯¹è±¡è¿›è¡Œæ‰‹å·¥åˆå§‹åŒ–ï¼Œå› ä¸ºC++ä¸ä¿è¯å®ƒä»¬</li>
<li>æ„é€ å‡½æ•°æœ€å¥½ä½¿ç”¨æˆå‘˜åˆå€¼åˆ—ï¼ˆmember initialization listï¼‰ï¼Œè€Œä¸è¦åœ¨æ„é€ å‡½æ•°æœ¬ä½“å†…ä½¿ç”¨èµ‹å€¼æ“ä½œã€‚åˆå€¼åˆ—åˆ—å‡ºçš„æˆå‘˜å˜é‡ï¼Œå…¶æ’åˆ—æ¬¡åºåº”è¯¥å’Œå®ƒä»¬åœ¨classä¸­çš„å£°æ˜æ¬¡åºç›¸åŒ  </li>
<li>ä¸ºå…é™¤â€è·¨ç¼–è¯‘å•å…ƒä¹‹åˆå§‹åŒ–æ¬¡åºé—®é¢˜â€ï¼Œè¯·ä»¥local staticå¯¹è±¡æ›¿æ¢non-local staticå¯¹è±¡</li>
</ul>
<h2 id="æ¡æ¬¾05ï¼š-äº†è§£C-é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨äº†å“ªäº›å‡½æ•°"><a href="#æ¡æ¬¾05ï¼š-äº†è§£C-é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨äº†å“ªäº›å‡½æ•°" class="headerlink" title="æ¡æ¬¾05ï¼š äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨äº†å“ªäº›å‡½æ•°"></a>æ¡æ¬¾05ï¼š äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨äº†å“ªäº›å‡½æ•°</h2><blockquote>
<p><em>Know what functions C++ silently writes and calls</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-4"><a href="#æ ¸å¿ƒç†å¿µ-4" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>å½“ä½ å£°æ˜ä¸€ä¸ªç©ºçš„classæ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¸ºä½ æš—è‡ªç”Ÿæˆå¤šä¸ªç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼š<strong>é»˜è®¤æ„é€ å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€ææ„å‡½æ•°</strong>ã€‚åœ¨C++11åŠä»¥åï¼Œè¿˜å¯èƒ½ç”Ÿæˆ<strong>ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</strong>ã€‚ç†è§£è¿™äº›å‡½æ•°çš„è‡ªåŠ¨ç”Ÿæˆè§„åˆ™ã€è¡Œä¸ºç‰¹ç‚¹ä»¥åŠæ½œåœ¨é—®é¢˜ï¼Œæ˜¯æ§åˆ¶ç±»è¡Œä¸ºå’Œé¿å…æ„å¤–é”™è¯¯çš„å…³é”®ã€‚</p>
<h3 id="æ·±åº¦è§£æ-4"><a href="#æ·±åº¦è§£æ-4" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„å‡½æ•°"><a href="#1-ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„å‡½æ•°" class="headerlink" title="1. ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„å‡½æ•°"></a>1. <strong>ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„å‡½æ•°</strong></h4><p><strong>åŸºæœ¬çš„ç©ºç±»ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çœ‹ä¼¼ç©ºçš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨å®é™…ç”Ÿæˆçš„ç­‰ä»·ä»£ç ï¼ˆC++98/03ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Empty</span>() &#123;&#125;                              <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Empty</span>(<span class="type">const</span> Empty&amp; rhs) &#123;&#125;              <span class="comment">// æ‹·è´æ„é€ å‡½æ•°  </span></span><br><span class="line">    ~<span class="built_in">Empty</span>() &#123;&#125;                             <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    Empty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Empty&amp; rhs) &#123;&#125;   <span class="comment">// æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++11åŠä»¥åï¼Œå¯èƒ½è¿˜ä¼šç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Empty</span>() &#123;&#125;                              <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Empty</span>(<span class="type">const</span> Empty&amp; rhs) &#123;&#125;              <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Empty</span>(Empty&amp;&amp; rhs) &#123;&#125;                   <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">Empty</span>() &#123;&#125;                             <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    Empty&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Empty&amp; rhs) &#123;&#125;   <span class="comment">// æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Empty&amp; <span class="keyword">operator</span>=(Empty&amp;&amp; rhs) &#123;&#125;        <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆæ¡ä»¶ï¼šåªæœ‰åœ¨è¢«è°ƒç”¨æ—¶æ‰ç”Ÿæˆ</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Empty</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Empty e1;           <span class="comment">// è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° â†’ ç”Ÿæˆ</span></span><br><span class="line">    <span class="function">Empty <span class="title">e2</span><span class="params">(e1)</span></span>;       <span class="comment">// è°ƒç”¨æ‹·è´æ„é€ å‡½æ•° â†’ ç”Ÿæˆ</span></span><br><span class="line">    e2 = e1;            <span class="comment">// è°ƒç”¨æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ â†’ ç”Ÿæˆ</span></span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸç»“æŸæ—¶è°ƒç”¨ææ„å‡½æ•° â†’ ç”Ÿæˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-é»˜è®¤æ„é€ å‡½æ•°çš„ç”Ÿæˆè§„åˆ™"><a href="#2-é»˜è®¤æ„é€ å‡½æ•°çš„ç”Ÿæˆè§„åˆ™" class="headerlink" title="2. é»˜è®¤æ„é€ å‡½æ•°çš„ç”Ÿæˆè§„åˆ™"></a>2. <strong>é»˜è®¤æ„é€ å‡½æ•°çš„ç”Ÿæˆè§„åˆ™</strong></h4><p><strong>ä½•æ—¶ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼šæ²¡æœ‰ä»»ä½•æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HasDefaultCtor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;     <span class="comment">// æ³¨æ„ï¼šæˆå‘˜å˜é‡æœªåˆå§‹åŒ–ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼šå·²å£°æ˜å…¶ä»–æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoDefaultCtor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NoDefaultCtor</span>(<span class="type">int</span> val) : <span class="built_in">value_</span>(val) &#123;&#125;  <span class="comment">// è‡ªå®šä¹‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¸å†ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testConstructors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HasDefaultCtor h1;          <span class="comment">// âœ… ç¼–è¯‘æˆåŠŸï¼Œè°ƒç”¨ç”Ÿæˆçš„é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="comment">// NoDefaultCtor n1;        // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function">NoDefaultCtor <span class="title">n2</span><span class="params">(<span class="number">42</span>)</span></span>;       <span class="comment">// âœ… ç¼–è¯‘æˆåŠŸï¼Œè°ƒç”¨è‡ªå®šä¹‰æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é»˜è®¤æ„é€ å‡½æ•°çš„è¡Œä¸ºï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultBehavior</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> primitive_;             <span class="comment">// å†…ç½®ç±»å‹ï¼šæœªåˆå§‹åŒ–ï¼</span></span><br><span class="line">    std::string object_;        <span class="comment">// å¯¹è±¡ç±»å‹ï¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; container_; <span class="comment">// å®¹å™¨ï¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼ˆç©ºå®¹å™¨ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æ„é€ å‡½æ•°ç­‰ä»·äºï¼š</span></span><br><span class="line">    <span class="comment">// DefaultBehavior() : object_(), container_() &#123;</span></span><br><span class="line">    <span class="comment">//     // primitive_ æœªåˆå§‹åŒ–ï¼</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDefaultBehavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DefaultBehavior obj;</span><br><span class="line">    <span class="comment">// obj.primitive_ åŒ…å«åƒåœ¾å€¼ï¼</span></span><br><span class="line">    <span class="comment">// obj.object_ æ˜¯ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// obj.container_ æ˜¯ç©ºvector</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ‹·è´æ„é€ å‡½æ•°çš„é»˜è®¤è¡Œä¸º"><a href="#3-æ‹·è´æ„é€ å‡½æ•°çš„é»˜è®¤è¡Œä¸º" class="headerlink" title="3. æ‹·è´æ„é€ å‡½æ•°çš„é»˜è®¤è¡Œä¸º"></a>3. <strong>æ‹·è´æ„é€ å‡½æ•°çš„é»˜è®¤è¡Œä¸º</strong></h4><p><strong>æˆå‘˜é€ä¸€æ‹·è´ï¼ˆmemberwise copyï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> x_, y_;</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> x, <span class="type">double</span> y, <span class="type">const</span> std::string&amp; name) </span><br><span class="line">        : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y), <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´æ„é€ å‡½æ•°ç­‰ä»·äºï¼š</span></span><br><span class="line">    <span class="comment">// Point(const Point&amp; other) </span></span><br><span class="line">    <span class="comment">//     : x_(other.x_),           // å†…ç½®ç±»å‹ï¼šæŒ‰ä½æ‹·è´</span></span><br><span class="line">    <span class="comment">//       y_(other.y_),           // å†…ç½®ç±»å‹ï¼šæŒ‰ä½æ‹·è´  </span></span><br><span class="line">    <span class="comment">//       name_(other.name_) &#123;&#125;   // å¯¹è±¡ï¼šè°ƒç”¨stringçš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testCopyCtor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Point <span class="title">p1</span><span class="params">(<span class="number">3.0</span>, <span class="number">4.0</span>, <span class="string">&quot;Origin&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Point <span class="title">p2</span><span class="params">(p1)</span></span>;                   <span class="comment">// è°ƒç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="comment">// p2.x_ == 3.0, p2.y_ == 4.0, p2.name_ == &quot;Origin&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŒ…å«æŒ‡é’ˆæˆå‘˜çš„é—®é¢˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DangerousClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DangerousClass</span>(<span class="type">const</span> <span class="type">char</span>* str) &#123;</span><br><span class="line">        size_ = <span class="built_in">strlen</span>(str);</span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">char</span>[size_ + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">strcpy</span>(data_, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">DangerousClass</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´æ„é€ å‡½æ•°ä¼šå¯¼è‡´é—®é¢˜ï¼š</span></span><br><span class="line">    <span class="comment">// DangerousClass(const DangerousClass&amp; other)</span></span><br><span class="line">    <span class="comment">//     : data_(other.data_),     // æµ…æ‹·è´ï¼ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€å†…å­˜</span></span><br><span class="line">    <span class="comment">//       size_(other.size_) &#123;&#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateShallowCopy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">DangerousClass <span class="title">obj1</span><span class="params">(<span class="string">&quot;Hello&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">DangerousClass <span class="title">obj2</span><span class="params">(obj1)</span></span>;      <span class="comment">// æµ…æ‹·è´ï¼šä¸¤ä¸ªå¯¹è±¡å…±äº«åŒä¸€data_</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸç»“æŸæ—¶ï¼š</span></span><br><span class="line">    <span class="comment">// 1. obj2ææ„ï¼Œdelete[] data_</span></span><br><span class="line">    <span class="comment">// 2. obj1ææ„ï¼Œå†æ¬¡delete[] data_ â†’ æœªå®šä¹‰è¡Œä¸ºï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„é»˜è®¤è¡Œä¸º"><a href="#4-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„é»˜è®¤è¡Œä¸º" class="headerlink" title="4. æ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„é»˜è®¤è¡Œä¸º"></a>4. <strong>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„é»˜è®¤è¡Œä¸º</strong></h4><p><strong>åŸºæœ¬çš„æˆå‘˜é€ä¸€èµ‹å€¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">    std::string text_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SimpleClass</span>(<span class="type">int</span> val, <span class="type">const</span> std::string&amp; text) : <span class="built_in">value_</span>(val), <span class="built_in">text_</span>(text) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ç­‰ä»·äºï¼š</span></span><br><span class="line">    <span class="comment">// SimpleClass&amp; operator=(const SimpleClass&amp; rhs) &#123;</span></span><br><span class="line">    <span class="comment">//     value_ = rhs.value_;    // å†…ç½®ç±»å‹ï¼šç›´æ¥èµ‹å€¼</span></span><br><span class="line">    <span class="comment">//     text_ = rhs.text_;      // å¯¹è±¡ï¼šè°ƒç”¨stringçš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="comment">//     return *this;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ç¼–è¯‘å™¨æ‹’ç»ç”Ÿæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„æƒ…å†µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CannotAssign</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> id_;              <span class="comment">// constæˆå‘˜</span></span><br><span class="line">    std::string&amp; name_ref_;     <span class="comment">// å¼•ç”¨æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CannotAssign</span>(<span class="type">int</span> id, std::string&amp; name) : <span class="built_in">id_</span>(id), <span class="built_in">name_ref_</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨æ— æ³•ç”Ÿæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œå› ä¸ºï¼š</span></span><br><span class="line">    <span class="comment">// 1. constæˆå‘˜ä¸èƒ½è¢«èµ‹å€¼</span></span><br><span class="line">    <span class="comment">// 2. å¼•ç”¨ä¸èƒ½è¢«é‡æ–°èµ‹å€¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testCannotAssign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string name1 = <span class="string">&quot;Alice&quot;</span>;</span><br><span class="line">    std::string name2 = <span class="string">&quot;Bob&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">CannotAssign <span class="title">obj1</span><span class="params">(<span class="number">1</span>, name1)</span></span>;</span><br><span class="line">    <span class="function">CannotAssign <span class="title">obj2</span><span class="params">(<span class="number">2</span>, name2)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// obj1 = obj2;  // ç¼–è¯‘é”™è¯¯ï¼šæ²¡æœ‰æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŒ…å«ä¸å¯èµ‹å€¼æˆå‘˜çš„ç±»ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NonAssignable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    NonAssignable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonAssignable&amp;) = <span class="keyword">delete</span>;  <span class="comment">// æ˜¾å¼ç¦æ­¢èµ‹å€¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ContainsNonAssignable</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    NonAssignable member_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨æ— æ³•ç”Ÿæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œå› ä¸ºmember_ä¸å¯èµ‹å€¼</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-ææ„å‡½æ•°çš„é»˜è®¤è¡Œä¸º"><a href="#5-ææ„å‡½æ•°çš„é»˜è®¤è¡Œä¸º" class="headerlink" title="5. ææ„å‡½æ•°çš„é»˜è®¤è¡Œä¸º"></a>5. <strong>ææ„å‡½æ•°çš„é»˜è®¤è¡Œä¸º</strong></h4><p><strong>åŸºæœ¬çš„éè™šææ„å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string text_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; numbers_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ææ„å‡½æ•°ç­‰ä»·äºï¼š</span></span><br><span class="line">    <span class="comment">// ~SimpleClass() &#123;</span></span><br><span class="line">    <span class="comment">//     // 1. æ‰§è¡Œæ„é€ å‡½æ•°ä½“ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span></span><br><span class="line">    <span class="comment">//     // 2. æŒ‰å£°æ˜é¡ºåºçš„é€†åºé”€æ¯æˆå‘˜ï¼š</span></span><br><span class="line">    <span class="comment">//     //    numbers_.~vector();</span></span><br><span class="line">    <span class="comment">//     //    text_.~string();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ææ„å‡½æ•°çš„éè™šæ€§è´¨é—®é¢˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ææ„å‡½æ•°æ˜¯éè™šçš„ï¼</span></span><br><span class="line">    <span class="comment">// ~Base() &#123;&#125;  // éè™šææ„å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;  <span class="comment">// éœ€è¦æ­£ç¡®ææ„çš„æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ~Derived() &#123;</span></span><br><span class="line">    <span class="comment">//     // é”€æ¯data_</span></span><br><span class="line">    <span class="comment">//     // è°ƒç”¨Base::~Base()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDestructorProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Base* ptr = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">    <span class="keyword">delete</span> ptr;  <span class="comment">// å±é™©ï¼åªè°ƒç”¨Base::~Base()ï¼Œä¸è°ƒç”¨Derived::~Derived()</span></span><br><span class="line">                 <span class="comment">// å¯¼è‡´data_æœªè¢«æ­£ç¡®é”€æ¯ï¼Œå¯èƒ½å†…å­˜æ³„æ¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-C-11çš„ç§»åŠ¨è¯­ä¹‰æ”¯æŒ"><a href="#6-C-11çš„ç§»åŠ¨è¯­ä¹‰æ”¯æŒ" class="headerlink" title="6. C++11çš„ç§»åŠ¨è¯­ä¹‰æ”¯æŒ"></a>6. <strong>C++11çš„ç§»åŠ¨è¯­ä¹‰æ”¯æŒ</strong></h4><p><strong>ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦çš„ç”Ÿæˆæ¡ä»¶ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MoveCapable</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; numbers_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MoveCapable</span>(std::string data) : <span class="built_in">data_</span>(std::<span class="built_in">move</span>(data)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C++11ç¼–è¯‘å™¨å¯èƒ½ç”Ÿæˆï¼š</span></span><br><span class="line">    <span class="comment">// MoveCapable(MoveCapable&amp;&amp; other) noexcept</span></span><br><span class="line">    <span class="comment">//     : data_(std::move(other.data_)),</span></span><br><span class="line">    <span class="comment">//       numbers_(std::move(other.numbers_)) &#123;&#125;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// MoveCapable&amp; operator=(MoveCapable&amp;&amp; other) noexcept &#123;</span></span><br><span class="line">    <span class="comment">//     data_ = std::move(other.data_);</span></span><br><span class="line">    <span class="comment">//     numbers_ = std::move(other.numbers_);</span></span><br><span class="line">    <span class="comment">//     return *this;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ç§»åŠ¨è¯­ä¹‰çš„ç”Ÿæˆè§„åˆ™ï¼ˆRule of Zero&#x2F;Three&#x2F;Fiveï¼‰ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rule of Zeroï¼šå°½é‡ä¸å®šä¹‰ä»»ä½•ç‰¹æ®Šæˆå‘˜å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RuleOfZero</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; ptr_;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯æ­£ç¡®çš„</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rule of Threeï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰ææ„å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°æˆ–æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ä¸­çš„ä¸€ä¸ªï¼Œ</span></span><br><span class="line"><span class="comment">// é€šå¸¸éœ€è¦è‡ªå®šä¹‰æ‰€æœ‰ä¸‰ä¸ª</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RuleOfThree</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">RuleOfThree</span>(<span class="type">const</span> <span class="type">char</span>* str) &#123;</span><br><span class="line">        size_ = <span class="built_in">strlen</span>(str);</span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">char</span>[size_ + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">strcpy</span>(data_, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è‡ªå®šä¹‰ææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">RuleOfThree</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">RuleOfThree</span>(<span class="type">const</span> RuleOfThree&amp; other) : <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">char</span>[size_ + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">strcpy</span>(data_, other.data_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è‡ªå®šä¹‰æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    RuleOfThree&amp; <span class="keyword">operator</span>=(<span class="type">const</span> RuleOfThree&amp; other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            <span class="keyword">delete</span>[] data_;</span><br><span class="line">            size_ = other.size_;</span><br><span class="line">            data_ = <span class="keyword">new</span> <span class="type">char</span>[size_ + <span class="number">1</span>];</span><br><span class="line">            <span class="built_in">strcpy</span>(data_, other.data_);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rule of Fiveï¼šC++11ä¸­ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰ä¸Šè¿°ä¸‰ä¸ªï¼Œé€šå¸¸ä¹Ÿéœ€è¦è‡ªå®šä¹‰ç§»åŠ¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RuleOfFive</span> : <span class="keyword">public</span> RuleOfThree &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> RuleOfThree::RuleOfThree;  <span class="comment">// ç»§æ‰¿æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">RuleOfFive</span>(RuleOfFive&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">data_</span>(other.data_), <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        other.data_ = <span class="literal">nullptr</span>;</span><br><span class="line">        other.size_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    RuleOfFive&amp; <span class="keyword">operator</span>=(RuleOfFive&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            <span class="keyword">delete</span>[] data_;</span><br><span class="line">            data_ = other.data_;</span><br><span class="line">            size_ = other.size_;</span><br><span class="line">            other.data_ = <span class="literal">nullptr</span>;</span><br><span class="line">            other.size_ = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-æ§åˆ¶é»˜è®¤å‡½æ•°çš„ç”Ÿæˆ"><a href="#7-æ§åˆ¶é»˜è®¤å‡½æ•°çš„ç”Ÿæˆ" class="headerlink" title="7. æ§åˆ¶é»˜è®¤å‡½æ•°çš„ç”Ÿæˆ"></a>7. <strong>æ§åˆ¶é»˜è®¤å‡½æ•°çš„ç”Ÿæˆ</strong></h4><p><strong>ä½¿ç”¨<code>= default</code>æ˜¾å¼è¦æ±‚ç”Ÿæˆï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExplicitDefault</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExplicitDefault</span>() = <span class="keyword">default</span>;                    <span class="comment">// æ˜¾å¼è¦æ±‚é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ExplicitDefault</span>(<span class="type">const</span> ExplicitDefault&amp;) = <span class="keyword">default</span>;  <span class="comment">// æ˜¾å¼è¦æ±‚æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    ExplicitDefault&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ExplicitDefault&amp;) = <span class="keyword">default</span>;  <span class="comment">// æ˜¾å¼è¦æ±‚æ‹·è´èµ‹å€¼</span></span><br><span class="line">    ~<span class="built_in">ExplicitDefault</span>() = <span class="keyword">default</span>;                   <span class="comment">// æ˜¾å¼è¦æ±‚ææ„å‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨<code>= delete</code>ç¦æ­¢ç”Ÿæˆï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NonCopyable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NonCopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´å’Œèµ‹å€¼</span></span><br><span class="line">    <span class="built_in">NonCopyable</span>(<span class="type">const</span> NonCopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    NonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonCopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…è®¸ç§»åŠ¨ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">    <span class="built_in">NonCopyable</span>(NonCopyable&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    NonCopyable&amp; <span class="keyword">operator</span>=(NonCopyable&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">NonCopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testNonCopyable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    NonCopyable obj1;</span><br><span class="line">    <span class="comment">// NonCopyable obj2(obj1);     // ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´æ„é€ å‡½æ•°è¢«åˆ é™¤</span></span><br><span class="line">    <span class="comment">// obj1 = NonCopyable&#123;&#125;;       // ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´èµ‹å€¼è¿ç®—ç¬¦è¢«åˆ é™¤</span></span><br><span class="line">    </span><br><span class="line">    NonCopyable obj3 = std::<span class="built_in">move</span>(obj1);  <span class="comment">// âœ… ç§»åŠ¨æ„é€ å¯ä»¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-å®é™…åº”ç”¨å»ºè®®"><a href="#8-å®é™…åº”ç”¨å»ºè®®" class="headerlink" title="8. å®é™…åº”ç”¨å»ºè®®"></a>8. <strong>å®é™…åº”ç”¨å»ºè®®</strong></h4><p><strong>ä¼˜å…ˆä½¿ç”¨Rule of Zeroï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èï¼šä½¿ç”¨RAIIå’Œæ ‡å‡†åº“ç»„ä»¶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;SomeResource&gt; resource_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernClass</span>(std::string name, std::vector&lt;<span class="type">int</span>&gt; data)</span><br><span class="line">        : <span class="built_in">name_</span>(std::<span class="built_in">move</span>(name)), </span><br><span class="line">          <span class="built_in">data_</span>(std::<span class="built_in">move</span>(data)),</span><br><span class="line">          <span class="built_in">resource_</span>(std::<span class="built_in">make_unique</span>&lt;SomeResource&gt;()) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‰€æœ‰ç‰¹æ®Šæˆå‘˜å‡½æ•°éƒ½æ˜¯æ­£ç¡®çš„ï¼</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è°¨æ…å¤„ç†ç»§æ‰¿å±‚æ¬¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Base</span>() = <span class="keyword">default</span>;  <span class="comment">// è™šææ„å‡½æ•°ï¼Œç¡®ä¿æ­£ç¡®ææ„æ´¾ç”Ÿç±»</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¶ä»–è™šå‡½æ•°...</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ææ„å‡½æ•°ä¼šæ­£ç¡®è°ƒç”¨åŸºç±»çš„è™šææ„å‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„å‡½æ•°ï¼š</strong></p>
<ol>
<li><strong>é»˜è®¤æ„é€ å‡½æ•°</strong>ï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–æ„é€ å‡½æ•°ï¼‰</li>
<li><strong>æ‹·è´æ„é€ å‡½æ•°</strong>ï¼ˆé™¤éç±»ä¸å¯æ‹·è´ï¼‰</li>
<li><strong>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</strong>ï¼ˆé™¤éç±»ä¸å¯èµ‹å€¼ï¼‰</li>
<li><strong>ææ„å‡½æ•°</strong>ï¼ˆæ€»æ˜¯éè™šçš„ï¼Œé™¤éåŸºç±»æœ‰è™šææ„å‡½æ•°ï¼‰</li>
<li><strong>ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</strong>ï¼ˆC++11ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼‰</li>
</ol>
<p><strong>å…³é”®åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>ç†è§£é»˜è®¤è¡Œä¸º</strong>ï¼šçŸ¥é“ç¼–è¯‘å™¨ä¼šç”Ÿæˆä»€ä¹ˆ</li>
<li><strong>æ§åˆ¶ç”Ÿæˆè¿‡ç¨‹</strong>ï¼šä½¿ç”¨<code>= default</code>å’Œ<code>= delete</code></li>
<li><strong>éµå¾ªRule of Zero&#x2F;Three&#x2F;Five</strong>ï¼šæ ¹æ®èµ„æºç®¡ç†éœ€æ±‚é€‰æ‹©åˆé€‚çš„è§„åˆ™</li>
<li><strong>æ³¨æ„æµ…æ‹·è´é—®é¢˜</strong>ï¼šåŒ…å«æŒ‡é’ˆæˆå‘˜æ—¶è¦å°å¿ƒ</li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨Rule of Zero</strong>ï¼šä¾èµ–æ ‡å‡†åº“å’ŒRAII</li>
<li><strong>æ˜ç¡®ç¦æ­¢ä¸éœ€è¦çš„æ“ä½œ</strong>ï¼šä½¿ç”¨<code>= delete</code></li>
<li><strong>ä¸ºå¤šæ€åŸºç±»æä¾›è™šææ„å‡½æ•°</strong></li>
<li><strong>ä½¿ç”¨ç°ä»£C++ç‰¹æ€§</strong>ï¼šæ™ºèƒ½æŒ‡é’ˆã€å®¹å™¨ç­‰</li>
</ul>
<p><strong>è®°ä½ï¼šç¼–è¯‘å™¨å¯ä»¥æš—è‡ªä¸ºclassåˆ›å»ºdefaultæ„é€ å‡½æ•°ã€copyæ„é€ å‡½æ•°ã€copy assignmentæ“ä½œç¬¦ï¼Œä»¥åŠææ„å‡½æ•°ã€‚</strong></p>
<h2 id="æ¡æ¬¾06ï¼š-è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œ-å°±è¯¥æ˜ç¡®æ‹’ç»ï¼"><a href="#æ¡æ¬¾06ï¼š-è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œ-å°±è¯¥æ˜ç¡®æ‹’ç»ï¼" class="headerlink" title="æ¡æ¬¾06ï¼š è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œ å°±è¯¥æ˜ç¡®æ‹’ç»ï¼"></a>æ¡æ¬¾06ï¼š è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œ å°±è¯¥æ˜ç¡®æ‹’ç»ï¼</h2><blockquote>
<p><em>Explicitly disallow the use of compiler-generated functions you do not want</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-5"><a href="#æ ¸å¿ƒç†å¿µ-5" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>æœ‰äº›æ—¶å€™ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼ˆå¦‚æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼‰å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚<strong>æ˜ç¡®ç¦æ­¢è¿™äº›å‡½æ•°æ¯”è®©ç¼–è¯‘å™¨æ„å¤–ç”Ÿæˆå®ƒä»¬è¦å®‰å…¨å¾—å¤š</strong>ã€‚ç†è§£å¦‚ä½•æ­£ç¡®åœ°æ‹’ç»ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œä»¥åŠä¸åŒæ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼Œæ˜¯æ§åˆ¶ç±»è¡Œä¸ºçš„é‡è¦æŠ€èƒ½ã€‚</p>
<h3 id="æ·±åº¦è§£æ-5"><a href="#æ·±åº¦è§£æ-5" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦ç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦ç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦ç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°"></a>1. <strong>ä¸ºä»€ä¹ˆéœ€è¦ç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°</strong></h4><p><strong>å…¸å‹åœºæ™¯ï¼šå”¯ä¸€æ€§å¯¹è±¡</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ¿å±‹å¯¹è±¡åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œä¸åº”è¯¥è¢«æ‹·è´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string address_;</span><br><span class="line">    <span class="type">double</span> area_;</span><br><span class="line">    <span class="type">int</span> rooms_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">House</span>(<span class="type">const</span> std::string&amp; address, <span class="type">double</span> area, <span class="type">int</span> rooms)</span><br><span class="line">        : <span class="built_in">address_</span>(address), <span class="built_in">area_</span>(area), <span class="built_in">rooms_</span>(rooms) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é—®é¢˜ï¼šå¦‚æœä¸åšå¤„ç†ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="comment">// House copy_house = original_house;  // è¿™æ ·çš„ä»£ç åœ¨é€»è¾‘ä¸Šæ˜¯é”™è¯¯çš„</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">problematicUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">House <span class="title">myHouse</span><span class="params">(<span class="string">&quot;123 Main St&quot;</span>, <span class="number">150.0</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    House anotherHouse = myHouse;  <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç°åœ¨æœ‰ä¸¤ä¸ª&quot;ç›¸åŒ&quot;çš„æˆ¿å­ï¼Ÿè¿™åœ¨ç°å®ä¸­æ˜¯ä¸å¯èƒ½çš„ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>èµ„æºç®¡ç†ç±»çš„é—®é¢˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileHandle</span>(<span class="type">const</span> <span class="type">char</span>* filename) &#123;</span><br><span class="line">        file_ = std::<span class="built_in">fopen</span>(filename, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file_) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Cannot open file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">FileHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é—®é¢˜ï¼šé»˜è®¤çš„æ‹·è´æ“ä½œä¼šå¯¼è‡´å¤šä¸ªå¯¹è±¡ç®¡ç†åŒä¸€æ–‡ä»¶å¥æŸ„</span></span><br><span class="line">    <span class="comment">// å½“å¤šä¸ªå¯¹è±¡ææ„æ—¶ï¼Œä¼šå¤šæ¬¡å…³é—­åŒä¸€æ–‡ä»¶ï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸º</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">FileHandle <span class="title">fh1</span><span class="params">(<span class="string">&quot;data.txt&quot;</span>)</span></span>;</span><br><span class="line">    FileHandle fh2 = fh1;  <span class="comment">// å±é™©ï¼ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€æ–‡ä»¶å¥æŸ„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸç»“æŸæ—¶ï¼š</span></span><br><span class="line">    <span class="comment">// 1. fh2ææ„ï¼Œå…³é—­æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// 2. fh1ææ„ï¼Œå†æ¬¡å…³é—­å·²å…³é—­çš„æ–‡ä»¶ â†’ æœªå®šä¹‰è¡Œä¸º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ä¼ ç»Ÿæ–¹æ³•ï¼šå£°æ˜ä¸ºprivateå¹¶ä¸å®ç°"><a href="#2-ä¼ ç»Ÿæ–¹æ³•ï¼šå£°æ˜ä¸ºprivateå¹¶ä¸å®ç°" class="headerlink" title="2. ä¼ ç»Ÿæ–¹æ³•ï¼šå£°æ˜ä¸ºprivateå¹¶ä¸å®ç°"></a>2. <strong>ä¼ ç»Ÿæ–¹æ³•ï¼šå£°æ˜ä¸ºprivateå¹¶ä¸å®ç°</strong></h4><p><strong>åŸºæœ¬æŠ€æœ¯ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NonCopyable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NonCopyable</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// å£°æ˜ä¸ºprivateï¼Œé˜»æ­¢å¤–éƒ¨è°ƒç”¨</span></span><br><span class="line">    <span class="built_in">NonCopyable</span>(<span class="type">const</span> NonCopyable&amp;);              <span class="comment">// ä¸å®ç°</span></span><br><span class="line">    NonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonCopyable&amp;);   <span class="comment">// ä¸å®ç°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testTraditionalMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    NonCopyable obj1;</span><br><span class="line">    <span class="comment">// NonCopyable obj2 = obj1;     // ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´æ„é€ å‡½æ•°æ˜¯private</span></span><br><span class="line">    <span class="comment">// NonCopyable obj3;</span></span><br><span class="line">    <span class="comment">// obj3 = obj1;                 // ç¼–è¯‘é”™è¯¯ï¼šèµ‹å€¼è¿ç®—ç¬¦æ˜¯private</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TraditionalNonCopyable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TraditionalNonCopyable</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">TraditionalNonCopyable</span>(<span class="type">const</span> TraditionalNonCopyable&amp;);</span><br><span class="line">    TraditionalNonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> TraditionalNonCopyable&amp;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜ç‚¹ï¼š</span></span><br><span class="line">    <span class="comment">// 1. ç¼–è¯‘æœŸå°±èƒ½å‘ç°é”™è¯¯</span></span><br><span class="line">    <span class="comment">// 2. é€‚ç”¨äºæ‰€æœ‰C++ç‰ˆæœ¬</span></span><br><span class="line">    <span class="comment">// 3. é˜»æ­¢å¤–éƒ¨å’Œæˆå‘˜å‡½æ•°/å‹å…ƒå‡½æ•°çš„è¯¯ç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼ºç‚¹ï¼š</span></span><br><span class="line">    <span class="comment">// 1. å¦‚æœæˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°æ„å¤–è°ƒç”¨ï¼Œé“¾æ¥æœŸæ‰èƒ½å‘ç°é”™è¯¯</span></span><br><span class="line">    <span class="comment">// 2. é”™è¯¯ä¿¡æ¯ä¸å¤Ÿæ˜ç¡®</span></span><br><span class="line">    <span class="comment">// 3. éœ€è¦è®°ä½ä¸å®ç°è¿™äº›å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåœ¨æˆå‘˜å‡½æ•°ä¸­æ„å¤–è°ƒç”¨äº†ç§æœ‰çš„æ‹·è´æ“ä½œï¼š</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TraditionalNonCopyable::someMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TraditionalNonCopyable temp = *<span class="keyword">this</span>;  <span class="comment">// é“¾æ¥é”™è¯¯ï¼Œä¸æ˜¯ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-åŸºç±»ç»§æ‰¿æ–¹æ³•"><a href="#3-åŸºç±»ç»§æ‰¿æ–¹æ³•" class="headerlink" title="3. åŸºç±»ç»§æ‰¿æ–¹æ³•"></a>3. <strong>åŸºç±»ç»§æ‰¿æ–¹æ³•</strong></h4><p><strong>åˆ›å»ºä¸“ç”¨çš„åŸºç±»ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Uncopyable</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">Uncopyable</span>() &#123;&#125;                          <span class="comment">// å…è®¸æ´¾ç”Ÿç±»æ„é€ </span></span><br><span class="line">    ~<span class="built_in">Uncopyable</span>() &#123;&#125;                         <span class="comment">// å…è®¸æ´¾ç”Ÿç±»ææ„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Uncopyable</span>(<span class="type">const</span> Uncopyable&amp;);           <span class="comment">// é˜»æ­¢æ‹·è´</span></span><br><span class="line">    Uncopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Uncopyable&amp;); <span class="comment">// é˜»æ­¢èµ‹å€¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿è‡ªUncopyableçš„ç±»è‡ªåŠ¨å˜ä¸ºä¸å¯æ‹·è´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">House</span> : <span class="keyword">private</span> Uncopyable &#123;  <span class="comment">// privateç»§æ‰¿ï¼Œè¡¨ç¤º&quot;æ ¹æ®æŸç‰©å®ç°&quot;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string address_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">House</span>(<span class="type">const</span> std::string&amp; address) : <span class="built_in">address_</span>(address) &#123;&#125;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¸ä¼šç”Ÿæˆæ‹·è´æ“ä½œï¼Œå› ä¸ºåŸºç±»ä¸å¯æ‹·è´</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testInheritanceMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">House <span class="title">h1</span><span class="params">(<span class="string">&quot;123 Main St&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">// House h2 = h1;  // ç¼–è¯‘é”™è¯¯ï¼šåŸºç±»Uncopyableä¸å¯æ‹·è´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Boostçš„å®ç°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Booståº“ä¸­çš„noncopyableå®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">namespace</span> boost &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">noncopyable</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">        <span class="built_in">noncopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">        ~<span class="built_in">noncopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">noncopyable</span>(<span class="type">const</span> noncopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">        noncopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> noncopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> : <span class="keyword">private</span> boost::noncopyable &#123;</span><br><span class="line">    <span class="comment">// MyClassè‡ªåŠ¨å˜ä¸ºä¸å¯æ‹·è´</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-ç°ä»£æ–¹æ³•ï¼šä½¿ç”¨delete"><a href="#4-ç°ä»£æ–¹æ³•ï¼šä½¿ç”¨delete" class="headerlink" title="4. ç°ä»£æ–¹æ³•ï¼šä½¿ç”¨delete"></a>4. <strong>ç°ä»£æ–¹æ³•ï¼šä½¿ç”¨delete</strong></h4><p><strong>C++11çš„&#x3D; deleteè¯­æ³•ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernNonCopyable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernNonCopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜ç¡®åˆ é™¤æ‹·è´æ“ä½œ</span></span><br><span class="line">    <span class="built_in">ModernNonCopyable</span>(<span class="type">const</span> ModernNonCopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    ModernNonCopyable&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ModernNonCopyable&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥é€‰æ‹©æ€§åœ°å…è®¸ç§»åŠ¨æ“ä½œ</span></span><br><span class="line">    <span class="built_in">ModernNonCopyable</span>(ModernNonCopyable&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ModernNonCopyable&amp; <span class="keyword">operator</span>=(ModernNonCopyable&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">ModernNonCopyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testModernMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModernNonCopyable obj1;</span><br><span class="line">    <span class="comment">// ModernNonCopyable obj2 = obj1;           // ç¼–è¯‘é”™è¯¯ï¼šå·²åˆ é™¤</span></span><br><span class="line">    <span class="comment">// obj1 = ModernNonCopyable&#123;&#125;;              // ç¼–è¯‘é”™è¯¯ï¼šå·²åˆ é™¤</span></span><br><span class="line">    </span><br><span class="line">    ModernNonCopyable obj3 = std::<span class="built_in">move</span>(obj1);   <span class="comment">// âœ… ç§»åŠ¨æ“ä½œè¢«å…è®¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>&#x3D; deleteçš„ä¼˜åŠ¿ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DeleteAdvantages</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DeleteAdvantages</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜åŠ¿1ï¼šæ›´æ˜ç¡®çš„æ„å›¾è¡¨è¾¾</span></span><br><span class="line">    <span class="built_in">DeleteAdvantages</span>(<span class="type">const</span> DeleteAdvantages&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    DeleteAdvantages&amp; <span class="keyword">operator</span>=(<span class="type">const</span> DeleteAdvantages&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜åŠ¿2ï¼šç¼–è¯‘æœŸé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯æ›´æ¸…æ™°</span></span><br><span class="line">    <span class="comment">// é”™è¯¯ä¿¡æ¯ï¼š&quot;function has been explicitly deleted&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜åŠ¿3ï¼šå¯ä»¥åˆ é™¤ä»»ä½•å‡½æ•°ï¼Œä¸ä»…é™äºç‰¹æ®Šæˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dangerousFunction</span><span class="params">(<span class="type">double</span>)</span> </span>= <span class="keyword">delete</span>;  <span class="comment">// ç¦æ­¢doubleç‰ˆæœ¬</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dangerousFunction</span><span class="params">(<span class="type">int</span>)</span> </span>&#123; <span class="comment">/* å…è®¸intç‰ˆæœ¬ */</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜åŠ¿4ï¼šä¸èƒ½è¢«æˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°æ„å¤–è°ƒç”¨</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testDeleteAdvantages</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DeleteAdvantages obj;</span><br><span class="line">    obj.<span class="built_in">dangerousFunction</span>(<span class="number">42</span>);      <span class="comment">// âœ… è°ƒç”¨intç‰ˆæœ¬</span></span><br><span class="line">    <span class="comment">// obj.dangerousFunction(3.14); // âŒ ç¼–è¯‘é”™è¯¯ï¼šdoubleç‰ˆæœ¬å·²åˆ é™¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-ä¸åŒç¦æ­¢ç­–ç•¥çš„å¯¹æ¯”"><a href="#5-ä¸åŒç¦æ­¢ç­–ç•¥çš„å¯¹æ¯”" class="headerlink" title="5. ä¸åŒç¦æ­¢ç­–ç•¥çš„å¯¹æ¯”"></a>5. <strong>ä¸åŒç¦æ­¢ç­–ç•¥çš„å¯¹æ¯”</strong></h4><p><strong>ä»…ç¦æ­¢æ‹·è´ï¼Œå…è®¸ç§»åŠ¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MoveOnlyType</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MoveOnlyType</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´</span></span><br><span class="line">    <span class="built_in">MoveOnlyType</span>(<span class="type">const</span> MoveOnlyType&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    MoveOnlyType&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MoveOnlyType&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">MoveOnlyType</span>(MoveOnlyType&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    MoveOnlyType&amp; <span class="keyword">operator</span>=(MoveOnlyType&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">MoveOnlyType</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testMoveOnly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MoveOnlyType obj1;</span><br><span class="line">    <span class="comment">// MoveOnlyType obj2 = obj1;                    // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´è¢«ç¦æ­¢</span></span><br><span class="line">    MoveOnlyType obj3 = std::<span class="built_in">move</span>(obj1);            <span class="comment">// âœ… ç§»åŠ¨è¢«å…è®¸</span></span><br><span class="line">    </span><br><span class="line">    std::vector&lt;MoveOnlyType&gt; vec;</span><br><span class="line">    vec.<span class="built_in">push_back</span>(MoveOnlyType&#123;&#125;);                  <span class="comment">// âœ… ç§»åŠ¨åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¦æ­¢æ‰€æœ‰å¤åˆ¶æ“ä½œï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ImmovableType</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ImmovableType</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´å’Œç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">ImmovableType</span>(<span class="type">const</span> ImmovableType&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    ImmovableType&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ImmovableType&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">ImmovableType</span>(ImmovableType&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    ImmovableType&amp; <span class="keyword">operator</span>=(ImmovableType&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">ImmovableType</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testImmovable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ImmovableType obj;</span><br><span class="line">    <span class="comment">// ImmovableType obj2 = obj;                // âŒ ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    <span class="comment">// ImmovableType obj3 = std::move(obj);     // âŒ ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªèƒ½é€šè¿‡å¼•ç”¨æˆ–æŒ‡é’ˆä½¿ç”¨</span></span><br><span class="line">    ImmovableType* ptr = &amp;obj;</span><br><span class="line">    ImmovableType&amp; ref = obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-ç‰¹æ®Šå‡½æ•°çš„é€‰æ‹©æ€§åˆ é™¤"><a href="#6-ç‰¹æ®Šå‡½æ•°çš„é€‰æ‹©æ€§åˆ é™¤" class="headerlink" title="6. ç‰¹æ®Šå‡½æ•°çš„é€‰æ‹©æ€§åˆ é™¤"></a>6. <strong>ç‰¹æ®Šå‡½æ•°çš„é€‰æ‹©æ€§åˆ é™¤</strong></h4><p><strong>åˆ é™¤ç‰¹å®šçš„æ„é€ å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeInteger</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SafeInteger</span><span class="params">(<span class="type">int</span> val)</span> : value_(val) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢ä»doubleæ„é€ ï¼Œé¿å…ç²¾åº¦ä¸¢å¤±</span></span><br><span class="line">    <span class="built_in">SafeInteger</span>(<span class="type">double</span>) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢ä»æŒ‡é’ˆæ„é€ ï¼Œé¿å…æ„å¤–è½¬æ¢</span></span><br><span class="line">    <span class="built_in">SafeInteger</span>(<span class="type">void</span>*) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testSelectiveDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">SafeInteger <span class="title">si1</span><span class="params">(<span class="number">42</span>)</span></span>;        <span class="comment">// âœ… ä»intæ„é€ </span></span><br><span class="line">    <span class="comment">// SafeInteger si2(3.14);   // âŒ ç¼–è¯‘é”™è¯¯ï¼šdoubleæ„é€ å‡½æ•°è¢«åˆ é™¤</span></span><br><span class="line">    <span class="comment">// SafeInteger si3(nullptr);// âŒ ç¼–è¯‘é”™è¯¯ï¼šæŒ‡é’ˆæ„é€ å‡½æ•°è¢«åˆ é™¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆ é™¤ç‰¹å®šçš„è¿ç®—ç¬¦ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestrictedOperations</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RestrictedOperations</span>(<span class="type">int</span> val) : <span class="built_in">value_</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…è®¸ä¸intçš„æ¯”è¾ƒ</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">int</span> other) <span class="type">const</span> &#123; <span class="keyword">return</span> value_ == other; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢ä¸doubleçš„æ¯”è¾ƒï¼Œé¿å…ç²¾åº¦é—®é¢˜</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">double</span>) <span class="type">const</span> = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æŸäº›å±é™©çš„è¿ç®—ç¬¦</span></span><br><span class="line">    RestrictedOperations <span class="keyword">operator</span>+(<span class="type">const</span> RestrictedOperations&amp;) <span class="type">const</span> = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-å®é™…åº”ç”¨åœºæ™¯"><a href="#7-å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="7. å®é™…åº”ç”¨åœºæ™¯"></a>7. <strong>å®é™…åº”ç”¨åœºæ™¯</strong></h4><p><strong>å•ä¾‹æ¨¡å¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Singleton</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´å’Œç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">Singleton</span>(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">Singleton</span>(Singleton&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(Singleton&amp;&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> Singleton&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> Singleton instance;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123; <span class="comment">/* ä¸šåŠ¡é€»è¾‘ */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>RAIIèµ„æºç®¡ç†ç±»ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MutexLock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::mutex&amp; mutex_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MutexLock</span><span class="params">(std::mutex&amp; m)</span> : mutex_(m) &#123;</span></span><br><span class="line">        mutex_.<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">MutexLock</span>() &#123;</span><br><span class="line">        mutex_.<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´ï¼šé¿å…é‡å¤é”å®š/è§£é”</span></span><br><span class="line">    <span class="built_in">MutexLock</span>(<span class="type">const</span> MutexLock&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    MutexLock&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MutexLock&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥è€ƒè™‘å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">MutexLock</span>(MutexLock&amp;&amp; other) <span class="keyword">noexcept</span> : <span class="built_in">mutex_</span>(other.mutex_) &#123;</span><br><span class="line">        other.moved_from_ = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span> moved_from_ = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ¥å£åŸºç±»ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractInterface</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractInterface</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¯è™šå‡½æ•°å®šä¹‰æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´ï¼šæ¥å£å¯¹è±¡é€šå¸¸åº”è¯¥æ˜¯å¤šæ€çš„ï¼Œæ‹·è´ä¼šåˆ‡ç‰‡</span></span><br><span class="line">    <span class="built_in">AbstractInterface</span>(<span class="type">const</span> AbstractInterface&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    AbstractInterface&amp; <span class="keyword">operator</span>=(<span class="type">const</span> AbstractInterface&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">AbstractInterface</span>() = <span class="keyword">default</span>;  <span class="comment">// åªå…è®¸æ´¾ç”Ÿç±»æ„é€ </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="8-æ–¹æ³•é€‰æ‹©æŒ‡å—"><a href="#8-æ–¹æ³•é€‰æ‹©æŒ‡å—" class="headerlink" title="8. æ–¹æ³•é€‰æ‹©æŒ‡å—"></a>8. <strong>æ–¹æ³•é€‰æ‹©æŒ‡å—</strong></h4><p><strong>ç°ä»£C++ï¼ˆC++11åŠä»¥åï¼‰æ¨èåšæ³•ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RecommendedApproach</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RecommendedApproach</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜å…ˆä½¿ç”¨ = deleteï¼Œæ„å›¾æ˜ç¡®</span></span><br><span class="line">    <span class="built_in">RecommendedApproach</span>(<span class="type">const</span> RecommendedApproach&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    RecommendedApproach&amp; <span class="keyword">operator</span>=(<span class="type">const</span> RecommendedApproach&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®éœ€è¦å†³å®šæ˜¯å¦å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">RecommendedApproach</span>(RecommendedApproach&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    RecommendedApproach&amp; <span class="keyword">operator</span>=(RecommendedApproach&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">RecommendedApproach</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å…¼å®¹æ—§ç¼–è¯‘å™¨æ—¶ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BackwardCompatible</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BackwardCompatible</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// å£°æ˜ä¸ºprivateä½†ä¸å®ç°</span></span><br><span class="line">    <span class="built_in">BackwardCompatible</span>(<span class="type">const</span> BackwardCompatible&amp;);</span><br><span class="line">    BackwardCompatible&amp; <span class="keyword">operator</span>=(<span class="type">const</span> BackwardCompatible&amp;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ç¦æ­¢ç¼–è¯‘å™¨ç”Ÿæˆå‡½æ•°çš„æ–¹æ³•æ¼”è¿›ï¼š</strong></p>
<ol>
<li><strong>ä¼ ç»Ÿæ–¹æ³•</strong>ï¼šå£°æ˜ä¸ºprivateå¹¶ä¸å®ç°</li>
<li><strong>ç»§æ‰¿æ–¹æ³•</strong>ï¼šç»§æ‰¿è‡ªä¸å¯æ‹·è´çš„åŸºç±»</li>
<li><strong>ç°ä»£æ–¹æ³•</strong>ï¼šä½¿ç”¨<code>= delete</code>æ˜¾å¼åˆ é™¤</li>
</ol>
<p><strong>é€‰æ‹©æŒ‡å—ï¼š</strong></p>
<ul>
<li><strong>C++11åŠä»¥å</strong>ï¼šä¼˜å…ˆä½¿ç”¨<code>= delete</code></li>
<li><strong>éœ€è¦å…¼å®¹æ—§ç¼–è¯‘å™¨</strong>ï¼šä½¿ç”¨privateå£°æ˜</li>
<li><strong>åº“è®¾è®¡</strong>ï¼šè€ƒè™‘æä¾›åŸºç±»ä¾›ç”¨æˆ·ç»§æ‰¿</li>
</ul>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>ç¼–è¯‘æœŸé”™è¯¯æ£€æµ‹</strong>ï¼šå°½æ—©å‘ç°é—®é¢˜</li>
<li><strong>æ„å›¾æ˜ç¡®</strong>ï¼šä»£ç è‡ªæ–‡æ¡£åŒ–</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé˜²æ­¢æ„å¤–çš„å¯¹è±¡å¤åˆ¶</li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>æ˜ç¡®æ§åˆ¶ç±»çš„æ‹·è´è¯­ä¹‰</li>
<li>ä¼˜å…ˆè€ƒè™‘ç§»åŠ¨è¯­ä¹‰ï¼ˆC++11ï¼‰</li>
<li>ä¸ºèµ„æºç®¡ç†ç±»è°¨æ…è®¾è®¡å¤åˆ¶æ“ä½œ</li>
<li>ä½¿ç”¨ç°ä»£C++ç‰¹æ€§æé«˜ä»£ç æ¸…æ™°åº¦</li>
</ul>
<p><strong>è®°ä½ï¼šä¸ºé©³å›ç¼–è¯‘å™¨è‡ªåŠ¨ï¼ˆæš—è‡ªï¼‰æä¾›çš„æœºèƒ½ï¼Œå¯å°†ç›¸åº”çš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºprivateå¹¶ä¸”ä¸äºˆå®ç°ã€‚ä½¿ç”¨åƒUncopyableè¿™æ ·çš„base classä¹Ÿæ˜¯ä¸€ç§åšæ³•ã€‚</strong></p>
<h2 id="æ¡æ¬¾07ï¼š-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"><a href="#æ¡æ¬¾07ï¼š-ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾07ï¼š ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"></a>æ¡æ¬¾07ï¼š ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°</h2><blockquote>
<p><em>Declare destructors virtual in polymorphic base classes</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-6"><a href="#æ ¸å¿ƒç†å¿µ-6" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨å¤šæ€ç»§æ‰¿ä½“ç³»ä¸­ï¼Œ<strong>é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»å¯¹è±¡æ—¶ï¼Œå¦‚æœåŸºç±»ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œå°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸º</strong>ã€‚è™šææ„å‡½æ•°ç¡®ä¿æ­£ç¡®çš„ææ„é¡ºåºï¼šå…ˆè°ƒç”¨æ´¾ç”Ÿç±»ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±»ææ„å‡½æ•°ã€‚è¿™æ˜¯C++å¤šæ€æœºåˆ¶ä¸­æœ€å®¹æ˜“è¢«å¿½è§†ä½†æå…¶é‡è¦çš„å®‰å…¨å‡†åˆ™ã€‚</p>
<h3 id="æ·±åº¦è§£æ-6"><a href="#æ·±åº¦è§£æ-6" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-é—®é¢˜æ ¹æºï¼šéè™šææ„å‡½æ•°çš„å±é™©"><a href="#1-é—®é¢˜æ ¹æºï¼šéè™šææ„å‡½æ•°çš„å±é™©" class="headerlink" title="1. é—®é¢˜æ ¹æºï¼šéè™šææ„å‡½æ•°çš„å±é™©"></a>1. <strong>é—®é¢˜æ ¹æºï¼šéè™šææ„å‡½æ•°çš„å±é™©</strong></h4><p><strong>å…¸å‹çš„é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TimeKeeper</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TimeKeeper</span>() &#123;&#125;</span><br><span class="line">    ~<span class="built_in">TimeKeeper</span>() &#123;&#125;  <span class="comment">// éè™šææ„å‡½æ•°ï¼</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getCurrentTime</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicClock</span> : <span class="keyword">public</span> TimeKeeper &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; calibrationData_;  <span class="comment">// éœ€è¦æ­£ç¡®ææ„çš„æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AtomicClock</span>() : <span class="built_in">calibrationData_</span>(<span class="number">1000000</span>) &#123;&#125;  <span class="comment">// åˆ†é…å¤§é‡å†…å­˜</span></span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">AtomicClock</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;AtomicClock destructor called\n&quot;</span>;</span><br><span class="line">        <span class="comment">// calibrationData_ä¼šè¢«æ­£ç¡®ææ„</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getCurrentTime</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°åŸå­é’Ÿæ—¶é—´è·å–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TimeKeeper* timeKeeper = <span class="keyword">new</span> <span class="built_in">AtomicClock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... ä½¿ç”¨timeKeeper ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> timeKeeper;  <span class="comment">// å±é™©ï¼åªè°ƒç”¨TimeKeeper::~TimeKeeper()</span></span><br><span class="line">                        <span class="comment">// AtomicClock::~AtomicClock()ä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">                        <span class="comment">// calibrationData_å¯èƒ½ä¸ä¼šè¢«æ­£ç¡®é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li><code>delete timeKeeper</code>åªä¼šè°ƒç”¨é™æ€ç»‘å®šçš„<code>TimeKeeper::~TimeKeeper()</code></li>
<li><code>AtomicClock::~AtomicClock()</code>ä¸ä¼šè¢«è°ƒç”¨</li>
<li><code>calibrationData_</code>æˆå‘˜å¯èƒ½ä¸ä¼šè¢«æ­£ç¡®ææ„ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
<li>è¿™æ˜¯<strong>æœªå®šä¹‰è¡Œä¸º</strong>ï¼Œåœ¨ä¸åŒç¼–è¯‘å™¨å’Œå¹³å°ä¸Šå¯èƒ½æœ‰ä¸åŒè¡¨ç°</li>
</ul>
<h4 id="2-è§£å†³æ–¹æ¡ˆï¼šè™šææ„å‡½æ•°"><a href="#2-è§£å†³æ–¹æ¡ˆï¼šè™šææ„å‡½æ•°" class="headerlink" title="2. è§£å†³æ–¹æ¡ˆï¼šè™šææ„å‡½æ•°"></a>2. <strong>è§£å†³æ–¹æ¡ˆï¼šè™šææ„å‡½æ•°</strong></h4><p><strong>æ­£ç¡®çš„å®ç°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TimeKeeper</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TimeKeeper</span>() &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">TimeKeeper</span>() &#123;&#125;  <span class="comment">// è™šææ„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">getCurrentTime</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtomicClock</span> : <span class="keyword">public</span> TimeKeeper &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; calibrationData_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AtomicClock</span>() : <span class="built_in">calibrationData_</span>(<span class="number">1000000</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">AtomicClock</span>() <span class="keyword">override</span> &#123;  <span class="comment">// å¯ä»¥æ˜¾å¼æ ‡è®°override</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;AtomicClock destructor called\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getCurrentTime</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSolution</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TimeKeeper* timeKeeper = <span class="keyword">new</span> <span class="built_in">AtomicClock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> timeKeeper;  <span class="comment">// æ­£ç¡®ï¼è°ƒç”¨é¡ºåºï¼š</span></span><br><span class="line">                        <span class="comment">// 1. AtomicClock::~AtomicClock()</span></span><br><span class="line">                        <span class="comment">// 2. TimeKeeper::~TimeKeeper()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è™šææ„å‡½æ•°çš„å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Base</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;Base constructor\n&quot;</span>; &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Base</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;Base destructor\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Derived</span>() : <span class="built_in">data_</span>(<span class="string">&quot;Derived data&quot;</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived constructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Derived</span>() <span class="keyword">override</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived destructor\n&quot;</span>;</span><br><span class="line">        <span class="comment">// data_ä¼šè¢«è‡ªåŠ¨ææ„</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived func\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testVirtualDestructor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Creating object ===\n&quot;</span>;</span><br><span class="line">    Base* ptr = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Calling virtual function ===\n&quot;</span>;</span><br><span class="line">    ptr-&gt;<span class="built_in">func</span>();</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Deleting object ===\n&quot;</span>;</span><br><span class="line">    <span class="keyword">delete</span> ptr;  <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">                 <span class="comment">// Derived destructor</span></span><br><span class="line">                 <span class="comment">// Base destructor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-ä½•æ—¶ä½¿ç”¨è™šææ„å‡½æ•°"><a href="#3-ä½•æ—¶ä½¿ç”¨è™šææ„å‡½æ•°" class="headerlink" title="3. ä½•æ—¶ä½¿ç”¨è™šææ„å‡½æ•°"></a>3. <strong>ä½•æ—¶ä½¿ç”¨è™šææ„å‡½æ•°</strong></h4><p><strong>è§„åˆ™1ï¼šå¤šæ€åŸºç±»éœ€è¦è™šææ„å‡½æ•°</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå¤šæ€åŸºç±»æœ‰è™šææ„å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;           <span class="comment">// è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;        <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;      <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius_;</span><br><span class="line">    std::vector&lt;Point&gt; cachedPoints_;     <span class="comment">// å¤æ‚æˆå‘˜éœ€è¦æ­£ç¡®ææ„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Circle</span><span class="params">(<span class="type">double</span> r)</span> : radius_(r) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Circle</span>() <span class="keyword">override</span> = <span class="keyword">default</span>;         <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„ææ„å‡½æ•°å°±è¶³å¤Ÿäº†</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* å®ç° */</span> &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="number">3.14159</span> * radius_ * radius_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">usePolymorphically</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::unique_ptr&lt;Shape&gt;&gt; shapes;</span><br><span class="line">    shapes.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;Circle&gt;(<span class="number">5.0</span>));</span><br><span class="line">    <span class="comment">// shapesææ„æ—¶ä¼šæ­£ç¡®è°ƒç”¨Circle::~Circle()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§„åˆ™2ï¼šå¦‚æœç±»æœ‰ä»»ä½•è™šå‡½æ•°ï¼Œå®ƒå°±åº”è¯¥æœ‰è™šææ„å‡½æ•°</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;           <span class="comment">// æœ‰è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">reset</span><span class="params">()</span> </span>= <span class="number">0</span>;             <span class="comment">// æœ‰è™šå‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å› ä¸ºæœ‰è™šå‡½æ•°ï¼Œæ‰€ä»¥åº”è¯¥æœ‰è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractProcessor</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-ä½•æ—¶ä¸åº”ä½¿ç”¨è™šææ„å‡½æ•°"><a href="#4-ä½•æ—¶ä¸åº”ä½¿ç”¨è™šææ„å‡½æ•°" class="headerlink" title="4. ä½•æ—¶ä¸åº”ä½¿ç”¨è™šææ„å‡½æ•°"></a>4. <strong>ä½•æ—¶ä¸åº”ä½¿ç”¨è™šææ„å‡½æ•°</strong></h4><p><strong>éå¤šæ€ç±»ä¸éœ€è¦è™šææ„å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šä¸ºéå¤šæ€ç±»æ·»åŠ è™šææ„å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> x, <span class="type">int</span> y) : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸è¦è¿™æ ·åšï¼Pointä¸æ˜¯ä¸ºå¤šæ€è®¾è®¡çš„</span></span><br><span class="line">    <span class="comment">// virtual ~Point() &#123;&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šéè™šææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">Point</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getX</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getY</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pointç±»çš„è®¾è®¡æ„å›¾ï¼š</span></span><br><span class="line"><span class="comment">// 1. ä¸æ˜¯ä¸ºç»§æ‰¿è®¾è®¡çš„</span></span><br><span class="line"><span class="comment">// 2. æ²¡æœ‰è™šå‡½æ•°</span></span><br><span class="line"><span class="comment">// 3. æŒ‰å€¼è¯­ä¹‰ä½¿ç”¨ï¼Œä¸æ˜¯æŒ‡é’ˆè¯­ä¹‰</span></span><br></pre></td></tr></table></figure>

<p><strong>è™šææ„å‡½æ•°çš„å¼€é”€ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExpensiveVirtualDestructor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ExpensiveVirtualDestructor</span>() &#123;&#125;  <span class="comment">// å¼•å…¥è™šå‡½æ•°è¡¨å¼€é”€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ è™šææ„å‡½æ•°çš„ä»£ä»·ï¼š</span></span><br><span class="line">    <span class="comment">// 1. æ¯ä¸ªå¯¹è±¡å¢åŠ ä¸€ä¸ªè™šå‡½æ•°è¡¨æŒ‡é’ˆï¼ˆé€šå¸¸8å­—èŠ‚ï¼‰</span></span><br><span class="line">    <span class="comment">// 2. ææ„æ—¶çš„è™šå‡½æ•°è°ƒç”¨å¼€é”€</span></span><br><span class="line">    <span class="comment">// 3. ç¼–è¯‘å™¨ä¼˜åŒ–æœºä¼šå‡å°‘</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_;  <span class="comment">// åŸæœ¬åªæœ‰8å­—èŠ‚ï¼Œç°åœ¨å˜æˆ16å­—èŠ‚</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EfficientNonVirtual</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">EfficientNonVirtual</span>() = <span class="keyword">default</span>;  <span class="comment">// éè™šææ„å‡½æ•°ï¼Œæ— é¢å¤–å¼€é”€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_, y_;  <span class="comment">// åªæœ‰8å­—èŠ‚</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-æ ‡å‡†åº“ç±»çš„ææ„å‡½æ•°é—®é¢˜"><a href="#5-æ ‡å‡†åº“ç±»çš„ææ„å‡½æ•°é—®é¢˜" class="headerlink" title="5. æ ‡å‡†åº“ç±»çš„ææ„å‡½æ•°é—®é¢˜"></a>5. <strong>æ ‡å‡†åº“ç±»çš„ææ„å‡½æ•°é—®é¢˜</strong></h4><p><strong>æ ‡å‡†åº“å®¹å™¨çš„éè™šææ„å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ å±é™©ï¼šç»§æ‰¿æ ‡å‡†åº“å®¹å™¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyVector</span> : <span class="keyword">public</span> std::vector&lt;<span class="type">int</span>&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyVector</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;MyVector constructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">MyVector</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;MyVector destructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStdContainerProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;* ptr = <span class="keyword">new</span> <span class="built_in">MyVector</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> ptr;  <span class="comment">// æœªå®šä¹‰è¡Œä¸ºï¼</span></span><br><span class="line">                 <span class="comment">// std::vectorçš„ææ„å‡½æ•°ä¸æ˜¯è™šçš„</span></span><br><span class="line">                 <span class="comment">// MyVector::~MyVector()ä¸ä¼šè¢«è°ƒç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SafeVector</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SafeVector</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;SafeVector constructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">SafeVector</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;SafeVector destructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›éœ€è¦çš„æ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_back</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123; data_.<span class="built_in">push_back</span>(value); &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">size</span>(); &#125;</span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index) &#123; <span class="keyword">return</span> data_[index]; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-æŠ½è±¡åŸºç±»çš„æœ€ä½³å®è·µ"><a href="#6-æŠ½è±¡åŸºç±»çš„æœ€ä½³å®è·µ" class="headerlink" title="6. æŠ½è±¡åŸºç±»çš„æœ€ä½³å®è·µ"></a>6. <strong>æŠ½è±¡åŸºç±»çš„æœ€ä½³å®è·µ</strong></h4><p><strong>çº¯è™šææ„å‡½æ•°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AbstractWorker</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">AbstractWorker</span>() = <span class="number">0</span>;        <span class="comment">// çº¯è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doWork</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å³ä½¿æ˜¯çº¯è™šææ„å‡½æ•°ï¼Œä¹Ÿå¿…é¡»æä¾›å®šä¹‰ï¼</span></span><br><span class="line">AbstractWorker::~<span class="built_in">AbstractWorker</span>() &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;AbstractWorker destructor\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteWorker</span> : <span class="keyword">public</span> AbstractWorker &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">ConcreteWorker</span>() <span class="keyword">override</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteWorker destructor\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doWork</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Doing concrete work\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testPureVirtualDestructor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AbstractWorker* worker = <span class="keyword">new</span> <span class="built_in">ConcreteWorker</span>();</span><br><span class="line">    worker-&gt;<span class="built_in">doWork</span>();</span><br><span class="line">    <span class="keyword">delete</span> worker;  <span class="comment">// è°ƒç”¨é¡ºåºï¼š</span></span><br><span class="line">                    <span class="comment">// ConcreteWorker destructor</span></span><br><span class="line">                    <span class="comment">// AbstractWorker destructor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç°ä»£C++çš„æ¨èå†™æ³•ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernAbstractBase</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é»˜è®¤è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ModernAbstractBase</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">reset</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// ä¿æŠ¤æ„é€ å‡½æ•°ï¼Œé˜²æ­¢ç›´æ¥å®ä¾‹åŒ–</span></span><br><span class="line">    <span class="built_in">ModernAbstractBase</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´å’Œèµ‹å€¼ï¼ˆé€šå¸¸æŠ½è±¡åŸºç±»ä¸åº”è¯¥è¢«æ‹·è´ï¼‰</span></span><br><span class="line">    <span class="built_in">ModernAbstractBase</span>(<span class="type">const</span> ModernAbstractBase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    ModernAbstractBase&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ModernAbstractBase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä»¥é€‰æ‹©æ€§å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">ModernAbstractBase</span>(ModernAbstractBase&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    ModernAbstractBase&amp; <span class="keyword">operator</span>=(ModernAbstractBase&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-æ™ºèƒ½æŒ‡é’ˆæ—¶ä»£çš„è€ƒè™‘"><a href="#7-æ™ºèƒ½æŒ‡é’ˆæ—¶ä»£çš„è€ƒè™‘" class="headerlink" title="7. æ™ºèƒ½æŒ‡é’ˆæ—¶ä»£çš„è€ƒè™‘"></a>7. <strong>æ™ºèƒ½æŒ‡é’ˆæ—¶ä»£çš„è€ƒè™‘</strong></h4><p><strong>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„å¥½å¤„ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernShape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ModernShape</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernCircle</span> : <span class="keyword">public</span> ModernShape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* å®ç° */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modernPolymorphicUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// âœ… ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    std::vector&lt;std::unique_ptr&lt;ModernShape&gt;&gt; shapes;</span><br><span class="line">    shapes.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;ModernCircle&gt;());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨æ­£ç¡®ææ„ï¼Œå³ä½¿æœ‰å¼‚å¸¸ä¹Ÿå®‰å…¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚å‡½æ•°è¿”å›æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;ModernShape&gt; <span class="title">createShape</span><span class="params">(<span class="type">const</span> std::string&amp; type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="string">&quot;circle&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_unique</span>&lt;ModernCircle&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>RAIIå’Œå¼‚å¸¸å®‰å…¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExceptionSafeBase</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ExceptionSafeBase</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">riskyOperation</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExceptionSafeDerived</span> : <span class="keyword">public</span> ExceptionSafeBase &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExceptionSafeDerived</span>() : <span class="built_in">data_</span>(<span class="number">1000</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">ExceptionSafeDerived</span>() <span class="keyword">override</span> &#123;</span><br><span class="line">        <span class="comment">// å³ä½¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿä¼šè¢«æ­£ç¡®è°ƒç”¨</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Cleaning up derived resources\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">riskyOperation</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (data_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Data is empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateExceptionSafety</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        std::unique_ptr&lt;ExceptionSafeBase&gt; obj = </span><br><span class="line">            std::<span class="built_in">make_unique</span>&lt;ExceptionSafeDerived&gt;();</span><br><span class="line">        </span><br><span class="line">        obj-&gt;<span class="built_in">riskyOperation</span>();  <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        <span class="comment">// å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œå¯¹è±¡ä¹Ÿä¼šè¢«æ­£ç¡®ææ„</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Exception caught: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-æ€§èƒ½è€ƒè™‘ä¸æƒè¡¡"><a href="#8-æ€§èƒ½è€ƒè™‘ä¸æƒè¡¡" class="headerlink" title="8. æ€§èƒ½è€ƒè™‘ä¸æƒè¡¡"></a>8. <strong>æ€§èƒ½è€ƒè™‘ä¸æƒè¡¡</strong></h4><p><strong>è™šå‡½æ•°è¡¨çš„å†…å­˜å¸ƒå±€ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WithVirtualDestructor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">WithVirtualDestructor</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> data1_;</span><br><span class="line">    <span class="type">int</span> data2_;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†…å­˜å¸ƒå±€ï¼ˆ64ä½ç³»ç»Ÿï¼‰ï¼š</span></span><br><span class="line">    <span class="comment">// [vptr: 8å­—èŠ‚] [data1_: 4å­—èŠ‚] [data2_: 4å­—èŠ‚] [å¡«å……: 0å­—èŠ‚]</span></span><br><span class="line">    <span class="comment">// æ€»å¤§å°ï¼š16å­—èŠ‚</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WithoutVirtualDestructor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">WithoutVirtualDestructor</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> data1_;</span><br><span class="line">    <span class="type">int</span> data2_;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†…å­˜å¸ƒå±€ï¼š</span></span><br><span class="line">    <span class="comment">// [data1_: 4å­—èŠ‚] [data2_: 4å­—èŠ‚]</span></span><br><span class="line">    <span class="comment">// æ€»å¤§å°ï¼š8å­—èŠ‚</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">compareSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;With virtual destructor: &quot;</span> </span><br><span class="line">              &lt;&lt; <span class="built_in">sizeof</span>(WithVirtualDestructor) &lt;&lt; <span class="string">&quot; bytes\n&quot;</span>;    <span class="comment">// 16</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Without virtual destructor: &quot;</span> </span><br><span class="line">              &lt;&lt; <span class="built_in">sizeof</span>(WithoutVirtualDestructor) &lt;&lt; <span class="string">&quot; bytes\n&quot;</span>; <span class="comment">// 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>è™šææ„å‡½æ•°çš„æ ¸å¿ƒåŸåˆ™ï¼š</strong></p>
<ol>
<li><strong>å¤šæ€åŸºç±»å¿…é¡»æœ‰è™šææ„å‡½æ•°</strong></li>
<li><strong>æœ‰è™šå‡½æ•°çš„ç±»åº”è¯¥æœ‰è™šææ„å‡½æ•°</strong></li>
<li><strong>éå¤šæ€ç±»ä¸åº”è¯¥æœ‰è™šææ„å‡½æ•°</strong></li>
</ol>
<p><strong>å®è·µæŒ‡å—ï¼š</strong></p>
<ul>
<li><strong>ä¸ºå¤šæ€åŸºç±»å£°æ˜è™šææ„å‡½æ•°</strong>ï¼šç¡®ä¿æ­£ç¡®çš„ææ„é¡ºåº</li>
<li><strong>ä½¿ç”¨<code>= default</code></strong>ï¼šè®©ç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤å®ç°</li>
<li><strong>è€ƒè™‘ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šè‡ªåŠ¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>ä¸è¦ç»§æ‰¿æ ‡å‡†åº“å®¹å™¨</strong>ï¼šå®ƒä»¬çš„ææ„å‡½æ•°ä¸æ˜¯è™šçš„</li>
</ul>
<p><strong>ç°ä»£C++æœ€ä½³å®è·µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èçš„å¤šæ€åŸºç±»è®¾è®¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RecommendedBase</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">RecommendedBase</span>() = <span class="keyword">default</span>;     <span class="comment">// è™šææ„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">interface</span><span class="params">()</span> </span>= <span class="number">0</span>;            <span class="comment">// çº¯è™šæ¥å£</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">RecommendedBase</span>() = <span class="keyword">default</span>;              <span class="comment">// ä¿æŠ¤æ„é€ å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šå¸¸ç¦æ­¢æ‹·è´</span></span><br><span class="line">    <span class="built_in">RecommendedBase</span>(<span class="type">const</span> RecommendedBase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    RecommendedBase&amp; <span class="keyword">operator</span>=(<span class="type">const</span> RecommendedBase&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯é€‰æ‹©æ€§å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">RecommendedBase</span>(RecommendedBase&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    RecommendedBase&amp; <span class="keyword">operator</span>=(RecommendedBase&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è®°ä½ä¸¤ä¸ªè¦ç‚¹ï¼š</strong></p>
<ul>
<li>polymorphicï¼ˆå¸¦å¤šæ€æ€§è´¨çš„ï¼‰base classesåº”è¯¥å£°æ˜ä¸€ä¸ªvirtualææ„å‡½æ•°ã€‚å¦‚æœclasså¸¦æœ‰ä»»ä½•virtualå‡½æ•°ï¼Œå®ƒå°±åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªvirtualææ„å‡½æ•°</li>
<li>Classesçš„è®¾è®¡ç›®çš„å¦‚æœä¸æ˜¯ä½œä¸ºbase classesä½¿ç”¨ï¼Œæˆ–ä¸æ˜¯ä¸ºäº†å…·å¤‡å¤šæ€æ€§ï¼ˆpolymorphicï¼‰ï¼Œå°±ä¸è¯¥å£°æ˜virtualææ„å‡½æ•°</li>
</ul>
<h2 id="æ¡æ¬¾08ï¼š-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"><a href="#æ¡æ¬¾08ï¼š-åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾08ï¼š åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"></a>æ¡æ¬¾08ï¼š åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</h2><blockquote>
<p><em>Prevent exceptions from leaving destructors</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-7"><a href="#æ ¸å¿ƒç†å¿µ-7" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ä¼šå¯¼è‡´ç¨‹åºçš„æœªå®šä¹‰è¡Œä¸º</strong>ï¼Œç‰¹åˆ«æ˜¯åœ¨æ ˆå±•å¼€ï¼ˆstack unwindingï¼‰è¿‡ç¨‹ä¸­ã€‚å½“å¤šä¸ªå¯¹è±¡åŒæ—¶ææ„æ—¶ï¼Œå¦‚æœææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºå°†é¢ä¸´â€åŒæ—¶å¤„ç†ä¸¤ä¸ªå¼‚å¸¸â€çš„å›°å¢ƒï¼Œé€šå¸¸å¯¼è‡´ç¨‹åºterminateã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨ææ„å‡½æ•°ä¸­æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¦ä¹ˆåæ‰å®ƒä»¬ï¼Œè¦ä¹ˆè®°å½•æ—¥å¿—åç»“æŸç¨‹åºã€‚</p>
<h3 id="æ·±åº¦è§£æ-7"><a href="#æ·±åº¦è§£æ-7" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ææ„å‡½æ•°æŠ›å¼‚å¸¸çš„å±é™©æ€§"><a href="#1-ææ„å‡½æ•°æŠ›å¼‚å¸¸çš„å±é™©æ€§" class="headerlink" title="1. ææ„å‡½æ•°æŠ›å¼‚å¸¸çš„å±é™©æ€§"></a>1. <strong>ææ„å‡½æ•°æŠ›å¼‚å¸¸çš„å±é™©æ€§</strong></h4><p><strong>åŒé‡å¼‚å¸¸é—®é¢˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ProblematicDestructor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">ProblematicDestructor</span>() &#123;</span><br><span class="line">        <span class="comment">// å±é™©ï¼ææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Destructor failed!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDoubleException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ProblematicDestructor obj1;</span><br><span class="line">        ProblematicDestructor obj2;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨æŠ›å‡ºç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œå¼€å§‹æ ˆå±•å¼€</span></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">logic_error</span>(<span class="string">&quot;Primary exception&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“æ ˆå±•å¼€æ—¶ï¼š</span></span><br><span class="line">        <span class="comment">// 1. obj2ææ„ -&gt; æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="comment">// 2. obj1ææ„ -&gt; åˆæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="comment">// ç»“æœï¼šç¨‹åºterminateï¼</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ°¸è¿œä¸ä¼šåˆ°è¾¾ï¼Œå› ä¸ºç¨‹åºå·²ç»terminate</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Caught: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®¹å™¨ææ„çš„è¿é”ååº”ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BadResource</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BadResource</span>(<span class="type">int</span> id) : <span class="built_in">id_</span>(id) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">BadResource</span>() &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿææ„å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (id_ % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Even numbered resource failed to destruct&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateContainerDestruction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        std::vector&lt;BadResource&gt; resources;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ å¤šä¸ªèµ„æº</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">            resources.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å½“vectorææ„æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨æ¯ä¸ªå…ƒç´ çš„ææ„å‡½æ•°</span></span><br><span class="line">        <span class="comment">// å¦‚æœä»»ä½•ä¸€ä¸ªæŠ›å‡ºå¼‚å¸¸ï¼Œæ•´ä¸ªç¨‹åºå¯èƒ½å´©æºƒ</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;This may never be reached\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ ˆå±•å¼€è¿‡ç¨‹ä¸­çš„å¼‚å¸¸"><a href="#2-æ ˆå±•å¼€è¿‡ç¨‹ä¸­çš„å¼‚å¸¸" class="headerlink" title="2. æ ˆå±•å¼€è¿‡ç¨‹ä¸­çš„å¼‚å¸¸"></a>2. <strong>æ ˆå±•å¼€è¿‡ç¨‹ä¸­çš„å¼‚å¸¸</strong></h4><p><strong>ç†è§£æ ˆå±•å¼€ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StackUnwindingDemo</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">StackUnwindingDemo</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;</span><br><span class="line">        std::cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; constructed\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ å±é™©çš„ææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">StackUnwindingDemo</span>() <span class="built_in">noexcept</span>(<span class="literal">false</span>) &#123;  <span class="comment">// æ˜ç¡®æ ‡è®°å¯èƒ½æŠ›å¼‚å¸¸</span></span><br><span class="line">        std::cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; destructor called\n&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (name_ == <span class="string">&quot;problematic&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(name_ + <span class="string">&quot; destructor failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStackUnwinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">StackUnwindingDemo <span class="title">obj1</span><span class="params">(<span class="string">&quot;first&quot;</span>)</span></span>;</span><br><span class="line">        <span class="function">StackUnwindingDemo <span class="title">obj2</span><span class="params">(<span class="string">&quot;problematic&quot;</span>)</span></span>;  <span class="comment">// è¿™ä¸ªä¼šåœ¨ææ„æ—¶æŠ›å¼‚å¸¸</span></span><br><span class="line">        <span class="function">StackUnwindingDemo <span class="title">obj3</span><span class="params">(<span class="string">&quot;third&quot;</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">logic_error</span>(<span class="string">&quot;Main exception&quot;</span>);  <span class="comment">// å¼€å§‹æ ˆå±•å¼€</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ˆå±•å¼€é¡ºåºï¼šobj3 -&gt; obj2 -&gt; obj1</span></span><br><span class="line">        <span class="comment">// å½“obj2ææ„æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºterminate</span></span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Caught: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ­£ç¡®å¤„ç†ææ„å‡½æ•°ä¸­çš„å¼‚å¸¸"><a href="#3-æ­£ç¡®å¤„ç†ææ„å‡½æ•°ä¸­çš„å¼‚å¸¸" class="headerlink" title="3. æ­£ç¡®å¤„ç†ææ„å‡½æ•°ä¸­çš„å¼‚å¸¸"></a>3. <strong>æ­£ç¡®å¤„ç†ææ„å‡½æ•°ä¸­çš„å¼‚å¸¸</strong></h4><p><strong>æ–¹æ³•1ï¼šåæ‰å¼‚å¸¸</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeDestructor1</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SafeDestructor1</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">SafeDestructor1</span>() <span class="keyword">noexcept</span> &#123;  <span class="comment">// ä¿è¯ä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ¸…ç†æ“ä½œ</span></span><br><span class="line">            <span class="built_in">performCleanup</span>();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•é”™è¯¯ä½†ä¸é‡æ–°æŠ›å‡º</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Error in destructor of &quot;</span> &lt;&lt; name_ </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¼‚å¸¸è¢«&quot;åæ‰&quot;ï¼Œä¸ä¼šä¼ æ’­</span></span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// æ•è·æ‰€æœ‰å…¶ä»–å¼‚å¸¸</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Unknown error in destructor of &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">performCleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå¯èƒ½å¤±è´¥çš„æ¸…ç†æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (name_ == <span class="string">&quot;fail&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Cleanup failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•2ï¼šç»ˆæ­¢ç¨‹åº</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeDestructor2</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SafeDestructor2</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">SafeDestructor2</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">performCriticalCleanup</span>();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">            <span class="comment">// å¯¹äºå…³é”®èµ„æºï¼Œæ¸…ç†å¤±è´¥å¯èƒ½æ„å‘³ç€ç¨‹åºçŠ¶æ€ä¸ä¸€è‡´</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Critical cleanup failed for &quot;</span> &lt;&lt; name_ </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é€‰æ‹©ç»ˆæ­¢ç¨‹åºè€Œä¸æ˜¯ç»§ç»­è¿è¡Œåœ¨ä¸ä¸€è‡´çŠ¶æ€</span></span><br><span class="line">            std::<span class="built_in">abort</span>();  <span class="comment">// æˆ–è€… std::terminate()</span></span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Critical cleanup failed with unknown error for &quot;</span> </span><br><span class="line">                      &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">            std::<span class="built_in">abort</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">performCriticalCleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å…³é”®æ¸…ç†æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> (name_ == <span class="string">&quot;critical_fail&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Critical cleanup failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-æä¾›æ™®é€šå‡½æ•°å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ"><a href="#4-æä¾›æ™®é€šå‡½æ•°å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ" class="headerlink" title="4. æä¾›æ™®é€šå‡½æ•°å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ"></a>4. <strong>æä¾›æ™®é€šå‡½æ•°å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ</strong></h4><p><strong>è®¾è®¡åŸåˆ™ï¼šåˆ†ç¦»å¯èƒ½å¤±è´¥çš„æ“ä½œ</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConnection</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span> connected_;</span><br><span class="line">    std::string connection_string_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">DatabaseConnection</span><span class="params">(<span class="type">const</span> std::string&amp; conn_str)</span> </span></span><br><span class="line"><span class="function">        : connected_(true), connection_string_(conn_str) &#123;</span></span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æä¾›æ˜¾å¼çš„æ¸…ç†å‡½æ•°ï¼Œå…è®¸å¼‚å¸¸ä¼ æ’­</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (connected_) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œè°ƒç”¨è€…å¯ä»¥å¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (connection_string_ == <span class="string">&quot;bad_connection&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to close database connection&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            connected_ = <span class="literal">false</span>;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Database connection closed successfully\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ææ„å‡½æ•°æä¾›&quot;æœ€åçš„é˜²çº¿&quot;ï¼Œä½†ä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">    ~<span class="built_in">DatabaseConnection</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (connected_) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å°è¯•æ¸…ç†ï¼Œä½†ä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">                <span class="built_in">close</span>();</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">                <span class="comment">// è®°å½•é”™è¯¯ï¼Œä½†ä¸ä¼ æ’­å¼‚å¸¸</span></span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;Warning: Failed to close connection in destructor: &quot;</span> </span><br><span class="line">                          &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">                <span class="comment">// å¯èƒ½è¿˜éœ€è¦åšä¸€äº›ç´§æ€¥æ¸…ç†</span></span><br><span class="line">                connected_ = <span class="literal">false</span>;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;Warning: Unknown error closing connection in destructor\n&quot;</span>;</span><br><span class="line">                connected_ = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isConnected</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> connected_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProperDesign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">DatabaseConnection <span class="title">conn</span><span class="params">(<span class="string">&quot;good_connection&quot;</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿›è¡Œæ•°æ®åº“æ“ä½œ...</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ˜¾å¼å…³é—­ï¼Œå¯ä»¥å¤„ç†å¼‚å¸¸</span></span><br><span class="line">        conn.<span class="built_in">close</span>();</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Handled connection error: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ˜¾å¼å…³é—­ï¼Œææ„å‡½æ•°ä¼šé™é»˜å¤„ç†</span></span><br><span class="line">    <span class="function">DatabaseConnection <span class="title">conn2</span><span class="params">(<span class="string">&quot;bad_connection&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">// conn2ææ„æ—¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œåªä¼šè®°å½•è­¦å‘Š</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-RAIIç±»çš„å¼‚å¸¸å®‰å…¨è®¾è®¡"><a href="#5-RAIIç±»çš„å¼‚å¸¸å®‰å…¨è®¾è®¡" class="headerlink" title="5. RAIIç±»çš„å¼‚å¸¸å®‰å…¨è®¾è®¡"></a>5. <strong>RAIIç±»çš„å¼‚å¸¸å®‰å…¨è®¾è®¡</strong></h4><p><strong>æ–‡ä»¶ç®¡ç†çš„ä¾‹å­ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeFileHandler</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line">    std::string filename_;</span><br><span class="line">    <span class="type">bool</span> explicitly_closed_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SafeFileHandler</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span> </span></span><br><span class="line"><span class="function">        : filename_(filename), explicitly_closed_(false) &#123;</span></span><br><span class="line">        </span><br><span class="line">        file_ = std::<span class="built_in">fopen</span>(filename.<span class="built_in">c_str</span>(), <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file: &quot;</span> + filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›æ˜¾å¼å…³é—­å‡½æ•°ï¼Œå…è®¸é”™è¯¯å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file_ &amp;&amp; !explicitly_closed_) &#123;</span><br><span class="line">            <span class="keyword">if</span> (std::<span class="built_in">fclose</span>(file_) != <span class="number">0</span>) &#123;</span><br><span class="line">                file_ = <span class="literal">nullptr</span>;  <span class="comment">// æ ‡è®°ä¸ºå·²å…³é—­ï¼Œå³ä½¿å¤±è´¥</span></span><br><span class="line">                explicitly_closed_ = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to close file: &quot;</span> + filename_);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            file_ = <span class="literal">nullptr</span>;</span><br><span class="line">            explicitly_closed_ = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®ï¼ˆå¯èƒ½å¤±è´¥ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">logic_error</span>(<span class="string">&quot;File is not open&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (std::<span class="built_in">fputs</span>(data.<span class="built_in">c_str</span>(), file_) == EOF) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to write to file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°ï¼šæœ€åçš„å®‰å…¨ç½‘</span></span><br><span class="line">    ~<span class="built_in">SafeFileHandler</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_ &amp;&amp; !explicitly_closed_) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•å…³é—­ï¼Œä½†ä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (std::<span class="built_in">fclose</span>(file_) != <span class="number">0</span>) &#123;</span><br><span class="line">                std::cerr &lt;&lt; <span class="string">&quot;Warning: Failed to close file &quot;</span> &lt;&lt; filename_ </span><br><span class="line">                          &lt;&lt; <span class="string">&quot; in destructor\n&quot;</span>;</span><br><span class="line">                <span class="comment">// å¯èƒ½éœ€è¦è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶æˆ–ç³»ç»Ÿæ—¥å¿—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´ï¼Œé¿å…é‡å¤å…³é—­</span></span><br><span class="line">    <span class="built_in">SafeFileHandler</span>(<span class="type">const</span> SafeFileHandler&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    SafeFileHandler&amp; <span class="keyword">operator</span>=(<span class="type">const</span> SafeFileHandler&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…è®¸ç§»åŠ¨</span></span><br><span class="line">    <span class="built_in">SafeFileHandler</span>(SafeFileHandler&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">file_</span>(other.file_), <span class="built_in">filename_</span>(std::<span class="built_in">move</span>(other.filename_)),</span><br><span class="line">          <span class="built_in">explicitly_closed_</span>(other.explicitly_closed_) &#123;</span><br><span class="line">        other.file_ = <span class="literal">nullptr</span>;</span><br><span class="line">        other.explicitly_closed_ = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateFileHandling</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">SafeFileHandler <span class="title">file</span><span class="params">(<span class="string">&quot;test.txt&quot;</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        file.<span class="built_in">write</span>(<span class="string">&quot;Hello, World!\n&quot;</span>);</span><br><span class="line">        file.<span class="built_in">write</span>(<span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ˜¾å¼å…³é—­ï¼Œå¯ä»¥å¤„ç†é”™è¯¯</span></span><br><span class="line">        file.<span class="built_in">close</span>();</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;File operations completed successfully\n&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;File operation failed: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-ç°ä»£C-çš„å¼‚å¸¸å®‰å…¨ææ„å‡½æ•°"><a href="#6-ç°ä»£C-çš„å¼‚å¸¸å®‰å…¨ææ„å‡½æ•°" class="headerlink" title="6. ç°ä»£C++çš„å¼‚å¸¸å®‰å…¨ææ„å‡½æ•°"></a>6. <strong>ç°ä»£C++çš„å¼‚å¸¸å®‰å…¨ææ„å‡½æ•°</strong></h4><p><strong>ä½¿ç”¨noexceptè§„èŒƒï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernSafeClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernSafeClass</span>(<span class="type">size_t</span> size) : <span class="built_in">data_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size)), <span class="built_in">size_</span>(size) &#123;&#125;  <span class="comment">// C++14</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç°ä»£C++ææ„å‡½æ•°é»˜è®¤æ˜¯noexceptçš„</span></span><br><span class="line">    ~<span class="built_in">ModernSafeClass</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="comment">// æ™ºèƒ½æŒ‡é’ˆä¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Safely destroyed ModernSafeClass with &quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; elements\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°ä¹Ÿåº”è¯¥æ˜¯noexceptçš„</span></span><br><span class="line">    <span class="built_in">ModernSafeClass</span>(ModernSafeClass&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">data_</span>(std::<span class="built_in">move</span>(other.data_)), <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        other.size_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernSafeClass&amp; <span class="keyword">operator</span>=(ModernSafeClass&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            data_ = std::<span class="built_in">move</span>(other.data_);</span><br><span class="line">            size_ = other.size_;</span><br><span class="line">            other.size_ = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ™ºèƒ½æŒ‡é’ˆå’Œå®¹å™¨çš„å¼‚å¸¸å®‰å…¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ContainerSafeClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;std::string&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;std::ofstream&gt; log_file_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ContainerSafeClass</span>() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log_file_ = std::<span class="built_in">make_unique</span>&lt;std::ofstream&gt;(<span class="string">&quot;log.txt&quot;</span>);</span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// æ„é€ å‡½æ•°ä¸­å¯ä»¥æŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">ContainerSafeClass</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="comment">// std::vectorå’Œstd::unique_ptrçš„ææ„å‡½æ•°éƒ½æ˜¯noexceptçš„</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿™ä¸ªææ„å‡½æ•°å¤©ç„¶å°±æ˜¯å®‰å…¨çš„</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (log_file_ &amp;&amp; log_file_-&gt;<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                *log_file_ &lt;&lt; <span class="string">&quot;Object destroyed safely\n&quot;</span>;</span><br><span class="line">                log_file_-&gt;<span class="built_in">close</span>();  <span class="comment">// è¿™å¯èƒ½å¤±è´¥ï¼Œä½†æˆ‘ä»¬æ•è·å¼‚å¸¸</span></span><br><span class="line">            &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">                <span class="comment">// é™é»˜å¤„ç†æ–‡ä»¶å…³é—­é”™è¯¯</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addData</span><span class="params">(<span class="type">const</span> std::string&amp; item)</span> </span>&#123;</span><br><span class="line">        data_.<span class="built_in">push_back</span>(item);  <span class="comment">// è¿™é‡Œå¯ä»¥æŠ›å¼‚å¸¸ï¼Œå› ä¸ºä¸åœ¨ææ„å‡½æ•°ä¸­</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (log_file_) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                *log_file_ &lt;&lt; <span class="string">&quot;Added: &quot;</span> &lt;&lt; item &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">                <span class="comment">// æ—¥å¿—å¤±è´¥ä¸åº”è¯¥å½±å“ä¸»è¦åŠŸèƒ½</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-å¼‚å¸¸å®‰å…¨çº§åˆ«ä¸ææ„å‡½æ•°"><a href="#7-å¼‚å¸¸å®‰å…¨çº§åˆ«ä¸ææ„å‡½æ•°" class="headerlink" title="7. å¼‚å¸¸å®‰å…¨çº§åˆ«ä¸ææ„å‡½æ•°"></a>7. <strong>å¼‚å¸¸å®‰å…¨çº§åˆ«ä¸ææ„å‡½æ•°</strong></h4><p><strong>ä¸‰ç§å¼‚å¸¸å®‰å…¨ä¿è¯ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExceptionSafetyDemo</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;std::string&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;std::ofstream&gt; backup_file_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼šå¯ä»¥æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="built_in">ExceptionSafetyDemo</span>(<span class="type">const</span> std::string&amp; backup_path) &#123;</span><br><span class="line">        backup_file_ = std::<span class="built_in">make_unique</span>&lt;std::ofstream&gt;(backup_path);</span><br><span class="line">        <span class="keyword">if</span> (!backup_file_-&gt;<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Cannot open backup file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ä¿è¯ï¼šæ“ä½œå¯èƒ½å¤±è´¥ï¼Œä½†å¯¹è±¡çŠ¶æ€ä¸€è‡´</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addItem</span><span class="params">(<span class="type">const</span> std::string&amp; item)</span> </span>&#123;</span><br><span class="line">        data_.<span class="built_in">push_back</span>(item);  <span class="comment">// å¯èƒ½æŠ›å¼‚å¸¸</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå¤‡ä»½å¤±è´¥ï¼Œæˆ‘ä»¬ä¸å›æ»šä¸»æ•°æ®</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            *backup_file_ &lt;&lt; item &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            backup_file_-&gt;<span class="built_in">flush</span>();</span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// åŸºæœ¬ä¿è¯ï¼šä¸»æ•°æ®å·²æ·»åŠ ï¼Œä½†å¤‡ä»½å¯èƒ½å¤±è´¥</span></span><br><span class="line">            std::cerr &lt;&lt; <span class="string">&quot;Warning: Failed to backup item\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¼ºä¿è¯ï¼šè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addItemWithStrongGuarantee</span><span class="params">(<span class="type">const</span> std::string&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å…ˆå¤‡ä»½</span></span><br><span class="line">        std::streampos pos = backup_file_-&gt;<span class="built_in">tellp</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            *backup_file_ &lt;&lt; item &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            backup_file_-&gt;<span class="built_in">flush</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤‡ä»½æˆåŠŸåå†æ·»åŠ åˆ°ä¸»æ•°æ®</span></span><br><span class="line">            data_.<span class="built_in">push_back</span>(item);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// æ¢å¤å¤‡ä»½æ–‡ä»¶çŠ¶æ€</span></span><br><span class="line">            backup_file_-&gt;<span class="built_in">seekp</span>(pos);</span><br><span class="line">            <span class="keyword">throw</span>;  <span class="comment">// é‡æ–°æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸æŠ›å¼‚å¸¸ä¿è¯ï¼šææ„å‡½æ•°å¿…é¡»æä¾›</span></span><br><span class="line">    ~<span class="built_in">ExceptionSafetyDemo</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¿…é¡»æä¾›ä¸æŠ›å¼‚å¸¸ä¿è¯</span></span><br><span class="line">        <span class="keyword">if</span> (backup_file_) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                backup_file_-&gt;<span class="built_in">close</span>();</span><br><span class="line">            &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">                <span class="comment">// åæ‰æ‰€æœ‰å¼‚å¸¸</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ææ„å‡½æ•°å¼‚å¸¸å®‰å…¨çš„æ ¸å¿ƒåŸåˆ™ï¼š</strong></p>
<ol>
<li><strong>ææ„å‡½æ•°ç»å¯¹ä¸è¦æŠ›å‡ºå¼‚å¸¸</strong></li>
<li><strong>åœ¨ææ„å‡½æ•°ä¸­æ•è·æ‰€æœ‰å¼‚å¸¸</strong></li>
<li><strong>æä¾›æ™®é€šå‡½æ•°å¤„ç†å¯èƒ½å¤±è´¥çš„æ“ä½œ</strong></li>
</ol>
<p><strong>å¤„ç†ææ„å‡½æ•°å¼‚å¸¸çš„ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>åæ‰å¼‚å¸¸</strong>ï¼šè®°å½•é”™è¯¯ä½†ä¸ä¼ æ’­</li>
<li><strong>ç»ˆæ­¢ç¨‹åº</strong>ï¼šå¯¹äºå…³é”®é”™è¯¯ï¼Œé€‰æ‹©abort()</li>
<li><strong>ä½¿ç”¨noexceptè§„èŒƒ</strong>ï¼šæ˜ç¡®æ ‡è®°å‡½æ•°ä¸æŠ›å¼‚å¸¸</li>
</ul>
<p><strong>è®¾è®¡æ¨¡å¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RecommendedPattern</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æä¾›æ˜¾å¼æ“ä½œå‡½æ•°ï¼Œå…è®¸å¼‚å¸¸å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">explicitCleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œè°ƒç”¨è€…è´Ÿè´£å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°ä½œä¸ºæœ€åçš„å®‰å…¨ç½‘</span></span><br><span class="line">    ~<span class="built_in">RecommendedPattern</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">explicitCleanup</span>();</span><br><span class="line">        &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•é”™è¯¯ä½†ä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨RAIIå’Œæ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šå®ƒä»¬çš„ææ„å‡½æ•°æ˜¯å¼‚å¸¸å®‰å…¨çš„</li>
<li><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong>ï¼šå°†å¯èƒ½å¤±è´¥çš„æ“ä½œæå–åˆ°æ™®é€šå‡½æ•°ä¸­</li>
<li><strong>ä½¿ç”¨noexcept</strong>ï¼šæ˜ç¡®è¡¨è¾¾å¼‚å¸¸å®‰å…¨ä¿è¯</li>
<li><strong>è®°å½•é”™è¯¯</strong>ï¼šå³ä½¿ä¸èƒ½æŠ›å¼‚å¸¸ï¼Œä¹Ÿè¦è®°å½•é—®é¢˜</li>
</ul>
<p><strong>è®°ä½ä¸¤ä¸ªè¦ç‚¹ï¼š</strong></p>
<ul>
<li>ææ„å‡½æ•°ç»å¯¹ä¸è¦åå‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸€ä¸ªè¢«ææ„å‡½æ•°è°ƒç”¨çš„å‡½æ•°å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œææ„å‡½æ•°åº”è¯¥æ•æ‰ä»»ä½•å¼‚å¸¸ï¼Œç„¶ååä¸‹å®ƒä»¬ï¼ˆä¸ä¼ æ’­ï¼‰æˆ–ç»“æŸç¨‹åº</li>
<li>å¦‚æœå®¢æˆ·éœ€è¦å¯¹æŸä¸ªæ“ä½œå‡½æ•°è¿è¡ŒæœŸé—´æŠ›å‡ºçš„å¼‚å¸¸åšå‡ºååº”ï¼Œé‚£ä¹ˆclassåº”è¯¥æä¾›ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼ˆè€Œéåœ¨ææ„å‡½æ•°ä¸­ï¼‰æ‰§è¡Œè¯¥æ“ä½œ</li>
</ul>
<h2 id="æ¡æ¬¾09-ï¼š-ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°"><a href="#æ¡æ¬¾09-ï¼š-ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°" class="headerlink" title="æ¡æ¬¾09 ï¼š ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°"></a>æ¡æ¬¾09 ï¼š ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°</h2><blockquote>
<p><em>Never call virtual functions during construction or destruction</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-8"><a href="#æ ¸å¿ƒç†å¿µ-8" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­ï¼Œ<strong>è™šå‡½æ•°è°ƒç”¨ä¸ä¼šè¡¨ç°å‡ºå¤šæ€è¡Œä¸º</strong>ã€‚å½“åŸºç±»æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°æ‰§è¡Œæ—¶ï¼Œæ´¾ç”Ÿç±»çš„éƒ¨åˆ†è¿˜æœªæ„é€ å®Œæˆæˆ–å·²è¢«é”€æ¯ï¼Œæ­¤æ—¶è°ƒç”¨è™šå‡½æ•°åªä¼šè°ƒç”¨å½“å‰æ­£åœ¨æ„é€ &#x2F;ææ„çš„ç±»çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æœ€ç»ˆæ´¾ç”Ÿç±»çš„ç‰ˆæœ¬ã€‚è¿™ç§è¡Œä¸ºå¾€å¾€ä¸ç¨‹åºå‘˜çš„æœŸæœ›ä¸ç¬¦ï¼Œå¯èƒ½å¯¼è‡´éš¾ä»¥å‘ç°çš„é€»è¾‘é”™è¯¯ã€‚</p>
<h3 id="æ·±åº¦è§£æ-8"><a href="#æ·±åº¦è§£æ-8" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-é—®é¢˜æ ¹æºï¼šå¯¹è±¡æ„é€ å’Œææ„çš„é˜¶æ®µæ€§"><a href="#1-é—®é¢˜æ ¹æºï¼šå¯¹è±¡æ„é€ å’Œææ„çš„é˜¶æ®µæ€§" class="headerlink" title="1. é—®é¢˜æ ¹æºï¼šå¯¹è±¡æ„é€ å’Œææ„çš„é˜¶æ®µæ€§"></a>1. <strong>é—®é¢˜æ ¹æºï¼šå¯¹è±¡æ„é€ å’Œææ„çš„é˜¶æ®µæ€§</strong></h4><p><strong>æ„é€ è¿‡ç¨‹ä¸­çš„è™šå‡½æ•°è°ƒç”¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Transaction</span>() &#123;</span><br><span class="line">        <span class="comment">// âŒ å±é™©ï¼šåœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">        <span class="built_in">logTransaction</span>();  <span class="comment">// æ€»æ˜¯è°ƒç”¨Transaction::logTransaction()</span></span><br><span class="line">                          <span class="comment">// å³ä½¿è¿™æ˜¯æ´¾ç”Ÿç±»çš„æ„é€ è¿‡ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">logTransaction</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Transaction base logging\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Transaction</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuyTransaction</span> : <span class="keyword">public</span> Transaction &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BuyTransaction</span>() &#123;</span><br><span class="line">        <span class="comment">// åœ¨è¿™ä¸ªæ„é€ å‡½æ•°æ‰§è¡Œå‰ï¼ŒTransactionçš„æ„é€ å‡½æ•°å·²ç»è°ƒç”¨äº†logTransaction()</span></span><br><span class="line">        <span class="comment">// ä½†è°ƒç”¨çš„æ˜¯Transaction::logTransaction()ï¼Œè€Œä¸æ˜¯BuyTransaction::logTransaction()</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;BuyTransaction constructed\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">logTransaction</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Buy transaction logging\n&quot;</span>;  <span class="comment">// åœ¨æ„é€ æœŸé—´ä¸ä¼šè¢«è°ƒç”¨ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateConstructionProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BuyTransaction buy;  <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">                         <span class="comment">// &quot;Transaction base logging&quot;     â† åŸºç±»ç‰ˆæœ¬è¢«è°ƒç”¨</span></span><br><span class="line">                         <span class="comment">// &quot;BuyTransaction constructed&quot;   â† æ´¾ç”Ÿç±»æ„é€ å®Œæˆ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœŸæœ›ï¼šè°ƒç”¨BuyTransaction::logTransaction()</span></span><br><span class="line">    <span class="comment">// å®é™…ï¼šè°ƒç”¨Transaction::logTransaction()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ææ„è¿‡ç¨‹ä¸­çš„è™šå‡½æ•°è°ƒç”¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Resource</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Resource</span>() &#123;</span><br><span class="line">        <span class="comment">// âŒ å±é™©ï¼šåœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">        <span class="built_in">cleanup</span>();  <span class="comment">// æ€»æ˜¯è°ƒç”¨Resource::cleanup()</span></span><br><span class="line">                    <span class="comment">// å³ä½¿è¿™æ˜¯æ´¾ç”Ÿç±»å¯¹è±¡çš„ææ„</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource cleanup: &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseResource</span> : <span class="keyword">public</span> Resource &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DatabaseResource</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">Resource</span>(name), <span class="built_in">data_</span>(<span class="number">1000</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">DatabaseResource</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;DatabaseResource destructor\n&quot;</span>;</span><br><span class="line">        <span class="comment">// åœ¨è¿™ä¸ªææ„å‡½æ•°æ‰§è¡Œåï¼ŒResourceçš„ææ„å‡½æ•°ä¼šè°ƒç”¨cleanup()</span></span><br><span class="line">        <span class="comment">// ä½†è°ƒç”¨çš„æ˜¯Resource::cleanup()ï¼Œè€Œä¸æ˜¯DatabaseResource::cleanup()</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Database cleanup with &quot;</span> &lt;&lt; data_.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; elements\n&quot;</span>;</span><br><span class="line">        data_.<span class="built_in">clear</span>();  <span class="comment">// åœ¨ææ„æœŸé—´è¿™å¯èƒ½å·²ç»æ— æ„ä¹‰æˆ–å±é™©ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDestructionProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DatabaseResource* db = <span class="keyword">new</span> <span class="built_in">DatabaseResource</span>(<span class="string">&quot;TestDB&quot;</span>);</span><br><span class="line">    <span class="keyword">delete</span> db;  <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">                <span class="comment">// &quot;DatabaseResource destructor&quot;     â† æ´¾ç”Ÿç±»ææ„å‡½æ•°</span></span><br><span class="line">                <span class="comment">// &quot;Resource cleanup: TestDB&quot;        â† åŸºç±»ç‰ˆæœ¬è¢«è°ƒç”¨</span></span><br><span class="line">                </span><br><span class="line">    <span class="comment">// æœŸæœ›ï¼šè°ƒç”¨DatabaseResource::cleanup()</span></span><br><span class="line">    <span class="comment">// å®é™…ï¼šè°ƒç”¨Resource::cleanup()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ä¸ºä»€ä¹ˆè™šå‡½æ•°åœ¨æ„é€ -ææ„ä¸­ä¸èµ·ä½œç”¨"><a href="#2-ä¸ºä»€ä¹ˆè™šå‡½æ•°åœ¨æ„é€ -ææ„ä¸­ä¸èµ·ä½œç”¨" class="headerlink" title="2. ä¸ºä»€ä¹ˆè™šå‡½æ•°åœ¨æ„é€ &#x2F;ææ„ä¸­ä¸èµ·ä½œç”¨"></a>2. <strong>ä¸ºä»€ä¹ˆè™šå‡½æ•°åœ¨æ„é€ &#x2F;ææ„ä¸­ä¸èµ·ä½œç”¨</strong></h4><p><strong>å¯¹è±¡æ„é€ çš„é˜¶æ®µæ€§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Base</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base constructor start\n&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ­¤æ—¶å¯¹è±¡çš„ç±»å‹æ˜¯Baseï¼Œä¸æ˜¯Derived</span></span><br><span class="line">        <span class="comment">// è™šå‡½æ•°è¡¨æŒ‡é’ˆæŒ‡å‘Baseçš„è™šå‡½æ•°è¡¨</span></span><br><span class="line">        <span class="built_in">virtualFunction</span>();  <span class="comment">// è°ƒç”¨Base::virtualFunction()</span></span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base constructor end\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualFunction</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::virtualFunction()\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Base</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Derived</span>() : <span class="built_in">data_</span>(<span class="string">&quot;Derived data&quot;</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived constructor\n&quot;</span>;</span><br><span class="line">        <span class="comment">// åªæœ‰åˆ°è¿™é‡Œï¼Œå¯¹è±¡æ‰çœŸæ­£å˜æˆDerivedç±»å‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">virtualFunction</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::virtualFunction() with data: &quot;</span> &lt;&lt; data_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨Baseæ„é€ å‡½æ•°ä¸­è°ƒç”¨ï¼Œdata_è¿˜æœªåˆå§‹åŒ–ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStageConstruction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Creating Derived object:\n&quot;</span>;</span><br><span class="line">    Derived d;  <span class="comment">// æ„é€ é¡ºåºï¼š</span></span><br><span class="line">                <span class="comment">// 1. Base constructor start</span></span><br><span class="line">                <span class="comment">// 2. Base::virtualFunction()      â† ä¸æ˜¯Derivedç‰ˆæœ¬ï¼</span></span><br><span class="line">                <span class="comment">// 3. Base constructor end</span></span><br><span class="line">                <span class="comment">// 4. Derived constructor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç±»å‹å®‰å…¨çš„è€ƒè™‘ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafetyDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SafetyDemo</span>() &#123;</span><br><span class="line">        <span class="comment">// C++çš„è®¾è®¡ç¡®ä¿ç±»å‹å®‰å…¨</span></span><br><span class="line">        <span class="comment">// åœ¨æ„é€ æœŸé—´ï¼Œå¯¹è±¡çš„&quot;ç±»å‹&quot;å°±æ˜¯å½“å‰æ­£åœ¨æ„é€ çš„ç±»</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Type during construction: &quot;</span> &lt;&lt; <span class="built_in">typeid</span>(*<span class="keyword">this</span>).<span class="built_in">name</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">SafetyDemo</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">identify</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSafety</span> : <span class="keyword">public</span> SafetyDemo &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConcreteSafety</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Type in derived constructor: &quot;</span> &lt;&lt; <span class="built_in">typeid</span>(*<span class="keyword">this</span>).<span class="built_in">name</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// ç°åœ¨å¯ä»¥å®‰å…¨è°ƒç”¨è™šå‡½æ•°ï¼Œå› ä¸ºå¯¹è±¡æ„é€ å®Œæˆ</span></span><br><span class="line">        <span class="built_in">identify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">identify</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteSafety object\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-è§£å†³æ–¹æ¡ˆï¼šé¿å…åœ¨æ„é€ -ææ„ä¸­è°ƒç”¨è™šå‡½æ•°"><a href="#3-è§£å†³æ–¹æ¡ˆï¼šé¿å…åœ¨æ„é€ -ææ„ä¸­è°ƒç”¨è™šå‡½æ•°" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆï¼šé¿å…åœ¨æ„é€ &#x2F;ææ„ä¸­è°ƒç”¨è™šå‡½æ•°"></a>3. <strong>è§£å†³æ–¹æ¡ˆï¼šé¿å…åœ¨æ„é€ &#x2F;ææ„ä¸­è°ƒç”¨è™šå‡½æ•°</strong></h4><p><strong>æ–¹æ¡ˆ1ï¼šä½¿ç”¨éè™šå‡½æ•°</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Transaction</span><span class="params">(<span class="type">const</span> std::string&amp; type)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// âœ… è°ƒç”¨éè™šå‡½æ•°ï¼Œä¼ é€’å¿…è¦ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">logTransaction</span>(type);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Transaction</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// éè™šå‡½æ•°ï¼Œåœ¨æ„é€ æœŸé—´å®‰å…¨è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">logTransaction</span><span class="params">(<span class="type">const</span> std::string&amp; type)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Transaction logged: &quot;</span> &lt;&lt; type &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuyTransaction</span> : <span class="keyword">public</span> Transaction &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BuyTransaction</span>() : <span class="built_in">Transaction</span>(<span class="string">&quot;Buy&quot;</span>) &#123;  <span class="comment">// ä¼ é€’ç±»å‹ä¿¡æ¯ç»™åŸºç±»</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;BuyTransaction construction complete\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SellTransaction</span> : <span class="keyword">public</span> Transaction &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SellTransaction</span>() : <span class="built_in">Transaction</span>(<span class="string">&quot;Sell&quot;</span>) &#123;  <span class="comment">// ä¼ é€’ç±»å‹ä¿¡æ¯ç»™åŸºç±»</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;SellTransaction construction complete\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ¡ˆ2ï¼šé™æ€å‡½æ•°è¾…åŠ©</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">logCreation</span><span class="params">(<span class="type">const</span> std::string&amp; objectType, <span class="type">const</span> std::string&amp; details)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Creating &quot;</span> &lt;&lt; objectType &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; details &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">logDestruction</span><span class="params">(<span class="type">const</span> std::string&amp; objectType)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Destroying &quot;</span> &lt;&lt; objectType &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Resource</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> : name_(name) &#123;</span></span><br><span class="line">        <span class="comment">// âœ… åŸºç±»åªè®°å½•è‡ªå·±çš„åˆ›å»º</span></span><br><span class="line">        Logger::<span class="built_in">logCreation</span>(<span class="string">&quot;Resource&quot;</span>, name_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Resource</span>() &#123;</span><br><span class="line">        <span class="comment">// âœ… åŸºç±»åªè®°å½•è‡ªå·±çš„é”€æ¯</span></span><br><span class="line">        Logger::<span class="built_in">logDestruction</span>(<span class="string">&quot;Resource&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileResource</span> : <span class="keyword">public</span> Resource &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::ofstream file_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">FileResource</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span> </span></span><br><span class="line"><span class="function">        : Resource(filename), file_(filename) &#123;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// âœ… æ´¾ç”Ÿç±»è®°å½•è‡ªå·±çš„ç‰¹å®šåˆ›å»ºé€»è¾‘</span></span><br><span class="line">        Logger::<span class="built_in">logCreation</span>(<span class="string">&quot;FileResource&quot;</span>, <span class="string">&quot;opened file: &quot;</span> + filename);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">FileResource</span>() &#123;</span><br><span class="line">        <span class="comment">// âœ… æ´¾ç”Ÿç±»è®°å½•è‡ªå·±çš„ç‰¹å®šé”€æ¯é€»è¾‘</span></span><br><span class="line">        Logger::<span class="built_in">logDestruction</span>(<span class="string">&quot;FileResource&quot;</span>);</span><br><span class="line">        file_.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ¡ˆ3ï¼šä¸¤é˜¶æ®µæ„é€ </strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexObject</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    <span class="type">bool</span> initialized_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ComplexObject</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span></span><br><span class="line"><span class="function">        : name_(name), initialized_(false) &#123;</span></span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°åªåšåŸºæœ¬åˆå§‹åŒ–ï¼Œä¸è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æä¾›åˆå§‹åŒ–å‡½æ•°ï¼Œåœ¨å¯¹è±¡å®Œå…¨æ„é€ åè°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!initialized_) &#123;</span><br><span class="line">            <span class="built_in">performInitialization</span>();  <span class="comment">// ç°åœ¨å¯ä»¥å®‰å…¨è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">            initialized_ = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ComplexObject</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">performInitialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ComplexObject initialized: &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isInitialized</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> initialized_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecializedObject</span> : <span class="keyword">public</span> ComplexObject &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SpecializedObject</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span></span><br><span class="line"><span class="function">        : ComplexObject(name), data_(<span class="number">100</span>) &#123;</span></span><br><span class="line">        <span class="comment">// æ´¾ç”Ÿç±»æ„é€ å®Œæˆåå†åˆå§‹åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">performInitialization</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        ComplexObject::<span class="built_in">performInitialization</span>();  <span class="comment">// è°ƒç”¨åŸºç±»ç‰ˆæœ¬</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;SpecializedObject initialized with &quot;</span> &lt;&lt; data_.<span class="built_in">size</span>() </span><br><span class="line">                  &lt;&lt; <span class="string">&quot; elements\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateTwoPhaseConstruction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">SpecializedObject <span class="title">obj</span><span class="params">(<span class="string">&quot;test&quot;</span>)</span></span>;</span><br><span class="line">    obj.<span class="built_in">initialize</span>();  <span class="comment">// ç°åœ¨è™šå‡½æ•°è°ƒç”¨æŒ‰é¢„æœŸå·¥ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-å®é™…åº”ç”¨ä¸­çš„æœ€ä½³å®è·µ"><a href="#4-å®é™…åº”ç”¨ä¸­çš„æœ€ä½³å®è·µ" class="headerlink" title="4. å®é™…åº”ç”¨ä¸­çš„æœ€ä½³å®è·µ"></a>4. <strong>å®é™…åº”ç”¨ä¸­çš„æœ€ä½³å®è·µ</strong></h4><p><strong>RAIIç±»çš„æ­£ç¡®è®¾è®¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Connection</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string endpoint_;</span><br><span class="line">    <span class="type">bool</span> connected_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Connection</span><span class="params">(<span class="type">const</span> std::string&amp; endpoint)</span> </span></span><br><span class="line"><span class="function">        : endpoint_(endpoint), connected_(false) &#123;</span></span><br><span class="line">        <span class="comment">// âœ… æ„é€ å‡½æ•°ä¸è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">        <span class="built_in">establishConnection</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Connection</span>() &#123;</span><br><span class="line">        <span class="comment">// âœ… ææ„å‡½æ•°ä½¿ç”¨éè™šå‡½æ•°æ¸…ç†</span></span><br><span class="line">        <span class="keyword">if</span> (connected_) &#123;</span><br><span class="line">            <span class="built_in">closeConnection</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// éè™šå‡½æ•°ï¼Œä¾›æ„é€ å‡½æ•°å®‰å…¨è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">establishConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å»ºç«‹è¿æ¥çš„é€šç”¨é€»è¾‘</span></span><br><span class="line">        connected_ = <span class="literal">true</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Connection established to &quot;</span> &lt;&lt; endpoint_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">closeConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å…³é—­è¿æ¥çš„é€šç”¨é€»è¾‘</span></span><br><span class="line">        connected_ = <span class="literal">false</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Connection closed\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… è™šå‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œä¸åœ¨æ„é€ /ææ„ä¸­ä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">sendData</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">receiveData</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isConnected</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> connected_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TCPConnection</span> : <span class="keyword">public</span> Connection &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">TCPConnection</span><span class="params">(<span class="type">const</span> std::string&amp; endpoint)</span> </span></span><br><span class="line"><span class="function">        : Connection(endpoint) &#123;</span></span><br><span class="line">        <span class="comment">// åŸºç±»å·²ç»å®‰å…¨åœ°å»ºç«‹äº†è¿æ¥</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;TCP connection ready\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendData</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isConnected</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Sending TCP data: &quot;</span> &lt;&lt; data &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">receiveData</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isConnected</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;TCP data received&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å·¥å‚æ¨¡å¼é¿å…æ„é€ æœŸé—´çš„è™šå‡½æ•°è°ƒç”¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string title_;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿æŠ¤æ„é€ å‡½æ•°ï¼Œé˜²æ­¢ç›´æ¥æ„é€ </span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Document</span><span class="params">(<span class="type">const</span> std::string&amp; title)</span> : title_(title) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Document</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å·¥å‚æ–¹æ³•ï¼Œç¡®ä¿å¯¹è±¡å®Œå…¨æ„é€ åå†è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="type">static</span> std::unique_ptr&lt;T&gt; <span class="title">create</span><span class="params">(<span class="type">const</span> std::string&amp; title)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(std::is_base_of_v&lt;Document, T&gt;, <span class="string">&quot;T must derive from Document&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> doc = std::<span class="built_in">unique_ptr</span>&lt;T&gt;(<span class="keyword">new</span> <span class="built_in">T</span>(title));</span><br><span class="line">        doc-&gt;<span class="built_in">afterConstruction</span>();  <span class="comment">// å¯¹è±¡å®Œå…¨æ„é€ åè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">save</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">print</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// è™šå‡½æ•°ï¼Œåœ¨å¯¹è±¡å®Œå…¨æ„é€ åè°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">afterConstruction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Document &#x27;&quot;</span> &lt;&lt; title_ &lt;&lt; <span class="string">&quot;&#x27; ready\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextDocument</span> : <span class="keyword">public</span> Document &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string content_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">TextDocument</span><span class="params">(<span class="type">const</span> std::string&amp; title)</span> </span></span><br><span class="line"><span class="function">        : Document(title), content_(<span class="string">&quot;&quot;</span>) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Saving text document: &quot;</span> &lt;&lt; title_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Printing: &quot;</span> &lt;&lt; title_ &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; content_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setContent</span><span class="params">(<span class="type">const</span> std::string&amp; content)</span> </span>&#123;</span><br><span class="line">        content_ = content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">afterConstruction</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        Document::<span class="built_in">afterConstruction</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;TextDocument specific initialization\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Document</span>;  <span class="comment">// å…è®¸å·¥å‚æ–¹æ³•è®¿é—®privateæ„é€ å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateFactoryPattern</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> doc = Document::<span class="built_in">create</span>&lt;TextDocument&gt;(<span class="string">&quot;My Document&quot;</span>);</span><br><span class="line">    <span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line">    <span class="comment">// Document &#x27;My Document&#x27; ready</span></span><br><span class="line">    <span class="comment">// TextDocument specific initialization</span></span><br><span class="line">    </span><br><span class="line">    doc-&gt;<span class="built_in">save</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-7"><a href="#æ€»ç»“-7" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>æ„é€ &#x2F;ææ„æœŸé—´è™šå‡½æ•°è°ƒç”¨çš„é—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>è™šå‡½æ•°ä¸ä¼šè¡¨ç°å‡ºå¤šæ€è¡Œä¸º</strong></li>
<li><strong>åªè°ƒç”¨å½“å‰æ„é€ &#x2F;ææ„ç±»çš„ç‰ˆæœ¬</strong></li>
<li><strong>å¯èƒ½è®¿é—®æœªåˆå§‹åŒ–æˆ–å·²é”€æ¯çš„æˆå‘˜</strong></li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>é¿å…åœ¨æ„é€ &#x2F;ææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</strong></li>
<li><strong>ä½¿ç”¨éè™šå‡½æ•°å¤„ç†æ„é€ &#x2F;ææ„é€»è¾‘</strong></li>
<li><strong>ä¼ é€’å‚æ•°ç»™åŸºç±»æ„é€ å‡½æ•°</strong></li>
<li><strong>ä½¿ç”¨ä¸¤é˜¶æ®µæ„é€ æ¨¡å¼</strong></li>
<li><strong>é‡‡ç”¨å·¥å‚æ¨¡å¼ç¡®ä¿å®Œå…¨æ„é€ åå†è°ƒç”¨è™šå‡½æ•°</strong></li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GoodDesign</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… æ„é€ å‡½æ•°ä¸è°ƒç”¨è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">GoodDesign</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> : name_(name) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ææ„å‡½æ•°ä¸è°ƒç”¨è™šå‡½æ•°  </span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">GoodDesign</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… è™šå‡½æ•°ä¾›æ­£å¸¸ä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… éè™šå‡½æ•°ä¾›å†…éƒ¨ä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è®°ä½ï¼šåœ¨æ„é€ å’Œææ„æœŸé—´ï¼Œåƒä¸‡ä¸è¦è°ƒç”¨virtualå‡½æ•°ï¼Œå› ä¸ºè¿™ç±»è°ƒç”¨ä»æ¥ä¸ä¼šä¸‹é™è‡³derived classï¼ˆæ¯”èµ·å½“å‰æ‰§è¡Œæ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„é‚£å±‚ï¼‰ã€‚</strong></p>
<h2 id="æ¡æ¬¾10ï¼š-ä»¤-operator-è¿”å›ä¸€ä¸ªreference-to-this"><a href="#æ¡æ¬¾10ï¼š-ä»¤-operator-è¿”å›ä¸€ä¸ªreference-to-this" class="headerlink" title="æ¡æ¬¾10ï¼š ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ªreference to *this"></a>æ¡æ¬¾10ï¼š ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ªreference to *this</h2><blockquote>
<p>*Have assignment operators return a reference to <em>this</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-9"><a href="#æ ¸å¿ƒç†å¿µ-9" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>èµ‹å€¼è¿ç®—ç¬¦åº”è¯¥è¿”å›å¯¹å½“å‰å¯¹è±¡çš„å¼•ç”¨ï¼ˆ<code>*this</code>ï¼‰ï¼Œè¿™æ ·å¯ä»¥æ”¯æŒ<strong>è¿ç»­èµ‹å€¼</strong>ï¼ˆå¦‚<code>a = b = c</code>ï¼‰å¹¶ä¿æŒä¸å†…ç½®ç±»å‹èµ‹å€¼è¿ç®—ç¬¦çš„ä¸€è‡´æ€§ã€‚è¿™ä¸ªçº¦å®šä¸ä»…é€‚ç”¨äºæ ‡å‡†çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ˆ<code>operator=</code>ï¼‰ï¼Œä¹Ÿé€‚ç”¨äºæ‰€æœ‰èµ‹å€¼ç›¸å…³çš„è¿ç®—ç¬¦ï¼ˆå¦‚<code>+=</code>ã€<code>-=</code>ã€<code>*=</code>ç­‰ï¼‰ã€‚éµå¾ªè¿™ä¸ªçº¦å®šæ˜¯è‰¯å¥½çš„C++ç¼–ç¨‹å®è·µã€‚</p>
<h3 id="æ·±åº¦è§£æ-9"><a href="#æ·±åº¦è§£æ-9" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å†…ç½®ç±»å‹çš„èµ‹å€¼è¡Œä¸º"><a href="#1-å†…ç½®ç±»å‹çš„èµ‹å€¼è¡Œä¸º" class="headerlink" title="1. å†…ç½®ç±»å‹çš„èµ‹å€¼è¡Œä¸º"></a>1. <strong>å†…ç½®ç±»å‹çš„èµ‹å€¼è¡Œä¸º</strong></h4><p><strong>è¿ç»­èµ‹å€¼çš„å·¥ä½œåŸç†ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateBuiltinAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x, y, z;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿ç»­èµ‹å€¼ä»å³å‘å·¦ç»“åˆ</span></span><br><span class="line">    x = y = z = <span class="number">15</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç­‰ä»·äºï¼š</span></span><br><span class="line">    <span class="comment">// x = (y = (z = 15));</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†è§£æ­¥éª¤ï¼š</span></span><br><span class="line">    <span class="comment">// 1. z = 15  è¿”å› z çš„å¼•ç”¨ï¼Œz ç°åœ¨æ˜¯ 15</span></span><br><span class="line">    <span class="comment">// 2. y = z   è¿”å› y çš„å¼•ç”¨ï¼Œy ç°åœ¨æ˜¯ 15  </span></span><br><span class="line">    <span class="comment">// 3. x = y   è¿”å› x çš„å¼•ç”¨ï¼Œx ç°åœ¨æ˜¯ 15</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, y=&quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;, z=&quot;</span> &lt;&lt; z &lt;&lt; std::endl;  <span class="comment">// éƒ½æ˜¯15</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateAssignmentReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">20</span>;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èµ‹å€¼è¿ç®—ç¬¦è¿”å›å·¦æ“ä½œæ•°çš„å¼•ç”¨</span></span><br><span class="line">    (c = a) = b;    <span class="comment">// c å…ˆè¢«èµ‹å€¼ä¸º a çš„å€¼ï¼ˆ10ï¼‰ï¼Œç„¶åè¢«èµ‹å€¼ä¸º b çš„å€¼ï¼ˆ20ï¼‰</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;c = &quot;</span> &lt;&lt; c &lt;&lt; std::endl;  <span class="comment">// è¾“å‡ºï¼šc = 20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è‡ªå®šä¹‰ç±»çš„èµ‹å€¼è¿ç®—ç¬¦å®ç°"><a href="#2-è‡ªå®šä¹‰ç±»çš„èµ‹å€¼è¿ç®—ç¬¦å®ç°" class="headerlink" title="2. è‡ªå®šä¹‰ç±»çš„èµ‹å€¼è¿ç®—ç¬¦å®ç°"></a>2. <strong>è‡ªå®šä¹‰ç±»çš„èµ‹å€¼è¿ç®—ç¬¦å®ç°</strong></h4><p><strong>åŸºæœ¬çš„æ­£ç¡®å®ç°ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>(<span class="type">int</span> value = <span class="number">0</span>, <span class="type">const</span> std::string&amp; name = <span class="string">&quot;&quot;</span>) </span><br><span class="line">        : <span class="built_in">value_</span>(value), <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šè¿”å› reference to *this</span></span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;  <span class="comment">// è‡ªèµ‹å€¼æ£€æŸ¥</span></span><br><span class="line">            value_ = rhs.value_;</span><br><span class="line">            name_ = rhs.name_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºå†…å®¹çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Widget(&quot;</span> &lt;&lt; value_ &lt;&lt; <span class="string">&quot;, \&quot;&quot;</span> &lt;&lt; name_ &lt;&lt; <span class="string">&quot;\&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateCustomAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Widget <span class="title">w1</span><span class="params">(<span class="number">10</span>, <span class="string">&quot;first&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Widget <span class="title">w2</span><span class="params">(<span class="number">20</span>, <span class="string">&quot;second&quot;</span>)</span></span>;  </span><br><span class="line">    <span class="function">Widget <span class="title">w3</span><span class="params">(<span class="number">30</span>, <span class="string">&quot;third&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿ç»­èµ‹å€¼ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ</span></span><br><span class="line">    w1 = w2 = w3;</span><br><span class="line">    </span><br><span class="line">    w<span class="number">1.</span><span class="built_in">show</span>();  <span class="comment">// Widget(30, &quot;third&quot;)</span></span><br><span class="line">    w<span class="number">2.</span><span class="built_in">show</span>();  <span class="comment">// Widget(30, &quot;third&quot;)</span></span><br><span class="line">    w<span class="number">3.</span><span class="built_in">show</span>();  <span class="comment">// Widget(30, &quot;third&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é”™è¯¯çš„å®ç°ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BadWidget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BadWidget</span>(<span class="type">int</span> value = <span class="number">0</span>) : <span class="built_in">value_</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šè¿”å› void</span></span><br><span class="line">    <span class="type">void</span> <span class="keyword">operator</span>=(<span class="type">const</span> BadWidget&amp; rhs) &#123;</span><br><span class="line">        value_ = rhs.value_;</span><br><span class="line">        <span class="comment">// ä¸è¿”å›ä»»ä½•å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šè¿”å›å‰¯æœ¬</span></span><br><span class="line">    BadWidget <span class="keyword">operator</span>=(<span class="type">const</span> BadWidget&amp; rhs) &#123;</span><br><span class="line">        value_ = rhs.value_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// è¿”å›å‰¯æœ¬ï¼Œä¸æ˜¯å¼•ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateBadAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">BadWidget <span class="title">b1</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function">BadWidget <span class="title">b2</span><span class="params">(<span class="number">20</span>)</span></span>;</span><br><span class="line">    <span class="function">BadWidget <span class="title">b3</span><span class="params">(<span class="number">30</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™äº›éƒ½ä¸èƒ½ç¼–è¯‘æˆ–ä¸èƒ½æŒ‰é¢„æœŸå·¥ä½œï¼š</span></span><br><span class="line">    <span class="comment">// b1 = b2 = b3;  // ç¼–è¯‘é”™è¯¯ï¼švoid operator= ä¸æ”¯æŒè¿ç»­èµ‹å€¼</span></span><br><span class="line">    <span class="comment">// (b1 = b2).getValue();  // å¦‚æœæ˜¯å‰¯æœ¬è¿”å›ï¼Œæ€§èƒ½å·®ä¸”è¯­ä¹‰ä¸å¯¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ‰€æœ‰èµ‹å€¼ç›¸å…³è¿ç®—ç¬¦çš„ä¸€è‡´æ€§"><a href="#3-æ‰€æœ‰èµ‹å€¼ç›¸å…³è¿ç®—ç¬¦çš„ä¸€è‡´æ€§" class="headerlink" title="3. æ‰€æœ‰èµ‹å€¼ç›¸å…³è¿ç®—ç¬¦çš„ä¸€è‡´æ€§"></a>3. <strong>æ‰€æœ‰èµ‹å€¼ç›¸å…³è¿ç®—ç¬¦çš„ä¸€è‡´æ€§</strong></h4><p><strong>å¤åˆèµ‹å€¼è¿ç®—ç¬¦ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Number</span><span class="params">(<span class="type">double</span> value = <span class="number">0.0</span>)</span> : value_(value) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ ‡å‡†èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            value_ = rhs.value_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… å¤åˆèµ‹å€¼è¿ç®—ç¬¦éƒ½åº”è¿”å› reference to *this</span></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        value_ += rhs.value_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        value_ -= rhs.value_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        value_ *= rhs.value_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rhs.value_ != <span class="number">0.0</span>) &#123;</span><br><span class="line">            value_ /= rhs.value_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… ä½è¿ç®—èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå¦‚æœé€‚ç”¨ï¼‰</span></span><br><span class="line">    Number&amp; <span class="keyword">operator</span>&amp;=(<span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        <span class="comment">// å‡è®¾æœ‰æ„ä¹‰çš„ä½è¿ç®—å®šä¹‰</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éæˆå‘˜å‡½æ•°çš„ç®—æœ¯è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="keyword">friend</span> Number <span class="keyword">operator</span>+(<span class="type">const</span> Number&amp; lhs, <span class="type">const</span> Number&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Number</span>(lhs.value_ + rhs.value_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateCompoundAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Number <span class="title">n1</span><span class="params">(<span class="number">10.0</span>)</span></span>;</span><br><span class="line">    <span class="function">Number <span class="title">n2</span><span class="params">(<span class="number">5.0</span>)</span></span>;</span><br><span class="line">    <span class="function">Number <span class="title">n3</span><span class="params">(<span class="number">2.0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿ç»­å¤åˆèµ‹å€¼</span></span><br><span class="line">    (n1 += n2) *= n3;  <span class="comment">// n1 = (n1 + n2) * n3 = (10 + 5) * 2 = 30</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;n1 = &quot;</span> &lt;&lt; n<span class="number">1.</span><span class="built_in">getValue</span>() &lt;&lt; std::endl;  <span class="comment">// 30.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆC-11ï¼‰"><a href="#4-ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆC-11ï¼‰" class="headerlink" title="4. ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆC++11ï¼‰"></a>4. <strong>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆC++11ï¼‰</strong></h4><p><strong>ç°ä»£C++çš„ç§»åŠ¨èµ‹å€¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernWidget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernWidget</span>(<span class="type">size_t</span> size, <span class="type">const</span> std::string&amp; name)</span><br><span class="line">        : <span class="built_in">data_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size)), <span class="built_in">size_</span>(size), <span class="built_in">name_</span>(name) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size_; ++i) &#123;</span><br><span class="line">            data_[i] = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernWidget</span>(<span class="type">const</span> ModernWidget&amp; other) </span><br><span class="line">        : <span class="built_in">data_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(other.size_)), </span><br><span class="line">          <span class="built_in">size_</span>(other.size_), </span><br><span class="line">          <span class="built_in">name_</span>(other.name_) &#123;</span><br><span class="line">        </span><br><span class="line">        std::<span class="built_in">copy</span>(other.data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>() + size_, data_.<span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernWidget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ModernWidget&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºæ–°çš„èµ„æº</span></span><br><span class="line">            <span class="keyword">auto</span> new_data = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(rhs.size_);</span><br><span class="line">            std::<span class="built_in">copy</span>(rhs.data_.<span class="built_in">get</span>(), rhs.data_.<span class="built_in">get</span>() + rhs.size_, new_data.<span class="built_in">get</span>());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">            data_ = std::<span class="built_in">move</span>(new_data);</span><br><span class="line">            size_ = rhs.size_;</span><br><span class="line">            name_ = rhs.name_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// è¿”å› reference to *this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆC++11ï¼‰</span></span><br><span class="line">    ModernWidget&amp; <span class="keyword">operator</span>=(ModernWidget&amp;&amp; rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            <span class="comment">// ç§»åŠ¨èµ„æºï¼Œä¸éœ€è¦æ‹·è´</span></span><br><span class="line">            data_ = std::<span class="built_in">move</span>(rhs.data_);</span><br><span class="line">            size_ = rhs.size_;</span><br><span class="line">            name_ = std::<span class="built_in">move</span>(rhs.name_);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ¸…ç†æºå¯¹è±¡</span></span><br><span class="line">            rhs.size_ = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// è¿”å› reference to *this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">name</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateModernAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ModernWidget <span class="title">w1</span><span class="params">(<span class="number">100</span>, <span class="string">&quot;widget1&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">ModernWidget <span class="title">w2</span><span class="params">(<span class="number">200</span>, <span class="string">&quot;widget2&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">ModernWidget <span class="title">w3</span><span class="params">(<span class="number">300</span>, <span class="string">&quot;widget3&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´èµ‹å€¼çš„è¿ç»­æ“ä½œ</span></span><br><span class="line">    w1 = w2 = w3;  <span class="comment">// éƒ½æ”¯æŒè¿ç»­èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">    <span class="function">ModernWidget <span class="title">w4</span><span class="params">(<span class="number">400</span>, <span class="string">&quot;widget4&quot;</span>)</span></span>;</span><br><span class="line">    w1 = std::<span class="built_in">move</span>(w4);  <span class="comment">// ç§»åŠ¨èµ‹å€¼ï¼Œä¹Ÿæ”¯æŒè¿ç»­æ“ä½œ</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;w1.name() = &quot;</span> &lt;&lt; w<span class="number">1.</span><span class="built_in">name</span>() &lt;&lt; std::endl;  <span class="comment">// widget4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-ç‰¹æ®Šæƒ…å†µå’Œè€ƒè™‘"><a href="#5-ç‰¹æ®Šæƒ…å†µå’Œè€ƒè™‘" class="headerlink" title="5. ç‰¹æ®Šæƒ…å†µå’Œè€ƒè™‘"></a>5. <strong>ç‰¹æ®Šæƒ…å†µå’Œè€ƒè™‘</strong></h4><p><strong>è‡ªèµ‹å€¼å®‰å…¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeAssignment</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string* data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SafeAssignment</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span></span><br><span class="line"><span class="function">        : data_(new std::string(str)) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SafeAssignment</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> data_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… è‡ªèµ‹å€¼å®‰å…¨çš„å®ç°</span></span><br><span class="line">    SafeAssignment&amp; <span class="keyword">operator</span>=(<span class="type">const</span> SafeAssignment&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;  <span class="comment">// è‡ªèµ‹å€¼æ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">delete</span> data_;</span><br><span class="line">            data_ = <span class="keyword">new</span> std::<span class="built_in">string</span>(*rhs.data_);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ›´å®‰å…¨çš„å®ç°ï¼šcopy-and-swap</span></span><br><span class="line">    SafeAssignment&amp; <span class="keyword">operator</span>=(SafeAssignment rhs) &#123;  <span class="comment">// æŒ‰å€¼ä¼ é€’ï¼Œè§¦å‘æ‹·è´</span></span><br><span class="line">        <span class="built_in">swap</span>(rhs);  <span class="comment">// äº¤æ¢èµ„æº</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// rhsææ„æ—¶é‡Šæ”¾æ—§èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(SafeAssignment&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(data_, other.data_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å¼‚å¸¸å®‰å…¨ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExceptionSafeAssignment</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExceptionSafeAssignment</span>(<span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; data, <span class="type">const</span> std::string&amp; name)</span><br><span class="line">        : <span class="built_in">data_</span>(data), <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯</span></span><br><span class="line">    ExceptionSafeAssignment&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ExceptionSafeAssignment&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            <span class="comment">// å…ˆåˆ›å»ºä¸´æ—¶å‰¯æœ¬ï¼ˆå¯èƒ½æŠ›å¼‚å¸¸ï¼‰</span></span><br><span class="line">            std::vector&lt;<span class="type">int</span>&gt; temp_data = rhs.data_;</span><br><span class="line">            std::string temp_name = rhs.name_;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åªæœ‰åœ¨æ²¡æœ‰å¼‚å¸¸çš„æƒ…å†µä¸‹æ‰ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">            data_ = std::<span class="built_in">move</span>(temp_data);</span><br><span class="line">            name_ = std::<span class="built_in">move</span>(temp_name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… ä½¿ç”¨copy-and-swapæä¾›å¼ºå¼‚å¸¸å®‰å…¨</span></span><br><span class="line">    ExceptionSafeAssignment&amp; <span class="keyword">operator</span>=(ExceptionSafeAssignment rhs) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(rhs);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(ExceptionSafeAssignment&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        data_.<span class="built_in">swap</span>(other.data_);</span><br><span class="line">        name_.<span class="built_in">swap</span>(other.name_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-ä¸æ ‡å‡†åº“çš„ä¸€è‡´æ€§"><a href="#6-ä¸æ ‡å‡†åº“çš„ä¸€è‡´æ€§" class="headerlink" title="6. ä¸æ ‡å‡†åº“çš„ä¸€è‡´æ€§"></a>6. <strong>ä¸æ ‡å‡†åº“çš„ä¸€è‡´æ€§</strong></h4><p><strong>æ ‡å‡†åº“å®¹å™¨çš„è¡Œä¸ºï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStandardLibraryConsistency</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v2 = &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v3 = &#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡å‡†åº“å®¹å™¨æ”¯æŒè¿ç»­èµ‹å€¼</span></span><br><span class="line">    v1 = v2 = v3;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤åˆèµ‹å€¼ä¹Ÿè¿”å›å¼•ç”¨</span></span><br><span class="line">    std::string s1 = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    std::string s2 = <span class="string">&quot; World&quot;</span>;</span><br><span class="line">    std::string s3 = <span class="string">&quot;!&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    (s1 += s2) += s3;  <span class="comment">// è¿ç»­å¤åˆèµ‹å€¼</span></span><br><span class="line">    std::cout &lt;&lt; s1 &lt;&lt; std::endl;  <span class="comment">// &quot;Hello World!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ç®—æœ¯ç±»å‹çš„ä¸€è‡´æ€§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;</span><br><span class="line">        <span class="keyword">if</span> (denominator_ == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Denominator cannot be zero&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… èµ‹å€¼è¿ç®—ç¬¦è¿”å›å¼•ç”¨ï¼Œä¸å†…ç½®ç±»å‹ä¸€è‡´</span></span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            numerator_ = rhs.numerator_;</span><br><span class="line">            denominator_ = rhs.denominator_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… å¤åˆèµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        numerator_ = numerator_ * rhs.denominator_ + rhs.numerator_ * denominator_;</span><br><span class="line">        denominator_ *= rhs.denominator_;</span><br><span class="line">        <span class="built_in">reduce</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºåˆ†æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; numerator_ &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; denominator_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> gcd_val = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(numerator_), <span class="built_in">abs</span>(denominator_));</span><br><span class="line">        numerator_ /= gcd_val;</span><br><span class="line">        denominator_ /= gcd_val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b == <span class="number">0</span> ? a : <span class="built_in">gcd</span>(b, a % b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateRationalAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">r1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;   <span class="comment">// 1/2</span></span><br><span class="line">    <span class="function">Rational <span class="title">r2</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>)</span></span>;   <span class="comment">// 1/3</span></span><br><span class="line">    <span class="function">Rational <span class="title">r3</span><span class="params">(<span class="number">1</span>, <span class="number">4</span>)</span></span>;   <span class="comment">// 1/4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿ç»­èµ‹å€¼</span></span><br><span class="line">    r1 = r2 = r3;</span><br><span class="line">    r<span class="number">1.</span><span class="built_in">print</span>();  <span class="comment">// 1/4</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿ç»­å¤åˆèµ‹å€¼</span></span><br><span class="line">    <span class="function">Rational <span class="title">r4</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">r5</span><span class="params">(<span class="number">1</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    (r4 += r5) += r3;  <span class="comment">// (1/2 + 1/4) + 1/4 = 1</span></span><br><span class="line">    r<span class="number">4.</span><span class="built_in">print</span>();  <span class="comment">// 1/1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼"><a href="#7-æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼" class="headerlink" title="7. æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼"></a>7. <strong>æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼</strong></h4><p><strong>æ¨èçš„èµ‹å€¼è¿ç®—ç¬¦æ¨¡æ¿ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AssignmentTemplate</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">AssignmentTemplate</span><span class="params">(<span class="type">const</span> T&amp; data)</span> : data_(data) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ ‡å‡†æ¨¡æ¿ï¼šæ‹·è´èµ‹å€¼</span></span><br><span class="line">    AssignmentTemplate&amp; <span class="keyword">operator</span>=(<span class="type">const</span> AssignmentTemplate&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            data_ = rhs.data_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ ‡å‡†æ¨¡æ¿ï¼šç§»åŠ¨èµ‹å€¼ï¼ˆC++11ï¼‰</span></span><br><span class="line">    AssignmentTemplate&amp; <span class="keyword">operator</span>=(AssignmentTemplate&amp;&amp; rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</span><br><span class="line">            data_ = std::<span class="built_in">move</span>(rhs.data_);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… å¤åˆèµ‹å€¼è¿ç®—ç¬¦æ¨¡æ¿</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span><br><span class="line">    AssignmentTemplate&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> U&amp; value) &#123;</span><br><span class="line">        data_ += value;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-8"><a href="#æ€»ç»“-8" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>*<em>è¿”å›reference to <em>thisçš„æ ¸å¿ƒä»·å€¼ï¼š</em></em></p>
<ol>
<li><strong>æ”¯æŒè¿ç»­èµ‹å€¼</strong>ï¼š<code>a = b = c</code> è¯­æ³•</li>
<li><strong>ä¸å†…ç½®ç±»å‹ä¸€è‡´</strong>ï¼šè¡Œä¸ºç¬¦åˆç›´è§‰</li>
<li><strong>æ”¯æŒå¤åˆæ“ä½œ</strong>ï¼š<code>(a += b) *= c</code> ç­‰</li>
<li><strong>æ ‡å‡†åº“å…¼å®¹</strong>ï¼šä¸STLå®¹å™¨è¡Œä¸ºä¸€è‡´</li>
</ol>
<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è¿”å›ç±»å‹</strong>ï¼š<code>ClassName&amp;</code>ï¼Œä¸æ˜¯<code>void</code>æˆ–<code>ClassName</code></li>
<li><strong>è¿”å›å€¼</strong>ï¼š<code>return *this;</code></li>
<li><strong>è‡ªèµ‹å€¼å®‰å…¨</strong>ï¼šæ£€æŸ¥<code>this != &amp;rhs</code></li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šè€ƒè™‘å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯</li>
</ul>
<p><strong>é€‚ç”¨èŒƒå›´ï¼š</strong></p>
<ul>
<li><code>operator=</code>ï¼ˆæ‹·è´å’Œç§»åŠ¨ï¼‰</li>
<li><code>operator+=</code>ã€<code>operator-=</code>ã€<code>operator*=</code> ç­‰å¤åˆèµ‹å€¼</li>
<li><code>operator&amp;=</code>ã€<code>operator|=</code>ã€<code>operator^=</code> ç­‰ä½è¿ç®—èµ‹å€¼</li>
<li><code>operator&lt;&lt;=</code>ã€<code>operator&gt;&gt;=</code> ç­‰ç§»ä½èµ‹å€¼</li>
</ul>
<p><strong>ç°ä»£C++æœ€ä½³å®è·µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ‹·è´èµ‹å€¼</span></span><br><span class="line">    ModernClass&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ModernClass&amp; rhs) &#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">    ModernClass&amp; <span class="keyword">operator</span>=(ModernClass&amp;&amp; rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤åˆèµ‹å€¼</span></span><br><span class="line">    ModernClass&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> ModernClass&amp; rhs) &#123;</span><br><span class="line">        <span class="comment">// å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>*<em>è®°ä½ï¼šä»¤èµ‹å€¼ï¼ˆassignmentï¼‰æ“ä½œç¬¦è¿”å›ä¸€ä¸ªreference to <em>thisã€‚</em></em></p>
<h2 id="æ¡æ¬¾11ï¼š-åœ¨operator-ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€"><a href="#æ¡æ¬¾11ï¼š-åœ¨operator-ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€" class="headerlink" title="æ¡æ¬¾11ï¼š åœ¨operator&#x3D;ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€"></a>æ¡æ¬¾11ï¼š åœ¨operator&#x3D;ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€</h2><blockquote>
<p><em>Handle assignment to self in operator&#x3D;</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-10"><a href="#æ ¸å¿ƒç†å¿µ-10" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ç¡®ä¿å½“å¯¹è±¡è‡ªæˆ‘èµ‹å€¼æ—¶operator&#x3D;æœ‰è‰¯å¥½è¡Œä¸º</strong>ã€‚è‡ªæˆ‘èµ‹å€¼çœ‹ä¼¼ä¸å¸¸è§ï¼Œä½†åœ¨å®é™…ç¼–ç¨‹ä¸­å¯èƒ½é€šè¿‡åˆ«åã€å¼•ç”¨ã€æŒ‡é’ˆé—´æ¥å‘ç”Ÿã€‚å¦‚æœoperator&#x3D;æ²¡æœ‰æ­£ç¡®å¤„ç†è‡ªæˆ‘èµ‹å€¼ï¼Œå¯èƒ½å¯¼è‡´èµ„æºé‡å¤é‡Šæ”¾ã€æ•°æ®æŸåæˆ–ç¨‹åºå´©æºƒã€‚å¤„ç†è‡ªæˆ‘èµ‹å€¼çš„æŠ€æœ¯åŒ…æ‹¬ï¼šèº«ä»½æµ‹è¯•ã€ç²¾å¿ƒå®‰æ’è¯­å¥é¡ºåºï¼Œä»¥åŠcopy-and-swapæŠ€æœ¯ã€‚</p>
<h3 id="æ·±åº¦è§£æ-10"><a href="#æ·±åº¦è§£æ-10" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-è‡ªæˆ‘èµ‹å€¼çš„ç°å®åœºæ™¯"><a href="#1-è‡ªæˆ‘èµ‹å€¼çš„ç°å®åœºæ™¯" class="headerlink" title="1. è‡ªæˆ‘èµ‹å€¼çš„ç°å®åœºæ™¯"></a>1. <strong>è‡ªæˆ‘èµ‹å€¼çš„ç°å®åœºæ™¯</strong></h4><p>è‡ªæˆ‘èµ‹å€¼ä¸ä»…ä»…æ˜¯<code>a = a</code>è¿™æ ·æ˜¾è€Œæ˜“è§çš„æƒ…å†µï¼Œæ›´å¤šæ—¶å€™æ˜¯é€šè¿‡é—´æ¥æ–¹å¼å‘ç”Ÿçš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Bitmap* pb_;  <span class="comment">// æŒ‡å‘ä¸€ä¸ªåœ¨heapä¸Šåˆ†é…çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ çœ‹ä¼¼ä¸å¯èƒ½çš„è‡ªæˆ‘èµ‹å€¼å®é™…ä¸Šå¾ˆå¸¸è§</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateAliasing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Widget w;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›´æ¥è‡ªæˆ‘èµ‹å€¼ï¼ˆæ˜¾è€Œæ˜“è§ï¼‰</span></span><br><span class="line">    w = w;  <span class="comment">// çœ‹èµ·æ¥æ„šè ¢ï¼Œä½†ç¡®å®å¯èƒ½å‘ç”Ÿ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨çš„é—´æ¥è‡ªæˆ‘èµ‹å€¼ï¼ˆéšè”½ï¼‰</span></span><br><span class="line">    Widget* pw1 = &amp;w;</span><br><span class="line">    Widget* pw2 = &amp;w;</span><br><span class="line">    *pw1 = *pw2;  <span class="comment">// å®é™…ä¸Šæ˜¯è‡ªæˆ‘èµ‹å€¼ï¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„ä¸­çš„è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">    Widget widgets[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span> i = <span class="number">5</span>, j = <span class="number">5</span>;</span><br><span class="line">    widgets[i] = widgets[j];  <span class="comment">// å¦‚æœi == jï¼Œå°±æ˜¯è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‡½æ•°å‚æ•°ä¸­çš„è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">    <span class="function">Widget&amp; <span class="title">getWidget</span><span class="params">(<span class="type">int</span> index)</span></span>;</span><br><span class="line">    widgets[<span class="number">0</span>] = <span class="built_in">getWidget</span>(<span class="number">0</span>);  <span class="comment">// å¦‚æœgetWidget(0)è¿”å›widgets[0]çš„å¼•ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-å±é™©çš„operator-å®ç°"><a href="#2-å±é™©çš„operator-å®ç°" class="headerlink" title="2. å±é™©çš„operator&#x3D;å®ç°"></a>2. <strong>å±é™©çš„operator&#x3D;å®ç°</strong></h4><p>æ²¡æœ‰è€ƒè™‘è‡ªæˆ‘èµ‹å€¼çš„operator&#x3D;å®ç°å¯èƒ½å¯¼è‡´ä¸¥é‡é—®é¢˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©çš„å®ç°ï¼šæ²¡æœ‰å¤„ç†è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">delete</span> pb_;                    <span class="comment">// é”€æ¯å½“å‰å¯¹è±¡çš„èµ„æº</span></span><br><span class="line">    pb_ = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb_);    <span class="comment">// ä»rhså¤åˆ¶èµ„æº</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Widget w;</span><br><span class="line">    <span class="comment">// ... åˆå§‹åŒ–w ...</span></span><br><span class="line">    </span><br><span class="line">    w = w;  <span class="comment">// ç¾éš¾ï¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œè¿‡ç¨‹ï¼š</span></span><br><span class="line">    <span class="comment">// 1. delete pb_;           - é”€æ¯äº†w.pb_æŒ‡å‘çš„å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// 2. pb_ = new Bitmap(*rhs.pb_);  - ä½†rhså°±æ˜¯*thisï¼</span></span><br><span class="line">    <span class="comment">//    rhs.pb_ç°åœ¨æŒ‡å‘ä¸€ä¸ªå·²åˆ é™¤çš„å¯¹è±¡ï¼</span></span><br><span class="line">    <span class="comment">//    å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œé€šå¸¸æ˜¯ç¨‹åºå´©æºƒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-è§£å†³æ–¹æ¡ˆ1ï¼šèº«ä»½æµ‹è¯•"><a href="#3-è§£å†³æ–¹æ¡ˆ1ï¼šèº«ä»½æµ‹è¯•" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆ1ï¼šèº«ä»½æµ‹è¯•"></a>3. <strong>è§£å†³æ–¹æ¡ˆ1ï¼šèº«ä»½æµ‹è¯•</strong></h4><p>æœ€ç›´æ¥çš„è§£å†³æ–¹æ¡ˆæ˜¯æ£€æŸ¥æ˜¯å¦ä¸ºè‡ªæˆ‘èµ‹å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šèº«ä»½æµ‹è¯•</span></span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) &#123;        <span class="comment">// èº«ä»½æµ‹è¯•ï¼šæ£€æŸ¥è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;          <span class="comment">// å¦‚æœæ˜¯è‡ªæˆ‘èµ‹å€¼ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> pb_;                <span class="comment">// å®‰å…¨ï¼šç¡®å®šä¸æ˜¯è‡ªæˆ‘èµ‹å€¼åæ‰åˆ é™¤</span></span><br><span class="line">    pb_ = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb_);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–ç‰ˆæœ¬ï¼šå¤„ç†å¼‚å¸¸å®‰å…¨æ€§</span></span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// èº«ä»½æµ‹è¯•</span></span><br><span class="line">    </span><br><span class="line">    Bitmap* pOrig = pb_;             <span class="comment">// è®°ä½åŸå…ˆçš„pb_</span></span><br><span class="line">    pb_ = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb_);      <span class="comment">// å…ˆåˆ›å»ºæ–°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">delete</span> pOrig;                    <span class="comment">// åˆ é™¤åŸå…ˆçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-è§£å†³æ–¹æ¡ˆ2ï¼šå¼‚å¸¸å®‰å…¨çš„è¯­å¥é¡ºåº"><a href="#4-è§£å†³æ–¹æ¡ˆ2ï¼šå¼‚å¸¸å®‰å…¨çš„è¯­å¥é¡ºåº" class="headerlink" title="4. è§£å†³æ–¹æ¡ˆ2ï¼šå¼‚å¸¸å®‰å…¨çš„è¯­å¥é¡ºåº"></a>4. <strong>è§£å†³æ–¹æ¡ˆ2ï¼šå¼‚å¸¸å®‰å…¨çš„è¯­å¥é¡ºåº</strong></h4><p>é€šè¿‡é‡æ–°å®‰æ’è¯­å¥é¡ºåºï¼Œæ—¢ä¿è¯å¼‚å¸¸å®‰å…¨åˆè‡ªåŠ¨å¤„ç†è‡ªæˆ‘èµ‹å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šå¼‚å¸¸å®‰å…¨çš„è¯­å¥é¡ºåº</span></span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    Bitmap* pOrig = pb_;             <span class="comment">// è®°ä½åŸå…ˆçš„pb_</span></span><br><span class="line">    pb_ = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb_);      <span class="comment">// å…ˆå¤åˆ¶rhsçš„èµ„æº</span></span><br><span class="line">    <span class="keyword">delete</span> pOrig;                    <span class="comment">// åˆ é™¤åŸå…ˆçš„èµ„æº</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateExceptionSafety</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Widget w1, w2;</span><br><span class="line">    <span class="comment">// ... åˆå§‹åŒ– ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        w1 = w2;  <span class="comment">// å¦‚æœnew BitmapæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                  <span class="comment">// w1.pb_ä»ç„¶æŒ‡å‘åŸå§‹æœ‰æ•ˆå¯¹è±¡</span></span><br><span class="line">                  <span class="comment">// æ²¡æœ‰èµ„æºæ³„æ¼æˆ–æ•°æ®æŸå</span></span><br><span class="line">    &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">        <span class="comment">// w1ä»ç„¶å¤„äºæœ‰æ•ˆçŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªæˆ‘èµ‹å€¼ä¹Ÿèƒ½æ­£ç¡®å·¥ä½œï¼š</span></span><br><span class="line">    w1 = w1;  <span class="comment">// è™½ç„¶æ•ˆç‡ä¸é«˜ï¼ˆä¼šåˆ›å»ºä¸å¿…è¦çš„å‰¯æœ¬ï¼‰ï¼Œä½†æ˜¯å®‰å…¨çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-è§£å†³æ–¹æ¡ˆ3ï¼šcopy-and-swapæŠ€æœ¯"><a href="#5-è§£å†³æ–¹æ¡ˆ3ï¼šcopy-and-swapæŠ€æœ¯" class="headerlink" title="5. è§£å†³æ–¹æ¡ˆ3ï¼šcopy-and-swapæŠ€æœ¯"></a>5. <strong>è§£å†³æ–¹æ¡ˆ3ï¼šcopy-and-swapæŠ€æœ¯</strong></h4><p>æœ€ä¼˜é›…å’Œé€šç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯copy-and-swapæƒ¯ç”¨æ³•ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Bitmap* pb_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… copy-and-swapæŠ€æœ¯</span></span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">        Widget <span class="built_in">temp</span>(rhs);        <span class="comment">// å¤åˆ¶rhsï¼ˆè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line">        <span class="built_in">swap</span>(temp);              <span class="comment">// äº¤æ¢*thiså’Œtempçš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;            <span class="comment">// tempç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨æ¸…ç†æ—§èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ–è€…æ›´ç®€æ´çš„ç‰ˆæœ¬ï¼ˆpass-by-valueï¼‰</span></span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(Widget rhs) &#123;  <span class="comment">// æ³¨æ„ï¼šæŒ‰å€¼ä¼ é€’ï¼ˆè‡ªåŠ¨åˆ›å»ºå‰¯æœ¬ï¼‰</span></span><br><span class="line">        <span class="built_in">swap</span>(rhs);                   <span class="comment">// äº¤æ¢å†…å®¹</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;                <span class="comment">// rhsç¦»å¼€ä½œç”¨åŸŸæ—¶æ¸…ç†æ—§èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> std::swap;</span><br><span class="line">        <span class="built_in">swap</span>(pb_, other.pb_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éœ€è¦å®ç°æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Widget</span>(<span class="type">const</span> Widget&amp; rhs) : <span class="built_in">pb_</span>(<span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb_)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">Widget</span>() &#123; <span class="keyword">delete</span> pb_; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-ç°ä»£C-çš„æ”¹è¿›å®ç°"><a href="#6-ç°ä»£C-çš„æ”¹è¿›å®ç°" class="headerlink" title="6. ç°ä»£C++çš„æ”¹è¿›å®ç°"></a>6. <strong>ç°ä»£C++çš„æ”¹è¿›å®ç°</strong></h4><p>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œç°ä»£C++ç‰¹æ€§å¯ä»¥å¤§å¤§ç®€åŒ–å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernWidget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;Bitmap&gt; pb_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernWidget</span>() : <span class="built_in">pb_</span>(std::<span class="built_in">make_unique</span>&lt;Bitmap&gt;()) &#123;&#125;  <span class="comment">// C++14</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernWidget</span>(<span class="type">const</span> ModernWidget&amp; other) </span><br><span class="line">        : <span class="built_in">pb_</span>(other.pb_ ? std::<span class="built_in">make_unique</span>&lt;Bitmap&gt;(*other.pb_) : <span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernWidget</span>(ModernWidget&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">pb_</span>(std::<span class="built_in">move</span>(other.pb_)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç°ä»£èµ‹å€¼è¿ç®—ç¬¦ï¼šä½¿ç”¨copy-and-swap</span></span><br><span class="line">    ModernWidget&amp; <span class="keyword">operator</span>=(ModernWidget other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="built_in">swap</span>(other);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// äº¤æ¢å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(ModernWidget&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> std::swap;</span><br><span class="line">        <span class="built_in">swap</span>(pb_, other.pb_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨å¤„ç†èµ„æºç®¡ç†ï¼Œæ— éœ€æ˜¾å¼ææ„å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éæˆå‘˜swapå‡½æ•°ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(ModernWidget&amp; a, ModernWidget&amp; b)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    a.<span class="built_in">swap</span>(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateModernSafety</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModernWidget w1, w2;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯å®‰å…¨çš„</span></span><br><span class="line">    w1 = w2;                    <span class="comment">// æ‹·è´èµ‹å€¼</span></span><br><span class="line">    w1 = w1;                    <span class="comment">// è‡ªæˆ‘èµ‹å€¼ï¼Œå®Œå…¨å®‰å…¨</span></span><br><span class="line">    w1 = std::<span class="built_in">move</span>(w2);         <span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">    w1 = ModernWidget&#123;&#125;;        <span class="comment">// ä¸´æ—¶å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-å¤šèµ„æºç®¡ç†çš„å¤æ‚æƒ…å†µ"><a href="#7-å¤šèµ„æºç®¡ç†çš„å¤æ‚æƒ…å†µ" class="headerlink" title="7. å¤šèµ„æºç®¡ç†çš„å¤æ‚æƒ…å†µ"></a>7. <strong>å¤šèµ„æºç®¡ç†çš„å¤æ‚æƒ…å†µ</strong></h4><p>å½“ç±»ç®¡ç†å¤šä¸ªèµ„æºæ—¶ï¼Œéœ€è¦ç‰¹åˆ«å°å¿ƒå¼‚å¸¸å®‰å…¨æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexWidget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string* pName_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt;* pData_;</span><br><span class="line">    std::unique_ptr&lt;Bitmap&gt; pBitmap_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ å±é™©çš„å®ç°ï¼šéƒ¨åˆ†ä¿®æ”¹åå¯èƒ½æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    ComplexWidget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ComplexWidget&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">delete</span> pName_;</span><br><span class="line">        <span class="keyword">delete</span> pData_;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸‹é¢çš„æ“ä½œæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¹è±¡å¤„äºéƒ¨åˆ†ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">        pName_ = <span class="keyword">new</span> std::<span class="built_in">string</span>(*rhs.pName_);</span><br><span class="line">        pData_ = <span class="keyword">new</span> std::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(*rhs.pData_);</span><br><span class="line">        pBitmap_ = std::<span class="built_in">make_unique</span>&lt;Bitmap&gt;(*rhs.pBitmap_);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®‰å…¨çš„å®ç°ï¼šè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆä¿æŒåŸçŠ¶</span></span><br><span class="line">    ComplexWidget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ComplexWidget&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…ˆåˆ›å»ºæ‰€æœ‰æ–°èµ„æº</span></span><br><span class="line">        <span class="function">std::unique_ptr&lt;std::string&gt; <span class="title">newName</span><span class="params">(<span class="keyword">new</span> std::string(*rhs.pName_))</span></span>;</span><br><span class="line">        std::unique_ptr&lt;std::vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">newData</span>(<span class="keyword">new</span> std::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(*rhs.pData_));</span><br><span class="line">        <span class="function">std::unique_ptr&lt;Bitmap&gt; <span class="title">newBitmap</span><span class="params">(std::make_unique&lt;Bitmap&gt;(*rhs.pBitmap_))</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°è¿™é‡Œæ²¡æœ‰å¼‚å¸¸ï¼Œå®‰å…¨åœ°æ›¿æ¢èµ„æº</span></span><br><span class="line">        <span class="keyword">delete</span> pName_;</span><br><span class="line">        <span class="keyword">delete</span> pData_;</span><br><span class="line">        pName_ = newName.<span class="built_in">release</span>();</span><br><span class="line">        pData_ = newData.<span class="built_in">release</span>();</span><br><span class="line">        pBitmap_ = std::<span class="built_in">move</span>(newBitmap);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´å¥½çš„ç°ä»£å®ç°ï¼šå…¨éƒ¨ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;std::string&gt; pName_;</span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;std::vector&lt;int&gt;&gt; pData_;</span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;Bitmap&gt; pBitmap_;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="8-æ€§èƒ½è€ƒè™‘å’Œæœ€ä½³å®è·µ"><a href="#8-æ€§èƒ½è€ƒè™‘å’Œæœ€ä½³å®è·µ" class="headerlink" title="8. æ€§èƒ½è€ƒè™‘å’Œæœ€ä½³å®è·µ"></a>8. <strong>æ€§èƒ½è€ƒè™‘å’Œæœ€ä½³å®è·µ</strong></h4><p>ä¸åŒçš„å®ç°æ–¹å¼æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PerformanceWidget</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;  <span class="comment">// å¤§å®¹é‡æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… é’ˆå¯¹æ€§èƒ½ä¼˜åŒ–çš„å®ç°</span></span><br><span class="line">    PerformanceWidget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> PerformanceWidget&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// é¿å…è‡ªæˆ‘èµ‹å€¼çš„å¼€é”€</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç›´æ¥èµ‹å€¼ï¼Œå¤ç”¨ç°æœ‰å®¹é‡</span></span><br><span class="line">        data_ = rhs.data_;  <span class="comment">// vectorçš„operator=å·²ç»æ˜¯å¼‚å¸¸å®‰å…¨çš„</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ç°ä»£å®ç°</span></span><br><span class="line">    PerformanceWidget&amp; <span class="keyword">operator</span>=(PerformanceWidget rhs) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        data_.<span class="built_in">swap</span>(rhs.data_);  <span class="comment">// é«˜æ•ˆçš„äº¤æ¢æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€§èƒ½æµ‹è¯•ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">performanceComparison</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PerformanceWidget w1, w2;</span><br><span class="line">    <span class="comment">// å‡è®¾w1å’Œw2åŒ…å«å¤§é‡æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ‹é‡è‡ªæˆ‘èµ‹å€¼çš„å¼€é”€</span></span><br><span class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i) &#123;</span><br><span class="line">        w1 = w1;  <span class="comment">// æœ‰èº«ä»½æµ‹è¯•çš„ç‰ˆæœ¬ä¼šç«‹å³è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Self-assignment time: &quot;</span> </span><br><span class="line">              &lt;&lt; std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(end - start).<span class="built_in">count</span>() </span><br><span class="line">              &lt;&lt; <span class="string">&quot; microseconds&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-9"><a href="#æ€»ç»“-9" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>è‡ªæˆ‘èµ‹å€¼å¤„ç†çš„ä¸‰ç§ä¸»è¦ç­–ç•¥ï¼š</strong></p>
<ol>
<li><strong>èº«ä»½æµ‹è¯•</strong>ï¼šç®€å•ç›´æ¥ï¼Œä½†åªä¼˜åŒ–äº†è‡ªæˆ‘èµ‹å€¼çš„æƒ…å†µ</li>
<li><strong>ç²¾å¿ƒå®‰æ’è¯­å¥é¡ºåº</strong>ï¼šæä¾›å¼‚å¸¸å®‰å…¨æ€§ï¼Œè‡ªåŠ¨å¤„ç†è‡ªæˆ‘èµ‹å€¼</li>
<li><strong>copy-and-swap</strong>ï¼šæœ€ä¼˜é›…ï¼ŒåŒæ—¶æä¾›å¼‚å¸¸å®‰å…¨æ€§å’Œè‡ªæˆ‘èµ‹å€¼å¤„ç†</li>
</ol>
<p><strong>ç°ä»£C++æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šè‡ªåŠ¨ç®¡ç†èµ„æºï¼Œå‡å°‘æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„å¤æ‚æ€§</li>
<li><strong>ä½¿ç”¨copy-and-swapæƒ¯ç”¨æ³•</strong>ï¼šç®€æ´ã€å®‰å…¨ã€æ˜“äºç†è§£</li>
<li><strong>æ”¯æŒç§»åŠ¨è¯­ä¹‰</strong>ï¼šæé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§å¯¹è±¡</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>å¼‚å¸¸å®‰å…¨æ€§ä¼˜å…ˆ</strong>ï¼šç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œå¯¹è±¡ä¹Ÿä¿æŒæœ‰æ•ˆçŠ¶æ€</li>
<li><strong>ç®€æ´æ€§</strong>ï¼šä¼˜å…ˆé€‰æ‹©ç®€å•ã€æ˜“ç†è§£çš„å®ç°</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šåœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹ä¼˜åŒ–æ€§èƒ½</li>
</ul>
<p><strong>è®°ä½ï¼šç¡®ä¿å½“å¯¹è±¡è‡ªæˆ‘èµ‹å€¼æ—¶operator&#x3D;æœ‰è‰¯å¥½è¡Œä¸ºã€‚æŠ€æœ¯åŒ…æ‹¬æ¯”è¾ƒâ€æ¥æºå¯¹è±¡â€å’Œâ€ç›®æ ‡å¯¹è±¡â€çš„åœ°å€ã€ç²¾å¿ƒå‘¨åˆ°çš„è¯­å¥é¡ºåºï¼Œä»¥åŠcopy-and-swapã€‚ç¡®å®šä»»ä½•å‡½æ•°å¦‚æœæ“ä½œä¸€ä¸ªä»¥ä¸Šçš„å¯¹è±¡ï¼Œè€Œå…¶ä¸­å¤šä¸ªå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå…¶è¡Œä¸ºä»ç„¶æ­£ç¡®ã€‚</strong></p>
<h2 id="æ¡æ¬¾12ï¼š-å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†"><a href="#æ¡æ¬¾12ï¼š-å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†" class="headerlink" title="æ¡æ¬¾12ï¼š å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†"></a>æ¡æ¬¾12ï¼š å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†</h2><blockquote>
<p><em>Copy all parts of an object</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-11"><a href="#æ ¸å¿ƒç†å¿µ-11" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>Copyingå‡½æ•°åº”ç¡®ä¿å¤åˆ¶â€å¯¹è±¡å†…çš„æ‰€æœ‰æˆå‘˜å˜é‡â€ä»¥åŠâ€æ‰€æœ‰base classæˆåˆ†â€</strong>ã€‚å½“ä½ ç¼–å†™æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦æ—¶ï¼Œå¿…é¡»ç¡®ä¿å¤åˆ¶å¯¹è±¡çš„æ¯ä¸€ä¸ªæˆåˆ†ï¼ŒåŒ…æ‹¬æ‰€æœ‰æˆå‘˜å˜é‡å’ŒåŸºç±»éƒ¨åˆ†ã€‚åŒæ—¶ï¼Œä¸è¦å°è¯•ä»¥æŸä¸ªcopyingå‡½æ•°å®ç°å¦ä¸€ä¸ªcopyingå‡½æ•°ï¼Œåº”è¯¥å°†å…±åŒåŠŸèƒ½æ”¾è¿›ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œå¹¶ç”±ä¸¤ä¸ªcopyingå‡½æ•°å…±åŒè°ƒç”¨ã€‚</p>
<h3 id="æ·±åº¦è§£æ-11"><a href="#æ·±åº¦è§£æ-11" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å¸¸è§é”™è¯¯ï¼šé—æ¼æ–°å¢çš„æˆå‘˜å˜é‡"><a href="#1-å¸¸è§é”™è¯¯ï¼šé—æ¼æ–°å¢çš„æˆå‘˜å˜é‡" class="headerlink" title="1. å¸¸è§é”™è¯¯ï¼šé—æ¼æ–°å¢çš„æˆå‘˜å˜é‡"></a>1. <strong>å¸¸è§é”™è¯¯ï¼šé—æ¼æ–°å¢çš„æˆå‘˜å˜é‡</strong></h4><p>æœ€å¸¸è§çš„é”™è¯¯æ˜¯åœ¨æ·»åŠ æ–°æˆå‘˜å˜é‡æ—¶å¿˜è®°æ›´æ–°æ‹·è´å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Customer</span>(<span class="type">const</span> Customer&amp; rhs);</span><br><span class="line">    Customer&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Customer&amp; rhs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Customer::<span class="built_in">Customer</span>(<span class="type">const</span> Customer&amp; rhs)</span><br><span class="line">    : <span class="built_in">name_</span>(rhs.name_) &#123;  <span class="comment">// å¤åˆ¶æ‰€æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Customer&amp; Customer::<span class="keyword">operator</span>=(<span class="type">const</span> Customer&amp; rhs) &#123;</span><br><span class="line">    name_ = rhs.name_;   <span class="comment">// å¤åˆ¶æ‰€æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ åæ¥æ·»åŠ äº†æ–°æˆå‘˜å˜é‡ï¼Œä½†å¿˜è®°æ›´æ–°æ‹·è´å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Customer</span>(<span class="type">const</span> Customer&amp; rhs);</span><br><span class="line">    Customer&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Customer&amp; rhs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    Date lastTransaction_;  <span class="comment">// æ–°å¢æˆå‘˜å˜é‡ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ å‡½æ•°é—æ¼äº†æ–°æˆå‘˜å˜é‡</span></span><br><span class="line">Customer::<span class="built_in">Customer</span>(<span class="type">const</span> Customer&amp; rhs)</span><br><span class="line">    : <span class="built_in">name_</span>(rhs.name_) &#123;  <span class="comment">// âŒ é—æ¼äº†lastTransaction_ï¼</span></span><br><span class="line">    <span class="comment">// lastTransaction_ä¼šè¢«é»˜è®¤æ„é€ ï¼Œè€Œä¸æ˜¯ä»rhså¤åˆ¶</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èµ‹å€¼è¿ç®—ç¬¦ä¹Ÿé—æ¼äº†æ–°æˆå‘˜å˜é‡</span></span><br><span class="line">Customer&amp; Customer::<span class="keyword">operator</span>=(<span class="type">const</span> Customer&amp; rhs) &#123;</span><br><span class="line">    name_ = rhs.name_;   <span class="comment">// âŒ é—æ¼äº†lastTransaction_ï¼</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;        <span class="comment">// lastTransaction_ä¿æŒä¸å˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ­£ç¡®çš„æˆå‘˜å˜é‡å¤åˆ¶"><a href="#2-æ­£ç¡®çš„æˆå‘˜å˜é‡å¤åˆ¶" class="headerlink" title="2. æ­£ç¡®çš„æˆå‘˜å˜é‡å¤åˆ¶"></a>2. <strong>æ­£ç¡®çš„æˆå‘˜å˜é‡å¤åˆ¶</strong></h4><p>ç¡®ä¿æ‰€æœ‰æˆå‘˜å˜é‡éƒ½è¢«æ­£ç¡®å¤åˆ¶ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Customer</span>(<span class="type">const</span> std::string&amp; name) </span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">lastTransaction_</span>(Date::<span class="built_in">today</span>()) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„æ‹·è´æ„é€ å‡½æ•°ï¼šå¤åˆ¶æ‰€æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="built_in">Customer</span>(<span class="type">const</span> Customer&amp; rhs)</span><br><span class="line">        : <span class="built_in">name_</span>(rhs.name_), </span><br><span class="line">          <span class="built_in">lastTransaction_</span>(rhs.lastTransaction_) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„èµ‹å€¼è¿ç®—ç¬¦ï¼šå¤åˆ¶æ‰€æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    Customer&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Customer&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;  <span class="comment">// å¤„ç†è‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">        </span><br><span class="line">        name_ = rhs.name_;</span><br><span class="line">        lastTransaction_ = rhs.lastTransaction_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    Date lastTransaction_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateCorrectCopying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Customer <span class="title">c1</span><span class="params">(<span class="string">&quot;Alice&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Customer <span class="title">c2</span><span class="params">(<span class="string">&quot;Bob&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Customer <span class="title">c3</span><span class="params">(c1)</span></span>;     <span class="comment">// è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    c2 = c1;             <span class="comment">// è°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç°åœ¨c3å’Œc2éƒ½å®Œæ•´åœ°å¤åˆ¶äº†c1çš„æ‰€æœ‰æˆå‘˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-ç»§æ‰¿ä¸­çš„å¤åˆ¶é—®é¢˜"><a href="#3-ç»§æ‰¿ä¸­çš„å¤åˆ¶é—®é¢˜" class="headerlink" title="3. ç»§æ‰¿ä¸­çš„å¤åˆ¶é—®é¢˜"></a>3. <strong>ç»§æ‰¿ä¸­çš„å¤åˆ¶é—®é¢˜</strong></h4><p>åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œæœ€å®¹æ˜“å¿˜è®°å¤åˆ¶åŸºç±»éƒ¨åˆ†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> year_, month_, day_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> year, <span class="type">int</span> month, <span class="type">int</span> day) </span><br><span class="line">        : <span class="built_in">year_</span>(year), <span class="built_in">month_</span>(month), <span class="built_in">day_</span>(day) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Dateç±»çš„æ‹·è´å‡½æ•°ï¼ˆå‡è®¾å·²æ­£ç¡®å®ç°ï¼‰</span></span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">const</span> Date&amp; rhs) </span><br><span class="line">        : <span class="built_in">year_</span>(rhs.year_), <span class="built_in">month_</span>(rhs.month_), <span class="built_in">day_</span>(rhs.day_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Date&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Date&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        year_ = rhs.year_;</span><br><span class="line">        month_ = rhs.month_;</span><br><span class="line">        day_ = rhs.day_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PriorityCustomer</span> : <span class="keyword">public</span> Customer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PriorityCustomer</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> priority)</span><br><span class="line">        : <span class="built_in">Customer</span>(name), <span class="built_in">priority_</span>(priority) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯çš„æ‹·è´æ„é€ å‡½æ•°ï¼šå¿˜è®°è°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">PriorityCustomer</span>(<span class="type">const</span> PriorityCustomer&amp; rhs)</span><br><span class="line">        : <span class="built_in">priority_</span>(rhs.priority_) &#123;  <span class="comment">// åªå¤åˆ¶äº†æ´¾ç”Ÿç±»æˆå‘˜</span></span><br><span class="line">        <span class="comment">// CustomeråŸºç±»éƒ¨åˆ†ä¼šè¢«é»˜è®¤æ„é€ ï¼</span></span><br><span class="line">        <span class="comment">// åŸºç±»çš„name_å’ŒlastTransaction_ä¸ä¼šä»rhså¤åˆ¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯çš„èµ‹å€¼è¿ç®—ç¬¦ï¼šå¿˜è®°è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    PriorityCustomer&amp; <span class="keyword">operator</span>=(<span class="type">const</span> PriorityCustomer&amp; rhs) &#123;</span><br><span class="line">        priority_ = rhs.priority_;  <span class="comment">// åªå¤åˆ¶äº†æ´¾ç”Ÿç±»æˆå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;               <span class="comment">// åŸºç±»éƒ¨åˆ†ä¿æŒä¸å˜ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> priority_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateInheritanceProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc1</span><span class="params">(<span class="string">&quot;Alice&quot;</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc2</span><span class="params">(pc1)</span></span>;  <span class="comment">// åŸºç±»éƒ¨åˆ†æ²¡æœ‰è¢«æ­£ç¡®å¤åˆ¶ï¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc3</span><span class="params">(<span class="string">&quot;Bob&quot;</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    pc3 = pc1;                  <span class="comment">// åŸºç±»éƒ¨åˆ†æ²¡æœ‰è¢«æ­£ç¡®å¤åˆ¶ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-æ­£ç¡®çš„ç»§æ‰¿ä¸­çš„å¤åˆ¶"><a href="#4-æ­£ç¡®çš„ç»§æ‰¿ä¸­çš„å¤åˆ¶" class="headerlink" title="4. æ­£ç¡®çš„ç»§æ‰¿ä¸­çš„å¤åˆ¶"></a>4. <strong>æ­£ç¡®çš„ç»§æ‰¿ä¸­çš„å¤åˆ¶</strong></h4><p>åœ¨æ´¾ç”Ÿç±»çš„æ‹·è´å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨åŸºç±»çš„æ‹·è´å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PriorityCustomer</span> : <span class="keyword">public</span> Customer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PriorityCustomer</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> priority)</span><br><span class="line">        : <span class="built_in">Customer</span>(name), <span class="built_in">priority_</span>(priority) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„æ‹·è´æ„é€ å‡½æ•°ï¼šè°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">PriorityCustomer</span>(<span class="type">const</span> PriorityCustomer&amp; rhs)</span><br><span class="line">        : <span class="built_in">Customer</span>(rhs),            <span class="comment">// è°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">          <span class="built_in">priority_</span>(rhs.priority_)  <span class="comment">// å¤åˆ¶æ´¾ç”Ÿç±»æˆå‘˜</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„èµ‹å€¼è¿ç®—ç¬¦ï¼šè°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    PriorityCustomer&amp; <span class="keyword">operator</span>=(<span class="type">const</span> PriorityCustomer&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        Customer::<span class="keyword">operator</span>=(rhs);   <span class="comment">// è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        priority_ = rhs.priority_;  <span class="comment">// å¤åˆ¶æ´¾ç”Ÿç±»æˆå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> priority_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateCorrectInheritanceCopying</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc1</span><span class="params">(<span class="string">&quot;Alice&quot;</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc2</span><span class="params">(pc1)</span></span>;  <span class="comment">// ç°åœ¨å®Œæ•´å¤åˆ¶äº†åŸºç±»å’Œæ´¾ç”Ÿç±»éƒ¨åˆ†</span></span><br><span class="line">    </span><br><span class="line">    <span class="function">PriorityCustomer <span class="title">pc3</span><span class="params">(<span class="string">&quot;Bob&quot;</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    pc3 = pc1;                  <span class="comment">// ç°åœ¨å®Œæ•´å¤åˆ¶äº†åŸºç±»å’Œæ´¾ç”Ÿç±»éƒ¨åˆ†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-å¤šé‡ç»§æ‰¿ä¸­çš„å¤åˆ¶"><a href="#5-å¤šé‡ç»§æ‰¿ä¸­çš„å¤åˆ¶" class="headerlink" title="5. å¤šé‡ç»§æ‰¿ä¸­çš„å¤åˆ¶"></a>5. <strong>å¤šé‡ç»§æ‰¿ä¸­çš„å¤åˆ¶</strong></h4><p>å¤šé‡ç»§æ‰¿ä½¿å¤åˆ¶å˜å¾—æ›´åŠ å¤æ‚ï¼Œå¿…é¡»ç¡®ä¿æ‰€æœ‰åŸºç±»éƒ½è¢«æ­£ç¡®å¤åˆ¶ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Named</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Named</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Named</span>(<span class="type">const</span> Named&amp; rhs) : <span class="built_in">name_</span>(rhs.name_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Named&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Named&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        name_ = rhs.name_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Timestamped</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Date timestamp_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Timestamped</span>() : <span class="built_in">timestamp_</span>(Date::<span class="built_in">today</span>()) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Timestamped</span>(<span class="type">const</span> Timestamped&amp; rhs) : <span class="built_in">timestamp_</span>(rhs.timestamp_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Timestamped&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Timestamped&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        timestamp_ = rhs.timestamp_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NamedTimestamped</span> : <span class="keyword">public</span> Named, <span class="keyword">public</span> Timestamped &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NamedTimestamped</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">Named</span>(name), <span class="built_in">Timestamped</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„å¤šé‡ç»§æ‰¿æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">NamedTimestamped</span>(<span class="type">const</span> NamedTimestamped&amp; rhs)</span><br><span class="line">        : <span class="built_in">Named</span>(rhs),           <span class="comment">// å¤åˆ¶ç¬¬ä¸€ä¸ªåŸºç±»</span></span><br><span class="line">          <span class="built_in">Timestamped</span>(rhs)      <span class="comment">// å¤åˆ¶ç¬¬äºŒä¸ªåŸºç±»</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„å¤šé‡ç»§æ‰¿èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    NamedTimestamped&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NamedTimestamped&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        Named::<span class="keyword">operator</span>=(rhs);        <span class="comment">// è°ƒç”¨ç¬¬ä¸€ä¸ªåŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        Timestamped::<span class="keyword">operator</span>=(rhs);  <span class="comment">// è°ƒç”¨ç¬¬äºŒä¸ªåŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-é¿å…åœ¨æ‹·è´å‡½æ•°é—´ç›¸äº’è°ƒç”¨"><a href="#6-é¿å…åœ¨æ‹·è´å‡½æ•°é—´ç›¸äº’è°ƒç”¨" class="headerlink" title="6. é¿å…åœ¨æ‹·è´å‡½æ•°é—´ç›¸äº’è°ƒç”¨"></a>6. <strong>é¿å…åœ¨æ‹·è´å‡½æ•°é—´ç›¸äº’è°ƒç”¨</strong></h4><p>ä¸è¦è®©æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ç›¸äº’è°ƒç”¨ï¼Œè€Œåº”è¯¥æå–å…¬å…±ä»£ç ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; buffer_;</span><br><span class="line">    <span class="type">size_t</span> bufferSize_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Resource</span>(<span class="type">const</span> std::string&amp; name, <span class="type">size_t</span> size)</span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">bufferSize_</span>(size), </span><br><span class="line">          <span class="built_in">buffer_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size)) &#123;</span><br><span class="line">        data_.<span class="built_in">reserve</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šè®©æ‹·è´æ„é€ å‡½æ•°è°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="built_in">Resource</span>(<span class="type">const</span> Resource&amp; rhs) &#123;</span><br><span class="line">        *<span class="keyword">this</span> = rhs;  <span class="comment">// å±é™©ï¼è¿™æ—¶å¯¹è±¡è¿˜æ²¡æœ‰å®Œå…¨æ„é€ </span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šè®©èµ‹å€¼è¿ç®—ç¬¦è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    Resource&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Resource&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>-&gt;~<span class="built_in">Resource</span>();           <span class="comment">// é”€æ¯å½“å‰å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">new</span> (<span class="keyword">this</span>) <span class="built_in">Resource</span>(rhs);    <span class="comment">// åœ¨åŸåœ°é‡æ–°æ„é€ </span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;                <span class="comment">// å±é™©ä¸”ä¸å¯ç§»æ¤</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®æ–¹æ³•ï¼šæå–å…¬å…±åˆå§‹åŒ–ä»£ç </span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">copyFrom</span><span class="params">(<span class="type">const</span> Resource&amp; rhs)</span> </span>&#123;</span><br><span class="line">        name_ = rhs.name_;</span><br><span class="line">        data_ = rhs.data_;</span><br><span class="line">        bufferSize_ = rhs.bufferSize_;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (rhs.buffer_) &#123;</span><br><span class="line">            buffer_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(bufferSize_);</span><br><span class="line">            std::<span class="built_in">copy</span>(rhs.buffer_.<span class="built_in">get</span>(), </span><br><span class="line">                     rhs.buffer_.<span class="built_in">get</span>() + bufferSize_, </span><br><span class="line">                     buffer_.<span class="built_in">get</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            buffer_.<span class="built_in">reset</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Resource</span>(<span class="type">const</span> Resource&amp; rhs) </span><br><span class="line">        : <span class="built_in">name_</span>(rhs.name_), </span><br><span class="line">          <span class="built_in">data_</span>(rhs.data_), </span><br><span class="line">          <span class="built_in">bufferSize_</span>(rhs.bufferSize_) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (rhs.buffer_) &#123;</span><br><span class="line">            buffer_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(bufferSize_);</span><br><span class="line">            std::<span class="built_in">copy</span>(rhs.buffer_.<span class="built_in">get</span>(), </span><br><span class="line">                     rhs.buffer_.<span class="built_in">get</span>() + bufferSize_, </span><br><span class="line">                     buffer_.<span class="built_in">get</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Resource&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Resource&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">copyFrom</span>(rhs);  <span class="comment">// ä½¿ç”¨å…¬å…±å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-ç°ä»£C-çš„æœ€ä½³å®è·µ"><a href="#7-ç°ä»£C-çš„æœ€ä½³å®è·µ" class="headerlink" title="7. ç°ä»£C++çš„æœ€ä½³å®è·µ"></a>7. <strong>ç°ä»£C++çš„æœ€ä½³å®è·µ</strong></h4><p>ä½¿ç”¨ç°ä»£C++ç‰¹æ€§å¯ä»¥ç®€åŒ–å¤åˆ¶æ“ä½œçš„å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernResource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; buffer_;</span><br><span class="line">    <span class="type">size_t</span> bufferSize_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernResource</span>(<span class="type">const</span> std::string&amp; name, <span class="type">size_t</span> size)</span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">bufferSize_</span>(size), </span><br><span class="line">          <span class="built_in">buffer_</span>(std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size)) &#123;</span><br><span class="line">        data_.<span class="built_in">reserve</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ‹·è´æ„é€ å‡½æ•°ï¼šä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">ModernResource</span>(<span class="type">const</span> ModernResource&amp; rhs)</span><br><span class="line">        : <span class="built_in">name_</span>(rhs.name_),</span><br><span class="line">          <span class="built_in">data_</span>(rhs.data_),</span><br><span class="line">          <span class="built_in">bufferSize_</span>(rhs.bufferSize_),</span><br><span class="line">          <span class="built_in">buffer_</span>(rhs.buffer_ ? std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(rhs.bufferSize_) : <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (buffer_ &amp;&amp; rhs.buffer_) &#123;</span><br><span class="line">            std::<span class="built_in">copy</span>(rhs.buffer_.<span class="built_in">get</span>(), </span><br><span class="line">                     rhs.buffer_.<span class="built_in">get</span>() + bufferSize_, </span><br><span class="line">                     buffer_.<span class="built_in">get</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ä½¿ç”¨copy-and-swapçš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernResource&amp; <span class="keyword">operator</span>=(ModernResource rhs) &#123;  <span class="comment">// æŒ‰å€¼ä¼ é€’</span></span><br><span class="line">        <span class="built_in">swap</span>(rhs);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernResource</span>(ModernResource&amp;&amp; rhs) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">name_</span>(std::<span class="built_in">move</span>(rhs.name_)),</span><br><span class="line">          <span class="built_in">data_</span>(std::<span class="built_in">move</span>(rhs.data_)),</span><br><span class="line">          <span class="built_in">buffer_</span>(std::<span class="built_in">move</span>(rhs.buffer_)),</span><br><span class="line">          <span class="built_in">bufferSize_</span>(rhs.bufferSize_) &#123;</span><br><span class="line">        rhs.bufferSize_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(ModernResource&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> std::swap;</span><br><span class="line">        <span class="built_in">swap</span>(name_, other.name_);</span><br><span class="line">        <span class="built_in">swap</span>(data_, other.data_);</span><br><span class="line">        <span class="built_in">swap</span>(buffer_, other.buffer_);</span><br><span class="line">        <span class="built_in">swap</span>(bufferSize_, other.bufferSize_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="8-å¤æ‚ç»§æ‰¿å±‚æ¬¡ä¸­çš„æœ€ä½³å®è·µ"><a href="#8-å¤æ‚ç»§æ‰¿å±‚æ¬¡ä¸­çš„æœ€ä½³å®è·µ" class="headerlink" title="8. å¤æ‚ç»§æ‰¿å±‚æ¬¡ä¸­çš„æœ€ä½³å®è·µ"></a>8. <strong>å¤æ‚ç»§æ‰¿å±‚æ¬¡ä¸­çš„æœ€ä½³å®è·µ</strong></h4><p>åœ¨å¤æ‚çš„ç»§æ‰¿å±‚æ¬¡ä¸­ï¼Œç¡®ä¿æ¯ä¸€å±‚éƒ½æ­£ç¡®å¤„ç†å¤åˆ¶ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string make_;</span><br><span class="line">    std::string model_;</span><br><span class="line">    <span class="type">int</span> year_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Vehicle</span>(<span class="type">const</span> std::string&amp; make, <span class="type">const</span> std::string&amp; model, <span class="type">int</span> year)</span><br><span class="line">        : <span class="built_in">make_</span>(make), <span class="built_in">model_</span>(model), <span class="built_in">year_</span>(year) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Vehicle</span>(<span class="type">const</span> Vehicle&amp; rhs)</span><br><span class="line">        : <span class="built_in">make_</span>(rhs.make_), <span class="built_in">model_</span>(rhs.model_), <span class="built_in">year_</span>(rhs.year_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Vehicle&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Vehicle&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        make_ = rhs.make_;</span><br><span class="line">        model_ = rhs.model_;</span><br><span class="line">        year_ = rhs.year_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Vehicle</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸­é—´å±‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MotorVehicle</span> : <span class="keyword">public</span> Vehicle &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string engineType_;</span><br><span class="line">    <span class="type">int</span> horsePower_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MotorVehicle</span>(<span class="type">const</span> std::string&amp; make, <span class="type">const</span> std::string&amp; model, </span><br><span class="line">                 <span class="type">int</span> year, <span class="type">const</span> std::string&amp; engine, <span class="type">int</span> hp)</span><br><span class="line">        : <span class="built_in">Vehicle</span>(make, model, year), <span class="built_in">engineType_</span>(engine), <span class="built_in">horsePower_</span>(hp) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®è°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">MotorVehicle</span>(<span class="type">const</span> MotorVehicle&amp; rhs)</span><br><span class="line">        : <span class="built_in">Vehicle</span>(rhs),                    <span class="comment">// è°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">          <span class="built_in">engineType_</span>(rhs.engineType_),</span><br><span class="line">          <span class="built_in">horsePower_</span>(rhs.horsePower_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    MotorVehicle&amp; <span class="keyword">operator</span>=(<span class="type">const</span> MotorVehicle&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        Vehicle::<span class="keyword">operator</span>=(rhs);           <span class="comment">// è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        engineType_ = rhs.engineType_;</span><br><span class="line">        horsePower_ = rhs.horsePower_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€ç»ˆæ´¾ç”Ÿç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> : <span class="keyword">public</span> MotorVehicle &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numberOfDoors_;</span><br><span class="line">    <span class="type">bool</span> isConvertible_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Car</span>(<span class="type">const</span> std::string&amp; make, <span class="type">const</span> std::string&amp; model, <span class="type">int</span> year,</span><br><span class="line">        <span class="type">const</span> std::string&amp; engine, <span class="type">int</span> hp, <span class="type">int</span> doors, <span class="type">bool</span> convertible)</span><br><span class="line">        : <span class="built_in">MotorVehicle</span>(make, model, year, engine, hp),</span><br><span class="line">          <span class="built_in">numberOfDoors_</span>(doors), <span class="built_in">isConvertible_</span>(convertible) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®Œæ•´çš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Car</span>(<span class="type">const</span> Car&amp; rhs)</span><br><span class="line">        : <span class="built_in">MotorVehicle</span>(rhs),               <span class="comment">// è°ƒç”¨åŸºç±»æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">          <span class="built_in">numberOfDoors_</span>(rhs.numberOfDoors_),</span><br><span class="line">          <span class="built_in">isConvertible_</span>(rhs.isConvertible_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®Œæ•´çš„èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Car&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Car&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        MotorVehicle::<span class="keyword">operator</span>=(rhs);      <span class="comment">// è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">        numberOfDoors_ = rhs.numberOfDoors_;</span><br><span class="line">        isConvertible_ = rhs.isConvertible_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="9-ç¼–è¯‘å™¨è¾…åŠ©æ£€æµ‹é—æ¼"><a href="#9-ç¼–è¯‘å™¨è¾…åŠ©æ£€æµ‹é—æ¼" class="headerlink" title="9. ç¼–è¯‘å™¨è¾…åŠ©æ£€æµ‹é—æ¼"></a>9. <strong>ç¼–è¯‘å™¨è¾…åŠ©æ£€æµ‹é—æ¼</strong></h4><p>ä½¿ç”¨ç°ä»£ç¼–è¯‘å™¨çš„è­¦å‘Šæ¥å¸®åŠ©æ£€æµ‹é—æ¼çš„æˆå‘˜å˜é‡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯ç¼–è¯‘å™¨è­¦å‘Šæ¥æ£€æµ‹æœªåˆå§‹åŒ–çš„æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="comment">// GCC/Clang: -Wuninitialized -Weffc++</span></span><br><span class="line"><span class="comment">// MSVC: /Wall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WarnableClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">    <span class="type">double</span> ratio_;</span><br><span class="line">    <span class="type">bool</span> flag_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¼šè­¦å‘Šä»»ä½•æœªåœ¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="built_in">WarnableClass</span>(<span class="type">const</span> WarnableClass&amp; rhs)</span><br><span class="line">        : <span class="built_in">name_</span>(rhs.name_),</span><br><span class="line">          <span class="built_in">value_</span>(rhs.value_),</span><br><span class="line">          <span class="built_in">ratio_</span>(rhs.ratio_)</span><br><span class="line">          <span class="comment">// âŒ ç¼ºå°‘flag_ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Š</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®Œæ•´çš„åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">WarnableClass</span>(<span class="type">const</span> WarnableClass&amp; rhs)</span><br><span class="line">        : <span class="built_in">name_</span>(rhs.name_),</span><br><span class="line">          <span class="built_in">value_</span>(rhs.value_),</span><br><span class="line">          <span class="built_in">ratio_</span>(rhs.ratio_),</span><br><span class="line">          <span class="built_in">flag_</span>(rhs.flag_)      <span class="comment">// ç°åœ¨æ‰€æœ‰æˆå‘˜éƒ½è¢«åˆå§‹åŒ–äº†</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-10"><a href="#æ€»ç»“-10" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>å¤åˆ¶å®Œæ•´æ€§çš„æ£€æŸ¥æ¸…å•ï¼š</strong></p>
<ol>
<li><strong>æ‰€æœ‰æˆå‘˜å˜é‡</strong>ï¼šç¡®ä¿æ¯ä¸ªæˆå‘˜å˜é‡éƒ½è¢«å¤åˆ¶</li>
<li><strong>æ‰€æœ‰åŸºç±»éƒ¨åˆ†</strong>ï¼šåœ¨æ´¾ç”Ÿç±»ä¸­è°ƒç”¨åŸºç±»çš„æ‹·è´å‡½æ•°</li>
<li><strong>å¤šé‡ç»§æ‰¿</strong>ï¼šç¡®ä¿æ‰€æœ‰åŸºç±»éƒ½è¢«æ­£ç¡®å¤„ç†</li>
<li><strong>èµ„æºç®¡ç†</strong>ï¼šæ·±æ‹·è´vsæµ…æ‹·è´çš„æ­£ç¡®é€‰æ‹©</li>
<li><strong>å¼‚å¸¸å®‰å…¨æ€§</strong>ï¼šç¡®ä¿æ‹·è´è¿‡ç¨‹ä¸­çš„å¼‚å¸¸å®‰å…¨</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</strong>ï¼šåœ¨æ‹·è´æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</li>
<li><strong>é¿å…å‡½æ•°é—´ç›¸äº’è°ƒç”¨</strong>ï¼šä¸è¦è®©æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ç›¸äº’è°ƒç”¨</li>
<li><strong>æå–å…¬å…±ä»£ç </strong>ï¼šå°†å…¬å…±çš„å¤åˆ¶é€»è¾‘æå–åˆ°ç§æœ‰å‡½æ•°ä¸­</li>
<li><strong>ä½¿ç”¨ç°ä»£C++ç‰¹æ€§</strong>ï¼šæ™ºèƒ½æŒ‡é’ˆã€ç§»åŠ¨è¯­ä¹‰ã€copy-and-swap</li>
</ul>
<p><strong>ç°ä»£C++å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>Rule of Zero</strong>ï¼šå°½å¯èƒ½ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œæ ‡å‡†å®¹å™¨ï¼Œé¿å…æ‰‹åŠ¨èµ„æºç®¡ç†</li>
<li><strong>Rule of Five</strong>ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰ææ„å‡½æ•°ï¼Œé€šå¸¸ä¹Ÿéœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</li>
<li><strong>ä½¿ç”¨&#x3D;defaultå’Œ&#x3D;delete</strong>ï¼šæ˜ç¡®è¡¨ç¤ºæ„å›¾</li>
</ul>
<p><strong>è®°ä½ï¼šCopyingå‡½æ•°åº”ç¡®ä¿å¤åˆ¶â€å¯¹è±¡å†…çš„æ‰€æœ‰æˆå‘˜å˜é‡â€ä»¥åŠâ€æ‰€æœ‰base classæˆåˆ†â€ã€‚ä¸è¦å°è¯•ä»¥æŸä¸ªcopyingå‡½æ•°å®ç°å¦ä¸€ä¸ªcopyingå‡½æ•°ã€‚åº”è¯¥å°†å…±åŒåŠŸèƒ½æ”¾è¿›ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œå¹¶ç”±ä¸¤ä¸ªcopyingå‡½æ•°å…±åŒè°ƒç”¨ã€‚</strong> </p>
<h2 id="æ¡æ¬¾13ï¼š-ä»¥å¯¹è±¡ç®¡ç†èµ„æº"><a href="#æ¡æ¬¾13ï¼š-ä»¥å¯¹è±¡ç®¡ç†èµ„æº" class="headerlink" title="æ¡æ¬¾13ï¼š ä»¥å¯¹è±¡ç®¡ç†èµ„æº"></a>æ¡æ¬¾13ï¼š ä»¥å¯¹è±¡ç®¡ç†èµ„æº</h2><blockquote>
<p><em>Use objects to manage resources</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-12"><a href="#æ ¸å¿ƒç†å¿µ-12" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ä¸ºé˜²æ­¢èµ„æºæ³„éœ²ï¼Œè¯·ä½¿ç”¨RAIIå¯¹è±¡ï¼Œå®ƒä»¬åœ¨æ„é€ å‡½æ•°ä¸­è·å¾—èµ„æºå¹¶åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æº</strong>ã€‚RAIIï¼ˆResource Acquisition Is Initializationï¼‰æ˜¯C++ä¸­æœ€é‡è¦çš„èµ„æºç®¡ç†æŠ€æœ¯ï¼Œå®ƒåˆ©ç”¨C++çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„ç¡®å®šæ€§è°ƒç”¨æ¥è‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§æŠ€æœ¯ä¸ä»…é€‚ç”¨äºå†…å­˜ç®¡ç†ï¼Œè¿˜é€‚ç”¨äºæ–‡ä»¶ã€ç½‘ç»œè¿æ¥ã€äº’æ–¥é”ç­‰å„ç§èµ„æºã€‚</p>
<h3 id="æ·±åº¦è§£æ-12"><a href="#æ·±åº¦è§£æ-12" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ä¼ ç»Ÿèµ„æºç®¡ç†çš„é—®é¢˜"><a href="#1-ä¼ ç»Ÿèµ„æºç®¡ç†çš„é—®é¢˜" class="headerlink" title="1. ä¼ ç»Ÿèµ„æºç®¡ç†çš„é—®é¢˜"></a>1. <strong>ä¼ ç»Ÿèµ„æºç®¡ç†çš„é—®é¢˜</strong></h4><p>æ‰‹åŠ¨èµ„æºç®¡ç†å®¹æ˜“å¯¼è‡´èµ„æºæ³„æ¼å’Œå¼‚å¸¸å®‰å…¨é—®é¢˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¼ ç»Ÿçš„æ‰‹åŠ¨èµ„æºç®¡ç†æ–¹å¼çš„é—®é¢˜</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ†é…èµ„æº</span></span><br><span class="line">    <span class="type">int</span>* data = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">1000</span>];</span><br><span class="line">    FILE* file = <span class="built_in">fopen</span>(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ•°æ®...</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">someErrorCondition</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;  <span class="comment">// âŒ å¿˜è®°é‡Šæ”¾èµ„æºå°±è¿”å›äº†ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ</span></span><br><span class="line">    <span class="built_in">riskyOperation</span>();  <span class="comment">// âŒ å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œèµ„æºä¸ä¼šè¢«é‡Šæ”¾</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­£å¸¸è·¯å¾„ä¸‹çš„æ¸…ç†</span></span><br><span class="line">    <span class="keyword">delete</span>[] data;</span><br><span class="line">    <span class="built_in">fclose</span>(file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-RAIIçš„åŸºæœ¬åŸç†"><a href="#2-RAIIçš„åŸºæœ¬åŸç†" class="headerlink" title="2. RAIIçš„åŸºæœ¬åŸç†"></a>2. <strong>RAIIçš„åŸºæœ¬åŸç†</strong></h4><p>RAIIåˆ©ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¥è‡ªåŠ¨ç®¡ç†èµ„æºã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… RAIIåŸç†ç¤ºä¾‹ï¼šç®€å•çš„æ•°ç»„åŒ…è£…å™¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IntArray</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">IntArray</span><span class="params">(<span class="type">size_t</span> size)</span> : size_(size) &#123;</span></span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">int</span>[size_];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">IntArray</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index) &#123; <span class="keyword">return</span> data_[index]; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦ç”¨æ‹·è´ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰</span></span><br><span class="line">    <span class="built_in">IntArray</span>(<span class="type">const</span> IntArray&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    IntArray&amp; <span class="keyword">operator</span>=(<span class="type">const</span> IntArray&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½¿ç”¨RAIIçš„å®‰å…¨ç‰ˆæœ¬</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processDataSafely</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">IntArray <span class="title">data</span><span class="params">(<span class="number">1000</span>)</span></span>;        <span class="comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">someErrorCondition</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;  <span class="comment">// âœ… dataçš„ææ„å‡½æ•°ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">riskyOperation</span>();  <span class="comment">// âœ… å³ä½¿æŠ›å‡ºå¼‚å¸¸ï¼Œææ„å‡½æ•°ä¹Ÿä¼šè¢«è°ƒç”¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å‡½æ•°ç»“æŸæ—¶ï¼Œdataçš„ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾èµ„æº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è®°ä½ï¼šä¸ºé˜²æ­¢èµ„æºæ³„éœ²ï¼Œè¯·ä½¿ç”¨RAIIå¯¹è±¡ï¼Œå®ƒä»¬åœ¨æ„é€ å‡½æ•°ä¸­è·å¾—èµ„æºå¹¶åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æºã€‚ç°ä»£C++ä¸­å¸¸ç”¨çš„RAIIç±»åŒ…æ‹¬std::unique_ptrå’Œstd::shared_ptrç­‰æ™ºèƒ½æŒ‡é’ˆã€‚</strong></p>
<h2 id="æ¡æ¬¾14ï¼š-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º"><a href="#æ¡æ¬¾14ï¼š-åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º" class="headerlink" title="æ¡æ¬¾14ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º"></a>æ¡æ¬¾14ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º</h2><blockquote>
<p><em>Think carefully about copying behavior in resource-managing classes</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-13"><a href="#æ ¸å¿ƒç†å¿µ-13" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å¤åˆ¶RAIIå¯¹è±¡å¿…é¡»ä¸€å¹¶å¤åˆ¶å®ƒæ‰€ç®¡ç†çš„èµ„æºï¼Œæ‰€ä»¥èµ„æºçš„copyingè¡Œä¸ºå†³å®šRAIIå¯¹è±¡çš„copyingè¡Œä¸º</strong>ã€‚å½“è®¾è®¡èµ„æºç®¡ç†ç±»æ—¶ï¼Œå¿…é¡»ä»”ç»†è€ƒè™‘æ‹·è´è¡Œä¸ºï¼Œå› ä¸ºä¸å½“çš„æ‹·è´å¯èƒ½å¯¼è‡´èµ„æºé‡å¤é‡Šæ”¾ã€æ‚¬æŒ‚æŒ‡é’ˆæˆ–èµ„æºæ³„æ¼ã€‚æ™®éè€Œå¸¸è§çš„RAII class copyingè¡Œä¸ºåŒ…æ‹¬ï¼šæŠ‘åˆ¶copyingã€æ–½è¡Œå¼•ç”¨è®¡æ•°æ³•ï¼ˆreference countingï¼‰ã€æ·±æ‹·è´èµ„æºï¼Œæˆ–è½¬ç§»èµ„æºæ‰€æœ‰æƒã€‚</p>
<h3 id="æ·±åº¦è§£æ-13"><a href="#æ·±åº¦è§£æ-13" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-èµ„æºç®¡ç†ç±»çš„æ‹·è´é—®é¢˜"><a href="#1-èµ„æºç®¡ç†ç±»çš„æ‹·è´é—®é¢˜" class="headerlink" title="1. èµ„æºç®¡ç†ç±»çš„æ‹·è´é—®é¢˜"></a>1. <strong>èµ„æºç®¡ç†ç±»çš„æ‹·è´é—®é¢˜</strong></h4><p>å½“RAIIç±»ç®¡ç†èµ„æºæ—¶ï¼Œé»˜è®¤çš„æ‹·è´è¡Œä¸ºé€šå¸¸æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æœ‰é—®é¢˜çš„RAIIç±»ï¼šé»˜è®¤æ‹·è´è¡Œä¸ºå±é™©</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NaiveLock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::mutex* pm_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">NaiveLock</span><span class="params">(std::mutex* pm)</span> : pm_(pm) &#123;</span></span><br><span class="line">        pm_-&gt;<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">NaiveLock</span>() &#123;</span><br><span class="line">        pm_-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="comment">// è¿™ä¼šå¯¼è‡´é—®é¢˜ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::mutex m;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">NaiveLock <span class="title">lock1</span><span class="params">(&amp;m)</span></span>;      <span class="comment">// è·å–é”</span></span><br><span class="line">        <span class="function">NaiveLock <span class="title">lock2</span><span class="params">(lock1)</span></span>;   <span class="comment">// âŒ æ‹·è´æ„é€ ï¼Œç°åœ¨ä¸¤ä¸ªå¯¹è±¡ç®¡ç†åŒä¸€ä¸ªé”</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// lock2ç¦»å¼€ä½œç”¨åŸŸï¼Œè°ƒç”¨unlock()</span></span><br><span class="line">    &#125;  <span class="comment">// lock1ç¦»å¼€ä½œç”¨åŸŸï¼Œå†æ¬¡è°ƒç”¨unlock() - é”™è¯¯ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è§£å†³æ–¹æ¡ˆ1ï¼šç¦æ­¢æ‹·è´"><a href="#2-è§£å†³æ–¹æ¡ˆ1ï¼šç¦æ­¢æ‹·è´" class="headerlink" title="2. è§£å†³æ–¹æ¡ˆ1ï¼šç¦æ­¢æ‹·è´"></a>2. <strong>è§£å†³æ–¹æ¡ˆ1ï¼šç¦æ­¢æ‹·è´</strong></h4><p>æœ€ç®€å•å’Œå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯ç¦æ­¢æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ç¦æ­¢æ‹·è´çš„RAIIç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NonCopyableLock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::mutex* pm_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">NonCopyableLock</span><span class="params">(std::mutex* pm)</span> : pm_(pm) &#123;</span></span><br><span class="line">        pm_-&gt;<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">NonCopyableLock</span>() &#123;</span><br><span class="line">        pm_-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="built_in">NonCopyableLock</span>(<span class="type">const</span> NonCopyableLock&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    NonCopyableLock&amp; <span class="keyword">operator</span>=(<span class="type">const</span> NonCopyableLock&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä»¥é€‰æ‹©æ”¯æŒç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">    <span class="built_in">NonCopyableLock</span>(NonCopyableLock&amp;&amp; other) <span class="keyword">noexcept</span> : <span class="built_in">pm_</span>(other.pm_) &#123;</span><br><span class="line">        other.pm_ = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NonCopyableLock&amp; <span class="keyword">operator</span>=(NonCopyableLock&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pm_) pm_-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">            pm_ = other.pm_;</span><br><span class="line">            other.pm_ = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateNonCopyable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::mutex m;</span><br><span class="line">    </span><br><span class="line">    <span class="function">NonCopyableLock <span class="title">lock1</span><span class="params">(&amp;m)</span></span>;</span><br><span class="line">    <span class="comment">// NonCopyableLock lock2(lock1);  // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ‹·è´è¢«ç¦ç”¨</span></span><br><span class="line">    </span><br><span class="line">    NonCopyableLock lock3 = std::<span class="built_in">move</span>(lock1);  <span class="comment">// âœ… ç§»åŠ¨æ˜¯å…è®¸çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-è§£å†³æ–¹æ¡ˆ2ï¼šå¼•ç”¨è®¡æ•°"><a href="#3-è§£å†³æ–¹æ¡ˆ2ï¼šå¼•ç”¨è®¡æ•°" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆ2ï¼šå¼•ç”¨è®¡æ•°"></a>3. <strong>è§£å†³æ–¹æ¡ˆ2ï¼šå¼•ç”¨è®¡æ•°</strong></h4><p>å…è®¸å¤šä¸ªå¯¹è±¡å…±äº«èµ„æºï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… ä½¿ç”¨å¼•ç”¨è®¡æ•°çš„RAIIç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedLock</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;std::mutex&gt; pm_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SharedLock</span><span class="params">(std::mutex* pm)</span> </span></span><br><span class="line"><span class="function">        : pm_(pm, [](std::mutex* m) &#123;</span> m-&gt;<span class="built_in">unlock</span>(); &#125;) &#123;</span><br><span class="line">        pm-&gt;<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é»˜è®¤æ‹·è´è¡Œä¸ºç°åœ¨æ˜¯å®‰å…¨çš„</span></span><br><span class="line">    <span class="comment">// shared_pträ¼šè‡ªåŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°</span></span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">SharedLock</span>() &#123;</span><br><span class="line">        <span class="comment">// shared_ptrçš„ææ„å‡½æ•°ä¼šåœ¨å¼•ç”¨è®¡æ•°ä¸º0æ—¶è°ƒç”¨deleter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSharedLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::mutex m;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">SharedLock <span class="title">lock1</span><span class="params">(&amp;m)</span></span>;      <span class="comment">// å¼•ç”¨è®¡æ•° = 1ï¼Œè·å–é”</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">SharedLock <span class="title">lock2</span><span class="params">(lock1)</span></span>;   <span class="comment">// âœ… å¼•ç”¨è®¡æ•° = 2ï¼Œå…±äº«é”</span></span><br><span class="line">            SharedLock lock3 = lock1;  <span class="comment">// âœ… å¼•ç”¨è®¡æ•° = 3</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// lock3ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•° = 2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// lock2ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•° = 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// lock1ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•° = 0ï¼Œé‡Šæ”¾é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-è§£å†³æ–¹æ¡ˆ3ï¼šæ·±æ‹·è´"><a href="#4-è§£å†³æ–¹æ¡ˆ3ï¼šæ·±æ‹·è´" class="headerlink" title="4. è§£å†³æ–¹æ¡ˆ3ï¼šæ·±æ‹·è´"></a>4. <strong>è§£å†³æ–¹æ¡ˆ3ï¼šæ·±æ‹·è´</strong></h4><p>åˆ›å»ºèµ„æºçš„å‰¯æœ¬ï¼Œæ¯ä¸ªå¯¹è±¡ç®¡ç†è‡ªå·±çš„èµ„æºã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ·±æ‹·è´çš„RAIIç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeepCopyResource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">DeepCopyResource</span>(<span class="type">size_t</span> size) : <span class="built_in">size_</span>(size) &#123;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Allocated &quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; integers&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼šæ·±æ‹·è´</span></span><br><span class="line">    <span class="built_in">DeepCopyResource</span>(<span class="type">const</span> DeepCopyResource&amp; other) : <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::<span class="built_in">copy</span>(other.data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>() + size_, data_.<span class="built_in">get</span>());</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Deep copied &quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; integers&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èµ‹å€¼è¿ç®—ç¬¦ï¼šæ·±æ‹·è´</span></span><br><span class="line">    DeepCopyResource&amp; <span class="keyword">operator</span>=(<span class="type">const</span> DeepCopyResource&amp; other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        size_ = other.size_;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::<span class="built_in">copy</span>(other.data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>() + size_, data_.<span class="built_in">get</span>());</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Deep copy assigned &quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; integers&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">DeepCopyResource</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Deallocated &quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; integers&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index) &#123; <span class="keyword">return</span> data_[index]; &#125;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index) <span class="type">const</span> &#123; <span class="keyword">return</span> data_[index]; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDeepCopy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">DeepCopyResource <span class="title">res1</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">    res1[<span class="number">0</span>] = <span class="number">42</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">DeepCopyResource <span class="title">res2</span><span class="params">(res1)</span></span>;  <span class="comment">// âœ… æ·±æ‹·è´ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰è‡ªå·±çš„èµ„æº</span></span><br><span class="line">    res2[<span class="number">0</span>] = <span class="number">99</span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;res1[0] = &quot;</span> &lt;&lt; res1[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º42</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;res2[0] = &quot;</span> &lt;&lt; res2[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º99</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-è§£å†³æ–¹æ¡ˆ4ï¼šè½¬ç§»æ‰€æœ‰æƒ"><a href="#5-è§£å†³æ–¹æ¡ˆ4ï¼šè½¬ç§»æ‰€æœ‰æƒ" class="headerlink" title="5. è§£å†³æ–¹æ¡ˆ4ï¼šè½¬ç§»æ‰€æœ‰æƒ"></a>5. <strong>è§£å†³æ–¹æ¡ˆ4ï¼šè½¬ç§»æ‰€æœ‰æƒ</strong></h4><p>å°†èµ„æºæ‰€æœ‰æƒä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… è½¬ç§»æ‰€æœ‰æƒçš„RAIIç±»ï¼ˆç±»ä¼¼std::unique_ptrï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TransferOwnership</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TransferOwnership</span>(<span class="type">size_t</span> size) : <span class="built_in">size_</span>(size) &#123;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦ç”¨æ‹·è´</span></span><br><span class="line">    <span class="built_in">TransferOwnership</span>(<span class="type">const</span> TransferOwnership&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    TransferOwnership&amp; <span class="keyword">operator</span>=(<span class="type">const</span> TransferOwnership&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°ï¼šè½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="built_in">TransferOwnership</span>(TransferOwnership&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">data_</span>(std::<span class="built_in">move</span>(other.data_)), <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        other.size_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼šè½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    TransferOwnership&amp; <span class="keyword">operator</span>=(TransferOwnership&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            data_ = std::<span class="built_in">move</span>(other.data_);</span><br><span class="line">            size_ = other.size_;</span><br><span class="line">            other.size_ = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span>&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index) &#123; <span class="keyword">return</span> data_[index]; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateOwnershipTransfer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">TransferOwnership <span class="title">res1</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">    res1[<span class="number">0</span>] = <span class="number">42</span>;</span><br><span class="line">    </span><br><span class="line">    TransferOwnership res2 = std::<span class="built_in">move</span>(res1);  <span class="comment">// âœ… è½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="comment">// ç°åœ¨res1ä¸å†æ‹¥æœ‰èµ„æºï¼Œres2æ‹¥æœ‰èµ„æº</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;res2[0] = &quot;</span> &lt;&lt; res2[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º42</span></span><br><span class="line">    <span class="comment">// std::cout &lt;&lt; res1[0];  // âŒ æœªå®šä¹‰è¡Œä¸ºï¼Œres1å·²ä¸æ‹¥æœ‰èµ„æº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-11"><a href="#æ€»ç»“-11" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>èµ„æºç®¡ç†ç±»çš„å››ç§æ‹·è´ç­–ç•¥ï¼š</strong></p>
<ol>
<li><p><strong>ç¦æ­¢æ‹·è´</strong>ï¼šåˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦</p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šç‹¬å èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€é”ï¼‰</li>
<li>ä¼˜ç‚¹ï¼šç®€å•ã€å®‰å…¨</li>
<li>ç¼ºç‚¹ï¼šé™åˆ¶äº†ä½¿ç”¨çµæ´»æ€§</li>
</ul>
</li>
<li><p><strong>å¼•ç”¨è®¡æ•°</strong>ï¼šå¤šä¸ªå¯¹è±¡å…±äº«èµ„æº</p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šå¯å…±äº«çš„èµ„æºï¼ˆå¦‚å†…å­˜ã€ç¼“å­˜ï¼‰</li>
<li>ä¼˜ç‚¹ï¼šçµæ´»ã€è‡ªåŠ¨ç®¡ç†</li>
<li>ç¼ºç‚¹ï¼šæœ‰å¼•ç”¨è®¡æ•°å¼€é”€ï¼Œå¯èƒ½æœ‰å¾ªç¯å¼•ç”¨é—®é¢˜</li>
</ul>
</li>
<li><p><strong>æ·±æ‹·è´</strong>ï¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºèµ„æºå‰¯æœ¬</p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šå¯å¤åˆ¶çš„èµ„æºï¼ˆå¦‚æ•°æ®å®¹å™¨ï¼‰</li>
<li>ä¼˜ç‚¹ï¼šæ¯ä¸ªå¯¹è±¡ç‹¬ç«‹ã€æ— å…±äº«é—®é¢˜</li>
<li>ç¼ºç‚¹ï¼šèµ„æºå¼€é”€å¤§</li>
</ul>
</li>
<li><p><strong>è½¬ç§»æ‰€æœ‰æƒ</strong>ï¼šä½¿ç”¨ç§»åŠ¨è¯­ä¹‰è½¬ç§»èµ„æº</p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šç‹¬å ä¸”å¯è½¬ç§»çš„èµ„æº</li>
<li>ä¼˜ç‚¹ï¼šé«˜æ•ˆã€æ˜ç¡®çš„æ‰€æœ‰æƒè¯­ä¹‰</li>
<li>ç¼ºç‚¹ï¼šèµ„æºåœ¨è½¬ç§»åä¸å¯è®¿é—®</li>
</ul>
</li>
</ol>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æ˜ç¡®èµ„æºè¯­ä¹‰</strong>ï¼šç¡®å®šèµ„æºæ˜¯ç‹¬å ã€å…±äº«è¿˜æ˜¯å¯å¤åˆ¶çš„</li>
<li><strong>é€‰æ‹©åˆé€‚çš„ç­–ç•¥</strong>ï¼šæ ¹æ®èµ„æºç‰¹æ€§é€‰æ‹©æ‹·è´è¡Œä¸º</li>
<li><strong>ä¿æŒä¸€è‡´æ€§</strong>ï¼šæ•´ä¸ªç±»çš„è®¾è®¡è¦ä¿æŒä¸€è‡´çš„èµ„æºç®¡ç†è¯­ä¹‰</li>
<li><strong>ä½¿ç”¨æ ‡å‡†åº“</strong>ï¼šä¼˜å…ˆä½¿ç”¨std::unique_ptrã€std::shared_ptrç­‰</li>
</ul>
<p><strong>è®°ä½ï¼šå¤åˆ¶RAIIå¯¹è±¡å¿…é¡»ä¸€å¹¶å¤åˆ¶å®ƒæ‰€ç®¡ç†çš„èµ„æºï¼Œæ‰€ä»¥èµ„æºçš„copyingè¡Œä¸ºå†³å®šRAIIå¯¹è±¡çš„copyingè¡Œä¸ºã€‚æ™®éè€Œå¸¸è§çš„RAII class copyingè¡Œä¸ºæ˜¯ï¼šæŠ‘åˆ¶copyingã€æ–½è¡Œå¼•ç”¨è®¡æ•°æ³•ï¼ˆreference countingï¼‰ã€‚ä¸è¿‡å…¶ä»–è¡Œä¸ºä¹Ÿéƒ½å¯èƒ½è¢«å®ç°ã€‚</strong></p>
<h2 id="æ¡æ¬¾15ï¼š-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"><a href="#æ¡æ¬¾15ï¼š-åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®" class="headerlink" title="æ¡æ¬¾15ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"></a>æ¡æ¬¾15ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</h2><blockquote>
<p><em>Provide access to raw resources in resource-managing classes</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-14"><a href="#æ ¸å¿ƒç†å¿µ-14" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>APIså¾€å¾€è¦æ±‚è®¿é—®åŸå§‹èµ„æºï¼ˆraw resourcesï¼‰ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªRAII classåº”è¯¥æä¾›ä¸€ä¸ªâ€å–å¾—å…¶æ‰€ç®¡ç†ä¹‹èµ„æºâ€çš„åŠæ³•</strong>ã€‚å¯¹åŸå§‹èµ„æºçš„è®¿é—®å¯èƒ½ç»ç”±æ˜¾å¼è½¬æ¢æˆ–éšå¼è½¬æ¢ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ˜¾å¼è½¬æ¢æ¯”è¾ƒå®‰å…¨ï¼Œä½†éšå¼è½¬æ¢å¯¹å®¢æˆ·æ¯”è¾ƒæ–¹ä¾¿ã€‚è®¾è®¡èµ„æºç®¡ç†ç±»æ—¶ï¼Œéœ€è¦åœ¨å®‰å…¨æ€§å’Œæ˜“ç”¨æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p>
<h3 id="æ·±åº¦è§£æ-14"><a href="#æ·±åº¦è§£æ-14" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®åŸå§‹èµ„æº"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®åŸå§‹èµ„æº" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®åŸå§‹èµ„æº"></a>1. <strong>ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®åŸå§‹èµ„æº</strong></h4><p>RAIIç±»å°è£…äº†èµ„æºï¼Œä½†ç°å®ä¸­çš„APIå¾€å¾€éœ€è¦ç›´æ¥è®¿é—®åº•å±‚èµ„æºã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç°å®ä¸­çš„APIé€šå¸¸éœ€è¦åŸå§‹èµ„æº</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processFile</span><span class="params">(FILE* file)</span></span>;           <span class="comment">// C APIéœ€è¦FILE*</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawTexture</span><span class="params">(GLuint textureId)</span></span>;     <span class="comment">// OpenGL APIéœ€è¦çº¹ç†ID</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendData</span><span class="params">(<span class="type">int</span> socket)</span></span>;              <span class="comment">// ç½‘ç»œAPIéœ€è¦socketå¥æŸ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RAIIç±»å¿…é¡»æä¾›è®¿é—®åŸå§‹èµ„æºçš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileRAII</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// éœ€è¦æŸç§æ–¹å¼è®©å¤–éƒ¨APIè®¿é—®file_</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ˜¾å¼è½¬æ¢ï¼šå®‰å…¨çš„è®¿é—®æ–¹å¼"><a href="#2-æ˜¾å¼è½¬æ¢ï¼šå®‰å…¨çš„è®¿é—®æ–¹å¼" class="headerlink" title="2. æ˜¾å¼è½¬æ¢ï¼šå®‰å…¨çš„è®¿é—®æ–¹å¼"></a>2. <strong>æ˜¾å¼è½¬æ¢ï¼šå®‰å…¨çš„è®¿é—®æ–¹å¼</strong></h4><p>é€šè¿‡æ˜ç¡®çš„æˆå‘˜å‡½æ•°æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">FileHandle</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filename, <span class="type">const</span> <span class="type">char</span>* mode)</span></span></span><br><span class="line"><span class="function">        : file_(std::fopen(filename, mode)) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">FileHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) &#123;</span><br><span class="line">            std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ˜¾å¼è½¬æ¢ï¼šæä¾›get()å‡½æ•°è®¿é—®åº•å±‚èµ„æº</span></span><br><span class="line">    <span class="function">FILE* <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›æ›´å¤šæœ‰ç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isOpen</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> file_ != <span class="literal">nullptr</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">readLine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!file_) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), file_)) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">string</span>(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateExplicitAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">FileHandle <span class="title">fileHandle</span><span class="params">(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… é€šè¿‡æ˜¾å¼è°ƒç”¨get()å‡½æ•°æ¥è®¿é—®åº•å±‚FILE*æŒ‡é’ˆ</span></span><br><span class="line">    FILE* rawFile = fileHandle.<span class="built_in">get</span>();</span><br><span class="line">    <span class="keyword">if</span> (rawFile) &#123;</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">100</span>];</span><br><span class="line">        std::<span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), rawFile);</span><br><span class="line">        std::<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ„å›¾æ˜ç¡®ï¼šæˆ‘ä»¬æ˜ç¡®çŸ¥é“åœ¨è®¿é—®åº•å±‚èµ„æº</span></span><br><span class="line">    <span class="built_in">processFile</span>(fileHandle.<span class="built_in">get</span>());  <span class="comment">// ä¼ é€’ç»™éœ€è¦FILE*çš„API</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ˜¾å¼è½¬æ¢çš„ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ„å›¾æ˜ç¡®ï¼Œä»£ç å¯è¯»æ€§å¥½</li>
<li>ä¸ä¼šå‘ç”Ÿæ„å¤–çš„ç±»å‹è½¬æ¢</li>
<li>ä¾¿äºè°ƒè¯•å’Œç»´æŠ¤</li>
</ul>
<p><strong>æ˜¾å¼è½¬æ¢çš„ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ç¨æ˜¾ç¹ç</li>
<li>éœ€è¦è®°ä½è°ƒç”¨get()å‡½æ•°</li>
</ul>
<h4 id="3-éšå¼è½¬æ¢ï¼šä¾¿åˆ©ä½†æœ‰é£é™©çš„è®¿é—®æ–¹å¼"><a href="#3-éšå¼è½¬æ¢ï¼šä¾¿åˆ©ä½†æœ‰é£é™©çš„è®¿é—®æ–¹å¼" class="headerlink" title="3. éšå¼è½¬æ¢ï¼šä¾¿åˆ©ä½†æœ‰é£é™©çš„è®¿é—®æ–¹å¼"></a>3. <strong>éšå¼è½¬æ¢ï¼šä¾¿åˆ©ä½†æœ‰é£é™©çš„è®¿é—®æ–¹å¼</strong></h4><p>é€šè¿‡ç±»å‹è½¬æ¢è¿ç®—ç¬¦æä¾›è‡ªåŠ¨è½¬æ¢ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ImplicitFileHandle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ImplicitFileHandle</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filename, <span class="type">const</span> <span class="type">char</span>* mode)</span></span></span><br><span class="line"><span class="function">        : file_(std::fopen(filename, mode)) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">ImplicitFileHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) &#123;</span><br><span class="line">            std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš ï¸ éšå¼è½¬æ¢ï¼šè‡ªåŠ¨è½¬æ¢ä¸ºFILE*</span></span><br><span class="line">    <span class="keyword">operator</span> FILE*() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> file_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥æä¾›boolè½¬æ¢ï¼Œç”¨äºæ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_ != <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateImplicitAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ImplicitFileHandle <span class="title">fileHandle</span><span class="params">(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… ç®€æ´ï¼šæ— éœ€æ˜¾å¼è°ƒç”¨ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºFILE*</span></span><br><span class="line">    <span class="keyword">if</span> (fileHandle) &#123;  <span class="comment">// è‡ªåŠ¨è½¬æ¢ä¸ºboolè¿›è¡Œæ£€æŸ¥</span></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">100</span>];</span><br><span class="line">        std::<span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), fileHandle); <span class="comment">// éšå¼è½¬æ¢ä¸ºFILE*</span></span><br><span class="line">        std::<span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buffer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç›´æ¥ä¼ é€’ç»™APIï¼Œè‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">    <span class="built_in">processFile</span>(fileHandle);  <span class="comment">// è‡ªåŠ¨è½¬æ¢ä¸ºFILE*</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä½†å¯èƒ½å¯¼è‡´æ„å¤–çš„è½¬æ¢</span></span><br><span class="line">    FILE* rawFile = fileHandle;  <span class="comment">// å¯èƒ½ä¸æ˜¯æœ‰æ„çš„</span></span><br><span class="line">    <span class="keyword">if</span> (fileHandle == <span class="literal">nullptr</span>) &#123; <span class="comment">/* ... */</span> &#125;  <span class="comment">// æ„å¤–çš„æŒ‡é’ˆæ¯”è¾ƒ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>éšå¼è½¬æ¢çš„ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ç®€æ´æ–¹ä¾¿</li>
<li>ä»£ç æ›´æ¥è¿‘ä½¿ç”¨åŸå§‹èµ„æºçš„é£æ ¼</li>
<li>å‡å°‘äº†é‡å¤çš„get()è°ƒç”¨</li>
</ul>
<p><strong>éšå¼è½¬æ¢çš„ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¯èƒ½å‘ç”Ÿæ„å¤–çš„ç±»å‹è½¬æ¢</li>
<li>é™ä½äº†ä»£ç çš„æ˜ç¡®æ€§</li>
<li>å¢åŠ äº†å‡ºé”™çš„å¯èƒ½æ€§</li>
</ul>
<h4 id="4-æ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡å€Ÿé‰´"><a href="#4-æ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡å€Ÿé‰´" class="headerlink" title="4. æ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡å€Ÿé‰´"></a>4. <strong>æ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡å€Ÿé‰´</strong></h4><p>æ ‡å‡†åº“æ™ºèƒ½æŒ‡é’ˆæä¾›äº†å¾ˆå¥½çš„è®¾è®¡å‚è€ƒã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSmartPointerAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; ptr = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">42</span>);  <span class="comment">// C++14</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ˜¾å¼è®¿é—®</span></span><br><span class="line">    <span class="type">int</span>* rawPtr = ptr.<span class="built_in">get</span>();        <span class="comment">// æ˜ç¡®çš„get()å‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> value = *ptr;               <span class="comment">// è§£å¼•ç”¨æ“ä½œç¬¦</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (ptr) &#123;                      <span class="comment">// éšå¼è½¬æ¢ä¸ºbool</span></span><br><span class="line">        std::cout &lt;&lt; *ptr &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ æ²¡æœ‰éšå¼è½¬æ¢ä¸ºåŸå§‹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// int* raw = ptr;              // ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åº”ç”¨åˆ°æˆ‘ä»¬çš„è®¾è®¡ä¸­</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BestPracticeFileHandle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BestPracticeFileHandle</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* filename, <span class="type">const</span> <span class="type">char</span>* mode)</span></span></span><br><span class="line"><span class="function">        : file_(std::fopen(filename, mode)) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">BestPracticeFileHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) &#123;</span><br><span class="line">            std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âœ… æ˜¾å¼è®¿é—®ï¼šç±»ä¼¼æ™ºèƒ½æŒ‡é’ˆçš„get()</span></span><br><span class="line">    <span class="function">FILE* <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… è§£å¼•ç”¨è®¿é—®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰</span></span><br><span class="line">    FILE&amp; <span class="keyword">operator</span>*() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!file_) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;File not open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> *file_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç®­å¤´æ“ä½œç¬¦ï¼ˆå¦‚æœFILEæ˜¯ç»“æ„ä½“çš„è¯ï¼‰</span></span><br><span class="line">    FILE* <span class="keyword">operator</span>-&gt;() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> file_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… éšå¼è½¬æ¢ä¸ºboolï¼Œç”¨äºæ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_ != <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-ä¸åŒèµ„æºç±»å‹çš„è®¿é—®æ¨¡å¼"><a href="#5-ä¸åŒèµ„æºç±»å‹çš„è®¿é—®æ¨¡å¼" class="headerlink" title="5. ä¸åŒèµ„æºç±»å‹çš„è®¿é—®æ¨¡å¼"></a>5. <strong>ä¸åŒèµ„æºç±»å‹çš„è®¿é—®æ¨¡å¼</strong></h4><p>ä¸åŒç±»å‹çš„èµ„æºå¯èƒ½éœ€è¦ä¸åŒçš„è®¿é—®ç­–ç•¥ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç½‘ç»œsocketï¼šé€šå¸¸åªéœ€è¦æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SocketHandle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> socket_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SocketHandle</span><span class="params">(<span class="type">const</span> std::string&amp; host, <span class="type">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºsocketè¿æ¥</span></span><br><span class="line">        socket_ = <span class="built_in">createConnection</span>(host, port);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">SocketHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (socket_ != <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">close</span>(socket_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ˜¾å¼è®¿é—®socketæè¿°ç¬¦</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> socket_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> socket_ != <span class="number">-1</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä¸æä¾›éšå¼è½¬æ¢ï¼Œé¿å…æ„å¤–ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// operator int() const &#123; return socket_; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">createConnection</span><span class="params">(<span class="type">const</span> std::string&amp; host, <span class="type">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°ç½‘ç»œè¿æ¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span>; <span class="comment">// ç¤ºä¾‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OpenGLçº¹ç†ï¼šå¯èƒ½éœ€è¦å¤šç§è®¿é—®æ–¹å¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextureHandle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> textureId_;</span><br><span class="line">    <span class="type">int</span> width_, height_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TextureHandle</span>(<span class="type">const</span> std::string&amp; filename) &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½çº¹ç†</span></span><br><span class="line">        textureId_ = <span class="built_in">loadTexture</span>(filename, width_, height_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">TextureHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (textureId_ != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">deleteTexture</span>(textureId_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æä¾›å¤šç§è®¿é—®æ–¹å¼</span></span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> textureId_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getWidth</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> width_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getHeight</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> height_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ä¸ºç‰¹å®šç”¨é€”æä¾›ä¾¿åˆ©å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bind</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">bindTexture</span>(textureId_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> textureId_ != <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">unsigned</span> <span class="type">int</span> <span class="title">loadTexture</span><span class="params">(<span class="type">const</span> std::string&amp; filename, <span class="type">int</span>&amp; w, <span class="type">int</span>&amp; h)</span> </span>&#123;</span><br><span class="line">        w = h = <span class="number">256</span>; <span class="comment">// ç¤ºä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;    <span class="comment">// ç¤ºä¾‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deleteTexture</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> id)</span> </span>&#123; <span class="comment">/* å®ç° */</span> &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bindTexture</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> id)</span> </span>&#123; <span class="comment">/* å®ç° */</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-12"><a href="#æ€»ç»“-12" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>èµ„æºè®¿é—®ç­–ç•¥çš„é€‰æ‹©æŒ‡å—ï¼š</strong></p>
<ol>
<li><p><strong>æ˜¾å¼è½¬æ¢ï¼ˆæ¨èï¼‰</strong>ï¼š</p>
<ul>
<li>æä¾›get()æˆ–ç±»ä¼¼çš„æ˜ç¡®å‡½æ•°</li>
<li>é€‚ç”¨äºå¤§å¤šæ•°RAIIç±»</li>
<li>å®‰å…¨æ€§é«˜ï¼Œæ„å›¾æ˜ç¡®</li>
</ul>
</li>
<li><p><strong>éšå¼è½¬æ¢ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</strong>ï¼š</p>
<ul>
<li>åªåœ¨ä½¿ç”¨é¢‘ç¹ä¸”è½¬æ¢å®‰å…¨æ—¶è€ƒè™‘</li>
<li>é¿å…æ„å¤–çš„ç±»å‹è½¬æ¢</li>
<li>è€ƒè™‘æä¾›explicitè½¬æ¢</li>
</ul>
</li>
<li><p><strong>æ··åˆç­–ç•¥</strong>ï¼š</p>
<ul>
<li>æ˜¾å¼è®¿é—®åŸå§‹èµ„æº</li>
<li>éšå¼è½¬æ¢ä¸ºboolç”¨äºæ¡ä»¶åˆ¤æ–­</li>
<li>æ ¹æ®èµ„æºç‰¹æ€§æä¾›ä¸“é—¨çš„æ“ä½œå‡½æ•°</li>
</ul>
</li>
</ol>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>å®‰å…¨ç¬¬ä¸€</strong>ï¼šé¿å…æ„å¤–çš„ç±»å‹è½¬æ¢</li>
<li><strong>æ˜ç¡®æ„å›¾</strong>ï¼šè®©ä»£ç æ¸…æ¥šåœ°è¡¨è¾¾è®¿é—®èµ„æºçš„æ„å›¾</li>
<li><strong>ä¾¿åˆ©æ€§</strong>ï¼šåœ¨å®‰å…¨çš„å‰æä¸‹æä¾›ä¾¿åˆ©çš„è®¿é—®æ–¹å¼</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šåœ¨æ•´ä¸ªé¡¹ç›®ä¸­ä¿æŒä¸€è‡´çš„è®¿é—®æ¨¡å¼</li>
</ul>
<p><strong>è®°ä½ï¼šAPIså¾€å¾€è¦æ±‚è®¿é—®åŸå§‹èµ„æºï¼ˆraw resourcesï¼‰ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªRAII classåº”è¯¥æä¾›ä¸€ä¸ªâ€å–å¾—å…¶æ‰€ç®¡ç†ä¹‹èµ„æºâ€çš„åŠæ³•ã€‚å¯¹åŸå§‹èµ„æºçš„è®¿é—®å¯èƒ½ç»ç”±æ˜¾å¼è½¬æ¢æˆ–éšå¼è½¬æ¢ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ˜¾å¼è½¬æ¢æ¯”è¾ƒå®‰å…¨ï¼Œä½†éšå¼è½¬æ¢å¯¹å®¢æˆ·æ¯”è¾ƒæ–¹ä¾¿ã€‚</strong></p>
<h2 id="æ¡æ¬¾16ï¼š-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼"><a href="#æ¡æ¬¾16ï¼š-æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼" class="headerlink" title="æ¡æ¬¾16ï¼š æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼"></a>æ¡æ¬¾16ï¼š æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼</h2><blockquote>
<p><em>Use the same form in corresponding uses of new and delete</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-15"><a href="#æ ¸å¿ƒç†å¿µ-15" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å¦‚æœä½ åœ¨newè¡¨è¾¾å¼ä¸­ä½¿ç”¨[]ï¼Œå¿…é¡»åœ¨ç›¸åº”çš„deleteè¡¨è¾¾å¼ä¸­ä¹Ÿä½¿ç”¨[]ã€‚å¦‚æœä½ åœ¨newè¡¨è¾¾å¼ä¸­ä¸ä½¿ç”¨[]ï¼Œä¸€å®šä¸è¦åœ¨ç›¸åº”çš„deleteè¡¨è¾¾å¼ä¸­ä½¿ç”¨[]</strong>ã€‚è¿™ä¸ªè§„åˆ™çœ‹ä¼¼ç®€å•ï¼Œä½†è¿åå®ƒä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚newå’Œdeleteçš„ä¸åŒ¹é…æ˜¯C++ä¸­å¸¸è§çš„å†…å­˜ç®¡ç†é”™è¯¯ä¹‹ä¸€ï¼Œç°ä»£C++é€šè¿‡æ™ºèƒ½æŒ‡é’ˆå’Œå®¹å™¨å¯ä»¥å®Œå…¨é¿å…è¿™ç±»é—®é¢˜ã€‚</p>
<h3 id="æ·±åº¦è§£æ-15"><a href="#æ·±åº¦è§£æ-15" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-newå’Œdeleteçš„åŸºæœ¬é…å¯¹è§„åˆ™"><a href="#1-newå’Œdeleteçš„åŸºæœ¬é…å¯¹è§„åˆ™" class="headerlink" title="1. newå’Œdeleteçš„åŸºæœ¬é…å¯¹è§„åˆ™"></a>1. <strong>newå’Œdeleteçš„åŸºæœ¬é…å¯¹è§„åˆ™</strong></h4><p>æ¯ç§newæ“ä½œéƒ½æœ‰å¯¹åº”çš„deleteæ“ä½œã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„é…å¯¹</span></span><br><span class="line"><span class="type">int</span>* p1 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">42</span>);          <span class="comment">// å•ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">delete</span> p1;                      <span class="comment">// å¯¹åº”çš„delete</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>* p2 = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100</span>];         <span class="comment">// æ•°ç»„</span></span><br><span class="line"><span class="keyword">delete</span>[] p2;                    <span class="comment">// å¯¹åº”çš„delete[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é”™è¯¯çš„é…å¯¹ - æœªå®šä¹‰è¡Œä¸º</span></span><br><span class="line"><span class="type">int</span>* p3 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">delete</span>[] p3;                    <span class="comment">// âŒ å•ä¸ªå¯¹è±¡ç”¨delete[]</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>* p4 = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">delete</span> p4;                      <span class="comment">// âŒ æ•°ç»„ç”¨delete</span></span><br></pre></td></tr></table></figure>

<h4 id="2-ä¸ºä»€ä¹ˆæ··ç”¨ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º"><a href="#2-ä¸ºä»€ä¹ˆæ··ç”¨ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º" class="headerlink" title="2. ä¸ºä»€ä¹ˆæ··ç”¨ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º"></a>2. <strong>ä¸ºä»€ä¹ˆæ··ç”¨ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º</strong></h4><p>new[]å’Œdelete[]å¤„ç†çš„å†…å­˜å¸ƒå±€ä¸new&#x2F;deleteä¸åŒã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Demo</span>(<span class="type">int</span> val = <span class="number">0</span>) : <span class="built_in">value_</span>(val) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Demo(&quot;</span> &lt;&lt; value_ &lt;&lt; <span class="string">&quot;) constructed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Demo</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Demo(&quot;</span> &lt;&lt; value_ &lt;&lt; <span class="string">&quot;) destructed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateUndefinedBehavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// new[]å¯èƒ½åœ¨å†…å­˜ä¸­å­˜å‚¨é¢å¤–ä¿¡æ¯ï¼ˆå¦‚æ•°ç»„å¤§å°ï¼‰</span></span><br><span class="line">    Demo* array = <span class="keyword">new</span> Demo[<span class="number">3</span>];  <span class="comment">// åˆ›å»º3ä¸ªDemoå¯¹è±¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä½¿ç”¨deleteè€Œä¸æ˜¯delete[] - æœªå®šä¹‰è¡Œä¸ºï¼</span></span><br><span class="line">    <span class="comment">// delete array;  // åªè°ƒç”¨ä¸€æ¬¡ææ„å‡½æ•°ï¼Œè€Œä¸æ˜¯3æ¬¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„æ–¹å¼</span></span><br><span class="line">    <span class="keyword">delete</span>[] array;  <span class="comment">// æ­£ç¡®è°ƒç”¨3æ¬¡ææ„å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSingleObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Demo* obj = <span class="keyword">new</span> <span class="built_in">Demo</span>(<span class="number">42</span>);  <span class="comment">// åˆ›å»ºå•ä¸ªå¯¹è±¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä½¿ç”¨delete[]è€Œä¸æ˜¯delete - æœªå®šä¹‰è¡Œä¸ºï¼</span></span><br><span class="line">    <span class="comment">// delete[] obj;  // å¯èƒ½å°è¯•è¯»å–ä¸å­˜åœ¨çš„æ•°ç»„å¤§å°ä¿¡æ¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„æ–¹å¼</span></span><br><span class="line">    <span class="keyword">delete</span> obj;  <span class="comment">// æ­£ç¡®è°ƒç”¨ä¸€æ¬¡ææ„å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-å¸¸è§é”™è¯¯åœºæ™¯"><a href="#3-å¸¸è§é”™è¯¯åœºæ™¯" class="headerlink" title="3. å¸¸è§é”™è¯¯åœºæ™¯"></a>3. <strong>å¸¸è§é”™è¯¯åœºæ™¯</strong></h4><p>typedefå’Œusingå£°æ˜å®¹æ˜“å¯¼è‡´æ··æ·†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å®¹æ˜“æ··æ·†çš„åœºæ™¯</span></span><br><span class="line"><span class="keyword">typedef</span> std::string AddressLines[<span class="number">4</span>];  <span class="comment">// æ•°ç»„ç±»å‹çš„typedef</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">problematicCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AddressLines* pal = <span class="keyword">new</span> AddressLines;  <span class="comment">// å®é™…ä¸Šæ˜¯ new std::string[4]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šçœ‹èµ·æ¥åƒå•ä¸ªå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯æ•°ç»„</span></span><br><span class="line">    <span class="comment">// delete pal;  // åº”è¯¥ç”¨delete[]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šå¿…é¡»ç”¨delete[]</span></span><br><span class="line">    <span class="keyword">delete</span>[] pal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ›´æ¸…æ™°çš„ç°ä»£å†™æ³•</span></span><br><span class="line"><span class="keyword">using</span> AddressArray = std::array&lt;std::string, <span class="number">4</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">betterCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AddressArray* pal = <span class="keyword">new</span> AddressArray;  <span class="comment">// çœŸæ­£çš„å•ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">delete</span> pal;  <span class="comment">// æ­£ç¡®ä½¿ç”¨delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ–è€…æ›´å¥½ï¼šé¿å…è£¸æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">auto</span> pal2 = std::<span class="built_in">make_unique</span>&lt;AddressArray&gt;();  <span class="comment">// è‡ªåŠ¨ç®¡ç†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹çš„é—®é¢˜"><a href="#4-ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹çš„é—®é¢˜" class="headerlink" title="4. ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹çš„é—®é¢˜"></a>4. <strong>ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹çš„é—®é¢˜</strong></h4><p>è¿™ç±»é”™è¯¯åœ¨ç¼–è¯‘æ—¶æ— æ³•æ£€æµ‹ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶å‘ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Resource</span>() : <span class="built_in">data_</span>(<span class="number">1000</span>) &#123;  <span class="comment">// åˆ†é…è¾ƒå¤§çš„å†…å­˜</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource created&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Resource</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource destroyed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">silentErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™äº›é”™è¯¯ä»£ç å¯èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿è¡Œæ—¶æœ‰é—®é¢˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœºæ™¯1ï¼šæ•°ç»„è¯¯ç”¨delete</span></span><br><span class="line">    Resource* resources = <span class="keyword">new</span> Resource[<span class="number">5</span>];</span><br><span class="line">    <span class="comment">// delete resources;     // âŒ å¯èƒ½åªé”€æ¯ç¬¬ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">delete</span>[] resources;      <span class="comment">// âœ… æ­£ç¡®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœºæ™¯2ï¼šå•å¯¹è±¡è¯¯ç”¨delete[]</span></span><br><span class="line">    Resource* resource = <span class="keyword">new</span> Resource;</span><br><span class="line">    <span class="comment">// delete[] resource;    // âŒ å¯èƒ½è¯»å–æ— æ•ˆçš„æ•°ç»„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">delete</span> resource;         <span class="comment">// âœ… æ­£ç¡®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-ç°ä»£C-çš„è§£å†³æ–¹æ¡ˆ"><a href="#5-ç°ä»£C-çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="5. ç°ä»£C++çš„è§£å†³æ–¹æ¡ˆ"></a>5. <strong>ç°ä»£C++çš„è§£å†³æ–¹æ¡ˆ</strong></h4><p>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œæ ‡å‡†å®¹å™¨é¿å…æ‰‹åŠ¨å†…å­˜ç®¡ç†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç°ä»£C++æœ€ä½³å®è·µ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modernApproach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å•ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> obj = std::<span class="built_in">make_unique</span>&lt;Demo&gt;(<span class="number">42</span>);  <span class="comment">// C++14</span></span><br><span class="line">    <span class="comment">// è‡ªåŠ¨è°ƒç”¨æ­£ç¡®çš„delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ä½¿ç”¨vectorç®¡ç†åŠ¨æ€æ•°ç»„</span></span><br><span class="line">    <span class="function">std::vector&lt;Demo&gt; <span class="title">dynamicArray</span><span class="params">(<span class="number">5</span>, Demo(<span class="number">10</span>))</span></span>;</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— éœ€æ‰‹åŠ¨delete</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. ä½¿ç”¨arrayç®¡ç†å›ºå®šå¤§å°æ•°ç»„</span></span><br><span class="line">    <span class="keyword">auto</span> fixedArray = std::make_unique&lt;std::array&lt;Demo, <span class="number">3</span>&gt;&gt;();  <span class="comment">// C++14</span></span><br><span class="line">    <span class="comment">// æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. ç®¡ç†æ•°ç»„çš„æ™ºèƒ½æŒ‡é’ˆï¼ˆC++14èµ·ï¼‰</span></span><br><span class="line">    <span class="keyword">auto</span> smartArray = std::<span class="built_in">make_unique</span>&lt;Demo[]&gt;(<span class="number">5</span>);  <span class="comment">// C++14</span></span><br><span class="line">    <span class="comment">// è‡ªåŠ¨è°ƒç”¨delete[]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰åˆ é™¤å™¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">customDeleterExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹äºç‰¹æ®Šæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åˆ é™¤å™¨</span></span><br><span class="line">    <span class="function">std::unique_ptr&lt;Demo[]&gt; <span class="title">arrayPtr</span><span class="params">(<span class="keyword">new</span> Demo[<span class="number">5</span>])</span></span>;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨çŸ¥é“è¿™æ˜¯æ•°ç»„ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨delete[]</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ–è€…æ˜¾å¼æŒ‡å®šåˆ é™¤å™¨</span></span><br><span class="line">    <span class="function">std::unique_ptr&lt;Demo, <span class="title">void</span><span class="params">(*)</span><span class="params">(Demo*)</span>&gt; <span class="title">ptr</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">new</span> Demo[<span class="number">3</span>], </span></span></span><br><span class="line"><span class="params"><span class="function">        [](Demo* p) &#123; <span class="keyword">delete</span>[] p; &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-è°ƒè¯•å’Œæ£€æµ‹å·¥å…·"><a href="#6-è°ƒè¯•å’Œæ£€æµ‹å·¥å…·" class="headerlink" title="6. è°ƒè¯•å’Œæ£€æµ‹å·¥å…·"></a>6. <strong>è°ƒè¯•å’Œæ£€æµ‹å·¥å…·</strong></h4><p>ä½¿ç”¨å·¥å…·å¸®åŠ©æ£€æµ‹å†…å­˜ç®¡ç†é”™è¯¯ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒè¯•ç‰ˆæœ¬å¯ä»¥æ·»åŠ å†…å­˜è·Ÿè¸ª</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrackedDemo</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> instanceCount_;</span><br><span class="line">    <span class="type">int</span> id_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TrackedDemo</span>() : <span class="built_in">id_</span>(++instanceCount_) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;TrackedDemo &quot;</span> &lt;&lt; id_ &lt;&lt; <span class="string">&quot; created&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">TrackedDemo</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;TrackedDemo &quot;</span> &lt;&lt; id_ &lt;&lt; <span class="string">&quot; destroyed&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        --instanceCount_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">getInstanceCount</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> instanceCount_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> TrackedDemo::instanceCount_ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">memoryLeakDetection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Initial count: &quot;</span> &lt;&lt; TrackedDemo::<span class="built_in">getInstanceCount</span>() &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        TrackedDemo* array = <span class="keyword">new</span> TrackedDemo[<span class="number">3</span>];</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;After creation: &quot;</span> &lt;&lt; TrackedDemo::<span class="built_in">getInstanceCount</span>() &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">delete</span>[] array;  <span class="comment">// æ­£ç¡®é‡Šæ”¾</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;After deletion: &quot;</span> &lt;&lt; TrackedDemo::<span class="built_in">getInstanceCount</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨AddressSanitizer, Valgrindç­‰å·¥å…·å¯ä»¥æ£€æµ‹è¿™ç±»é”™è¯¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-ç‰¹æ®Šæƒ…å†µå’Œæ³¨æ„äº‹é¡¹"><a href="#7-ç‰¹æ®Šæƒ…å†µå’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="7. ç‰¹æ®Šæƒ…å†µå’Œæ³¨æ„äº‹é¡¹"></a>7. <strong>ç‰¹æ®Šæƒ…å†µå’Œæ³¨æ„äº‹é¡¹</strong></h4><p>æŸäº›åœºæ™¯éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// placement newçš„ç‰¹æ®Šå¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">placementNewExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="built_in">sizeof</span>(Demo) * <span class="number">3</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// placement newæ•°ç»„</span></span><br><span class="line">    Demo* array = <span class="built_in">new</span>(buffer) Demo[<span class="number">3</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä¸èƒ½ç”¨deleteæˆ–delete[]ï¼Œå› ä¸ºå†…å­˜ä¸æ˜¯é€šè¿‡newåˆ†é…çš„</span></span><br><span class="line">    <span class="comment">// delete[] array;  // é”™è¯¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ‰‹åŠ¨è°ƒç”¨ææ„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        array[i].~<span class="built_in">Demo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å‚æ•°ä¼ é€’ä¸­çš„é™·é˜±</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">functionParameterTrap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// âŒ å±é™©ï¼šå®¹æ˜“å¿˜è®°æ­£ç¡®çš„deleteå½¢å¼</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(Demo* arr)</span></span>;  <span class="comment">// ä¸çŸ¥é“æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯æ•°ç»„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ›´å¥½ï¼šä½¿ç”¨æ˜ç¡®çš„ç±»å‹</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(std::vector&lt;Demo&gt;&amp; arr)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(std::array&lt;Demo, <span class="number">5</span>&gt;&amp; arr)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processArray</span><span class="params">(std::unique_ptr&lt;Demo[]&gt; arr)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-13"><a href="#æ€»ç»“-13" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>åŸºæœ¬è§„åˆ™ï¼š</strong></p>
<ul>
<li><strong>new é…å¯¹ delete</strong>ï¼šç”¨äºå•ä¸ªå¯¹è±¡</li>
<li><strong>new[] é…å¯¹ delete[]</strong>ï¼šç”¨äºæ•°ç»„</li>
<li><strong>ç»ä¸æ··ç”¨</strong>ï¼šè¿åæ­¤è§„åˆ™å¯¼è‡´æœªå®šä¹‰è¡Œä¸º</li>
</ul>
<p><strong>å¸¸è§é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>typedeféšè—æ•°ç»„æ€§è´¨</strong>ï¼šéœ€è¦ä»”ç»†æ£€æŸ¥ç±»å‹å®šä¹‰</li>
<li><strong>ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹</strong>ï¼šé”™è¯¯åœ¨è¿è¡Œæ—¶æ‰æ˜¾ç°</li>
<li><strong>ææ„å‡½æ•°è°ƒç”¨æ¬¡æ•°é”™è¯¯</strong>ï¼šå¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼æˆ–å¤šæ¬¡ææ„</li>
</ul>
<p><strong>ç°ä»£C++è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼š<code>std::unique_ptr</code>ã€<code>std::shared_ptr</code></li>
<li><strong>ä½¿ç”¨æ ‡å‡†å®¹å™¨</strong>ï¼š<code>std::vector</code>ã€<code>std::array</code></li>
<li><strong>é¿å…è£¸æŒ‡é’ˆ</strong>ï¼šé™¤éä¸C APIäº¤äº’</li>
<li><strong>ä½¿ç”¨make_å‡½æ•°</strong>ï¼š<code>std::make_unique</code>(C++14)ã€<code>std::make_shared</code></li>
</ul>
<p><strong>è°ƒè¯•å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>ä½¿ç”¨å†…å­˜æ£€æµ‹å·¥å…·</strong>ï¼šAddressSanitizerã€Valgrind</li>
<li><strong>å¼€å¯ç¼–è¯‘å™¨è­¦å‘Š</strong>ï¼šæ£€æµ‹å¯èƒ½çš„å†…å­˜ç®¡ç†é—®é¢˜</li>
<li><strong>ç¼–å†™æµ‹è¯•ä»£ç </strong>ï¼šéªŒè¯å†…å­˜ç®¡ç†çš„æ­£ç¡®æ€§</li>
</ul>
<p><strong>è®°ä½ï¼šå¦‚æœä½ åœ¨newè¡¨è¾¾å¼ä¸­ä½¿ç”¨[]ï¼Œå¿…é¡»åœ¨ç›¸åº”çš„deleteè¡¨è¾¾å¼ä¸­ä¹Ÿä½¿ç”¨[]ã€‚å¦‚æœä½ åœ¨newè¡¨è¾¾å¼ä¸­ä¸ä½¿ç”¨[]ï¼Œä¸€å®šä¸è¦åœ¨ç›¸åº”çš„deleteè¡¨è¾¾å¼ä¸­ä½¿ç”¨[]ã€‚ç°ä»£C++é€šè¿‡æ™ºèƒ½æŒ‡é’ˆå’Œæ ‡å‡†å®¹å™¨å¯ä»¥å®Œå…¨é¿å…è¿™ç±»é—®é¢˜ã€‚</strong></p>
<h2 id="æ¡æ¬¾17-ä»¥ç‹¬ç«‹è¯­å¥å°†-newï¼ˆedï¼‰-å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆï¼"><a href="#æ¡æ¬¾17-ä»¥ç‹¬ç«‹è¯­å¥å°†-newï¼ˆedï¼‰-å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆï¼" class="headerlink" title="æ¡æ¬¾17 : ä»¥ç‹¬ç«‹è¯­å¥å°† newï¼ˆedï¼‰ å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆï¼"></a>æ¡æ¬¾17 : ä»¥ç‹¬ç«‹è¯­å¥å°† newï¼ˆedï¼‰ å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆï¼</h2><blockquote>
<p>ï¼ˆStore newed objects in smart pointers in standalone statementsï¼‰</p>
</blockquote>
<ul>
<li>ä»¥ç‹¬ç«‹è¯­å¥å°† <strong>new</strong>edå¯¹è±¡å­˜å‚¨äºï¼ˆç½®å…¥ï¼‰æ™ºèƒ½æŒ‡é’ˆå†…ã€‚ å¦‚æœä¸è¿™æ ·åšï¼Œ ä¸€æ—¦å¼‚å¸¸è¢«æŠ›å‡ºï¼Œ æœ‰å¯èƒ½å¯¼è‡´éš¾ä»¥å¯Ÿè§‰çš„èµ„æºæ³„éœ²ã€‚</li>
</ul>
<h3 id="æ ¸å¿ƒç†å¿µ-16"><a href="#æ ¸å¿ƒç†å¿µ-16" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨å°†åŠ¨æ€åˆ†é…çš„å¯¹è±¡å­˜å…¥æ™ºèƒ½æŒ‡é’ˆæ—¶ï¼Œåº”è¯¥ä½¿ç”¨<strong>ç‹¬ç«‹è¯­å¥</strong>ï¼Œé¿å…åœ¨å¤æ‚è¡¨è¾¾å¼ä¸­ç›´æ¥åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆçš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´å¯¹è±¡æ²¡æœ‰è¢«æ­£ç¡®ç®¡ç†ï¼Œä»è€Œå‡ºç°èµ„æºæ³„éœ²ã€‚</p>
<h4 id="é€šä¿—è§£é‡Š"><a href="#é€šä¿—è§£é‡Š" class="headerlink" title="é€šä¿—è§£é‡Š"></a>é€šä¿—è§£é‡Š</h4><blockquote>
<p>å‡è®¾ä½ å†™äº†ä¸€è¡Œä»£ç ï¼Œç”¨ <code>new</code> åˆ†é…ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”ç›´æ¥ä¼ é€’ç»™æ™ºèƒ½æŒ‡é’ˆçš„æ„é€ å‡½æ•°ã€‚å¦‚æœåœ¨è¿™è¡Œä»£ç ä¸­é—´å‘ç”Ÿå¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼Œæ™ºèƒ½æŒ‡é’ˆçš„æ„é€ å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸ï¼‰ï¼Œå°±å¯èƒ½å¯¼è‡´å¯¹è±¡æ²¡æœ‰è¢«æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡è€Œæ³„éœ²ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚å› æ­¤ï¼Œåº”è¯¥åœ¨<strong>ç‹¬ç«‹è¯­å¥</strong>ä¸­å…ˆç”¨ <code>new</code> åˆ›å»ºå¯¹è±¡ï¼Œå†å°†å®ƒä¼ ç»™æ™ºèƒ½æŒ‡é’ˆã€‚è¿™æ ·å¯ä»¥ç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºä¹Ÿä¸ä¼šä¸¢å¤±è¿™ä¸ªå¯¹è±¡çš„æ§åˆ¶æƒã€‚</p>
</blockquote>
<h3 id="æ·±åº¦è§£æ-16"><a href="#æ·±åº¦è§£æ-16" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å‡½æ•°å‚æ•°çš„æ±‚å€¼é¡ºåºä¸ç¡®å®š"><a href="#1-å‡½æ•°å‚æ•°çš„æ±‚å€¼é¡ºåºä¸ç¡®å®š" class="headerlink" title="1. å‡½æ•°å‚æ•°çš„æ±‚å€¼é¡ºåºä¸ç¡®å®š"></a>1. å‡½æ•°å‚æ•°çš„æ±‚å€¼é¡ºåºä¸ç¡®å®š</h4><p>åœ¨ C++ ä¸­ï¼Œä¸åŒå‚æ•°çš„æ±‚å€¼é¡ºåºç”±ç¼–è¯‘å™¨å†³å®šï¼Œä¸æ˜¯å›ºå®šçš„ã€‚è¿™æ„å‘³ç€ä½ æ— æ³•ä¿è¯ <code>new</code> è¡¨è¾¾å¼ä¸€å®šå…ˆæ‰§è¡Œï¼Œå¹¶ç«‹å³è¢«æ™ºèƒ½æŒ‡é’ˆæ¥ç®¡ã€‚</p>
<h4 id="2-å¼‚å¸¸å®‰å…¨æ€§ä¸§å¤±-â†’-éšæ€§å†…å­˜æ³„æ¼"><a href="#2-å¼‚å¸¸å®‰å…¨æ€§ä¸§å¤±-â†’-éšæ€§å†…å­˜æ³„æ¼" class="headerlink" title="2. å¼‚å¸¸å®‰å…¨æ€§ä¸§å¤± â†’ éšæ€§å†…å­˜æ³„æ¼"></a>2. å¼‚å¸¸å®‰å…¨æ€§ä¸§å¤± â†’ éšæ€§å†…å­˜æ³„æ¼</h4><p>å¦‚æœåœ¨å‡½æ•°è°ƒç”¨å‚æ•°ä¸­å†™å…¥ <code>new</code>ï¼Œä½†åœ¨åˆ«çš„å‚æ•°æ±‚å€¼ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶ <code>new</code> çš„ç»“æœå¹¶æœªäº¤ç»™æ™ºèƒ½æŒ‡é’ˆï¼Œå¯¼è‡´èµ„æºæ³„éœ²ã€‚</p>
<h4 id="3-ä½¿ç”¨ç‹¬ç«‹è¯­å¥ç¡®ä¿-new-çš„èµ„æºè¢«ç«‹å³ç®¡ç†"><a href="#3-ä½¿ç”¨ç‹¬ç«‹è¯­å¥ç¡®ä¿-new-çš„èµ„æºè¢«ç«‹å³ç®¡ç†" class="headerlink" title="3. ä½¿ç”¨ç‹¬ç«‹è¯­å¥ç¡®ä¿ new çš„èµ„æºè¢«ç«‹å³ç®¡ç†"></a>3. ä½¿ç”¨ç‹¬ç«‹è¯­å¥ç¡®ä¿ new çš„èµ„æºè¢«ç«‹å³ç®¡ç†</h4><p>ä½¿ç”¨ä¸¤æ­¥æ“ä½œå°†å¯¹è±¡äº¤ç”±æ™ºèƒ½æŒ‡é’ˆæ‰˜ç®¡ï¼Œå¯ä»¥æ˜¾å¼åœ°æ§åˆ¶èµ„æºçš„æ‰€æœ‰æƒè½¬ç§»è¿‡ç¨‹ã€‚</p>
<h3 id="âœ¨-æ¨èå†™æ³•-vs-å±é™©å†™æ³•å¯¹æ¯”"><a href="#âœ¨-æ¨èå†™æ³•-vs-å±é™©å†™æ³•å¯¹æ¯”" class="headerlink" title="âœ¨ æ¨èå†™æ³• vs å±é™©å†™æ³•å¯¹æ¯”"></a>âœ¨ æ¨èå†™æ³• vs å±é™©å†™æ³•å¯¹æ¯”</h3><p>âœ… <strong>æ¨èå†™æ³•ï¼ˆç‹¬ç«‹è¯­å¥ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Widget&gt; <span class="title">pw</span><span class="params">(<span class="keyword">new</span> Widget)</span></span>;</span><br><span class="line"><span class="built_in">processWidget</span>(std::<span class="built_in">move</span>(pw));</span><br></pre></td></tr></table></figure>

<p>âŒ <strong>ä¸æ¨èå†™æ³•ï¼ˆå¤æ‚è¡¨è¾¾å¼ï¼‰</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">processWidget</span>(std::<span class="built_in">unique_ptr</span>&lt;Widget&gt;(<span class="keyword">new</span> Widget));</span><br><span class="line"><span class="comment">// å¦‚æœ processWidget çš„å…¶ä»–å‚æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œnew å‡ºæ¥çš„ Widget æ— äººç®¡ç† â†’ æ³„æ¼</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ’¡-æ‹“å±•å»ºè®®"><a href="#ğŸ’¡-æ‹“å±•å»ºè®®" class="headerlink" title="ğŸ’¡ æ‹“å±•å»ºè®®"></a>ğŸ’¡ æ‹“å±•å»ºè®®</h3><ol>
<li><p>ä½¿ç”¨ <code>std::make_unique</code>(C++14) æˆ– <code>std::make_shared</code></p>
<ol>
<li><p>åœ¨ C++14&#x2F;17 ä¸­ï¼Œæ¨èä½¿ç”¨ <code>make_unique</code> æ›¿ä»£ <code>new</code>ï¼Œå®ƒé¿å…äº†æ˜¾å¼è£¸æŒ‡é’ˆæš´éœ²ï¼Œå¹¶ç¡®ä¿åˆ›å»ºå’Œæ¥ç®¡å¯¹è±¡æ˜¯<strong>åŸå­æ“ä½œ</strong>ï¼Œæ›´å®‰å…¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> ptr = std::<span class="built_in">make_unique</span>&lt;Wiget&gt;();</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½†åŠæ—¶ä½¿ç”¨ <code>std::make_unique</code> æˆ– <code>std::make_shared</code>ï¼Œä¹Ÿè¦é¿å…è¿™æ ·çš„ç”¨æ³•ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">processWidget</span>(std::<span class="built_in">make_unique</span>&lt;Widget&gt;(), <span class="built_in">computeSomething</span>()); </span><br><span class="line"><span class="comment">// computeSomething() æŠ›å¼‚å¸¸ â†’ std::make_unique&lt;Widget&gt;() çš„èµ„æºæœªè¢«æ¥ç®¡ â†’ æµªè´¹æˆ–æ³„éœ²é£é™©</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="ğŸ§ -å°ç»“"><a href="#ğŸ§ -å°ç»“" class="headerlink" title="ğŸ§  å°ç»“"></a>ğŸ§  å°ç»“</h3><p>åœ¨æ„é€ æ™ºèƒ½æŒ‡é’ˆç®¡ç†å¯¹è±¡æ—¶ï¼Œ<strong>ä½¿ç”¨ç‹¬ç«‹è¯­å¥</strong>æ˜¯ä¿éšœå¼‚å¸¸å®‰å…¨çš„å…³é”®æ‰‹æ®µã€‚</p>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š<br> <strong>ä¸è¦æŠŠ <code>new</code> å†™è¿›å¤æ‚è¡¨è¾¾å¼é‡Œï¼Œä¸‡ä¸€å¼‚å¸¸å‘ç”Ÿï¼Œæ²¡äººèƒ½å¸®ä½ å›æ”¶è¿™å—å†…å­˜äº†ï¼</strong></p>
</blockquote>
<h2 id="æ¡æ¬¾18ï¼š-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨"><a href="#æ¡æ¬¾18ï¼š-è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨" class="headerlink" title="æ¡æ¬¾18ï¼š è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨"></a>æ¡æ¬¾18ï¼š è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨</h2><blockquote>
<p><em>Make interfaces easy to use correctly and hard to use incorrectly</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-17"><a href="#æ ¸å¿ƒç†å¿µ-17" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å¥½çš„æ¥å£å¾ˆå®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸å®¹æ˜“è¢«è¯¯ç”¨ã€‚ä½ åº”è¯¥åœ¨ä½ çš„æ‰€æœ‰æ¥å£ä¸­åŠªåŠ›è¾¾æˆè¿™äº›æ€§è´¨</strong>ã€‚æ¥å£è®¾è®¡æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­æœ€é‡è¦çš„æŠ€èƒ½ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œé”™è¯¯ç‡ã€‚â€ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨â€çš„åŠæ³•åŒ…æ‹¬æ¥å£çš„ä¸€è‡´æ€§ï¼Œä»¥åŠä¸å†…ç½®ç±»å‹çš„è¡Œä¸ºå…¼å®¹ã€‚â€é˜»æ­¢è¯¯ç”¨â€çš„åŠæ³•åŒ…æ‹¬å»ºç«‹æ–°ç±»å‹ã€é™åˆ¶ç±»å‹ä¸Šçš„æ“ä½œã€æŸç¼šå¯¹è±¡å€¼ï¼Œä»¥åŠæ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»»ã€‚</p>
<h3 id="æ·±åº¦è§£æ-17"><a href="#æ·±åº¦è§£æ-17" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„è®¾è®¡ç­–ç•¥"><a href="#1-ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„è®¾è®¡ç­–ç•¥" class="headerlink" title="1. ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„è®¾è®¡ç­–ç•¥"></a>1. <strong>ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„è®¾è®¡ç­–ç•¥</strong></h4><p>è®¾è®¡æ¥å£æ—¶åº”è¯¥è®©æ­£ç¡®çš„ç”¨æ³•å˜å¾—è‡ªç„¶å’Œç›´è§‚ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å®¹æ˜“è¯¯ç”¨çš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Date</span>(<span class="type">int</span> month, <span class="type">int</span> day, <span class="type">int</span> year);  <span class="comment">// å‚æ•°é¡ºåºå®¹æ˜“æ··æ·†</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">problemExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Date <span class="title">d1</span><span class="params">(<span class="number">30</span>, <span class="number">3</span>, <span class="number">1995</span>)</span></span>;   <span class="comment">// æ„å›¾ï¼š1995å¹´3æœˆ30æ—¥</span></span><br><span class="line">    <span class="function">Date <span class="title">d2</span><span class="params">(<span class="number">3</span>, <span class="number">30</span>, <span class="number">1995</span>)</span></span>;   <span class="comment">// ä½†å‚æ•°é¡ºåºé”™äº†ï¼å®é™…æ˜¯ï¼š30æœˆ3æ—¥1995å¹´</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„æ¥å£</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Day</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Day</span><span class="params">(<span class="type">int</span> d)</span> : val(d) &#123;</span>&#125;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Month</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Month</span><span class="params">(<span class="type">int</span> m)</span> : val(m) &#123;</span>&#125;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Year</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Year</span><span class="params">(<span class="type">int</span> y)</span> : val(y) &#123;</span>&#125;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BetterDate</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BetterDate</span>(<span class="type">const</span> Month&amp; m, <span class="type">const</span> Day&amp; d, <span class="type">const</span> Year&amp; y);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">betterExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">BetterDate <span class="title">d1</span><span class="params">(Month(<span class="number">3</span>), Day(<span class="number">30</span>), Year(<span class="number">1995</span>))</span></span>;  <span class="comment">// æ¸…æ™°æ˜ç¡®</span></span><br><span class="line">    <span class="comment">// BetterDate d2(Day(30), Month(3), Year(1995));  // ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-é˜»æ­¢è¯¯ç”¨çš„ç±»å‹ç³»ç»Ÿ"><a href="#2-é˜»æ­¢è¯¯ç”¨çš„ç±»å‹ç³»ç»Ÿ" class="headerlink" title="2. é˜»æ­¢è¯¯ç”¨çš„ç±»å‹ç³»ç»Ÿ"></a>2. <strong>é˜»æ­¢è¯¯ç”¨çš„ç±»å‹ç³»ç»Ÿ</strong></h4><p>ä½¿ç”¨ç±»å‹ç³»ç»Ÿé˜²æ­¢å¸¸è§é”™è¯¯ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä½¿ç”¨åŸå§‹ç±»å‹å®¹æ˜“å‡ºé”™</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">transferMoney</span><span class="params">(<span class="type">double</span> amount, <span class="type">int</span> fromAccount, <span class="type">int</span> toAccount)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dangerousUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">transferMoney</span>(<span class="number">1000.0</span>, <span class="number">12345</span>, <span class="number">67890</span>);  <span class="comment">// å‚æ•°é¡ºåºå¯èƒ½é”™è¯¯</span></span><br><span class="line">    <span class="built_in">transferMoney</span>(<span class="number">-500.0</span>, <span class="number">12345</span>, <span class="number">67890</span>);  <span class="comment">// è´Ÿæ•°é‡‘é¢åº”è¯¥è¢«é˜»æ­¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½¿ç”¨å¼ºç±»å‹é˜²æ­¢é”™è¯¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Amount</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> value_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Amount</span><span class="params">(<span class="type">double</span> val)</span> : value_(val) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (val &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Amount cannot be negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AccountId</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">AccountId</span><span class="params">(<span class="type">int</span> id)</span> : id_(id) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (id &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Account ID must be positive&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getId</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> id_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BankTransaction</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">transferMoney</span><span class="params">(<span class="type">const</span> Amount&amp; amount, </span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> AccountId&amp; from, </span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> AccountId&amp; to)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç±»å‹å®‰å…¨çš„å®ç°</span></span><br><span class="line">        <span class="keyword">if</span> (from.<span class="built_in">getId</span>() == to.<span class="built_in">getId</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Cannot transfer to same account&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè½¬è´¦...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">safeUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BankTransaction bank;</span><br><span class="line">    <span class="function">Amount <span class="title">amt</span><span class="params">(<span class="number">1000.0</span>)</span></span>;</span><br><span class="line">    <span class="function">AccountId <span class="title">from</span><span class="params">(<span class="number">12345</span>)</span></span>;</span><br><span class="line">    <span class="function">AccountId <span class="title">to</span><span class="params">(<span class="number">67890</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    bank.<span class="built_in">transferMoney</span>(amt, from, to);  <span class="comment">// ç±»å‹å®‰å…¨</span></span><br><span class="line">    <span class="comment">// bank.transferMoney(amt, to, from);  // ä»å¯èƒ½é”™è¯¯ï¼Œä½†è‡³å°‘ç±»å‹æ­£ç¡®</span></span><br><span class="line">    <span class="comment">// bank.transferMoney(Amount(-500), from, to);  // è¿è¡Œæ—¶é”™è¯¯ï¼Œä½†è¢«æ£€æµ‹åˆ°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ¥å£ä¸€è‡´æ€§"><a href="#3-æ¥å£ä¸€è‡´æ€§" class="headerlink" title="3. æ¥å£ä¸€è‡´æ€§"></a>3. <strong>æ¥å£ä¸€è‡´æ€§</strong></h4><p>ä¿æŒæ¥å£åœ¨æ•´ä¸ªç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸ä¸€è‡´çš„æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InconsistentContainer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span></span>;        <span class="comment">// è¿”å›size_t</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span></span>;         <span class="comment">// è¿”å›intï¼Œåç§°ä¸ä¸€è‡´</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;             <span class="comment">// éconstï¼Œè¡Œä¸ºä¸ä¸€è‡´</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;               <span class="comment">// voidè¿”å›</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(<span class="type">const</span> T&amp; item)</span></span>; <span class="comment">// boolè¿”å›</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä¸€è‡´çš„æ¥å£è®¾è®¡</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsistentContainer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ä¸€è‡´çš„å‘½åçº¦å®š</span></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸€è‡´çš„è¿”å›ç±»å‹çº¦å®š</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> T&amp; item)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(<span class="type">const</span> T&amp; item)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">contains</span><span class="params">(<span class="type">const</span> T&amp; item)</span> <span class="type">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸€è‡´çš„constæ­£ç¡®æ€§</span></span><br><span class="line">    <span class="function">T&amp; <span class="title">at</span><span class="params">(<span class="type">size_t</span> index)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">at</span><span class="params">(<span class="type">size_t</span> index)</span> <span class="type">const</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸€è‡´çš„å¼‚å¸¸å¤„ç†ç­–ç•¥</span></span><br><span class="line">    T&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> index);          <span class="comment">// ä¸æ£€æŸ¥è¾¹ç•Œ</span></span><br><span class="line">    <span class="function">T&amp; <span class="title">at</span><span class="params">(<span class="type">size_t</span> index)</span></span>;                  <span class="comment">// æ£€æŸ¥è¾¹ç•Œï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-æ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»»"><a href="#4-æ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»»" class="headerlink" title="4. æ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»»"></a>4. <strong>æ¶ˆé™¤å®¢æˆ·çš„èµ„æºç®¡ç†è´£ä»»</strong></h4><p>è®©æ¥å£è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œå‡å°‘å®¢æˆ·ç«¯é”™è¯¯ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ è¦æ±‚å®¢æˆ·ç®¡ç†èµ„æº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Widget* <span class="title">createWidget</span><span class="params">(WidgetType type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Widget</span>(type);  <span class="comment">// å®¢æˆ·éœ€è¦è®°ä½delete</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">riskyClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Widget* w = BadFactory::<span class="built_in">createWidget</span>(WidgetType::Button);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">someCondition</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;  <span class="comment">// âŒ å¿˜è®°deleteï¼Œå†…å­˜æ³„æ¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> w;  <span class="comment">// å®¢æˆ·å¿…é¡»è®°ä½è¿™ä¸ª</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è‡ªåŠ¨èµ„æºç®¡ç†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> std::unique_ptr&lt;Widget&gt; <span class="title">createWidget</span><span class="params">(WidgetType type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_unique</span>&lt;Widget&gt;(type);  <span class="comment">// è‡ªåŠ¨ç®¡ç† (C++14)</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> std::shared_ptr&lt;Widget&gt; <span class="title">createSharedWidget</span><span class="params">(WidgetType type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;Widget&gt;(type);  <span class="comment">// å…±äº«æ‰€æœ‰æƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">safeClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> w = GoodFactory::<span class="built_in">createWidget</span>(WidgetType::Button);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">someCondition</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;  <span class="comment">// âœ… è‡ªåŠ¨æ¸…ç†ï¼Œæ— æ³„æ¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-é™åˆ¶å¯¹è±¡å€¼å’Œæ“ä½œ"><a href="#5-é™åˆ¶å¯¹è±¡å€¼å’Œæ“ä½œ" class="headerlink" title="5. é™åˆ¶å¯¹è±¡å€¼å’Œæ“ä½œ"></a>5. <strong>é™åˆ¶å¯¹è±¡å€¼å’Œæ“ä½œ</strong></h4><p>é€šè¿‡è®¾è®¡é™åˆ¶æ— æ•ˆçš„æ“ä½œå’Œå€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœˆä»½ç±»ï¼šé™åˆ¶æœ‰æ•ˆå€¼</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Month</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Month <span class="title">Jan</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Month</span>(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> Month <span class="title">Feb</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Month</span>(<span class="number">2</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> Month <span class="title">Mar</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Month</span>(<span class="number">3</span>); &#125;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–æœˆä»½</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Month <span class="title">Dec</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Month</span>(<span class="number">12</span>); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">value</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> month_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Month</span><span class="params">(<span class="type">int</span> m)</span> : month_(m) &#123;</span>&#125;  <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="type">int</span> month_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼šé™åˆ¶å®ä¾‹æ•°é‡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadSafeConfig</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> ThreadSafeConfig&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> ThreadSafeConfig instance;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¦æ­¢æ‹·è´å’Œèµ‹å€¼</span></span><br><span class="line">    <span class="built_in">ThreadSafeConfig</span>(<span class="type">const</span> ThreadSafeConfig&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    ThreadSafeConfig&amp; <span class="keyword">operator</span>=(<span class="type">const</span> ThreadSafeConfig&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSetting</span><span class="params">(<span class="type">const</span> std::string&amp; key, <span class="type">const</span> std::string&amp; value)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        settings_[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">getSetting</span><span class="params">(<span class="type">const</span> std::string&amp; key)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mutex_)</span></span>;</span><br><span class="line">        <span class="keyword">auto</span> it = settings_.<span class="built_in">find</span>(key);</span><br><span class="line">        <span class="keyword">return</span> (it != settings_.<span class="built_in">end</span>()) ? it-&gt;second : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">ThreadSafeConfig</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">mutable</span> std::mutex mutex_;</span><br><span class="line">    std::map&lt;std::string, std::string&gt; settings_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-è‡ªå®šä¹‰åˆ é™¤å™¨å’ŒRAII"><a href="#6-è‡ªå®šä¹‰åˆ é™¤å™¨å’ŒRAII" class="headerlink" title="6. è‡ªå®šä¹‰åˆ é™¤å™¨å’ŒRAII"></a>6. <strong>è‡ªå®šä¹‰åˆ é™¤å™¨å’ŒRAII</strong></h4><p>ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„è‡ªå®šä¹‰åˆ é™¤å™¨è§£å†³ç‰¹æ®Šèµ„æºç®¡ç†é—®é¢˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†C APIèµ„æº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> FilePtr = std::unique_ptr&lt;FILE, <span class="built_in">int</span>(*)(FILE*)&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> FilePtr <span class="title">openFile</span><span class="params">(<span class="type">const</span> std::string&amp; filename, <span class="type">const</span> <span class="type">char</span>* mode)</span> </span>&#123;</span><br><span class="line">        FILE* file = <span class="built_in">fopen</span>(filename.<span class="built_in">c_str</span>(), mode);</span><br><span class="line">        <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file: &quot;</span> + filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">FilePtr</span>(file, fclose);  <span class="comment">// è‡ªåŠ¨è°ƒç”¨fclose</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†ç³»ç»Ÿèµ„æº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MutexManager</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> MutexPtr = std::unique_ptr&lt;std::mutex, <span class="built_in">void</span>(*)(std::mutex*)&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> MutexPtr <span class="title">createMutex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">MutexPtr</span>(</span><br><span class="line">            <span class="keyword">new</span> std::mutex,</span><br><span class="line">            [](std::mutex* m) &#123; <span class="keyword">delete</span> m; &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†ç½‘ç»œè¿æ¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionManager</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">ConnectionDeleter</span> &#123;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(Connection* conn)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (conn) &#123;</span><br><span class="line">                conn-&gt;<span class="built_in">close</span>();     <span class="comment">// ç¡®ä¿è¿æ¥è¢«å…³é—­</span></span><br><span class="line">                <span class="keyword">delete</span> conn;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> ConnectionPtr = std::unique_ptr&lt;Connection, ConnectionDeleter&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> ConnectionPtr <span class="title">connect</span><span class="params">(<span class="type">const</span> std::string&amp; host, <span class="type">int</span> port)</span> </span>&#123;</span><br><span class="line">        Connection* conn = <span class="keyword">new</span> <span class="built_in">Connection</span>(host, port);</span><br><span class="line">        <span class="keyword">if</span> (!conn-&gt;<span class="built_in">isConnected</span>()) &#123;</span><br><span class="line">            <span class="keyword">delete</span> conn;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to connect&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ConnectionPtr</span>(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="7-é”™è¯¯å¤„ç†çš„æ¥å£è®¾è®¡"><a href="#7-é”™è¯¯å¤„ç†çš„æ¥å£è®¾è®¡" class="headerlink" title="7. é”™è¯¯å¤„ç†çš„æ¥å£è®¾è®¡"></a>7. <strong>é”™è¯¯å¤„ç†çš„æ¥å£è®¾è®¡</strong></h4><p>è®¾è®¡æ¸…æ™°çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸æ˜ç¡®çš„é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadParser</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">parse</span><span class="params">(<span class="type">const</span> std::string&amp; input, Result&amp; result)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿”å›boolï¼Œä½†ä¸çŸ¥é“å…·ä½“é”™è¯¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ˜ç¡®çš„é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">ParseError</span> &#123;</span><br><span class="line">    None,</span><br><span class="line">    InvalidFormat,</span><br><span class="line">    MissingField,</span><br><span class="line">    TypeMismatch,</span><br><span class="line">    OutOfRange</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ParseResult</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::optional&lt;T&gt; value_;  <span class="comment">// C++17</span></span><br><span class="line">    ParseError error_;</span><br><span class="line">    std::string errorMessage_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ParseResult</span>(T value) : <span class="built_in">value_</span>(std::<span class="built_in">move</span>(value)), <span class="built_in">error_</span>(ParseError::None) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ParseResult</span>(ParseError error, std::string message) </span><br><span class="line">        : <span class="built_in">error_</span>(error), <span class="built_in">errorMessage_</span>(std::<span class="built_in">move</span>(message)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSuccess</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_.<span class="built_in">has_value</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_.<span class="built_in">value</span>(); &#125;</span><br><span class="line">    <span class="function">ParseError <span class="title">getError</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> error_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getErrorMessage</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> errorMessage_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodParser</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ParseResult&lt;<span class="type">int</span>&gt; <span class="title">parseInt</span><span class="params">(<span class="type">const</span> std::string&amp; input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">size_t</span> pos;</span><br><span class="line">            <span class="type">int</span> result = std::<span class="built_in">stoi</span>(input, &amp;pos);</span><br><span class="line">            <span class="keyword">if</span> (pos != input.<span class="built_in">length</span>()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">ParseResult</span>&lt;<span class="type">int</span>&gt;(ParseError::InvalidFormat, </span><br><span class="line">                                      <span class="string">&quot;Extra characters after number&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ParseResult</span>&lt;<span class="type">int</span>&gt;(result);</span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::invalid_argument&amp;) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ParseResult</span>&lt;<span class="type">int</span>&gt;(ParseError::InvalidFormat, </span><br><span class="line">                                  <span class="string">&quot;Not a valid number&quot;</span>);</span><br><span class="line">        &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::out_of_range&amp;) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">ParseResult</span>&lt;<span class="type">int</span>&gt;(ParseError::OutOfRange, </span><br><span class="line">                                  <span class="string">&quot;Number too large&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-14"><a href="#æ€»ç»“-14" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ä¿ƒè¿›æ­£ç¡®ä½¿ç”¨çš„ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šä½¿ç”¨å¼ºç±»å‹é˜²æ­¢å‚æ•°é”™è¯¯</li>
<li><strong>æ¥å£ä¸€è‡´æ€§</strong>ï¼šåœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä¿æŒå‘½åå’Œè¡Œä¸ºä¸€è‡´</li>
<li><strong>ç¬¦åˆç›´è§‰</strong>ï¼šè®©æ¥å£è¡Œä¸ºç¬¦åˆç”¨æˆ·æœŸæœ›</li>
<li><strong>æä¾›ä¾¿åˆ©</strong>ï¼šå‡å°‘æ ·æ¿ä»£ç å’Œé‡å¤æ“ä½œ</li>
</ul>
<p><strong>é˜»æ­¢è¯¯ç”¨çš„æŠ€æœ¯ï¼š</strong></p>
<ul>
<li><strong>é™åˆ¶å€¼åŸŸ</strong>ï¼šåªå…è®¸æœ‰æ•ˆçš„å€¼å’Œæ“ä½œ</li>
<li><strong>ç¼–è¯‘æ—¶æ£€æŸ¥</strong>ï¼šåˆ©ç”¨ç±»å‹ç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶å‘ç°é”™è¯¯</li>
<li><strong>è¿è¡Œæ—¶éªŒè¯</strong>ï¼šåœ¨å¿…è¦æ—¶è¿›è¡Œè¿è¡Œæ—¶æ£€æŸ¥</li>
<li><strong>èµ„æºè‡ªåŠ¨ç®¡ç†</strong>ï¼šä½¿ç”¨RAIIå’Œæ™ºèƒ½æŒ‡é’ˆ</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æœ€å°æƒŠè®¶åŸåˆ™</strong>ï¼šæ¥å£è¡Œä¸ºåº”è¯¥ç¬¦åˆç”¨æˆ·æœŸæœ›</li>
<li><strong>æ¸è¿›å¼æŠ«éœ²</strong>ï¼šæä¾›ç®€å•çš„é»˜è®¤ç”¨æ³•å’Œé«˜çº§é€‰é¡¹</li>
<li><strong>å¤±è´¥å¿«é€ŸåŸåˆ™</strong>ï¼šå°½æ—©æ£€æµ‹å’ŒæŠ¥å‘Šé”™è¯¯</li>
<li><strong>æ­£äº¤æ€§</strong>ï¼šç‹¬ç«‹çš„åŠŸèƒ½åº”è¯¥ç‹¬ç«‹è®¾è®¡</li>
</ul>
<p><strong>ç°ä»£C++å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šè‡ªåŠ¨èµ„æºç®¡ç†</li>
<li><strong>RAII</strong>ï¼šç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾</li>
<li><strong>ç±»å‹ç³»ç»Ÿ</strong>ï¼šç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹</li>
<li><strong>æ ‡å‡†åº“å®¹å™¨</strong>ï¼šé¿å…æ‰‹åŠ¨å†…å­˜ç®¡ç†</li>
</ul>
<p><strong>è®°ä½ï¼šå¥½çš„æ¥å£å¾ˆå®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸å®¹æ˜“è¢«è¯¯ç”¨ã€‚é€šè¿‡ç±»å‹å®‰å…¨ã€æ¥å£ä¸€è‡´æ€§ã€è‡ªåŠ¨èµ„æºç®¡ç†å’Œæ˜ç¡®çš„é”™è¯¯å¤„ç†ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ä»£ç è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚</strong></p>
<h2 id="æ¡æ¬¾19ï¼š-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type"><a href="#æ¡æ¬¾19ï¼š-è®¾è®¡classçŠ¹å¦‚è®¾è®¡type" class="headerlink" title="æ¡æ¬¾19ï¼š è®¾è®¡classçŠ¹å¦‚è®¾è®¡type"></a>æ¡æ¬¾19ï¼š è®¾è®¡classçŠ¹å¦‚è®¾è®¡type</h2><blockquote>
<p><em>Treat class design as type design</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-18"><a href="#æ ¸å¿ƒç†å¿µ-18" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>Classçš„è®¾è®¡å°±æ˜¯typeçš„è®¾è®¡ã€‚åœ¨å®šä¹‰ä¸€ä¸ªæ–°typeä¹‹å‰ï¼Œè¯·ç¡®å®šä½ å·²ç»è€ƒè™‘è¿‡æœ¬æ¡æ¬¾è¦†ç›–çš„æ‰€æœ‰è®¨è®ºä¸»é¢˜</strong>ã€‚è®¾è®¡ç±»å°±åƒè®¾è®¡å†…ç½®ç±»å‹ä¸€æ ·ï¼Œéœ€è¦è€ƒè™‘å¯¹è±¡çš„åˆ›å»ºã€é”€æ¯ã€åˆå§‹åŒ–ã€èµ‹å€¼ã€æ‹·è´ã€ç§»åŠ¨ã€ç±»å‹è½¬æ¢ã€æ“ä½œç¬¦é‡è½½ã€å†…å­˜ç®¡ç†ã€ç»§æ‰¿å…³ç³»ç­‰å„ä¸ªæ–¹é¢ã€‚ä¸€ä¸ªå¥½çš„ç±»è®¾è®¡åº”è¯¥å…·æœ‰æ¸…æ™°çš„è¯­ä¹‰ã€ä¸€è‡´çš„æ¥å£ã€æ­£ç¡®çš„èµ„æºç®¡ç†å’Œåˆç†çš„æ€§èƒ½ç‰¹å¾ã€‚</p>
<h3 id="æ·±åº¦è§£æ-18"><a href="#æ·±åº¦è§£æ-18" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ"><a href="#1-æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ" class="headerlink" title="1. æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ"></a>1. <strong>æ–°typeçš„å¯¹è±¡åº”è¯¥å¦‚ä½•è¢«åˆ›å»ºå’Œé”€æ¯ï¼Ÿ</strong></h4><p>è€ƒè™‘å¯¹è±¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernString</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">char</span>* data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line">    <span class="type">size_t</span> capacity_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernString</span>() : <span class="built_in">data_</span>(<span class="literal">nullptr</span>), <span class="built_in">size_</span>(<span class="number">0</span>), <span class="built_in">capacity_</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‚æ•°æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ModernString</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> </span>&#123;</span><br><span class="line">        size_ = <span class="built_in">strlen</span>(str);</span><br><span class="line">        capacity_ = size_ + <span class="number">1</span>;</span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">char</span>[capacity_];</span><br><span class="line">        <span class="built_in">strcpy</span>(data_, str);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernString</span>(<span class="type">const</span> ModernString&amp; other) </span><br><span class="line">        : <span class="built_in">size_</span>(other.size_), <span class="built_in">capacity_</span>(other.capacity_) &#123;</span><br><span class="line">        data_ = <span class="keyword">new</span> <span class="type">char</span>[capacity_];</span><br><span class="line">        <span class="built_in">strcpy</span>(data_, other.data_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernString</span>(ModernString&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">data_</span>(other.data_), <span class="built_in">size_</span>(other.size_), <span class="built_in">capacity_</span>(other.capacity_) &#123;</span><br><span class="line">        other.data_ = <span class="literal">nullptr</span>;</span><br><span class="line">        other.size_ = other.capacity_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">    ~<span class="built_in">ModernString</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] data_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰å†…å­˜ç®¡ç†ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span>* <span class="keyword">operator</span> <span class="title">new</span><span class="params">(<span class="type">size_t</span> size)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Custom new for ModernString&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> ::<span class="keyword">operator</span> <span class="built_in">new</span>(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span>* ptr)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Custom delete for ModernString&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        ::<span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(ptr)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-å¯¹è±¡åˆå§‹åŒ–ä¸èµ‹å€¼æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#2-å¯¹è±¡åˆå§‹åŒ–ä¸èµ‹å€¼æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="2. å¯¹è±¡åˆå§‹åŒ–ä¸èµ‹å€¼æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a>2. <strong>å¯¹è±¡åˆå§‹åŒ–ä¸èµ‹å€¼æœ‰ä½•åŒºåˆ«ï¼Ÿ</strong></h4><p>æ˜ç¡®åŒºåˆ†åˆå§‹åŒ–å’Œèµ‹å€¼çš„è¯­ä¹‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼šè´Ÿè´£åˆå§‹åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Resource</span><span class="params">(<span class="type">size_t</span> size)</span> : size_(size) &#123;</span></span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource initialized with size &quot;</span> &lt;&lt; size_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ–æ–°å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">Resource</span>(<span class="type">const</span> Resource&amp; other) : <span class="built_in">size_</span>(other.size_) &#123;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::<span class="built_in">copy</span>(other.data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>() + size_, data_.<span class="built_in">get</span>());</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource copy-initialized&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èµ‹å€¼è¿ç®—ç¬¦ï¼šä¿®æ”¹å·²å­˜åœ¨çš„å¯¹è±¡</span></span><br><span class="line">    Resource&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Resource&amp; other) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource assigned&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é‡æ–°åˆ†é…èµ„æº</span></span><br><span class="line">        size_ = other.size_;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(size_);</span><br><span class="line">        std::<span class="built_in">copy</span>(other.data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>() + size_, data_.<span class="built_in">get</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    Resource&amp; <span class="keyword">operator</span>=(Resource&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource move-assigned&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        </span><br><span class="line">        data_ = std::<span class="built_in">move</span>(other.data_);</span><br><span class="line">        size_ = other.size_;</span><br><span class="line">        other.size_ = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateInitializationVsAssignment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Resource <span class="title">r1</span><span class="params">(<span class="number">10</span>)</span></span>;        <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    Resource r2 = r1;       <span class="comment">// æ‹·è´åˆå§‹åŒ–ï¼ˆè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line">    <span class="function">Resource <span class="title">r3</span><span class="params">(<span class="number">5</span>)</span></span>;         <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    r3 = r1;               <span class="comment">// èµ‹å€¼ï¼ˆè°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ–°typeçš„å¯¹è±¡å¦‚æœè¢«passed-by-valueï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ"><a href="#3-æ–°typeçš„å¯¹è±¡å¦‚æœè¢«passed-by-valueï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. æ–°typeçš„å¯¹è±¡å¦‚æœè¢«passed by valueï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ"></a>3. <strong>æ–°typeçš„å¯¹è±¡å¦‚æœè¢«passed by valueï¼Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong></h4><p>è€ƒè™‘æ‹·è´è¯­ä¹‰å’Œæ€§èƒ½å½±å“ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExpensiveObject</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">double</span>&gt; data_;</span><br><span class="line">    std::string name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ExpensiveObject</span>(<span class="type">const</span> std::string&amp; name, <span class="type">size_t</span> size) </span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">data_</span>(size, <span class="number">0.0</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Created &quot;</span> &lt;&lt; name_ &lt;&lt; <span class="string">&quot; with &quot;</span> &lt;&lt; size &lt;&lt; <span class="string">&quot; elements&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼šæŒ‰å€¼ä¼ é€’æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">    <span class="built_in">ExpensiveObject</span>(<span class="type">const</span> ExpensiveObject&amp; other) </span><br><span class="line">        : <span class="built_in">name_</span>(other.name_ + <span class="string">&quot;_copy&quot;</span>), <span class="built_in">data_</span>(other.data_) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Copied &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°ï¼šç§»åŠ¨è¯­ä¹‰ä¼˜åŒ–</span></span><br><span class="line">    <span class="built_in">ExpensiveObject</span>(ExpensiveObject&amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">name_</span>(std::<span class="built_in">move</span>(other.name_)), <span class="built_in">data_</span>(std::<span class="built_in">move</span>(other.data_)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Moved &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æŒ‰å€¼ä¼ é€’ï¼šæ˜‚è´µçš„æ‹·è´</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processExpensiveByValue</span><span class="params">(ExpensiveObject obj)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Processing &quot;</span> &lt;&lt; obj.<span class="built_in">getName</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æŒ‰å¼•ç”¨ä¼ é€’ï¼šé¿å…æ‹·è´</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processExpensiveByReference</span><span class="params">(<span class="type">const</span> ExpensiveObject&amp; obj)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Processing &quot;</span> &lt;&lt; obj.<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot; (by reference)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç§»åŠ¨è¯­ä¹‰ï¼šé«˜æ•ˆçš„æ‰€æœ‰æƒè½¬ç§»</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processExpensiveByMove</span><span class="params">(ExpensiveObject obj)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Processing moved &quot;</span> &lt;&lt; obj.<span class="built_in">getName</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstratePassByValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ExpensiveObject <span class="title">original</span><span class="params">(<span class="string">&quot;BigData&quot;</span>, <span class="number">1000000</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">processExpensiveByValue</span>(original);        <span class="comment">// è§¦å‘æ‹·è´</span></span><br><span class="line">    <span class="built_in">processExpensiveByReference</span>(original);    <span class="comment">// æ— æ‹·è´</span></span><br><span class="line">    <span class="built_in">processExpensiveByMove</span>(std::<span class="built_in">move</span>(original)); <span class="comment">// ç§»åŠ¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-ä»€ä¹ˆæ˜¯æ–°typeçš„åˆæ³•å€¼ï¼Ÿ"><a href="#4-ä»€ä¹ˆæ˜¯æ–°typeçš„åˆæ³•å€¼ï¼Ÿ" class="headerlink" title="4. ä»€ä¹ˆæ˜¯æ–°typeçš„åˆæ³•å€¼ï¼Ÿ"></a>4. <strong>ä»€ä¹ˆæ˜¯æ–°typeçš„åˆæ³•å€¼ï¼Ÿ</strong></h4><p>å®šä¹‰å€¼åŸŸå’Œä¸å˜é‡çº¦æŸã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Temperature</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> celsius_;</span><br><span class="line">    </span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">double</span> ABSOLUTE_ZERO = <span class="number">-273.15</span>;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">double</span> MAX_TEMP = <span class="number">1000000.0</span>; <span class="comment">// å®ç”¨ä¸Šé™</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Temperature</span><span class="params">(<span class="type">double</span> celsius = <span class="number">0.0</span>)</span> : celsius_(celsius) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (celsius &lt; ABSOLUTE_ZERO) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Temperature cannot be below absolute zero&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (celsius &gt; MAX_TEMP) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Temperature too high&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—®å™¨</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">celsius</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> celsius_; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">fahrenheit</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> celsius_ * <span class="number">9.0</span> / <span class="number">5.0</span> + <span class="number">32.0</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">kelvin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> celsius_ + <span class="number">273.15</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹å™¨ï¼šç»´æŠ¤ä¸å˜é‡</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCelsius</span><span class="params">(<span class="type">double</span> celsius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (celsius &lt; ABSOLUTE_ZERO || celsius &gt; MAX_TEMP) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Invalid temperature value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        celsius_ = celsius;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ“ä½œç¬¦ï¼šç¡®ä¿ç»“æœæœ‰æ•ˆ</span></span><br><span class="line">    Temperature <span class="keyword">operator</span>+(<span class="type">const</span> Temperature&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Temperature</span>(celsius_ + other.celsius_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Temperature <span class="keyword">operator</span>-(<span class="type">const</span> Temperature&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Temperature</span>(celsius_ - other.celsius_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Temperature&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> celsius_ &lt; other.celsius_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateValidValues</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">Temperature <span class="title">room</span><span class="params">(<span class="number">20.0</span>)</span></span>;           <span class="comment">// âœ… æœ‰æ•ˆ</span></span><br><span class="line">        Temperature hot = room + <span class="built_in">Temperature</span>(<span class="number">50.0</span>); <span class="comment">// âœ… æœ‰æ•ˆè¿ç®—</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Temperature invalid(-300.0);  // âŒ æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Room: &quot;</span> &lt;&lt; room.<span class="built_in">celsius</span>() &lt;&lt; <span class="string">&quot;Â°C&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Hot: &quot;</span> &lt;&lt; hot.<span class="built_in">fahrenheit</span>() &lt;&lt; <span class="string">&quot;Â°F&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾ç³»å—ï¼Ÿ"><a href="#5-æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾ç³»å—ï¼Ÿ" class="headerlink" title="5. æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾ç³»å—ï¼Ÿ"></a>5. <strong>æ–°typeéœ€è¦é…åˆæŸä¸ªç»§æ‰¿å›¾ç³»å—ï¼Ÿ</strong></h4><p>è€ƒè™‘ç»§æ‰¿å…³ç³»å’Œå¤šæ€è®¾è®¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»ï¼šå®šä¹‰æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Shape</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> : name_(name) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è™šææ„å‡½æ•°ï¼šæ”¯æŒå¤šæ€é”€æ¯</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¯è™šå‡½æ•°ï¼šå®šä¹‰æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">perimeter</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éè™šå‡½æ•°ï¼šå…¬å…±åŠŸèƒ½</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¨¡æ¿æ–¹æ³•æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Shape: &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Area: &quot;</span> &lt;&lt; <span class="built_in">area</span>() &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Perimeter: &quot;</span> &lt;&lt; <span class="built_in">perimeter</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ´¾ç”Ÿç±»ï¼šå…·ä½“å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Circle</span><span class="params">(<span class="type">double</span> radius)</span> </span></span><br><span class="line"><span class="function">        : Shape(<span class="string">&quot;Circle&quot;</span>), radius_(radius) &#123;</span></span><br><span class="line">        <span class="keyword">if</span> (radius &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Radius must be positive&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14159</span> * radius_ * radius_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">perimeter</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * <span class="number">3.14159</span> * radius_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing circle with radius &quot;</span> &lt;&lt; radius_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getRadius</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> radius_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> width_, height_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>(<span class="type">double</span> width, <span class="type">double</span> height) </span><br><span class="line">        : <span class="built_in">Shape</span>(<span class="string">&quot;Rectangle&quot;</span>), <span class="built_in">width_</span>(width), <span class="built_in">height_</span>(height) &#123;</span><br><span class="line">        <span class="keyword">if</span> (width &lt;= <span class="number">0</span> || height &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Dimensions must be positive&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width_ * height_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">perimeter</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (width_ + height_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing rectangle &quot;</span> &lt;&lt; width_ &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; height_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateInheritance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::unique_ptr&lt;Shape&gt;&gt; shapes;</span><br><span class="line">    shapes.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;Circle&gt;(<span class="number">5.0</span>));</span><br><span class="line">    shapes.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;Rectangle&gt;(<span class="number">4.0</span>, <span class="number">6.0</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; shape : shapes) &#123;</span><br><span class="line">        shape-&gt;<span class="built_in">display</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;---&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-æ–°typeéœ€è¦ä»€ä¹ˆç±»å‹çš„è½¬æ¢ï¼Ÿ"><a href="#6-æ–°typeéœ€è¦ä»€ä¹ˆç±»å‹çš„è½¬æ¢ï¼Ÿ" class="headerlink" title="6. æ–°typeéœ€è¦ä»€ä¹ˆç±»å‹çš„è½¬æ¢ï¼Ÿ"></a>6. <strong>æ–°typeéœ€è¦ä»€ä¹ˆç±»å‹çš„è½¬æ¢ï¼Ÿ</strong></h4><p>è®¾è®¡ç±»å‹è½¬æ¢çš„ç­–ç•¥ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Money</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> cents_;  <span class="comment">// ä»¥åˆ†ä¸ºå•ä½å­˜å‚¨ï¼Œé¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ˜¾å¼æ„é€ ï¼šé˜²æ­¢æ„å¤–è½¬æ¢</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Money</span><span class="params">(<span class="type">double</span> dollars)</span> : cents_(static_cast&lt;int&gt;(dollars * <span class="number">100</span>)) &#123;</span>&#125;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Money</span><span class="params">(<span class="type">int</span> cents)</span> : cents_(cents) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—®å™¨</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">dollars</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> cents_ / <span class="number">100.0</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">cents</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> cents_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ˜¾å¼è½¬æ¢è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">dollars</span>(); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éšå¼è½¬æ¢åˆ°boolï¼ˆç”¨äºæ¡ä»¶åˆ¤æ–­ï¼‰</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> cents_ != <span class="number">0</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line">    Money <span class="keyword">operator</span>+(<span class="type">const</span> Money&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Money</span>(cents_ + other.cents_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Money&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Money&amp; other) &#123;</span><br><span class="line">        cents_ += other.cents_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Money&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cents_ == other.cents_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Money&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cents_ &lt; other.cents_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å…³çš„éæˆå‘˜å‡½æ•°</span></span><br><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Money&amp; money) &#123;</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; <span class="string">&quot;$&quot;</span> &lt;&lt; money.<span class="built_in">dollars</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateTypeConversion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Money <span class="title">m1</span><span class="params">(<span class="number">10.50</span>)</span></span>;  <span class="comment">// explicitæ„é€ </span></span><br><span class="line">    <span class="function">Money <span class="title">m2</span><span class="params">(<span class="number">1000</span>)</span></span>;   <span class="comment">// 1000åˆ† = $10.00</span></span><br><span class="line">    </span><br><span class="line">    Money total = m1 + m2;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Total: &quot;</span> &lt;&lt; total &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ˜¾å¼è½¬æ¢</span></span><br><span class="line">    <span class="type">double</span> amount = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(total);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Amount: &quot;</span> &lt;&lt; amount &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (total) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Total is non-zero&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-15"><a href="#æ€»ç»“-15" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>è®¾è®¡ç±»æ—¶éœ€è¦è€ƒè™‘çš„12ä¸ªé—®é¢˜ï¼š</strong></p>
<ol>
<li><strong>åˆ›å»ºå’Œé”€æ¯</strong>ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€å†…å­˜ç®¡ç†</li>
<li><strong>åˆå§‹åŒ–vsèµ‹å€¼</strong>ï¼šæ‹·è´æ„é€ å‡½æ•°vsèµ‹å€¼è¿ç®—ç¬¦</li>
<li><strong>å€¼ä¼ é€’è¯­ä¹‰</strong>ï¼šæ‹·è´æ„é€ å‡½æ•°çš„æ€§èƒ½å’Œæ­£ç¡®æ€§</li>
<li><strong>åˆæ³•å€¼åŸŸ</strong>ï¼šä¸å˜é‡ã€çº¦æŸæ¡ä»¶ã€é”™è¯¯å¤„ç†</li>
<li><strong>ç»§æ‰¿å…³ç³»</strong>ï¼šæ˜¯å¦éœ€è¦è™šå‡½æ•°ã€å¤šæ€è®¾è®¡</li>
<li><strong>ç±»å‹è½¬æ¢</strong>ï¼šéšå¼vsæ˜¾å¼è½¬æ¢ã€è½¬æ¢è¿ç®—ç¬¦</li>
<li><strong>æ“ä½œç¬¦å’Œå‡½æ•°</strong>ï¼šæˆå‘˜vséæˆå‘˜ã€è¿ç®—ç¬¦é‡è½½</li>
<li><strong>ç¦ç”¨æ“ä½œ</strong>ï¼š&#x3D;deleteã€privateå£°æ˜</li>
<li><strong>è®¿é—®æ§åˆ¶</strong>ï¼špublic&#x2F;protected&#x2F;privateã€friend</li>
<li><strong>éšå«æ¥å£</strong>ï¼šå¼‚å¸¸å®‰å…¨ã€èµ„æºç®¡ç†ã€æ€§èƒ½ä¿è¯</li>
<li><strong>æ³›åŒ–ç¨‹åº¦</strong>ï¼šæ˜¯å¦éœ€è¦æ¨¡æ¿åŒ–</li>
<li><strong>å¿…è¦æ€§</strong>ï¼šæ˜¯å¦çœŸçš„éœ€è¦æ–°ç±»å‹</li>
</ol>
<p><strong>ç°ä»£C++è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>RAII</strong>ï¼šèµ„æºè·å–å³åˆå§‹åŒ–</li>
<li><strong>Rule of Zero&#x2F;Three&#x2F;Five</strong>ï¼šæ˜ç¡®æ‹·è´&#x2F;ç§»åŠ¨è¯­ä¹‰</li>
<li><strong>å¼ºç±»å‹</strong>ï¼šä½¿ç”¨ç±»å‹ç³»ç»Ÿé˜²æ­¢é”™è¯¯</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šæä¾›å¼‚å¸¸å®‰å…¨ä¿è¯</li>
<li><strong>constæ­£ç¡®æ€§</strong>ï¼šåˆç†ä½¿ç”¨const</li>
<li><strong>ç§»åŠ¨è¯­ä¹‰</strong>ï¼šæ”¯æŒé«˜æ•ˆçš„èµ„æºè½¬ç§»</li>
</ul>
<p><strong>è®°ä½ï¼šClassçš„è®¾è®¡å°±æ˜¯typeçš„è®¾è®¡ã€‚åœ¨å®šä¹‰ä¸€ä¸ªæ–°typeä¹‹å‰ï¼Œè¯·ç¡®å®šä½ å·²ç»è€ƒè™‘è¿‡æ‰€æœ‰ç›¸å…³çš„è®¾è®¡å†³ç­–ã€‚ä¸€ä¸ªå¥½çš„ç±»è®¾è®¡åº”è¯¥å…·æœ‰æ¸…æ™°çš„è¯­ä¹‰ã€ä¸€è‡´çš„æ¥å£ã€æ­£ç¡®çš„èµ„æºç®¡ç†å’Œåˆç†çš„æ€§èƒ½ç‰¹å¾ã€‚</strong> </p>
<h2 id="æ¡æ¬¾20ï¼š-å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value"><a href="#æ¡æ¬¾20ï¼š-å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value" class="headerlink" title="æ¡æ¬¾20ï¼š å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value"></a>æ¡æ¬¾20ï¼š å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value</h2><blockquote>
<p><em>Prefer pass-by-reference-to-const to pass-by-value</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-19"><a href="#æ ¸å¿ƒç†å¿µ-19" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å°½é‡ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-valueã€‚å‰è€…é€šå¸¸æ¯”è¾ƒé«˜æ•ˆï¼Œå¹¶å¯é¿å…åˆ‡å‰²é—®é¢˜ï¼ˆslicing problemï¼‰</strong>ã€‚ä½†è¿™ä¸ªè§„åˆ™å¹¶ä¸é€‚ç”¨äºå†…ç½®ç±»å‹ã€ä»¥åŠSTLçš„è¿­ä»£å™¨å’Œå‡½æ•°å¯¹è±¡ï¼Œå¯¹å®ƒä»¬è€Œè¨€ï¼Œpass-by-valueå¾€å¾€æ¯”è¾ƒæ°å½“ã€‚é€‰æ‹©æ­£ç¡®çš„å‚æ•°ä¼ é€’æ–¹å¼å¯¹ç¨‹åºæ€§èƒ½å’Œæ­£ç¡®æ€§éƒ½æœ‰é‡è¦å½±å“ã€‚</p>
<h3 id="æ·±åº¦è§£æ-19"><a href="#æ·±åº¦è§£æ-19" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-åˆ‡å‰²é—®é¢˜çš„ä¸¥é‡æ€§"><a href="#1-åˆ‡å‰²é—®é¢˜çš„ä¸¥é‡æ€§" class="headerlink" title="1. åˆ‡å‰²é—®é¢˜çš„ä¸¥é‡æ€§"></a>1. <strong>åˆ‡å‰²é—®é¢˜çš„ä¸¥é‡æ€§</strong></h4><p>å½“æ´¾ç”Ÿç±»å¯¹è±¡æŒ‰å€¼ä¼ é€’æ—¶ï¼Œåªä¼šå¤åˆ¶åŸºç±»éƒ¨åˆ†ï¼Œå¯¼è‡´å¤šæ€è¡Œä¸ºä¸¢å¤±ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Window</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Window</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Displaying window: &quot;</span> &lt;&lt; name_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">getType</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Window&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialWindow</span> : <span class="keyword">public</span> Window &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string specialFeature_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SpecialWindow</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; feature) </span><br><span class="line">        : <span class="built_in">Window</span>(name), <span class="built_in">specialFeature_</span>(feature) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Displaying special window: &quot;</span> &lt;&lt; name_ </span><br><span class="line">                  &lt;&lt; <span class="string">&quot; with feature: &quot;</span> &lt;&lt; specialFeature_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">getType</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SpecialWindow&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getSpecialFeature</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> specialFeature_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æŒ‰å€¼ä¼ é€’ï¼šå‘ç”Ÿåˆ‡å‰²</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printWindowByValue</span><span class="params">(Window w)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Type: &quot;</span> &lt;&lt; w.<span class="built_in">getType</span>() &lt;&lt; std::endl;</span><br><span class="line">    w.<span class="built_in">display</span>();  <span class="comment">// æ€»æ˜¯è°ƒç”¨Window::display()ï¼Œä¸¢å¤±å¤šæ€æ€§</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æŒ‰å¼•ç”¨ä¼ é€’ï¼šä¿æŒå¤šæ€æ€§</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printWindowByReference</span><span class="params">(<span class="type">const</span> Window&amp; w)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Type: &quot;</span> &lt;&lt; w.<span class="built_in">getType</span>() &lt;&lt; std::endl;</span><br><span class="line">    w.<span class="built_in">display</span>();  <span class="comment">// æ­£ç¡®è°ƒç”¨æ´¾ç”Ÿç±»çš„ç‰ˆæœ¬</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSlicing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">SpecialWindow <span class="title">sw</span><span class="params">(<span class="string">&quot;MainWindow&quot;</span>, <span class="string">&quot;ResizableFrame&quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;=== Pass by value (slicing occurs) ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">printWindowByValue</span>(sw);    <span class="comment">// åˆ‡å‰²ï¼šåªä¿ç•™Windowéƒ¨åˆ†</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n=== Pass by reference (no slicing) ===&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">printWindowByReference</span>(sw); <span class="comment">// ä¿æŒå®Œæ•´å¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ€§èƒ½å·®å¼‚çš„é‡åŒ–åˆ†æ"><a href="#2-æ€§èƒ½å·®å¼‚çš„é‡åŒ–åˆ†æ" class="headerlink" title="2. æ€§èƒ½å·®å¼‚çš„é‡åŒ–åˆ†æ"></a>2. <strong>æ€§èƒ½å·®å¼‚çš„é‡åŒ–åˆ†æ</strong></h4><p>å¤§å¯¹è±¡çš„æ‹·è´å¼€é”€å¯èƒ½éå¸¸æ˜‚è´µã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LargeObject</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">double</span>&gt; data_;</span><br><span class="line">    std::string description_;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; metadata_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">LargeObject</span><span class="params">(<span class="type">size_t</span> size)</span> </span></span><br><span class="line"><span class="function">        : data_(size, <span class="number">3.14159</span>), </span></span><br><span class="line"><span class="function">          description_(<span class="string">&quot;Large object with &quot;</span> + std::to_string(size) + <span class="string">&quot; elements&quot;</span>) &#123;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€äº›å…ƒæ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">            metadata_[<span class="string">&quot;key&quot;</span> + std::<span class="built_in">to_string</span>(i)] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼šæ˜¾ç¤ºæ‹·è´å¼€é”€</span></span><br><span class="line">    <span class="built_in">LargeObject</span>(<span class="type">const</span> LargeObject&amp; other) </span><br><span class="line">        : <span class="built_in">data_</span>(other.data_), </span><br><span class="line">          <span class="built_in">description_</span>(other.description_), </span><br><span class="line">          <span class="built_in">metadata_</span>(other.metadata_) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Expensive copy of LargeObject with &quot;</span> </span><br><span class="line">                  &lt;&lt; data_.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; elements&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">size</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getDescription</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> description_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">computeSum</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">accumulate</span>(data_.<span class="built_in">begin</span>(), data_.<span class="built_in">end</span>(), <span class="number">0.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æŒ‰å€¼ä¼ é€’ï¼šæ˜‚è´µçš„æ‹·è´</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">processLargeObjectByValue</span><span class="params">(LargeObject obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="built_in">computeSum</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æŒ‰å¼•ç”¨ä¼ é€’ï¼šæ— æ‹·è´å¼€é”€</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">processLargeObjectByReference</span><span class="params">(<span class="type">const</span> LargeObject&amp; obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="built_in">computeSum</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€§èƒ½æµ‹è¯•</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">performanceComparison</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">LargeObject <span class="title">bigObj</span><span class="params">(<span class="number">1000000</span>)</span></span>;  <span class="comment">// 100ä¸‡ä¸ªå…ƒç´ </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">double</span> result1 = <span class="built_in">processLargeObjectByValue</span>(bigObj);  <span class="comment">// è§¦å‘æ˜‚è´µæ‹·è´</span></span><br><span class="line">    <span class="keyword">auto</span> mid = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">double</span> result2 = <span class="built_in">processLargeObjectByReference</span>(bigObj);  <span class="comment">// æ— æ‹·è´</span></span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> copyTime = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(mid - start);</span><br><span class="line">    <span class="keyword">auto</span> refTime = std::chrono::<span class="built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(end - mid);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Pass by value time: &quot;</span> &lt;&lt; copyTime.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; Î¼s&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Pass by reference time: &quot;</span> &lt;&lt; refTime.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; Î¼s&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Performance ratio: &quot;</span> &lt;&lt; copyTime.<span class="built_in">count</span>() / (<span class="type">double</span>)refTime.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-å†…ç½®ç±»å‹å’Œå°å¯¹è±¡çš„ä¾‹å¤–"><a href="#3-å†…ç½®ç±»å‹å’Œå°å¯¹è±¡çš„ä¾‹å¤–" class="headerlink" title="3. å†…ç½®ç±»å‹å’Œå°å¯¹è±¡çš„ä¾‹å¤–"></a>3. <strong>å†…ç½®ç±»å‹å’Œå°å¯¹è±¡çš„ä¾‹å¤–</strong></h4><p>å¯¹äºå†…ç½®ç±»å‹ã€è¿­ä»£å™¨å’Œå°å¯¹è±¡ï¼ŒæŒ‰å€¼ä¼ é€’é€šå¸¸æ›´å¥½ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… å†…ç½®ç±»å‹ï¼šæŒ‰å€¼ä¼ é€’æ›´è‡ªç„¶</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">addNumbers</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">multiply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å°å¯¹è±¡ï¼šæŒ‰å€¼ä¼ é€’é€šå¸¸æ²¡é—®é¢˜</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point2D</span> &#123;</span><br><span class="line">    <span class="type">double</span> x, y;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Point2D</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Point2D <span class="keyword">operator</span>+(<span class="type">const</span> Point2D&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point2D</span>(x + other.x, y + other.y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Point2D <span class="title">calculateMidpoint</span><span class="params">(Point2D p1, Point2D p2)</span> </span>&#123;  <span class="comment">// æŒ‰å€¼ä¼ é€’å°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Point2D</span>((p<span class="number">1.</span>x + p<span class="number">2.</span>x) / <span class="number">2</span>, (p<span class="number">1.</span>y + p<span class="number">2.</span>y) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… STLè¿­ä»£å™¨ï¼šæŒ‰å€¼ä¼ é€’</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Iterator&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">typename</span> Iterator::value_type <span class="title">findMax</span><span class="params">(Iterator first, Iterator last)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (first == last) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Empty range&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> maxVal = *first;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = first; it != last; ++it) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*it &gt; maxVal) &#123;</span><br><span class="line">            maxVal = *it;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å‡½æ•°å¯¹è±¡ï¼šé€šå¸¸æŒ‰å€¼ä¼ é€’</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Predicate&gt;</span></span><br><span class="line"><span class="function">std::vector&lt;T&gt; <span class="title">filterVector</span><span class="params">(<span class="type">const</span> std::vector&lt;T&gt;&amp; vec, Predicate pred)</span> </span>&#123;</span><br><span class="line">    std::vector&lt;T&gt; result;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; item : vec) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">pred</span>(item)) &#123;</span><br><span class="line">            result.<span class="built_in">push_back</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateBuiltinTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å†…ç½®ç±»å‹</span></span><br><span class="line">    <span class="type">int</span> sum = <span class="built_in">addNumbers</span>(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">double</span> product = <span class="built_in">multiply</span>(<span class="number">3.14</span>, <span class="number">2.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°å¯¹è±¡</span></span><br><span class="line">    <span class="function">Point2D <span class="title">p1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Point2D <span class="title">p2</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    Point2D mid = <span class="built_in">calculateMidpoint</span>(p1, p2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// STLè¿­ä»£å™¨</span></span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; numbers = &#123;<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">7</span>&#125;;</span><br><span class="line">    <span class="type">int</span> maxNum = <span class="built_in">findMax</span>(numbers.<span class="built_in">begin</span>(), numbers.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‡½æ•°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">auto</span> filtered = <span class="built_in">filterVector</span>(numbers, [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x &gt; <span class="number">3</span>; &#125;);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Sum: &quot;</span> &lt;&lt; sum &lt;&lt; <span class="string">&quot;, Product: &quot;</span> &lt;&lt; product &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Midpoint: (&quot;</span> &lt;&lt; mid.x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; mid.y &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Max: &quot;</span> &lt;&lt; maxNum &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-å¼•ç”¨ä¼ é€’çš„å®ç°ç»†èŠ‚"><a href="#4-å¼•ç”¨ä¼ é€’çš„å®ç°ç»†èŠ‚" class="headerlink" title="4. å¼•ç”¨ä¼ é€’çš„å®ç°ç»†èŠ‚"></a>4. <strong>å¼•ç”¨ä¼ é€’çš„å®ç°ç»†èŠ‚</strong></h4><p>å¼•ç”¨åœ¨åº•å±‚é€šå¸¸å®ç°ä¸ºæŒ‡é’ˆï¼Œä½†è¯­æ³•æ›´å®‰å…¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;std::vector&lt;<span class="type">double</span>&gt;&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> rows_, cols_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Matrix</span>(<span class="type">size_t</span> rows, <span class="type">size_t</span> cols) </span><br><span class="line">        : <span class="built_in">rows_</span>(rows), <span class="built_in">cols_</span>(cols), <span class="built_in">data_</span>(rows, std::<span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(cols, <span class="number">0.0</span>)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—®å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">double</span>&amp; <span class="title">at</span><span class="params">(<span class="type">size_t</span> row, <span class="type">size_t</span> col)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_[row][col];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">double</span>&amp; <span class="title">at</span><span class="params">(<span class="type">size_t</span> row, <span class="type">size_t</span> col)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data_[row][col];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">rows</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> rows_; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">cols</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> cols_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å¼•ç”¨ä¼ é€’ï¼šé«˜æ•ˆä¸”ç±»å‹å®‰å…¨</span></span><br><span class="line"><span class="function">Matrix <span class="title">multiplyMatrices</span><span class="params">(<span class="type">const</span> Matrix&amp; a, <span class="type">const</span> Matrix&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a.<span class="built_in">cols</span>() != b.<span class="built_in">rows</span>()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Matrix dimensions don&#x27;t match&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Matrix <span class="title">result</span><span class="params">(a.rows(), b.cols())</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">rows</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; b.<span class="built_in">cols</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">size_t</span> k = <span class="number">0</span>; k &lt; a.<span class="built_in">cols</span>(); ++k) &#123;</span><br><span class="line">                result.<span class="built_in">at</span>(i, j) += a.<span class="built_in">at</span>(i, k) * b.<span class="built_in">at</span>(k, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ æŒ‡é’ˆä¼ é€’ï¼šå®¹æ˜“å‡ºé”™</span></span><br><span class="line"><span class="function">Matrix <span class="title">multiplyMatricesWithPointers</span><span class="params">(<span class="type">const</span> Matrix* a, <span class="type">const</span> Matrix* b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!a || !b) &#123;  <span class="comment">// éœ€è¦æ£€æŸ¥ç©ºæŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Null matrix pointer&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (a-&gt;<span class="built_in">cols</span>() != b-&gt;<span class="built_in">rows</span>()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Matrix dimensions don&#x27;t match&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°ç›¸åŒï¼Œä½†è¯­æ³•æ›´å¤æ‚ä¸”å®¹æ˜“å‡ºé”™</span></span><br><span class="line">    <span class="function">Matrix <span class="title">result</span><span class="params">(a-&gt;rows(), b-&gt;cols())</span></span>;</span><br><span class="line">    <span class="comment">// ... çŸ©é˜µä¹˜æ³•å®ç°</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-constå¼•ç”¨çš„é‡è¦æ€§"><a href="#5-constå¼•ç”¨çš„é‡è¦æ€§" class="headerlink" title="5. constå¼•ç”¨çš„é‡è¦æ€§"></a>5. <strong>constå¼•ç”¨çš„é‡è¦æ€§</strong></h4><p>ä½¿ç”¨constå¼•ç”¨è¡¨æ˜å‡½æ•°ä¸ä¼šä¿®æ”¹å‚æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string content_;</span><br><span class="line">    std::string title_;</span><br><span class="line">    std::vector&lt;std::string&gt; tags_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Document</span>(<span class="type">const</span> std::string&amp; title, <span class="type">const</span> std::string&amp; content) </span><br><span class="line">        : <span class="built_in">title_</span>(title), <span class="built_in">content_</span>(content) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addTag</span><span class="params">(<span class="type">const</span> std::string&amp; tag)</span> </span>&#123;</span><br><span class="line">        tags_.<span class="built_in">push_back</span>(tag);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getTitle</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> title_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getContent</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> content_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::vector&lt;std::string&gt;&amp; <span class="title">getTags</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> tags_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">getWordCount</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="function">std::istringstream <span class="title">iss</span><span class="params">(content_)</span></span>;</span><br><span class="line">        std::string word;</span><br><span class="line">        <span class="type">size_t</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (iss &gt;&gt; word) &#123;</span><br><span class="line">            ++count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… constå¼•ç”¨ï¼šæ˜ç¡®è¡¨ç¤ºåªè¯»æ“ä½œ</span></span><br><span class="line"><span class="function">std::string <span class="title">generateSummary</span><span class="params">(<span class="type">const</span> Document&amp; doc)</span> </span>&#123;</span><br><span class="line">    std::ostringstream summary;</span><br><span class="line">    summary &lt;&lt; <span class="string">&quot;Title: &quot;</span> &lt;&lt; doc.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    summary &lt;&lt; <span class="string">&quot;Word count: &quot;</span> &lt;&lt; doc.<span class="built_in">getWordCount</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    summary &lt;&lt; <span class="string">&quot;Tags: &quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span>&amp; tags = doc.<span class="built_in">getTags</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; tags.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span>) summary &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">        summary &lt;&lt; tags[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> summary.<span class="built_in">str</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ éconstå¼•ç”¨ï¼šè¯¯å¯¼æ€§ï¼Œæš—ç¤ºå¯èƒ½ä¿®æ”¹</span></span><br><span class="line"><span class="function">std::string <span class="title">generateSummaryMisleading</span><span class="params">(Document&amp; doc)</span> </span>&#123;  <span class="comment">// ä¸åº”è¯¥éœ€è¦éconst</span></span><br><span class="line">    <span class="comment">// å®ç°ç›¸åŒï¼Œä½†æ¥å£æš—ç¤ºå¯èƒ½ä¿®æ”¹doc</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">generateSummary</span>(doc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… åŒºåˆ†åªè¯»å’Œä¿®æ”¹æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processDocument</span><span class="params">(Document&amp; doc)</span> </span>&#123;  <span class="comment">// éconstï¼šä¼šä¿®æ”¹</span></span><br><span class="line">    doc.<span class="built_in">addTag</span>(<span class="string">&quot;processed&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">analyzeDocument</span><span class="params">(<span class="type">const</span> Document&amp; doc)</span> </span>&#123;  <span class="comment">// constï¼šåªè¯»åˆ†æ</span></span><br><span class="line">    <span class="keyword">return</span> doc.<span class="built_in">getWordCount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-ç°ä»£C-çš„å‚æ•°ä¼ é€’æœ€ä½³å®è·µ"><a href="#6-ç°ä»£C-çš„å‚æ•°ä¼ é€’æœ€ä½³å®è·µ" class="headerlink" title="6. ç°ä»£C++çš„å‚æ•°ä¼ é€’æœ€ä½³å®è·µ"></a>6. <strong>ç°ä»£C++çš„å‚æ•°ä¼ é€’æœ€ä½³å®è·µ</strong></h4><p>ç»“åˆç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘çš„ç°ä»£æŠ€å·§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Container</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;T&gt; items_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… å¯¹äºå¤åˆ¶ï¼šä½¿ç”¨constå¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addItem</span><span class="params">(<span class="type">const</span> T&amp; item)</span> </span>&#123;</span><br><span class="line">        items_.<span class="built_in">push_back</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å¯¹äºç§»åŠ¨ï¼šä½¿ç”¨å³å€¼å¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addItem</span><span class="params">(T&amp;&amp; item)</span> </span>&#123;</span><br><span class="line">        items_.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(item));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®Œç¾è½¬å‘ï¼šç»Ÿä¸€å¤„ç†</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">emplaceItem</span><span class="params">(U&amp;&amp; item)</span> </span>&#123;</span><br><span class="line">        items_.<span class="built_in">emplace_back</span>(std::forward&lt;U&gt;(item));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… åªè¯»è®¿é—®ï¼šconstå¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">getItem</span><span class="params">(<span class="type">size_t</span> index)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items_.<span class="built_in">at</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ä¿®æ”¹è®¿é—®ï¼šéconstå¼•ç”¨</span></span><br><span class="line">    <span class="function">T&amp; <span class="title">getItem</span><span class="params">(<span class="type">size_t</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items_.<span class="built_in">at</span>(index);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> items_.<span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateModernPassing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Container&lt;std::string&gt; container;</span><br><span class="line">    </span><br><span class="line">    std::string str1 = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    container.<span class="built_in">addItem</span>(str1);                    <span class="comment">// æ‹·è´</span></span><br><span class="line">    container.<span class="built_in">addItem</span>(<span class="string">&quot;World&quot;</span>);                 <span class="comment">// ç§»åŠ¨ï¼ˆä»ä¸´æ—¶å¯¹è±¡ï¼‰</span></span><br><span class="line">    container.<span class="built_in">emplaceItem</span>(<span class="string">&quot;Perfect&quot;</span>);           <span class="comment">// å®Œç¾è½¬å‘</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªè¯»è®¿é—®</span></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span>&amp; first = container.<span class="built_in">getItem</span>(<span class="number">0</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;First item: &quot;</span> &lt;&lt; first &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-æ€§èƒ½æµ‹é‡å’Œé€‰æ‹©æŒ‡å—"><a href="#7-æ€§èƒ½æµ‹é‡å’Œé€‰æ‹©æŒ‡å—" class="headerlink" title="7. æ€§èƒ½æµ‹é‡å’Œé€‰æ‹©æŒ‡å—"></a>7. <strong>æ€§èƒ½æµ‹é‡å’Œé€‰æ‹©æŒ‡å—</strong></h4><p>å¦‚ä½•å†³å®šä½¿ç”¨å“ªç§ä¼ é€’æ–¹å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹é‡å¯¹è±¡å¤§å°çš„å·¥å…·</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">analyzeType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Type: &quot;</span> &lt;&lt; <span class="built_in">typeid</span>(T).<span class="built_in">name</span>() &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Size: &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(T) &lt;&lt; <span class="string">&quot; bytes&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Recommended: &quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (std::is_fundamental_v&lt;T&gt; || <span class="built_in">sizeof</span>(T) &lt;= <span class="built_in">sizeof</span>(<span class="type">void</span>*)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Pass by value&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Pass by const reference&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateTypeAnalysis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">analyzeType</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    <span class="built_in">analyzeType</span>&lt;<span class="type">double</span>&gt;();</span><br><span class="line">    <span class="built_in">analyzeType</span>&lt;std::string&gt;();</span><br><span class="line">    analyzeType&lt;std::vector&lt;<span class="type">int</span>&gt;&gt;();</span><br><span class="line">    <span class="built_in">analyzeType</span>&lt;Point2D&gt;();</span><br><span class="line">    <span class="built_in">analyzeType</span>&lt;Matrix&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-16"><a href="#æ€»ç»“-16" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>é€‰æ‹©å‚æ•°ä¼ é€’æ–¹å¼çš„æŒ‡å—ï¼š</strong></p>
<ol>
<li><p><strong>Pass-by-valueé€‚ç”¨äºï¼š</strong></p>
<ul>
<li>å†…ç½®ç±»å‹ï¼ˆint, double, boolç­‰ï¼‰</li>
<li>æšä¸¾ç±»å‹</li>
<li>æŒ‡é’ˆç±»å‹</li>
<li>STLè¿­ä»£å™¨</li>
<li>å‡½æ•°å¯¹è±¡ï¼ˆé€šå¸¸ï¼‰</li>
<li>å°å‹è‡ªå®šä¹‰ç±»å‹ï¼ˆé€šå¸¸â‰¤2ä¸ªæŒ‡é’ˆå¤§å°ï¼‰</li>
</ul>
</li>
<li><p><strong>Pass-by-reference-to-consté€‚ç”¨äºï¼š</strong></p>
<ul>
<li>ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆé™¤éå¾ˆå°ï¼‰</li>
<li>STLå®¹å™¨</li>
<li>å­—ç¬¦ä¸²ç±»å‹</li>
<li>ä»»ä½•æ‹·è´å¼€é”€è¾ƒå¤§çš„ç±»å‹</li>
</ul>
</li>
<li><p><strong>Pass-by-referenceï¼ˆéconstï¼‰é€‚ç”¨äºï¼š</strong></p>
<ul>
<li>éœ€è¦ä¿®æ”¹å‚æ•°çš„æƒ…å†µ</li>
<li>è¾“å‡ºå‚æ•°</li>
</ul>
</li>
</ol>
<p><strong>ç°ä»£C++æ‰©å±•ï¼š</strong></p>
<ul>
<li><strong>å³å€¼å¼•ç”¨</strong>ï¼šæ”¯æŒç§»åŠ¨è¯­ä¹‰</li>
<li><strong>å®Œç¾è½¬å‘</strong>ï¼šæ¨¡æ¿å‡½æ•°çš„é€šç”¨è§£å†³æ–¹æ¡ˆ</li>
<li><strong>ç»“æ„åŒ–ç»‘å®š</strong>ï¼šç®€åŒ–å¤šè¿”å›å€¼</li>
</ul>
<p><strong>æ€§èƒ½è€ƒè™‘ï¼š</strong></p>
<ul>
<li><strong>æµ‹é‡ä¼˜äºçŒœæµ‹</strong>ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·</li>
<li><strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong>ï¼šç°ä»£ç¼–è¯‘å™¨å¾ˆèªæ˜ï¼Œä½†åŸºæœ¬åŸåˆ™ä»ç„¶é‡è¦</li>
<li><strong>ç¼“å­˜å‹å¥½æ€§</strong>ï¼šå¼•ç”¨ä¼ é€’é€šå¸¸æ›´ç¼“å­˜å‹å¥½</li>
</ul>
<p><strong>è®°ä½ï¼šå°½é‡ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-valueã€‚å‰è€…é€šå¸¸æ¯”è¾ƒé«˜æ•ˆï¼Œå¹¶å¯é¿å…åˆ‡å‰²é—®é¢˜ã€‚ä½†è¿™ä¸ªè§„åˆ™å¹¶ä¸é€‚ç”¨äºå†…ç½®ç±»å‹ã€ä»¥åŠSTLçš„è¿­ä»£å™¨å’Œå‡½æ•°å¯¹è±¡ï¼Œå¯¹å®ƒä»¬è€Œè¨€ï¼Œpass-by-valueå¾€å¾€æ¯”è¾ƒæ°å½“ã€‚</strong></p>
<h2 id="æ¡æ¬¾21ï¼š-å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶-reference"><a href="#æ¡æ¬¾21ï¼š-å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶-reference" class="headerlink" title="æ¡æ¬¾21ï¼š å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶ reference"></a>æ¡æ¬¾21ï¼š å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶ reference</h2><blockquote>
<p><em>Donâ€™t try to return a reference when you must return an object</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-20"><a href="#æ ¸å¿ƒç†å¿µ-20" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ç»ä¸è¦è¿”å›pointeræˆ–referenceæŒ‡å‘ä¸€ä¸ªlocal stackå¯¹è±¡ï¼Œæˆ–è¿”å›referenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡</strong>ã€‚å½“å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œå°±è®©å®ƒè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¸è¦è¯•å›¾é€šè¿‡è¿”å›å¼•ç”¨æ¥é¿å…å¯¹è±¡æ„é€ çš„æˆæœ¬ã€‚è™½ç„¶è¿”å›å¼•ç”¨çœ‹èµ·æ¥æ›´é«˜æ•ˆï¼Œä½†å¦‚æœå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¸å­˜åœ¨æˆ–ç®¡ç†ä¸å½“ï¼Œä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºæˆ–å†…å­˜æ³„æ¼ã€‚</p>
<h3 id="æ·±åº¦è§£æ-20"><a href="#æ·±åº¦è§£æ-20" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-è¿”å›å±€éƒ¨å¯¹è±¡å¼•ç”¨çš„å±é™©æ€§"><a href="#1-è¿”å›å±€éƒ¨å¯¹è±¡å¼•ç”¨çš„å±é™©æ€§" class="headerlink" title="1. è¿”å›å±€éƒ¨å¯¹è±¡å¼•ç”¨çš„å±é™©æ€§"></a>1. <strong>è¿”å›å±€éƒ¨å¯¹è±¡å¼•ç”¨çš„å±é™©æ€§</strong></h4><p>å½“å‡½æ•°ç»“æŸæ—¶ï¼Œå±€éƒ¨å¯¹è±¡ä¼šè¢«è‡ªåŠ¨é”€æ¯ï¼Œè¿”å›çš„å¼•ç”¨å°†æŒ‡å‘ä¸€ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©ï¼šè¿”å›å±€éƒ¨å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="type">const</span> Rational&amp; <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">result</span><span class="params">(lhs.numerator() * rhs.numerator(),</span></span></span><br><span class="line"><span class="params"><span class="function">                   lhs.denominator() * rhs.denominator())</span></span>;</span><br><span class="line">    <span class="keyword">return</span> result;  <span class="comment">// è¿”å›å¯¹å±€éƒ¨å¯¹è±¡çš„å¼•ç”¨ï¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDanger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">b</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> Rational&amp; product = <span class="built_in">multiply</span>(a, b);  <span class="comment">// æœªå®šä¹‰è¡Œä¸ºï¼</span></span><br><span class="line">    std::cout &lt;&lt; product;  <span class="comment">// è®¿é—®å·²é”€æ¯çš„å¯¹è±¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šè¿”å›å¯¹è±¡æœ¬èº«</span></span><br><span class="line"><span class="function">Rational <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è¿”å›å †åˆ†é…å¯¹è±¡å¼•ç”¨çš„é—®é¢˜"><a href="#2-è¿”å›å †åˆ†é…å¯¹è±¡å¼•ç”¨çš„é—®é¢˜" class="headerlink" title="2. è¿”å›å †åˆ†é…å¯¹è±¡å¼•ç”¨çš„é—®é¢˜"></a>2. <strong>è¿”å›å †åˆ†é…å¯¹è±¡å¼•ç”¨çš„é—®é¢˜</strong></h4><p>è™½ç„¶å †å¯¹è±¡ä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼Œä½†ä¼šå¸¦æ¥å†…å­˜ç®¡ç†çš„è´Ÿæ‹…å’Œæ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é—®é¢˜ï¼šè¿”å›å †åˆ†é…å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="type">const</span> Rational&amp; <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    Rational* result = <span class="keyword">new</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">    <span class="keyword">return</span> *result;  <span class="comment">// è°æ¥åˆ é™¤è¿™ä¸ªå¯¹è±¡ï¼Ÿ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateMemoryLeak</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">b</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†…å­˜æ³„æ¼ï¼æ— æ³•çŸ¥é“ä½•æ—¶åˆ é™¤è¿”å›çš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">const</span> Rational&amp; product1 = <span class="built_in">multiply</span>(a, b);</span><br><span class="line">    <span class="type">const</span> Rational&amp; product2 = <span class="built_in">multiply</span>(a, b);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// delete &amp;product1;  // å±é™©ï¼å®¢æˆ·ç«¯ä¸åº”è¯¥è´Ÿè´£å†…å­˜ç®¡ç†</span></span><br><span class="line">    <span class="comment">// delete &amp;product2;  // è€Œä¸”å¾ˆå®¹æ˜“å¿˜è®°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šè¿”å›å¯¹è±¡æœ¬èº«ï¼Œè®©ç¼–è¯‘å™¨ä¼˜åŒ–</span></span><br><span class="line"><span class="function">Rational <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-é™æ€å¯¹è±¡çš„å±€é™æ€§"><a href="#3-é™æ€å¯¹è±¡çš„å±€é™æ€§" class="headerlink" title="3. é™æ€å¯¹è±¡çš„å±€é™æ€§"></a>3. <strong>é™æ€å¯¹è±¡çš„å±€é™æ€§</strong></h4><p>è™½ç„¶é™æ€å¯¹è±¡å¯ä»¥å®‰å…¨è¿”å›å¼•ç”¨ï¼Œä½†ä¼šå¯¼è‡´å¤šçº¿ç¨‹é—®é¢˜å’Œå¥‡æ€ªçš„è¡Œä¸ºã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é—®é¢˜ï¼šè¿”å›é™æ€å¯¹è±¡å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="type">const</span> Rational&amp; <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> Rational result;  <span class="comment">// é™æ€å¯¹è±¡ï¼Œå‡½æ•°ç»“æŸåä»å­˜åœ¨</span></span><br><span class="line">    result = <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                     lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStaticProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">b</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">c</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">d</span><span class="params">(<span class="number">4</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—®é¢˜ï¼šæ¯”è¾ƒæ€»æ˜¯è¿”å›trueï¼</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">multiply</span>(a, b) == <span class="built_in">multiply</span>(c, d)) &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ¡ä»¶æ€»æ˜¯æˆç«‹ï¼Œå› ä¸ºä¸¤æ¬¡è°ƒç”¨è¿”å›çš„æ˜¯åŒä¸€ä¸ªé™æ€å¯¹è±¡</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Products are equal&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ›´å±é™©</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹1: multiply(a, b)</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹2: multiply(c, d)  // å¯èƒ½è¦†ç›–çº¿ç¨‹1çš„ç»“æœ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ"><a href="#4-æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ"></a>4. <strong>æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ</strong></h4><p>ç›¸ä¿¡ç¼–è¯‘å™¨çš„ä¼˜åŒ–èƒ½åŠ›ï¼Œç›´æ¥è¿”å›å¯¹è±¡ã€‚ç°ä»£ç¼–è¯‘å™¨ä¼šåº”ç”¨RVOï¼ˆè¿”å›å€¼ä¼˜åŒ–ï¼‰æ¥æ¶ˆé™¤ä¸å¿…è¦çš„æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®çš„è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line">    Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(numerator_ * rhs.numerator_,</span><br><span class="line">                       denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Rational <span class="keyword">operator</span>+(<span class="type">const</span> Rational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(numerator_ * rhs.denominator_ + rhs.numerator_ * denominator_,</span><br><span class="line">                       denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Rational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> numerator_ * rhs.denominator_ == rhs.numerator_ * denominator_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜å‡½æ•°ç‰ˆæœ¬ä¹Ÿæ˜¯å¦‚æ­¤</span></span><br><span class="line"><span class="function">Rational <span class="title">multiply</span><span class="params">(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateCorrectUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">a</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">b</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">c</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">d</span><span class="params">(<span class="number">4</span>, <span class="number">5</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¼˜åŒ–ï¼šé€šå¸¸ä¸ä¼šæœ‰é¢å¤–çš„æ‹·è´</span></span><br><span class="line">    Rational product1 = a * b;        <span class="comment">// ä½¿ç”¨æˆå‘˜å‡½æ•°</span></span><br><span class="line">    Rational product2 = <span class="built_in">multiply</span>(c, d);  <span class="comment">// ä½¿ç”¨éæˆå‘˜å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­£ç¡®çš„æ¯”è¾ƒç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> (product1 == product2) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Products are equal&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Products are different&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-ç°ä»£C-çš„è¿›ä¸€æ­¥ä¼˜åŒ–"><a href="#5-ç°ä»£C-çš„è¿›ä¸€æ­¥ä¼˜åŒ–" class="headerlink" title="5. ç°ä»£C++çš„è¿›ä¸€æ­¥ä¼˜åŒ–"></a>5. <strong>ç°ä»£C++çš„è¿›ä¸€æ­¥ä¼˜åŒ–</strong></h4><p>ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘å¯ä»¥è¿›ä¸€æ­¥å‡å°‘ä¸å¿…è¦çš„æ‹·è´ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernRational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernRational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernRational</span>(ModernRational&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">numerator_</span>(other.numerator_), <span class="built_in">denominator_</span>(other.denominator_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernRational&amp; <span class="keyword">operator</span>=(ModernRational&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        numerator_ = other.numerator_;</span><br><span class="line">        denominator_ = other.denominator_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›å€¼ä¼˜åŒ– + ç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">    ModernRational <span class="keyword">operator</span>*(<span class="type">const</span> ModernRational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ModernRational</span>(numerator_ * rhs.numerator_,</span><br><span class="line">                             denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨autoå’Œåˆå§‹åŒ–åˆ—è¡¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateModernUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> a = ModernRational&#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> b = ModernRational&#123;<span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> product = a * b;  <span class="comment">// é«˜æ•ˆï¼šRVO + ç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é“¾å¼æ“ä½œä¹Ÿå¾ˆé«˜æ•ˆ</span></span><br><span class="line">    <span class="keyword">auto</span> result = ModernRational&#123;<span class="number">1</span>, <span class="number">2</span>&#125; * ModernRational&#123;<span class="number">3</span>, <span class="number">4</span>&#125; * ModernRational&#123;<span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-17"><a href="#æ€»ç»“-17" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ol>
<li><strong>å®‰å…¨ç¬¬ä¸€</strong>ï¼šä¸è¿”å›æŒ‡å‘å±€éƒ¨å¯¹è±¡çš„å¼•ç”¨</li>
<li><strong>æ˜ç¡®è´£ä»»</strong>ï¼šä¸è®©å®¢æˆ·ç«¯ç®¡ç†å†…å­˜</li>
<li><strong>é¿å…å…±äº«çŠ¶æ€</strong>ï¼šä¸ä½¿ç”¨é™æ€å¯¹è±¡çš„å¼•ç”¨</li>
<li><strong>ç›¸ä¿¡ç¼–è¯‘å™¨</strong>ï¼šç°ä»£ç¼–è¯‘å™¨çš„ä¼˜åŒ–èƒ½åŠ›å¾ˆå¼º</li>
</ol>
<p><strong>è¿”å›ç­–ç•¥é€‰æ‹©ï¼š</strong></p>
<ul>
<li><strong>è¿”å›å¯¹è±¡æœ¬èº«</strong>ï¼šæœ€å®‰å…¨ã€æœ€æ¸…æ™°çš„é€‰æ‹©</li>
<li><strong>è¿”å›æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼šéœ€è¦å…±äº«æ‰€æœ‰æƒæ—¶</li>
<li><strong>è¿”å›å®¹å™¨</strong>ï¼šéœ€è¦è¿”å›å¤šä¸ªå¯¹è±¡æ—¶</li>
<li><strong>ä½¿ç”¨è¾“å‡ºå‚æ•°</strong>ï¼šæå°‘æ•°æ€§èƒ½å…³é”®åœºæ™¯</li>
</ul>
<p><strong>è®°ä½ï¼šå½“å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œå°±è®©å®ƒè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ã€‚ä¸è¦è¯•å›¾è¿”å›referenceæŒ‡å‘æŸä¸ªlocal stackå¯¹è±¡ï¼Œæˆ–è¿”å›referenceæŒ‡å‘ä¸€ä¸ªheap-allocatedå¯¹è±¡ï¼Œæˆ–è¿”å›referenceæŒ‡å‘ä¸€ä¸ªlocal staticå¯¹è±¡è€Œæœ‰å¯èƒ½åŒæ—¶éœ€è¦å¤šä¸ªè¿™æ ·çš„å¯¹è±¡ã€‚æ¡æ¬¾4å·²ç»ä¸ºâ€åœ¨æŸäº›å•çº¿ç¨‹ç¯å¢ƒä¸­åˆç†è¿”å›referenceæŒ‡å‘ä¸€ä¸ªlocal staticå¯¹è±¡â€æä¾›äº†ä¸€ä»½è®¾è®¡å®ä¾‹ã€‚</strong></p>
<h2 id="æ¡æ¬¾22ï¼š-å°†æˆå‘˜å˜é‡å£°æ˜ä¸º-private"><a href="#æ¡æ¬¾22ï¼š-å°†æˆå‘˜å˜é‡å£°æ˜ä¸º-private" class="headerlink" title="æ¡æ¬¾22ï¼š å°†æˆå‘˜å˜é‡å£°æ˜ä¸º private"></a>æ¡æ¬¾22ï¼š å°†æˆå‘˜å˜é‡å£°æ˜ä¸º private</h2><blockquote>
<p><em>Declare data members private</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-21"><a href="#æ ¸å¿ƒç†å¿µ-21" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>åˆ‡è®°å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</strong>ã€‚è¿™å¯èµ‹äºˆå®¢æˆ·è®¿é—®æ•°æ®çš„ä¸€è‡´æ€§ã€å¯ç»†å¾®åˆ’åˆ†è®¿é—®æ§åˆ¶ã€å…è¯ºçº¦æŸæ¡ä»¶è·å¾—ä¿è¯ï¼Œå¹¶æä¾›classä½œè€…ä»¥å……åˆ†çš„å®ç°å¼¹æ€§ã€‚ä»å°è£…çš„è§’åº¦çœ‹ï¼Œåªæœ‰ä¸¤ç§è®¿é—®æƒé™ï¼šprivateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆä¸æä¾›å°è£…ï¼‰ã€‚protectedå¹¶ä¸æ¯”publicæ›´å…·æœ‰å°è£…æ€§ã€‚</p>
<h3 id="æ·±åº¦è§£æ-21"><a href="#æ·±åº¦è§£æ-21" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-æ•°æ®å°è£…çš„é‡è¦æ€§"><a href="#1-æ•°æ®å°è£…çš„é‡è¦æ€§" class="headerlink" title="1. æ•°æ®å°è£…çš„é‡è¦æ€§"></a>1. <strong>æ•°æ®å°è£…çš„é‡è¦æ€§</strong></h4><p>å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivateæ˜¯è‰¯å¥½å°è£…çš„åŸºç¡€ï¼Œå®ƒæä¾›äº†æ¥å£å’Œå®ç°çš„å®Œå…¨åˆ†ç¦»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸è‰¯è®¾è®¡ï¼šå…¬å¼€æ•°æ®æˆå‘˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadPoint</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">double</span> x, y;  <span class="comment">// å…¬å¼€çš„æ•°æ®æˆå‘˜</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">badUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    BadPoint p;</span><br><span class="line">    p.x = <span class="number">10.5</span>;  <span class="comment">// ç›´æ¥è®¿é—®</span></span><br><span class="line">    p.y = <span class="number">20.3</span>;  <span class="comment">// æ²¡æœ‰ä»»ä½•æ§åˆ¶</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—®é¢˜ï¼š</span></span><br><span class="line">    <span class="comment">// 1. æ— æ³•éªŒè¯æ•°æ®åˆæ³•æ€§</span></span><br><span class="line">    <span class="comment">// 2. æ— æ³•åœ¨è®¿é—®æ—¶æ‰§è¡Œé¢å¤–æ“ä½œ</span></span><br><span class="line">    <span class="comment">// 3. æ— æ³•æ”¹å˜å†…éƒ¨å®ç°</span></span><br><span class="line">    <span class="comment">// 4. æ— æ³•ç»Ÿè®¡è®¿é—®æ¬¡æ•°æˆ–è°ƒè¯•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è‰¯å¥½è®¾è®¡ï¼šç§æœ‰æ•°æ®æˆå‘˜ + å…¬å¼€æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodPoint</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> x_, y_;  <span class="comment">// ç§æœ‰æ•°æ®æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°æä¾›åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">GoodPoint</span>(<span class="type">double</span> x = <span class="number">0.0</span>, <span class="type">double</span> y = <span class="number">0.0</span>) : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›å—æ§è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">x</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">y</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; </span><br><span class="line">        <span class="comment">// å¯ä»¥æ·»åŠ éªŒè¯é€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> (std::<span class="built_in">isfinite</span>(x)) &#123;</span><br><span class="line">            x_ = x; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setY</span><span class="params">(<span class="type">double</span> y)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (std::<span class="built_in">isfinite</span>(y)) &#123;</span><br><span class="line">            y_ = y; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä»¥æä¾›ä¾¿åˆ©çš„ç»„åˆæ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPosition</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">setX</span>(x);</span><br><span class="line">        <span class="built_in">setY</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-è®¿é—®æ§åˆ¶çš„å¥½å¤„"><a href="#2-è®¿é—®æ§åˆ¶çš„å¥½å¤„" class="headerlink" title="2. è®¿é—®æ§åˆ¶çš„å¥½å¤„"></a>2. <strong>è®¿é—®æ§åˆ¶çš„å¥½å¤„</strong></h4><p>Privateæˆå‘˜å˜é‡é…åˆå…¬å¼€çš„è®¿é—®å‡½æ•°å¯ä»¥æä¾›ç²¾ç¡®çš„æ§åˆ¶å’ŒéªŒè¯æœºåˆ¶ã€‚</p>
<p><strong>ä¸€è‡´æ€§å’Œç²¾ç¡®æ§åˆ¶ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string accountNumber_;</span><br><span class="line">    <span class="type">double</span> balance_;</span><br><span class="line">    std::vector&lt;std::string&gt; transactionHistory_;</span><br><span class="line">    <span class="type">bool</span> isActive_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BankAccount</span>(<span class="type">const</span> std::string&amp; accountNum, <span class="type">double</span> initialBalance) </span><br><span class="line">        : <span class="built_in">accountNumber_</span>(accountNum), <span class="built_in">balance_</span>(initialBalance), <span class="built_in">isActive_</span>(<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… åªè¯»è®¿é—®ï¼šä¸€è‡´çš„æ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getAccountNumber</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> accountNumber_; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getBalance</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> balance_; &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isActive</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> isActive_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å—æ§çš„å†™è®¿é—®ï¼šå¯ä»¥æ·»åŠ ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">deposit</span><span class="params">(<span class="type">double</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isActive_ || amount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// éªŒè¯å¤±è´¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        balance_ += amount;</span><br><span class="line">        transactionHistory_.<span class="built_in">push_back</span>(<span class="string">&quot;Deposit: $&quot;</span> + std::<span class="built_in">to_string</span>(amount));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">withdraw</span><span class="params">(<span class="type">double</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isActive_ || amount &lt;= <span class="number">0</span> || amount &gt; balance_) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// éªŒè¯å¤±è´¥</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        balance_ -= amount;</span><br><span class="line">        transactionHistory_.<span class="built_in">push_back</span>(<span class="string">&quot;Withdrawal: $&quot;</span> + std::<span class="built_in">to_string</span>(amount));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deactivateAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        isActive_ = <span class="literal">false</span>;</span><br><span class="line">        transactionHistory_.<span class="built_in">push_back</span>(<span class="string">&quot;Account deactivated&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç»„åˆæ“ä½œï¼šæä¾›æ›´é«˜çº§çš„åŠŸèƒ½</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">transfer</span><span class="params">(BankAccount&amp; toAccount, <span class="type">double</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">withdraw</span>(amount)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (toAccount.<span class="built_in">deposit</span>(amount)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å›æ»šæ“ä½œ</span></span><br><span class="line">                <span class="built_in">deposit</span>(amount);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°å¼¹æ€§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‰ˆæœ¬1ï¼šç®€å•å®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Temperature</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> celsius_;  <span class="comment">// å†…éƒ¨ä»¥æ‘„æ°åº¦å­˜å‚¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Temperature</span>(<span class="type">double</span> celsius) : <span class="built_in">celsius_</span>(celsius) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">celsius</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> celsius_; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">fahrenheit</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> celsius_ * <span class="number">9.0</span> / <span class="number">5.0</span> + <span class="number">32.0</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCelsius</span><span class="params">(<span class="type">double</span> c)</span> </span>&#123; celsius_ = c; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setFahrenheit</span><span class="params">(<span class="type">double</span> f)</span> </span>&#123; celsius_ = (f - <span class="number">32.0</span>) * <span class="number">5.0</span> / <span class="number">9.0</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰ˆæœ¬2ï¼šä¼˜åŒ–å®ç°ï¼ˆå†…éƒ¨è¡¨ç¤ºæ”¹å˜ï¼Œæ¥å£ä¸å˜ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Temperature</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> kelvin_;  <span class="comment">// æ”¹ä¸ºä»¥å¼€å°”æ–‡å­˜å‚¨ï¼Œæ›´é€‚åˆç§‘å­¦è®¡ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Temperature</span>(<span class="type">double</span> celsius) : <span class="built_in">kelvin_</span>(celsius + <span class="number">273.15</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¥å£ä¿æŒä¸å˜ï¼</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">celsius</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> kelvin_ - <span class="number">273.15</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">fahrenheit</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> (kelvin_ - <span class="number">273.15</span>) * <span class="number">9.0</span> / <span class="number">5.0</span> + <span class="number">32.0</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCelsius</span><span class="params">(<span class="type">double</span> c)</span> </span>&#123; kelvin_ = c + <span class="number">273.15</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setFahrenheit</span><span class="params">(<span class="type">double</span> f)</span> </span>&#123; kelvin_ = (f - <span class="number">32.0</span>) * <span class="number">5.0</span> / <span class="number">9.0</span> + <span class="number">273.15</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–°å¢åŠŸèƒ½ï¼šå¯ä»¥ç›´æ¥è·å–å¼€å°”æ–‡æ¸©åº¦</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">kelvin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> kelvin_; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setKelvin</span><span class="params">(<span class="type">double</span> k)</span> </span>&#123; kelvin_ = k; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-protectedçš„å°è£…æ€§é—®é¢˜"><a href="#3-protectedçš„å°è£…æ€§é—®é¢˜" class="headerlink" title="3. protectedçš„å°è£…æ€§é—®é¢˜"></a>3. <strong>protectedçš„å°è£…æ€§é—®é¢˜</strong></h4><p>Protectedæˆå‘˜å˜é‡åœ¨å°è£…æ€§ä¸Šä¸publicæˆå‘˜å˜é‡æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œéƒ½ä¼šç ´åå°è£…ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä½¿ç”¨protectedæ•°æ®æˆå‘˜çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">double</span> area_;  <span class="comment">// protectedæ•°æ®æˆå‘˜</span></span><br><span class="line">    std::string color_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Shape</span>(<span class="type">const</span> std::string&amp; color) : <span class="built_in">area_</span>(<span class="number">0.0</span>), <span class="built_in">color_</span>(color) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getArea</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> area_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getColor</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> color_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>(<span class="type">double</span> width, <span class="type">double</span> height, <span class="type">const</span> std::string&amp; color) </span><br><span class="line">        : <span class="built_in">Shape</span>(color), <span class="built_in">width_</span>(width), <span class="built_in">height_</span>(height) &#123;</span><br><span class="line">        area_ = width_ * height_;  <span class="comment">// ç›´æ¥è®¿é—®åŸºç±»çš„protectedæˆå‘˜</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">double</span> width, <span class="type">double</span> height)</span> </span>&#123;</span><br><span class="line">        width_ = width;</span><br><span class="line">        height_ = height;</span><br><span class="line">        area_ = width_ * height_;  <span class="comment">// å¿…é¡»è®°ä½æ›´æ–°area_</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> width_, height_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šå¦‚æœShapeç±»çš„å®ç°æ”¹å˜ï¼ˆæ¯”å¦‚area_æ”¹ä¸ºæŒ‰éœ€è®¡ç®—ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">// æ‰€æœ‰æ´¾ç”Ÿç±»éƒ½éœ€è¦ä¿®æ”¹ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ›´å¥½çš„è®¾è®¡ï¼šprivateæ•°æ® + protectedæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BetterShape</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string color_;  <span class="comment">// privateæ•°æ®æˆå‘˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// protectedæˆå‘˜å‡½æ•°ï¼Œè€Œä¸æ˜¯æ•°æ®æˆå‘˜</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setColor</span><span class="params">(<span class="type">const</span> std::string&amp; color)</span> </span>&#123; color_ = color; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BetterShape</span>(<span class="type">const</span> std::string&amp; color) : <span class="built_in">color_</span>(color) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">BetterShape</span>() = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">getArea</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// çº¯è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getColor</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> color_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BetterRectangle</span> : <span class="keyword">public</span> BetterShape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BetterRectangle</span>(<span class="type">double</span> width, <span class="type">double</span> height, <span class="type">const</span> std::string&amp; color) </span><br><span class="line">        : <span class="built_in">BetterShape</span>(color), <span class="built_in">width_</span>(width), <span class="built_in">height_</span>(height) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getArea</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> width_ * height_;  <span class="comment">// æŒ‰éœ€è®¡ç®—ï¼Œä¸éœ€è¦å­˜å‚¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">double</span> width, <span class="type">double</span> height)</span> </span>&#123;</span><br><span class="line">        width_ = width;</span><br><span class="line">        height_ = height;</span><br><span class="line">        <span class="comment">// ä¸éœ€è¦æ›´æ–°area_ï¼Œå› ä¸ºå®ƒæ˜¯è®¡ç®—å¾—å‡ºçš„</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> width_, height_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨"><a href="#4-è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨" class="headerlink" title="4. è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨"></a>4. <strong>è®¾è®¡æ¨¡å¼ä¸­çš„åº”ç”¨</strong></h4><p>Privateæ•°æ®æˆå‘˜åœ¨å„ç§è®¾è®¡æ¨¡å¼ä¸­éƒ½å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p>
<p><strong>RAIIæ¨¡å¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;  <span class="comment">// privateèµ„æº</span></span><br><span class="line">    std::string filename_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">FileHandle</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span> </span></span><br><span class="line"><span class="function">        : filename_(filename), file_(nullptr) &#123;</span></span><br><span class="line">        file_ = <span class="built_in">fopen</span>(filename.<span class="built_in">c_str</span>(), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file_) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Failed to open file: &quot;</span> + filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">FileHandle</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) &#123;</span><br><span class="line">            <span class="built_in">fclose</span>(file_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤æ‹·è´æ„é€ å’Œèµ‹å€¼ï¼ˆæˆ–å®ç°æ·±æ‹·è´ï¼‰</span></span><br><span class="line">    <span class="built_in">FileHandle</span>(<span class="type">const</span> FileHandle&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    FileHandle&amp; <span class="keyword">operator</span>=(<span class="type">const</span> FileHandle&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨è¯­ä¹‰</span></span><br><span class="line">    <span class="built_in">FileHandle</span>(FileHandle&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">file_</span>(other.file_), <span class="built_in">filename_</span>(std::<span class="built_in">move</span>(other.filename_)) &#123;</span><br><span class="line">        other.file_ = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    FileHandle&amp; <span class="keyword">operator</span>=(FileHandle&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file_) <span class="built_in">fclose</span>(file_);</span><br><span class="line">            file_ = other.file_;</span><br><span class="line">            filename_ = std::<span class="built_in">move</span>(other.filename_);</span><br><span class="line">            other.file_ = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›å—æ§è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isOpen</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> file_ != <span class="literal">nullptr</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getFilename</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> filename_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">readLine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!file_) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;File not open&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), file_)) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">string</span>(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Observer*&gt; observers_;  <span class="comment">// privateè§‚å¯Ÿè€…åˆ—è¡¨</span></span><br><span class="line">    <span class="type">int</span> state_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addObserver</span><span class="params">(Observer* observer)</span> </span>&#123;</span><br><span class="line">        observers_.<span class="built_in">push_back</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">removeObserver</span><span class="params">(Observer* observer)</span> </span>&#123;</span><br><span class="line">        observers_.<span class="built_in">erase</span>(</span><br><span class="line">            std::<span class="built_in">remove</span>(observers_.<span class="built_in">begin</span>(), observers_.<span class="built_in">end</span>(), observer),</span><br><span class="line">            observers_.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setState</span><span class="params">(<span class="type">int</span> newState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state_ != newState) &#123;</span><br><span class="line">            state_ = newState;</span><br><span class="line">            <span class="built_in">notifyObservers</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getState</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> state_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>* observer : observers_) &#123;</span><br><span class="line">            observer-&gt;<span class="built_in">update</span>(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-ç°ä»£C-çš„æœ€ä½³å®è·µ"><a href="#5-ç°ä»£C-çš„æœ€ä½³å®è·µ" class="headerlink" title="5. ç°ä»£C++çš„æœ€ä½³å®è·µ"></a>5. <strong>ç°ä»£C++çš„æœ€ä½³å®è·µ</strong></h4><p>ç»“åˆç°ä»£C++ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥æå‡privateæ•°æ®æˆå‘˜çš„ä½¿ç”¨æ•ˆæœã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernString</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::unique_ptr&lt;<span class="type">char</span>[]&gt; data_;  <span class="comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å†…å­˜</span></span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line">    <span class="type">size_t</span> capacity_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ModernString</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str = <span class="string">&quot;&quot;</span>)</span> </span>&#123;</span><br><span class="line">        size_ = <span class="built_in">strlen</span>(str);</span><br><span class="line">        capacity_ = size_ + <span class="number">1</span>;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">char</span>[]&gt;(capacity_);</span><br><span class="line">        <span class="built_in">strcpy</span>(data_.<span class="built_in">get</span>(), str);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernString</span>(<span class="type">const</span> ModernString&amp; other) </span><br><span class="line">        : <span class="built_in">size_</span>(other.size_), <span class="built_in">capacity_</span>(other.capacity_) &#123;</span><br><span class="line">        data_ = std::<span class="built_in">make_unique</span>&lt;<span class="type">char</span>[]&gt;(capacity_);</span><br><span class="line">        <span class="built_in">strcpy</span>(data_.<span class="built_in">get</span>(), other.data_.<span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernString</span>(ModernString&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">data_</span>(std::<span class="built_in">move</span>(other.data_)), <span class="built_in">size_</span>(other.size_), <span class="built_in">capacity_</span>(other.capacity_) &#123;</span><br><span class="line">        other.size_ = <span class="number">0</span>;</span><br><span class="line">        other.capacity_ = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernString&amp; <span class="keyword">operator</span>=(ModernString other) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(other);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›constå’Œnon-constç‰ˆæœ¬çš„è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">c_str</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">get</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_ == <span class="number">0</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ”¯æŒèŒƒå›´forå¾ªç¯</span></span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">get</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">get</span>() + size_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">begin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">get</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">end</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">get</span>() + size_; &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(ModernString&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> std::swap;</span><br><span class="line">        <span class="built_in">swap</span>(data_, other.data_);</span><br><span class="line">        <span class="built_in">swap</span>(size_, other.size_);</span><br><span class="line">        <span class="built_in">swap</span>(capacity_, other.capacity_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-18"><a href="#æ€»ç»“-18" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>Privateæ•°æ®æˆå‘˜çš„ä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li><strong>å°è£…æ€§</strong>ï¼šéšè—å®ç°ç»†èŠ‚ï¼Œä¿æŠ¤æ•°æ®å®Œæ•´æ€§</li>
<li><strong>çµæ´»æ€§</strong>ï¼šå¯ä»¥æ”¹å˜å†…éƒ¨å®ç°è€Œä¸å½±å“å®¢æˆ·ä»£ç </li>
<li><strong>æ§åˆ¶æ€§</strong>ï¼šå¯ä»¥æ·»åŠ éªŒè¯ã€æ—¥å¿—ã€ç»Ÿè®¡ç­‰åŠŸèƒ½</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šé€šè¿‡å‡½æ•°æ¥å£æä¾›ç»Ÿä¸€çš„è®¿é—®æ–¹å¼</li>
</ol>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æ•°æ®æˆå‘˜å§‹ç»ˆprivate</strong>ï¼šé™¤äº†æå°‘æ•°ä¾‹å¤–æƒ…å†µ</li>
<li><strong>é€šè¿‡å‡½æ•°æä¾›è®¿é—®</strong>ï¼šgetter&#x2F;setteræˆ–æ›´é«˜çº§çš„æ¥å£</li>
<li><strong>éªŒè¯è¾“å…¥æ•°æ®</strong>ï¼šåœ¨setterä¸­æ·»åŠ åˆç†æ€§æ£€æŸ¥</li>
<li><strong>è€ƒè™‘ä¸å˜é‡</strong>ï¼šç¡®ä¿å¯¹è±¡å§‹ç»ˆå¤„äºæœ‰æ•ˆçŠ¶æ€</li>
</ul>
<p><strong>é¿å…çš„é™·é˜±ï¼š</strong></p>
<ul>
<li><strong>ä¸è¦ä½¿ç”¨publicæ•°æ®æˆå‘˜</strong>ï¼šç ´åå°è£…æ€§</li>
<li><strong>ä¸è¦ä½¿ç”¨protectedæ•°æ®æˆå‘˜</strong>ï¼šåŒæ ·ç ´åå°è£…æ€§</li>
<li><strong>ä¸è¦è¿‡åº¦è®¾è®¡</strong>ï¼šç®€å•çš„æ•°æ®ç±»å¯ä»¥è€ƒè™‘struct</li>
</ul>
<p><strong>è®°ä½ï¼šåˆ‡è®°å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivateã€‚è¿™å¯èµ‹äºˆå®¢æˆ·è®¿é—®æ•°æ®çš„ä¸€è‡´æ€§ã€å¯ç»†å¾®åˆ’åˆ†è®¿é—®æ§åˆ¶ã€å…è¯ºçº¦æŸæ¡ä»¶è·å¾—ä¿è¯ï¼Œå¹¶æä¾›classä½œè€…ä»¥å……åˆ†çš„å®ç°å¼¹æ€§ã€‚protectedå¹¶ä¸æ¯”publicæ›´å…·å°è£…æ€§ã€‚</strong></p>
<h2 id="æ¡æ¬¾23ï¼š-å®ä»¥non-memberã€non-friendæ›¿member-å‡½æ•°ã€‚"><a href="#æ¡æ¬¾23ï¼š-å®ä»¥non-memberã€non-friendæ›¿member-å‡½æ•°ã€‚" class="headerlink" title="æ¡æ¬¾23ï¼š å®ä»¥non-memberã€non-friendæ›¿member å‡½æ•°ã€‚"></a>æ¡æ¬¾23ï¼š å®ä»¥non-memberã€non-friendæ›¿member å‡½æ•°ã€‚</h2><blockquote>
<p><em>Prefer non-member non-friend functions to member functions</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-22"><a href="#æ ¸å¿ƒç†å¿µ-22" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>éæˆå‘˜éå‹å…ƒå‡½æ•°æ¯”æˆå‘˜å‡½æ•°æä¾›æ›´å¥½çš„å°è£…æ€§</strong>ã€‚è¿™å¬èµ·æ¥å¯èƒ½è¿èƒŒç›´è§‰ï¼Œä½†ä»å°è£…çš„æœ¬è´¨æ¥çœ‹ï¼šå°è£…æ„å‘³ç€ä¸è¢«çœ‹åˆ°ï¼Œè€Œèƒ½å¤Ÿè®¿é—®ç±»ç§æœ‰æˆå‘˜çš„å‡½æ•°è¶Šå°‘ï¼Œå°è£…æ€§å°±è¶Šå¥½ã€‚éæˆå‘˜éå‹å…ƒå‡½æ•°æ— æ³•è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜ï¼Œå› æ­¤ä¸ä¼šå¢åŠ â€èƒ½å¤Ÿè®¿é—®ç§æœ‰æ•°æ®çš„å‡½æ•°æ•°é‡â€ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„å°è£…æ€§ã€åŒ…è£…å¼¹æ€§å’ŒåŠŸèƒ½æ‰©å±•æ€§ã€‚</p>
<h3 id="æ·±åº¦è§£æ-22"><a href="#æ·±åº¦è§£æ-22" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å°è£…æ€§çš„çœŸæ­£å«ä¹‰"><a href="#1-å°è£…æ€§çš„çœŸæ­£å«ä¹‰" class="headerlink" title="1. å°è£…æ€§çš„çœŸæ­£å«ä¹‰"></a>1. <strong>å°è£…æ€§çš„çœŸæ­£å«ä¹‰</strong></h4><p><strong>å°è£…æ€§çš„é‡åŒ–æ ‡å‡†ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WebBrowser</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string bookmarks_;</span><br><span class="line">    std::string history_;</span><br><span class="line">    std::string cookies_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// åŸºæœ¬æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearHistory</span><span class="params">()</span> </span>&#123; history_.<span class="built_in">clear</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBookmarks</span><span class="params">()</span> </span>&#123; bookmarks_.<span class="built_in">clear</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearCookies</span><span class="params">()</span> </span>&#123; cookies_.<span class="built_in">clear</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ æˆå‘˜å‡½æ•°ç‰ˆæœ¬ï¼šèƒ½è®¿é—®æ‰€æœ‰ç§æœ‰æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearEverything</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">clearHistory</span>();</span><br><span class="line">        <span class="built_in">clearBookmarks</span>(); </span><br><span class="line">        <span class="built_in">clearCookies</span>();</span><br><span class="line">        <span class="comment">// è¿˜å¯ä»¥ç›´æ¥è®¿é—® bookmarks_, history_, cookies_</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜éå‹å…ƒå‡½æ•°ç‰ˆæœ¬ï¼šæ— æ³•è®¿é—®ç§æœ‰æ•°æ®</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clearBrowser</span><span class="params">(WebBrowser&amp; wb)</span> </span>&#123;</span><br><span class="line">    wb.<span class="built_in">clearHistory</span>();</span><br><span class="line">    wb.<span class="built_in">clearBookmarks</span>();</span><br><span class="line">    wb.<span class="built_in">clearCookies</span>();</span><br><span class="line">    <span class="comment">// æ— æ³•è®¿é—®ç§æœ‰æˆå‘˜ï¼Œå°è£…æ€§æ›´å¥½</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateEncapsulation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WebBrowser browser;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸¤ç§è°ƒç”¨æ–¹å¼åŠŸèƒ½ç›¸åŒ</span></span><br><span class="line">    browser.<span class="built_in">clearEverything</span>();  <span class="comment">// æˆå‘˜å‡½æ•°</span></span><br><span class="line">    <span class="built_in">clearBrowser</span>(browser);      <span class="comment">// éæˆå‘˜å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½†å°è£…æ€§ä¸åŒï¼š</span></span><br><span class="line">    <span class="comment">// - æˆå‘˜å‡½æ•°èƒ½è®¿é—®3ä¸ªç§æœ‰å˜é‡</span></span><br><span class="line">    <span class="comment">// - éæˆå‘˜å‡½æ•°èƒ½è®¿é—®0ä¸ªç§æœ‰å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å°è£…æ€§çš„æ•°å­¦è¯æ˜ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataContainer</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;     <span class="comment">// ç§æœ‰æ•°æ®1</span></span><br><span class="line">    std::string metadata_;      <span class="comment">// ç§æœ‰æ•°æ®2</span></span><br><span class="line">    <span class="type">bool</span> modified_;             <span class="comment">// ç§æœ‰æ•°æ®3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å¿…éœ€çš„è®¿é—®å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addData</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123; data_.<span class="built_in">push_back</span>(value); modified_ = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMetadata</span><span class="params">(<span class="type">const</span> std::string&amp; meta)</span> </span>&#123; metadata_ = meta; &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isModified</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> modified_; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">size</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âŒ æˆå‘˜å‡½æ•°ï¼šå¢åŠ äº†èƒ½è®¿é—®ç§æœ‰æ•°æ®çš„å‡½æ•°æ•°é‡</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printSummary</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Data size: &quot;</span> &lt;&lt; data_.<span class="built_in">size</span>() </span><br><span class="line">                  &lt;&lt; <span class="string">&quot;, Metadata: &quot;</span> &lt;&lt; metadata_</span><br><span class="line">                  &lt;&lt; <span class="string">&quot;, Modified: &quot;</span> &lt;&lt; modified_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜å‡½æ•°ï¼šä¸å¢åŠ èƒ½è®¿é—®ç§æœ‰æ•°æ®çš„å‡½æ•°æ•°é‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printDataSummary</span><span class="params">(<span class="type">const</span> DataContainer&amp; container)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Data size: &quot;</span> &lt;&lt; container.<span class="built_in">size</span>()</span><br><span class="line">              &lt;&lt; <span class="string">&quot;, Modified: &quot;</span> &lt;&lt; container.<span class="built_in">isModified</span>() &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…æ€§åˆ†æï¼š</span></span><br><span class="line"><span class="comment">// - æœ‰æˆå‘˜å‡½æ•°ç‰ˆæœ¬ï¼š5ä¸ªå‡½æ•°èƒ½è®¿é—®ç§æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬printSummaryï¼‰</span></span><br><span class="line"><span class="comment">// - æœ‰éæˆå‘˜å‡½æ•°ç‰ˆæœ¬ï¼š4ä¸ªå‡½æ•°èƒ½è®¿é—®ç§æœ‰æ•°æ®ï¼ˆä¸åŒ…æ‹¬printDataSummaryï¼‰</span></span><br><span class="line"><span class="comment">// ç»“è®ºï¼šéæˆå‘˜å‡½æ•°ç‰ˆæœ¬å°è£…æ€§æ›´å¥½</span></span><br></pre></td></tr></table></figure>

<h4 id="2-åŒ…è£…å¼¹æ€§ï¼ˆPackaging-Flexibilityï¼‰"><a href="#2-åŒ…è£…å¼¹æ€§ï¼ˆPackaging-Flexibilityï¼‰" class="headerlink" title="2. åŒ…è£…å¼¹æ€§ï¼ˆPackaging Flexibilityï¼‰"></a>2. <strong>åŒ…è£…å¼¹æ€§ï¼ˆPackaging Flexibilityï¼‰</strong></h4><p><strong>å¤´æ–‡ä»¶ç»„ç»‡çš„çµæ´»æ€§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webbrowser.h - æ ¸å¿ƒç±»å®šä¹‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WebBrowser</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string bookmarks_;</span><br><span class="line">    std::string history_;</span><br><span class="line">    std::string cookies_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearHistory</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBookmarks</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearCookies</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼Œä¿æŒå¤´æ–‡ä»¶è½»é‡</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webbrowser_utils.h - ä¾¿åˆ©å‡½æ•°</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> WebBrowserUtils &#123;</span><br><span class="line">    <span class="comment">// âœ… åŸºæœ¬æ¸…ç†å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBrowser</span><span class="params">(WebBrowser&amp; wb)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… é«˜çº§æ¸…ç†å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBrowserSafely</span><span class="params">(WebBrowser&amp; wb)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBrowserWithBackup</span><span class="params">(WebBrowser&amp; wb, <span class="type">const</span> std::string&amp; backupPath)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webbrowser_bookmarks.h - ä¹¦ç­¾ç›¸å…³æ‰©å±•</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> WebBrowserBookmarks &#123;</span><br><span class="line">    <span class="comment">// âœ… ä¹¦ç­¾ç‰¹å®šæ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">exportBookmarks</span><span class="params">(<span class="type">const</span> WebBrowser&amp; wb, <span class="type">const</span> std::string&amp; filename)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">importBookmarks</span><span class="params">(WebBrowser&amp; wb, <span class="type">const</span> std::string&amp; filename)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sortBookmarks</span><span class="params">(WebBrowser&amp; wb)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webbrowser_history.h - å†å²è®°å½•ç›¸å…³æ‰©å±•  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> WebBrowserHistory &#123;</span><br><span class="line">    <span class="comment">// âœ… å†å²è®°å½•ç‰¹å®šæ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">analyzeHistory</span><span class="params">(<span class="type">const</span> WebBrowser&amp; wb)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">exportHistory</span><span class="params">(<span class="type">const</span> WebBrowser&amp; wb, <span class="type">const</span> std::string&amp; format)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯æŒ‰éœ€åŒ…å«ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®¢æˆ·ç«¯1ï¼šåªéœ€è¦åŸºæœ¬åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser_utils.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">basicUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WebBrowser browser;</span><br><span class="line">    WebBrowserUtils::<span class="built_in">clearBrowser</span>(browser);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯2ï¼šéœ€è¦ä¹¦ç­¾åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser_bookmarks.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bookmarkUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WebBrowser browser;</span><br><span class="line">    WebBrowserBookmarks::<span class="built_in">exportBookmarks</span>(browser, <span class="string">&quot;my_bookmarks.html&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯3ï¼šéœ€è¦å…¨éƒ¨åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser_utils.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser_bookmarks.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;webbrowser_history.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fullUsage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WebBrowser browser;</span><br><span class="line">    WebBrowserUtils::<span class="built_in">clearBrowserSafely</span>(browser);</span><br><span class="line">    WebBrowserBookmarks::<span class="built_in">sortBookmarks</span>(browser);</span><br><span class="line">    WebBrowserHistory::<span class="built_in">analyzeHistory</span>(browser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-åŠŸèƒ½æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰"><a href="#3-åŠŸèƒ½æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰" class="headerlink" title="3. åŠŸèƒ½æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰"></a>3. <strong>åŠŸèƒ½æ‰©å±•æ€§ï¼ˆExtensibilityï¼‰</strong></h4><p><strong>ç¬¬ä¸‰æ–¹æ‰©å±•çš„å¯èƒ½æ€§ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹ç±»ï¼ˆæ— æ³•ä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextDocument</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string content_;</span><br><span class="line">    std::string filename_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TextDocument</span>(<span class="type">const</span> std::string&amp; filename) : <span class="built_in">filename_</span>(filename) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setContent</span><span class="params">(<span class="type">const</span> std::string&amp; content)</span> </span>&#123; content_ = content; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getContent</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> content_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getFilename</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> filename_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">save</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="function">std::ofstream <span class="title">file</span><span class="params">(filename_)</span></span>;</span><br><span class="line">        file &lt;&lt; content_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç¬¬ä¸‰æ–¹å¯ä»¥æ·»åŠ éæˆå‘˜å‡½æ•°æ‰©å±•åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">namespace</span> DocumentFormatting &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addHeader</span><span class="params">(TextDocument&amp; doc, <span class="type">const</span> std::string&amp; header)</span> </span>&#123;</span><br><span class="line">        std::string content = header + <span class="string">&quot;\n&quot;</span> + doc.<span class="built_in">getContent</span>();</span><br><span class="line">        doc.<span class="built_in">setContent</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addFooter</span><span class="params">(TextDocument&amp; doc, <span class="type">const</span> std::string&amp; footer)</span> </span>&#123;</span><br><span class="line">        std::string content = doc.<span class="built_in">getContent</span>() + <span class="string">&quot;\n&quot;</span> + footer;</span><br><span class="line">        doc.<span class="built_in">setContent</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">toUpperCase</span><span class="params">(TextDocument&amp; doc)</span> </span>&#123;</span><br><span class="line">        std::string content = doc.<span class="built_in">getContent</span>();</span><br><span class="line">        std::<span class="built_in">transform</span>(content.<span class="built_in">begin</span>(), content.<span class="built_in">end</span>(), content.<span class="built_in">begin</span>(), ::toupper);</span><br><span class="line">        doc.<span class="built_in">setContent</span>(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> DocumentAnalysis &#123;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">wordCount</span><span class="params">(<span class="type">const</span> TextDocument&amp; doc)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::istringstream <span class="title">iss</span><span class="params">(doc.getContent())</span></span>;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">distance</span>(std::<span class="built_in">istream_iterator</span>&lt;std::string&gt;(iss),</span><br><span class="line">                           std::<span class="built_in">istream_iterator</span>&lt;std::string&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">lineCount</span><span class="params">(<span class="type">const</span> TextDocument&amp; doc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">count</span>(doc.<span class="built_in">getContent</span>().<span class="built_in">begin</span>(), doc.<span class="built_in">getContent</span>().<span class="built_in">end</span>(), <span class="string">&#x27;\n&#x27;</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::vector&lt;std::string&gt; <span class="title">getWords</span><span class="params">(<span class="type">const</span> TextDocument&amp; doc)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::istringstream <span class="title">iss</span><span class="params">(doc.getContent())</span></span>;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">vector</span>&lt;std::string&gt;(std::<span class="built_in">istream_iterator</span>&lt;std::string&gt;(iss),</span><br><span class="line">                                       std::<span class="built_in">istream_iterator</span>&lt;std::string&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateExtensibility</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">TextDocument <span class="title">doc</span><span class="params">(<span class="string">&quot;example.txt&quot;</span>)</span></span>;</span><br><span class="line">    doc.<span class="built_in">setContent</span>(<span class="string">&quot;Hello World\nThis is a test&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•</span></span><br><span class="line">    DocumentFormatting::<span class="built_in">addHeader</span>(doc, <span class="string">&quot;=== DOCUMENT ===&quot;</span>);</span><br><span class="line">    DocumentFormatting::<span class="built_in">addFooter</span>(doc, <span class="string">&quot;=== END ===&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Word count: &quot;</span> &lt;&lt; DocumentAnalysis::<span class="built_in">wordCount</span>(doc) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Line count: &quot;</span> &lt;&lt; DocumentAnalysis::<span class="built_in">lineCount</span>(doc) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-ç°ä»£C-ä¸­çš„åº”ç”¨"><a href="#4-ç°ä»£C-ä¸­çš„åº”ç”¨" class="headerlink" title="4. ç°ä»£C++ä¸­çš„åº”ç”¨"></a>4. <strong>ç°ä»£C++ä¸­çš„åº”ç”¨</strong></h4><p><strong>STLç®—æ³•çš„è®¾è®¡å“²å­¦ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;numeric&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSTLPhilosophy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ å¦‚æœSTLæ˜¯é¢å‘å¯¹è±¡è®¾è®¡ï¼ˆå‡æƒ³ï¼‰</span></span><br><span class="line">    <span class="comment">// numbers.sort();</span></span><br><span class="line">    <span class="comment">// numbers.reverse();</span></span><br><span class="line">    <span class="comment">// int sum = numbers.accumulate();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å®é™…çš„STLè®¾è®¡ï¼šéæˆå‘˜å‡½æ•°</span></span><br><span class="line">    std::<span class="built_in">sort</span>(numbers.<span class="built_in">begin</span>(), numbers.<span class="built_in">end</span>());</span><br><span class="line">    std::<span class="built_in">reverse</span>(numbers.<span class="built_in">begin</span>(), numbers.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> sum = std::<span class="built_in">accumulate</span>(numbers.<span class="built_in">begin</span>(), numbers.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼˜åŠ¿ï¼š</span></span><br><span class="line">    <span class="comment">// 1. ç®—æ³•å¯ä»¥ç”¨äºä»»ä½•å®¹å™¨</span></span><br><span class="line">    <span class="comment">// 2. å®¹å™¨ç±»ä¿æŒç®€æ´</span></span><br><span class="line">    <span class="comment">// 3. ç®—æ³•å¯ä»¥ç‹¬ç«‹æ‰©å±•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰å®¹å™¨éµå¾ªç›¸åŒåŸåˆ™</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CircularBuffer</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> capacity_;</span><br><span class="line">    <span class="type">size_t</span> head_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CircularBuffer</span>(<span class="type">size_t</span> capacity) </span><br><span class="line">        : <span class="built_in">data_</span>(capacity), <span class="built_in">capacity_</span>(capacity), <span class="built_in">head_</span>(<span class="number">0</span>), <span class="built_in">size_</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        data_[head_] = value;</span><br><span class="line">        head_ = (head_ + <span class="number">1</span>) % capacity_;</span><br><span class="line">        <span class="keyword">if</span> (size_ &lt; capacity_) ++size_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›è¿­ä»£å™¨æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">begin</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">end</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">begin</span>() + size_; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> size_ == <span class="number">0</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜å‡½æ•°æ‰©å±•</span></span><br><span class="line"><span class="keyword">namespace</span> CircularBufferUtils &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">const</span> CircularBuffer&amp; buffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">accumulate</span>(buffer.<span class="built_in">begin</span>(), buffer.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">max</span><span class="params">(<span class="type">const</span> CircularBuffer&amp; buffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (buffer.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> *std::<span class="built_in">max_element</span>(buffer.<span class="built_in">begin</span>(), buffer.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> CircularBuffer&amp; buffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> it = buffer.<span class="built_in">begin</span>(); it != buffer.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">            std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::cout &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-è¿ç®—ç¬¦é‡è½½çš„åº”ç”¨"><a href="#5-è¿ç®—ç¬¦é‡è½½çš„åº”ç”¨" class="headerlink" title="5. è¿ç®—ç¬¦é‡è½½çš„åº”ç”¨"></a>5. <strong>è¿ç®—ç¬¦é‡è½½çš„åº”ç”¨</strong></h4><p><strong>éæˆå‘˜è¿ç®—ç¬¦çš„ä¼˜åŠ¿ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜è¿ç®—ç¬¦ï¼šæ”¯æŒéšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line">Rational <span class="keyword">operator</span>+(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() + rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜è¾“å‡ºè¿ç®—ç¬¦</span></span><br><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Rational&amp; r) &#123;</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; r.<span class="built_in">numerator</span>() &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; r.<span class="built_in">denominator</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateOperatorOverloading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">r1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">r2</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éæˆå‘˜è¿ç®—ç¬¦çš„ä¼˜åŠ¿ï¼š</span></span><br><span class="line">    Rational r3 = r1 + r2;        <span class="comment">// âœ… æ­£å¸¸</span></span><br><span class="line">    Rational r4 = <span class="number">2</span> + r1;         <span class="comment">// âœ… éšå¼è½¬æ¢ï¼š2 -&gt; Rational(2,1)</span></span><br><span class="line">    Rational r5 = r1 + <span class="number">3</span>;         <span class="comment">// âœ… éšå¼è½¬æ¢ï¼š3 -&gt; Rational(3,1)</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; r3 &lt;&lt; std::endl; <span class="comment">// âœ… éæˆå‘˜è¾“å‡ºè¿ç®—ç¬¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ å¦‚æœæ˜¯æˆå‘˜å‡½æ•°ç‰ˆæœ¬çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadRational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_, denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BadRational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    BadRational <span class="keyword">operator</span>+(<span class="type">const</span> BadRational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">BadRational</span>(numerator_ * rhs.denominator_ + rhs.numerator_ * denominator_,</span><br><span class="line">                          denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateMemberOperatorProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">BadRational <span class="title">r1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    BadRational r2 = r1 + <span class="built_in">BadRational</span>(<span class="number">1</span>, <span class="number">3</span>);  <span class="comment">// âœ… æ­£å¸¸</span></span><br><span class="line">    <span class="comment">// BadRational r3 = 2 + r1;                // âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">    <span class="comment">// ç­‰ä»·äº 2.operator+(r1)ï¼Œä½†intæ²¡æœ‰è¿™ä¸ªæˆå‘˜å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-å‘½åç©ºé—´çš„ç»„ç»‡ç­–ç•¥"><a href="#6-å‘½åç©ºé—´çš„ç»„ç»‡ç­–ç•¥" class="headerlink" title="6. å‘½åç©ºé—´çš„ç»„ç»‡ç­–ç•¥"></a>6. <strong>å‘½åç©ºé—´çš„ç»„ç»‡ç­–ç•¥</strong></h4><p><strong>è‰¯å¥½çš„å‘½åç©ºé—´è®¾è®¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// geometry.h - æ ¸å¿ƒå‡ ä½•ç±»</span></span><br><span class="line"><span class="keyword">namespace</span> Geometry &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="type">double</span> x_, y_;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Point</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>) : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">x</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">y</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; x_ = x; &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">setY</span><span class="params">(<span class="type">double</span> y)</span> </span>&#123; y_ = y; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        Point topLeft_, bottomRight_;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Rectangle</span>(<span class="type">const</span> Point&amp; tl, <span class="type">const</span> Point&amp; br) : <span class="built_in">topLeft_</span>(tl), <span class="built_in">bottomRight_</span>(br) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="type">const</span> Point&amp; <span class="title">topLeft</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> topLeft_; &#125;</span><br><span class="line">        <span class="function"><span class="type">const</span> Point&amp; <span class="title">bottomRight</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> bottomRight_; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// geometry_calculations.h - è®¡ç®—ç›¸å…³éæˆå‘˜å‡½æ•°</span></span><br><span class="line"><span class="keyword">namespace</span> Geometry &#123;</span><br><span class="line">    <span class="keyword">namespace</span> Calculations &#123;</span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">distance</span><span class="params">(<span class="type">const</span> Point&amp; p1, <span class="type">const</span> Point&amp; p2)</span> </span>&#123;</span><br><span class="line">            <span class="type">double</span> dx = p<span class="number">1.</span><span class="built_in">x</span>() - p<span class="number">2.</span><span class="built_in">x</span>();</span><br><span class="line">            <span class="type">double</span> dy = p<span class="number">1.</span><span class="built_in">y</span>() - p<span class="number">2.</span><span class="built_in">y</span>();</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">sqrt</span>(dx * dx + dy * dy);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">(<span class="type">const</span> Rectangle&amp; rect)</span> </span>&#123;</span><br><span class="line">            <span class="type">double</span> width = rect.<span class="built_in">bottomRight</span>().<span class="built_in">x</span>() - rect.<span class="built_in">topLeft</span>().<span class="built_in">x</span>();</span><br><span class="line">            <span class="type">double</span> height = rect.<span class="built_in">topLeft</span>().<span class="built_in">y</span>() - rect.<span class="built_in">bottomRight</span>().<span class="built_in">y</span>();</span><br><span class="line">            <span class="keyword">return</span> width * height;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">perimeter</span><span class="params">(<span class="type">const</span> Rectangle&amp; rect)</span> </span>&#123;</span><br><span class="line">            <span class="type">double</span> width = rect.<span class="built_in">bottomRight</span>().<span class="built_in">x</span>() - rect.<span class="built_in">topLeft</span>().<span class="built_in">x</span>();</span><br><span class="line">            <span class="type">double</span> height = rect.<span class="built_in">topLeft</span>().<span class="built_in">y</span>() - rect.<span class="built_in">bottomRight</span>().<span class="built_in">y</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span> * (width + height);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// geometry_transformations.h - å˜æ¢ç›¸å…³éæˆå‘˜å‡½æ•°</span></span><br><span class="line"><span class="keyword">namespace</span> Geometry &#123;</span><br><span class="line">    <span class="keyword">namespace</span> Transformations &#123;</span><br><span class="line">        <span class="function">Point <span class="title">translate</span><span class="params">(<span class="type">const</span> Point&amp; p, <span class="type">double</span> dx, <span class="type">double</span> dy)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Point</span>(p.<span class="built_in">x</span>() + dx, p.<span class="built_in">y</span>() + dy);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">Point <span class="title">rotate</span><span class="params">(<span class="type">const</span> Point&amp; p, <span class="type">double</span> angle, <span class="type">const</span> Point&amp; center = Point(<span class="number">0</span>, <span class="number">0</span>))</span> </span>&#123;</span><br><span class="line">            <span class="type">double</span> cos_a = std::<span class="built_in">cos</span>(angle);</span><br><span class="line">            <span class="type">double</span> sin_a = std::<span class="built_in">sin</span>(angle);</span><br><span class="line">            <span class="type">double</span> dx = p.<span class="built_in">x</span>() - center.<span class="built_in">x</span>();</span><br><span class="line">            <span class="type">double</span> dy = p.<span class="built_in">y</span>() - center.<span class="built_in">y</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Point</span>(center.<span class="built_in">x</span>() + dx * cos_a - dy * sin_a,</span><br><span class="line">                        center.<span class="built_in">y</span>() + dx * sin_a + dy * cos_a);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function">Rectangle <span class="title">scale</span><span class="params">(<span class="type">const</span> Rectangle&amp; rect, <span class="type">double</span> factor)</span> </span>&#123;</span><br><span class="line">            Point tl = rect.<span class="built_in">topLeft</span>();</span><br><span class="line">            Point br = rect.<span class="built_in">bottomRight</span>();</span><br><span class="line">            <span class="type">double</span> width = br.<span class="built_in">x</span>() - tl.<span class="built_in">x</span>();</span><br><span class="line">            <span class="type">double</span> height = tl.<span class="built_in">y</span>() - br.<span class="built_in">y</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Rectangle</span>(tl, <span class="built_in">Point</span>(tl.<span class="built_in">x</span>() + width * factor, tl.<span class="built_in">y</span>() - height * factor));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateNamespaceOrganization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Geometry;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Geometry::Calculations;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> Geometry::Transformations;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Point <span class="title">p1</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="function">Point <span class="title">p2</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Rectangle <span class="title">rect</span><span class="params">(Point(<span class="number">0</span>, <span class="number">2</span>), Point(<span class="number">4</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Distance: &quot;</span> &lt;&lt; <span class="built_in">distance</span>(p1, p2) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Area: &quot;</span> &lt;&lt; <span class="built_in">area</span>(rect) &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    Point translated = <span class="built_in">translate</span>(p1, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">    Rectangle scaled = <span class="built_in">scale</span>(rect, <span class="number">2.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-å®é™…è®¾è®¡æ¡ˆä¾‹å¯¹æ¯”"><a href="#7-å®é™…è®¾è®¡æ¡ˆä¾‹å¯¹æ¯”" class="headerlink" title="7. å®é™…è®¾è®¡æ¡ˆä¾‹å¯¹æ¯”"></a>7. <strong>å®é™…è®¾è®¡æ¡ˆä¾‹å¯¹æ¯”</strong></h4><p><strong>æ¡ˆä¾‹ï¼šå­—ç¬¦ä¸²å¤„ç†ç±»</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ è‡ƒè‚¿çš„æˆå‘˜å‡½æ•°è®¾è®¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BadString</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BadString</span>(<span class="type">const</span> std::string&amp; str) : <span class="built_in">data_</span>(str) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123; data_ = str; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¶Šæ¥è¶Šå¤šçš„æˆå‘˜å‡½æ•°...</span></span><br><span class="line">    <span class="function">BadString <span class="title">toUpper</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">BadString <span class="title">toLower</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">BadString <span class="title">trim</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">BadString <span class="title">replace</span><span class="params">(<span class="type">const</span> std::string&amp; from, <span class="type">const</span> std::string&amp; to)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::vector&lt;BadString&gt; <span class="title">split</span><span class="params">(<span class="type">char</span> delimiter)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">startsWith</span><span class="params">(<span class="type">const</span> std::string&amp; prefix)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">endsWith</span><span class="params">(<span class="type">const</span> std::string&amp; suffix)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">contains</span><span class="params">(<span class="type">const</span> std::string&amp; substring)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">BadString <span class="title">reverse</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">BadString <span class="title">substring</span><span class="params">(<span class="type">size_t</span> start, <span class="type">size_t</span> length)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">toInt</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">toDouble</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">toHex</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="comment">// ... è¿˜æœ‰æ›´å¤šåŠŸèƒ½</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—®é¢˜ï¼š</span></span><br><span class="line">    <span class="comment">// 1. ç±»å˜å¾—è¶Šæ¥è¶Šå¤§</span></span><br><span class="line">    <span class="comment">// 2. æ‰€æœ‰å‡½æ•°éƒ½èƒ½è®¿é—®ç§æœ‰æ•°æ®</span></span><br><span class="line">    <span class="comment">// 3. éš¾ä»¥æ‰©å±•</span></span><br><span class="line">    <span class="comment">// 4. ç¼–è¯‘ä¾èµ–å¢åŠ </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ç®€æ´çš„æ ¸å¿ƒç±» + éæˆå‘˜å‡½æ•°æ‰©å±•</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodString</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string data_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">GoodString</span>(<span class="type">const</span> std::string&amp; str) : <span class="built_in">data_</span>(str) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªåŒ…å«æ ¸å¿ƒæ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123; data_ = str; &#125;</span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">length</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">length</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data_.<span class="built_in">empty</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// string_transform.h</span></span><br><span class="line"><span class="keyword">namespace</span> StringTransform &#123;</span><br><span class="line">    <span class="function">GoodString <span class="title">toUpper</span><span class="params">(<span class="type">const</span> GoodString&amp; str)</span> </span>&#123;</span><br><span class="line">        std::string result = str.<span class="built_in">get</span>();</span><br><span class="line">        std::<span class="built_in">transform</span>(result.<span class="built_in">begin</span>(), result.<span class="built_in">end</span>(), result.<span class="built_in">begin</span>(), ::toupper);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">GoodString</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">GoodString <span class="title">toLower</span><span class="params">(<span class="type">const</span> GoodString&amp; str)</span> </span>&#123;</span><br><span class="line">        std::string result = str.<span class="built_in">get</span>();</span><br><span class="line">        std::<span class="built_in">transform</span>(result.<span class="built_in">begin</span>(), result.<span class="built_in">end</span>(), result.<span class="built_in">begin</span>(), ::tolower);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">GoodString</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">GoodString <span class="title">trim</span><span class="params">(<span class="type">const</span> GoodString&amp; str)</span> </span>&#123;</span><br><span class="line">        std::string result = str.<span class="built_in">get</span>();</span><br><span class="line">        result.<span class="built_in">erase</span>(<span class="number">0</span>, result.<span class="built_in">find_first_not_of</span>(<span class="string">&quot; \t\n\r&quot;</span>));</span><br><span class="line">        result.<span class="built_in">erase</span>(result.<span class="built_in">find_last_not_of</span>(<span class="string">&quot; \t\n\r&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">GoodString</span>(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// string_query.h</span></span><br><span class="line"><span class="keyword">namespace</span> StringQuery &#123;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">startsWith</span><span class="params">(<span class="type">const</span> GoodString&amp; str, <span class="type">const</span> std::string&amp; prefix)</span> </span>&#123;</span><br><span class="line">        <span class="type">const</span> std::string&amp; data = str.<span class="built_in">get</span>();</span><br><span class="line">        <span class="keyword">return</span> data.<span class="built_in">length</span>() &gt;= prefix.<span class="built_in">length</span>() &amp;&amp; </span><br><span class="line">               data.<span class="built_in">substr</span>(<span class="number">0</span>, prefix.<span class="built_in">length</span>()) == prefix;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">endsWith</span><span class="params">(<span class="type">const</span> GoodString&amp; str, <span class="type">const</span> std::string&amp; suffix)</span> </span>&#123;</span><br><span class="line">        <span class="type">const</span> std::string&amp; data = str.<span class="built_in">get</span>();</span><br><span class="line">        <span class="keyword">return</span> data.<span class="built_in">length</span>() &gt;= suffix.<span class="built_in">length</span>() &amp;&amp; </span><br><span class="line">               data.<span class="built_in">substr</span>(data.<span class="built_in">length</span>() - suffix.<span class="built_in">length</span>()) == suffix;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">contains</span><span class="params">(<span class="type">const</span> GoodString&amp; str, <span class="type">const</span> std::string&amp; substring)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.<span class="built_in">get</span>().<span class="built_in">find</span>(substring) != std::string::npos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// string_convert.h  </span></span><br><span class="line"><span class="keyword">namespace</span> StringConvert &#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">toInt</span><span class="params">(<span class="type">const</span> GoodString&amp; str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">stoi</span>(str.<span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">toDouble</span><span class="params">(<span class="type">const</span> GoodString&amp; str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">stod</span>(str.<span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateStringDesign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">GoodString <span class="title">text</span><span class="params">(<span class="string">&quot;  Hello World  &quot;</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‰éœ€ä½¿ç”¨åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> StringTransform;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> StringQuery;</span><br><span class="line">    </span><br><span class="line">    GoodString trimmed = <span class="built_in">trim</span>(text);</span><br><span class="line">    GoodString upper = <span class="built_in">toUpper</span>(trimmed);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">startsWith</span>(upper, <span class="string">&quot;HELLO&quot;</span>)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;String starts with HELLO&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-19"><a href="#æ€»ç»“-19" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>é€‰æ‹©éæˆå‘˜éå‹å…ƒå‡½æ•°çš„æ ¸å¿ƒåŸå› ï¼š</strong></p>
<ol>
<li><strong>æ›´å¥½çš„å°è£…æ€§</strong>ï¼šå‡å°‘èƒ½è®¿é—®ç§æœ‰æ•°æ®çš„å‡½æ•°æ•°é‡</li>
<li><strong>åŒ…è£…å¼¹æ€§</strong>ï¼šå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„å¤´æ–‡ä»¶å’Œå‘½åç©ºé—´ä¸­</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šç¬¬ä¸‰æ–¹å¯ä»¥è½»æ¾æ·»åŠ åŠŸèƒ½</li>
<li><strong>ç¼–è¯‘ä¾èµ–æ€§</strong>ï¼šå®¢æˆ·ç«¯åªéœ€åŒ…å«éœ€è¦çš„åŠŸèƒ½</li>
</ol>
<p><strong>è®¾è®¡æŒ‡å¯¼åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æ ¸å¿ƒç±»ä¿æŒç®€æ´</strong>ï¼šåªåŒ…å«å¿…è¦çš„æˆå‘˜å‡½æ•°</li>
<li><strong>æŒ‰åŠŸèƒ½ç»„ç»‡éæˆå‘˜å‡½æ•°</strong>ï¼šä½¿ç”¨å‘½åç©ºé—´åˆ†ç»„</li>
<li><strong>æä¾›è‰¯å¥½çš„å…¬å…±æ¥å£</strong>ï¼šè®©éæˆå‘˜å‡½æ•°èƒ½å¤Ÿå®Œæˆå·¥ä½œ</li>
<li><strong>éµå¾ªæ ‡å‡†åº“æ¨¡å¼</strong>ï¼šå¦‚STLç®—æ³•çš„è®¾è®¡</li>
</ul>
<p><strong>ä½•æ—¶ä½¿ç”¨æˆå‘˜å‡½æ•°ï¼š</strong></p>
<ul>
<li>éœ€è¦è®¿é—®ç§æœ‰æ•°æ®æ—¶</li>
<li>è™šå‡½æ•°éœ€è¦å¤šæ€è¡Œä¸ºæ—¶</li>
<li>è¿ç®—ç¬¦éœ€è¦ç‰¹æ®Šè¯­æ³•æ—¶ï¼ˆå¦‚<code>[]</code>ã€<code>()</code>ã€<code>-&gt;</code>ï¼‰</li>
</ul>
<p><strong>ä½•æ—¶ä½¿ç”¨éæˆå‘˜å‡½æ•°ï¼š</strong></p>
<ul>
<li>å¯ä»¥é€šè¿‡å…¬å…±æ¥å£å®ç°æ—¶</li>
<li>æä¾›ä¾¿åˆ©åŠŸèƒ½æ—¶</li>
<li>æ‰©å±•ç°æœ‰ç±»åŠŸèƒ½æ—¶</li>
<li>æ”¯æŒç±»å‹è½¬æ¢æ—¶ï¼ˆè¿ç®—ç¬¦é‡è½½ï¼‰</li>
</ul>
<p><strong>ç°ä»£C++æœ€ä½³å®è·µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModernClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ ¸å¿ƒæ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">coreOperation</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getCoreData</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> data_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ModernClassUtils &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•åŠŸèƒ½</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">convenienceFunction</span><span class="params">(ModernClass&amp; obj)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">derivedCalculation</span><span class="params">(<span class="type">const</span> ModernClass&amp; obj)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è®°ä½ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°ã€‚è¿™æ ·åšå¯ä»¥å¢åŠ å°è£…æ€§ã€åŒ…è£…å¼¹æ€§ï¼ˆpackaging flexibilityï¼‰å’Œæœºèƒ½æ‰©å……æ€§ã€‚</strong></p>
<h2 id="æ¡æ¬¾24ï¼š-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"><a href="#æ¡æ¬¾24ï¼š-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°" class="headerlink" title="æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"></a>æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°</h2><blockquote>
<p><em>Declare non-member functions when type conversions should apply to all parameters</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-23"><a href="#æ ¸å¿ƒç†å¿µ-23" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å¦‚æœä½ éœ€è¦ä¸ºæŸä¸ªå‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼ˆåŒ…æ‹¬è¢«thisæŒ‡é’ˆæ‰€æŒ‡çš„é‚£ä¸ªéšå–»å‚æ•°ï¼‰è¿›è¡Œç±»å‹è½¬æ¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯ä¸ªnon-memberå‡½æ•°</strong>ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰non-memberå‡½æ•°æ‰èƒ½å¯¹æ‰€æœ‰å‚æ•°å®ç°éšå¼ç±»å‹è½¬æ¢ï¼Œè€Œæˆå‘˜å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆthisæ‰€æŒ‡çš„å¯¹è±¡ï¼‰ä¸ä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢ã€‚è¿™åœ¨è¿ç®—ç¬¦é‡è½½ä¸­å°¤å…¶é‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¸Œæœ›æ”¯æŒæ··åˆç±»å‹è¿ç®—æ—¶ã€‚</p>
<h3 id="æ·±åº¦è§£æ-23"><a href="#æ·±åº¦è§£æ-23" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-æˆå‘˜å‡½æ•°çš„ç±»å‹è½¬æ¢é™åˆ¶"><a href="#1-æˆå‘˜å‡½æ•°çš„ç±»å‹è½¬æ¢é™åˆ¶" class="headerlink" title="1. æˆå‘˜å‡½æ•°çš„ç±»å‹è½¬æ¢é™åˆ¶"></a>1. <strong>æˆå‘˜å‡½æ•°çš„ç±»å‹è½¬æ¢é™åˆ¶</strong></h4><p>æˆå‘˜å‡½æ•°çš„éšå¼ç±»å‹è½¬æ¢åªä½œç”¨äºå‚æ•°ï¼Œè€Œä¸ä½œç”¨äºè°ƒç”¨å¯¹è±¡ï¼ˆthisæŒ‡é’ˆï¼‰ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> numerator = <span class="number">0</span>, <span class="type">int</span> denominator = <span class="number">1</span>)  <span class="comment">// æ³¨æ„ï¼šéexplicit</span></span><br><span class="line">        : <span class="built_in">numerator_</span>(numerator), <span class="built_in">denominator_</span>(denominator) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ æˆå‘˜å‡½æ•°ç‰ˆæœ¬çš„ä¹˜æ³•è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(numerator_ * rhs.numerator_, </span><br><span class="line">                       denominator_ * rhs.denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateMemberFunctionProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">oneEighth</span><span class="params">(<span class="number">1</span>, <span class="number">8</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">oneHalf</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    Rational result1 = oneHalf * oneEighth;  <span class="comment">// âœ… æ­£å¸¸å·¥ä½œ</span></span><br><span class="line">    Rational result2 = oneHalf * <span class="number">2</span>;          <span class="comment">// âœ… æ­£å¸¸å·¥ä½œï¼š2è¢«è½¬æ¢ä¸ºRational(2,1)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Rational result3 = 2 * oneHalf;       // âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">    <span class="comment">// ç­‰ä»·äºï¼š2.operator*(oneHalf)</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯intç±»å‹æ²¡æœ‰operator*æˆå‘˜å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-éæˆå‘˜å‡½æ•°å®ç°å¯¹ç§°çš„ç±»å‹è½¬æ¢"><a href="#2-éæˆå‘˜å‡½æ•°å®ç°å¯¹ç§°çš„ç±»å‹è½¬æ¢" class="headerlink" title="2. éæˆå‘˜å‡½æ•°å®ç°å¯¹ç§°çš„ç±»å‹è½¬æ¢"></a>2. <strong>éæˆå‘˜å‡½æ•°å®ç°å¯¹ç§°çš„ç±»å‹è½¬æ¢</strong></h4><p>éæˆå‘˜å‡½æ•°å¯ä»¥å¯¹æ‰€æœ‰å‚æ•°è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œå®ç°å®Œå…¨å¯¹ç§°çš„æ“ä½œã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> numerator = <span class="number">0</span>, <span class="type">int</span> denominator = <span class="number">1</span>)  <span class="comment">// å…è®¸éšå¼è½¬æ¢</span></span><br><span class="line">        : <span class="built_in">numerator_</span>(numerator), <span class="built_in">denominator_</span>(denominator) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›å¿…è¦çš„è®¿é—®å‡½æ•°ï¼Œä¾›éæˆå‘˜å‡½æ•°ä½¿ç”¨</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… éæˆå‘˜å‡½æ•°ç‰ˆæœ¬ï¼šæ”¯æŒå¯¹ç§°çš„ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateNonMemberFunctionSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">oneEighth</span><span class="params">(<span class="number">1</span>, <span class="number">8</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">oneHalf</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    Rational result1 = oneHalf * oneEighth;  <span class="comment">// âœ… æ­£å¸¸å·¥ä½œ</span></span><br><span class="line">    Rational result2 = oneHalf * <span class="number">2</span>;          <span class="comment">// âœ… æ­£å¸¸å·¥ä½œï¼š2è½¬æ¢ä¸ºRational(2,1)</span></span><br><span class="line">    Rational result3 = <span class="number">2</span> * oneHalf;          <span class="comment">// âœ… ç°åœ¨ä¹Ÿæ­£å¸¸å·¥ä½œäº†ï¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰€æœ‰å‚æ•°éƒ½å¯ä»¥è¿›è¡Œéšå¼ç±»å‹è½¬æ¢</span></span><br><span class="line">    Rational result4 = <span class="number">3</span> * <span class="built_in">Rational</span>(<span class="number">1</span>, <span class="number">4</span>) * <span class="number">5</span>;  <span class="comment">// âœ… é“¾å¼è¿ç®—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-å®Œæ•´çš„è¿ç®—ç¬¦é‡è½½è®¾è®¡"><a href="#3-å®Œæ•´çš„è¿ç®—ç¬¦é‡è½½è®¾è®¡" class="headerlink" title="3. å®Œæ•´çš„è¿ç®—ç¬¦é‡è½½è®¾è®¡"></a>3. <strong>å®Œæ•´çš„è¿ç®—ç¬¦é‡è½½è®¾è®¡</strong></h4><p>è®¾è®¡ä¸€ä¸ªæ”¯æŒæ··åˆç±»å‹è¿ç®—çš„å®Œæ•´æœ‰ç†æ•°ç±»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_;</span><br><span class="line">    <span class="type">int</span> denominator_;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾…åŠ©å‡½æ•°ï¼šæ±‚æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (b != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> temp = b;</span><br><span class="line">            b = a % b;</span><br><span class="line">            a = temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒ–ç®€åˆ†æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">simplify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (denominator_ &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            numerator_ = -numerator_;</span><br><span class="line">            denominator_ = -denominator_;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> g = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(numerator_), <span class="built_in">abs</span>(denominator_));</span><br><span class="line">        numerator_ /= g;</span><br><span class="line">        denominator_ /= g;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼šå…è®¸éšå¼è½¬æ¢</span></span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">int</span> numerator = <span class="number">0</span>, <span class="type">int</span> denominator = <span class="number">1</span>)</span><br><span class="line">        : <span class="built_in">numerator_</span>(numerator), <span class="built_in">denominator_</span>(denominator) &#123;</span><br><span class="line">        <span class="keyword">if</span> (denominator == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Denominator cannot be zero&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">simplify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¿é—®å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç±»å‹è½¬æ¢å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">double</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(numerator_) / denominator_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸€å…ƒè¿ç®—ç¬¦ï¼ˆä½œä¸ºæˆå‘˜å‡½æ•°ï¼‰</span></span><br><span class="line">    Rational <span class="keyword">operator</span>-() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Rational</span>(-numerator_, denominator_);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        numerator_ = numerator_ * rhs.denominator_ + rhs.numerator_ * denominator_;</span><br><span class="line">        denominator_ *= rhs.denominator_;</span><br><span class="line">        <span class="built_in">simplify</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>-=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span> += (-rhs);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>*=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        numerator_ *= rhs.numerator_;</span><br><span class="line">        denominator_ *= rhs.denominator_;</span><br><span class="line">        <span class="built_in">simplify</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Rational&amp; <span class="keyword">operator</span>/=(<span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rhs.numerator_ == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        numerator_ *= rhs.denominator_;</span><br><span class="line">        denominator_ *= rhs.numerator_;</span><br><span class="line">        <span class="built_in">simplify</span>();</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… äºŒå…ƒè¿ç®—ç¬¦ï¼šä½œä¸ºéæˆå‘˜å‡½æ•°ï¼Œæ”¯æŒå¯¹ç§°çš„ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>+(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() + rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>-(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> lhs + (-rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>/(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rhs.<span class="built_in">numerator</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">numerator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯”è¾ƒè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() == rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>!=(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> !(lhs == rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() &lt; rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&gt;(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> rhs &lt; lhs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;=(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> !(lhs &gt; rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="keyword">operator</span>&gt;=(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> !(lhs &lt; rhs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å…¥è¾“å‡ºè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">inline</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Rational&amp; r) &#123;</span><br><span class="line">    <span class="keyword">if</span> (r.<span class="built_in">denominator</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> os &lt;&lt; r.<span class="built_in">numerator</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> os &lt;&lt; r.<span class="built_in">numerator</span>() &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; r.<span class="built_in">denominator</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> std::istream&amp; <span class="keyword">operator</span>&gt;&gt;(std::istream&amp; is, Rational&amp; r) &#123;</span><br><span class="line">    <span class="type">int</span> numerator, denominator = <span class="number">1</span>;</span><br><span class="line">    is &gt;&gt; numerator;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (is.<span class="built_in">peek</span>() == <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">        is.<span class="built_in">ignore</span>();  <span class="comment">// è·³è¿‡&#x27;/&#x27;</span></span><br><span class="line">        is &gt;&gt; denominator;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    r = <span class="built_in">Rational</span>(numerator, denominator);</span><br><span class="line">    <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-ç±»å‹è½¬æ¢çš„å®é™…åº”ç”¨ç¤ºä¾‹"><a href="#4-ç±»å‹è½¬æ¢çš„å®é™…åº”ç”¨ç¤ºä¾‹" class="headerlink" title="4. ç±»å‹è½¬æ¢çš„å®é™…åº”ç”¨ç¤ºä¾‹"></a>4. <strong>ç±»å‹è½¬æ¢çš„å®é™…åº”ç”¨ç¤ºä¾‹</strong></h4><p>å±•ç¤ºéæˆå‘˜å‡½æ•°å¦‚ä½•å®ç°è‡ªç„¶çš„æ··åˆç±»å‹è¿ç®—ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateSymmetricOperations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">half</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">quarter</span><span class="params">(<span class="number">1</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ‰€æœ‰è¿™äº›è¡¨è¾¾å¼éƒ½èƒ½å·¥ä½œ</span></span><br><span class="line">    Rational result1 = half + quarter;      <span class="comment">// Rational + Rational</span></span><br><span class="line">    Rational result2 = half + <span class="number">1</span>;            <span class="comment">// Rational + int</span></span><br><span class="line">    Rational result3 = <span class="number">2</span> + half;            <span class="comment">// int + Rational</span></span><br><span class="line">    Rational result4 = half * <span class="number">3</span>;            <span class="comment">// Rational * int  </span></span><br><span class="line">    Rational result5 = <span class="number">4</span> * quarter;         <span class="comment">// int * Rational</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… å¤æ‚è¡¨è¾¾å¼ä¹Ÿèƒ½è‡ªç„¶å·¥ä½œ</span></span><br><span class="line">    Rational result6 = <span class="number">1</span> + half * <span class="number">2</span> - quarter / <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¯”è¾ƒæ“ä½œä¹Ÿæ”¯æŒæ··åˆç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (half &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;half is positive&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="number">2</span> * quarter == half) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;2 * quarter equals half&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… è¾“å‡ºæ“ä½œ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Results: &quot;</span> &lt;&lt; result1 &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; result2 &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">              &lt;&lt; result3 &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; result4 &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; result5 &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… é“¾å¼è¿ç®—</span></span><br><span class="line">    Rational complex = (half + <span class="number">1</span>) * (quarter - <span class="number">2</span>) / (<span class="number">3</span> + result1);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Complex calculation: &quot;</span> &lt;&lt; complex &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-è®¾è®¡è€ƒè™‘å’Œæœ€ä½³å®è·µ"><a href="#5-è®¾è®¡è€ƒè™‘å’Œæœ€ä½³å®è·µ" class="headerlink" title="5. è®¾è®¡è€ƒè™‘å’Œæœ€ä½³å®è·µ"></a>5. <strong>è®¾è®¡è€ƒè™‘å’Œæœ€ä½³å®è·µ</strong></h4><p>åœ¨å®ç°æ”¯æŒç±»å‹è½¬æ¢çš„è¿ç®—ç¬¦æ—¶éœ€è¦è€ƒè™‘çš„é‡è¦å› ç´ ã€‚</p>
<p><strong>explicitæ„é€ å‡½æ•°çš„æƒè¡¡ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StrictRational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_, denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… explicitæ„é€ å‡½æ•°ï¼šé˜²æ­¢æ„å¤–çš„éšå¼è½¬æ¢</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">StrictRational</span><span class="params">(<span class="type">int</span> numerator, <span class="type">int</span> denominator = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">        : numerator_(numerator), denominator_(denominator) &#123;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æä¾›æ˜¾å¼çš„ç±»å‹è½¬æ¢å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">static</span> StrictRational <span class="title">fromInt</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">StrictRational</span>(value, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éæˆå‘˜å‡½æ•°éœ€è¦æ˜¾å¼è½¬æ¢</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> StrictRational <span class="keyword">operator</span>*(<span class="type">const</span> StrictRational&amp; lhs, <span class="type">const</span> StrictRational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">StrictRational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                         lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateExplicitConversion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">StrictRational <span class="title">half</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// StrictRational result1 = half * 2;          // âŒ ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    StrictRational result2 = half * <span class="built_in">StrictRational</span>(<span class="number">2</span>, <span class="number">1</span>);  <span class="comment">// âœ… æ˜¾å¼è½¬æ¢</span></span><br><span class="line">    StrictRational result3 = half * StrictRational::<span class="built_in">fromInt</span>(<span class="number">2</span>);  <span class="comment">// âœ… å·¥å‚å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€§èƒ½è€ƒè™‘ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›å€¼ä¼˜åŒ–ï¼šè¿”å›å¯¹è±¡è€Œä¸æ˜¯å¼•ç”¨</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>+(<span class="type">const</span> Rational&amp; lhs, <span class="type">const</span> Rational&amp; rhs) &#123;</span><br><span class="line">    <span class="comment">// ç°ä»£ç¼–è¯‘å™¨ä¼šè¿›è¡ŒRVOï¼ˆè¿”å›å€¼ä¼˜åŒ–ï¼‰ï¼Œé€šå¸¸ä¸ä¼šæœ‰é¢å¤–çš„æ‹·è´</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() + rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                   lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰è¿›ä¸€æ­¥ä¼˜åŒ–</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernRational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_, denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ModernRational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">ModernRational</span>(ModernRational&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">        : <span class="built_in">numerator_</span>(other.numerator_), <span class="built_in">denominator_</span>(other.denominator_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">    ModernRational&amp; <span class="keyword">operator</span>=(ModernRational&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        numerator_ = other.numerator_;</span><br><span class="line">        denominator_ = other.denominator_;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„è¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">inline</span> ModernRational <span class="keyword">operator</span>+(ModernRational lhs, <span class="type">const</span> ModernRational&amp; rhs) &#123;</span><br><span class="line">    lhs += rhs;  <span class="comment">// å¤ç”¨+=è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="keyword">return</span> lhs;  <span class="comment">// è¿”å›ä¿®æ”¹åçš„lhsï¼ˆå¯èƒ½è§¦å‘ç§»åŠ¨ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ"><a href="#6-å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="6. å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ"></a>6. <strong>å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ</strong></h4><p>é¿å…åœ¨å®ç°éæˆå‘˜è¿ç®—ç¬¦æ—¶é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚</p>
<p><strong>é¿å…æ— é™é€’å½’ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BadRational</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BadRational</span>(<span class="type">int</span> n = <span class="number">0</span>, <span class="type">int</span> d = <span class="number">1</span>) : <span class="built_in">num_</span>(n), <span class="built_in">den_</span>(d) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ è¿™ä¼šå¯¼è‡´æ— é™é€’å½’ï¼</span></span><br><span class="line">    BadRational&amp; <span class="keyword">operator</span>+=(<span class="type">const</span> BadRational&amp; rhs) &#123;</span><br><span class="line">        *<span class="keyword">this</span> = *<span class="keyword">this</span> + rhs;  <span class="comment">// è°ƒç”¨operator+ï¼Œè€Œoperator+åˆè°ƒç”¨operator+=</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> num_, den_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„å®ç°ï¼šç›´æ¥è®¡ç®—ï¼Œä¸ä¾èµ–å…¶ä»–è¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> BadRational <span class="keyword">operator</span>+(<span class="type">const</span> BadRational&amp; lhs, <span class="type">const</span> BadRational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">BadRational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>() + rhs.<span class="built_in">numerator</span>() * lhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                      lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¤„ç†ç‰¹æ®Šæƒ…å†µï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RobustRational</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> numerator_, denominator_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RobustRational</span>(<span class="type">int</span> num = <span class="number">0</span>, <span class="type">int</span> den = <span class="number">1</span>) : <span class="built_in">numerator_</span>(num), <span class="built_in">denominator_</span>(den) &#123;</span><br><span class="line">        <span class="keyword">if</span> (den == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Zero denominator&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> numerator_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> denominator_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†é™¤é›¶ç­‰ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">const</span> RobustRational <span class="keyword">operator</span>/(<span class="type">const</span> RobustRational&amp; lhs, <span class="type">const</span> RobustRational&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rhs.<span class="built_in">numerator</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">RobustRational</span>(lhs.<span class="built_in">numerator</span>() * rhs.<span class="built_in">denominator</span>(),</span><br><span class="line">                         lhs.<span class="built_in">denominator</span>() * rhs.<span class="built_in">numerator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-20"><a href="#æ€»ç»“-20" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ä½•æ—¶ä½¿ç”¨éæˆå‘˜å‡½æ•°ï¼š</strong></p>
<ol>
<li><strong>éœ€è¦å¯¹æ‰€æœ‰å‚æ•°è¿›è¡Œç±»å‹è½¬æ¢æ—¶</strong>ï¼ˆå¦‚å¯¹ç§°çš„äºŒå…ƒè¿ç®—ç¬¦ï¼‰</li>
<li><strong>ä¸éœ€è¦è®¿é—®ç§æœ‰æˆå‘˜æ—¶</strong></li>
<li><strong>å¸Œæœ›æ”¯æŒé“¾å¼æ“ä½œæ—¶</strong></li>
<li><strong>å®ç°æ ‡å‡†åº“é£æ ¼çš„æ¥å£æ—¶</strong></li>
</ol>
<p><strong>å®ç°è¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æä¾›è¶³å¤Ÿçš„å…¬å…±æ¥å£</strong>ï¼šè®©éæˆå‘˜å‡½æ•°èƒ½å¤Ÿå®Œæˆå·¥ä½œ</li>
<li><strong>è€ƒè™‘æ€§èƒ½</strong>ï¼šè¿”å›å€¼ä¼˜åŒ–å’Œç§»åŠ¨è¯­ä¹‰</li>
<li><strong>å¤„ç†å¼‚å¸¸æƒ…å†µ</strong>ï¼šè¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†</li>
<li><strong>ä¿æŒä¸€è‡´æ€§</strong>ï¼šè¿ç®—ç¬¦çš„è¯­ä¹‰è¦ç¬¦åˆç›´è§‰</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>å¯¹ç§°æ€§</strong>ï¼š<code>a op b</code>å’Œ<code>b op a</code>åº”è¯¥éƒ½èƒ½å·¥ä½œï¼ˆå¦‚æœè¯­ä¹‰ä¸Šåˆç†ï¼‰</li>
<li><strong>ç»„åˆæ€§</strong>ï¼šè¿ç®—ç¬¦åº”è¯¥èƒ½å¤Ÿè‡ªç„¶åœ°ç»„åˆä½¿ç”¨</li>
<li><strong>æ•ˆç‡</strong>ï¼šé¿å…ä¸å¿…è¦çš„æ‹·è´å’Œè½¬æ¢</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šæä¾›é€‚å½“çš„é”™è¯¯æ£€æŸ¥</li>
</ul>
<p><strong>è®°ä½ï¼šå¦‚æœä½ éœ€è¦ä¸ºæŸä¸ªå‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼ˆåŒ…æ‹¬è¢«thisæŒ‡é’ˆæ‰€æŒ‡çš„é‚£ä¸ªéšå–»å‚æ•°ï¼‰è¿›è¡Œç±»å‹è½¬æ¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯ä¸ªnon-memberå‡½æ•°ã€‚</strong></p>
<h2 id="æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„-swap-å‡½æ•°"><a href="#æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„-swap-å‡½æ•°" class="headerlink" title="æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„ swap å‡½æ•°"></a>æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„ swap å‡½æ•°</h2><blockquote>
<p><em>Consider writing a swap that wonâ€™t throw exceptions</em></p>
</blockquote>
<hr>
<h3 id="æ ¸å¿ƒç†å¿µ-24"><a href="#æ ¸å¿ƒç†å¿µ-24" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨ <code>C++</code> ä¸­ï¼Œ<code> swap</code> æ˜¯ä¸€ä¸ªåŸºç¡€æ“ä½œï¼Œå°¤å…¶åœ¨ <code>STL</code> å®¹å™¨ã€æ’åºç®—æ³•å’Œèµ„æºç®¡ç†ç±»ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä¸ºäº†ç¡®ä¿ç¨‹åºçš„å¼ºå¼‚å¸¸å®‰å…¨ä¿è¯ï¼Œ ä½ ååˆ†åº”è¯¥ä¸ºä½ çš„ç±»å‹æä¾›ä¸€ä¸ªä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„ï¼ˆ<code>noexcept</code>ï¼‰ çš„ <code>swap</code> å‡½æ•°ã€‚</p>
<p>åŸå› æ˜¯ï¼Œå¦‚æœä½ çš„ç±»å‹ä½¿ç”¨äº†è‡ªå®šä¹‰èµ„æºï¼ˆæ¯”å¦‚åŠ¨æ€å†…å­˜ã€æ–‡ä»¶å¥æŸ„ç­‰ï¼‰ï¼Œ é»˜è®¤çš„ <code>std::swap</code> å¯èƒ½è°ƒç”¨æ‹·è´æ„é€ &#x2F;èµ‹å€¼æ“ä½œï¼Œè¿™äº›æ“ä½œå¾ˆæœ‰å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œ ä»è€Œç ´åç¨‹åºçš„ç¨³å®šæ€§ï¼</p>
<hr>
<h3 id="æ·±åº¦è§£æ-24"><a href="#æ·±åº¦è§£æ-24" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-æ ‡å‡†åº“ä¾èµ–-swap-çš„å¼‚å¸¸å®‰å…¨æ€§"><a href="#1-æ ‡å‡†åº“ä¾èµ–-swap-çš„å¼‚å¸¸å®‰å…¨æ€§" class="headerlink" title="1. æ ‡å‡†åº“ä¾èµ– swap çš„å¼‚å¸¸å®‰å…¨æ€§"></a>1. æ ‡å‡†åº“ä¾èµ– <code>swap</code> çš„å¼‚å¸¸å®‰å…¨æ€§</h4><ul>
<li>STL ç®—æ³•ï¼ˆå¦‚ <code>sort</code>ï¼‰ä½¿ç”¨ <code>swap</code>ï¼Œå‡è®¾å®ƒ <strong>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</strong>ï¼›</li>
<li>STL å®¹å™¨å†…éƒ¨æ“ä½œï¼ˆå¦‚ <code>resize</code>ã€<code>insert</code>ï¼‰å¸¸ä»¥ <code>swap</code> å®ç°å…ƒç´ çš„ç§»åŠ¨ï¼›</li>
<li>å¦‚æœ <code>swap</code> æŠ›å‡ºå¼‚å¸¸ï¼Œ<strong>STL çš„å¼‚å¸¸å®‰å…¨ä¿è¯ä¼šå¤±æ•ˆ</strong>ï¼Œå¯¼è‡´<strong>èµ„æºæ³„æ¼æˆ–æœªå®šä¹‰è¡Œä¸º</strong>ã€‚</li>
</ul>
<h4 id="2-ç¼–å†™è‡ªå®šä¹‰çš„-swapï¼ˆï¼‰å‡½æ•°"><a href="#2-ç¼–å†™è‡ªå®šä¹‰çš„-swapï¼ˆï¼‰å‡½æ•°" class="headerlink" title="2. ç¼–å†™è‡ªå®šä¹‰çš„ swapï¼ˆï¼‰å‡½æ•°"></a>2. ç¼–å†™è‡ªå®šä¹‰çš„ <code>swapï¼ˆï¼‰</code>å‡½æ•°</h4><ul>
<li>ä¸ºç±»æä¾›ä¸“é—¨çš„<code>swap ()</code>æˆå‘˜å‡½æ•°ï¼Œè®©ä»–å†…éƒ¨åªç”¨<code>noexcept</code>çš„æˆå‘˜å˜é‡ <code>swap</code>ã€‚</li>
<li>åœ¨å…¨å±€æˆ– <code>std </code>å‘½åç©ºé—´ä¸­ä¸ºä½ çš„ç±»å‹æä¾›é‡è½½çš„ <code>swap</code>ï¼›</li>
<li>ä½¿ç”¨&#96;&#96;std::swap<code> æ›¿æ¢ä½ è‡ªå·±å˜é‡çš„äº¤æ¢å‰ï¼Œ ç¡®ä¿å®ƒæ˜¯</code> noexcept&#96;çš„ã€‚</li>
</ul>
<h4 id="3-ä½¿ç”¨-noexcept-å…³é”®å­—æé«˜æ•ˆç‡"><a href="#3-ä½¿ç”¨-noexcept-å…³é”®å­—æé«˜æ•ˆç‡" class="headerlink" title="3. ä½¿ç”¨ noexcept å…³é”®å­—æé«˜æ•ˆç‡"></a>3. ä½¿ç”¨ <code>noexcept</code> å…³é”®å­—æé«˜æ•ˆç‡</h4><ul>
<li>åœ¨<code>C++11</code>ä»¥åŠä»¥åæ ‡å‡†ï¼Œ <code>noexcept</code> è®©ç¼–è¯‘å™¨çŸ¥é“æŸå‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>å¦‚æœä½ æä¾›äº†<code>noexcept swapï¼ˆï¼‰</code>ï¼Œ å®¹å™¨åœ¨ä»»æ„ç§»åŠ¨çš„è¿‡ç¨‹ä¸­åº”è¯¥ä¼˜å…ˆä½¿ç”¨å®ƒæ¥ä¼˜åŒ–æ€§èƒ½ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹ï¼š-åˆç†å°è£…-swap-çš„æˆå‘˜å‡½æ•°"><a href="#ç¤ºä¾‹ï¼š-åˆç†å°è£…-swap-çš„æˆå‘˜å‡½æ•°" class="headerlink" title="ç¤ºä¾‹ï¼š åˆç†å°è£… swap çš„æˆå‘˜å‡½æ•°"></a>ç¤ºä¾‹ï¼š <strong>åˆç†å°è£… <code>swap </code>çš„æˆå‘˜å‡½æ•°</strong></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Widget</span> (std::string name, <span class="type">int</span> id)</span><br><span class="line">        : _name(std::<span class="built_in">move</span>(name))</span><br><span class="line">            , _id(id)</span><br><span class="line">        &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span> <span class="params">(Widget&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        _name.<span class="built_in">swap</span>(other._name);</span><br><span class="line">        std::<span class="built_in">swap</span>(_id, other._id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string _name;</span><br><span class="line">    <span class="type">int</span> _id</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æä¾› std::swap ç‰¹åŒ–ï¼Œä¾¿äºä½¿ç”¨ ADL æŸ¥æ‰¾ä½ çš„ swap</span></span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt;</span><br><span class="line">    <span class="type">void</span> <span class="built_in">swap</span>&lt;Widget&gt; (Widget&amp; a, Widget&amp;b) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        a.<span class="built_in">swap</span>(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸æ¨èï¼è¿™ç§æ‹·è´å‹å¾ˆå¯èƒ½è®©ä½ åœ¨ä¸´æ—¶å¯¹è±¡æ„é€ æˆ–è€…èµ‹å€¼çš„è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&amp; a, Widget&amp; b)</span> </span>&#123;</span><br><span class="line">    Widget temp = a; </span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ‹“å±•å»ºè®®ï¼š"><a href="#æ‹“å±•å»ºè®®ï¼š" class="headerlink" title="æ‹“å±•å»ºè®®ï¼š"></a>æ‹“å±•å»ºè®®ï¼š</h3><h4 id="1-copy-and-swap-ä¹ æƒ¯ç”¨æ³•ä¾èµ–-noexcept"><a href="#1-copy-and-swap-ä¹ æƒ¯ç”¨æ³•ä¾èµ–-noexcept" class="headerlink" title="1. copy-and-swap ä¹ æƒ¯ç”¨æ³•ä¾èµ– noexcept"></a>1. <code>copy-and-swap</code> ä¹ æƒ¯ç”¨æ³•ä¾èµ– noexcept</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line">    <span class="built_in">Wiget</span>(<span class="type">const</span> Widget&amp; other);</span><br><span class="line">    widget&amp; <span class="keyword">operator</span>=(Widget other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="built_in">swap</span>(other);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ¨¡å¼èƒŒåçš„æ€æƒ³æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">// 1. å…ˆæ‹·è´ rhsï¼ˆå®‰å…¨ï¼Œä¸ä¼šå½±å“å½“å‰å¯¹è±¡ï¼‰ï¼›</span></span><br><span class="line"><span class="comment">// 2. å†äº¤æ¢å½“å‰å¯¹è±¡å’Œ rhs çš„å†…å®¹ï¼›</span></span><br><span class="line"><span class="comment">// 3. åŸå…ˆçš„ rhs è¢«ææ„ï¼Œé‡Šæ”¾æ—§èµ„æºï¼Œå½“å‰å¯¹è±¡æ‹¥æœ‰æ–°å€¼ã€‚</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœ <code>swap()</code> æŠ›å¼‚å¸¸ï¼Œ<code>operator=</code> å°†æ— æ³•ä¿æŒç±»çš„ä¸å˜å¼ã€‚</li>
<li>å› æ­¤ <code>copy-and-swap</code> æ¨¡å¼çš„å‰ææ˜¯ï¼š<strong><code>swap()</code> å¿…é¡» <code>noexcept</code></strong>ã€‚</li>
</ul>
<h4 id="2-æ‹“å±•ï¼šä»€ä¹ˆç±»å‹å®¹æ˜“æŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿ"><a href="#2-æ‹“å±•ï¼šä»€ä¹ˆç±»å‹å®¹æ˜“æŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿ" class="headerlink" title="2.  æ‹“å±•ï¼šä»€ä¹ˆç±»å‹å®¹æ˜“æŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿ"></a>2.  æ‹“å±•ï¼šä»€ä¹ˆç±»å‹å®¹æ˜“æŠ›å‡ºå¼‚å¸¸å‘¢ï¼Ÿ</h4><ol>
<li><p><strong>ä¾èµ–åŠ¨æ€å†…å­˜åˆ†é…çš„ç±»å‹</strong>ï¼Œ</p>
<ol>
<li>æ¯”å¦‚ <code>std::vector</code>, <code>std::string</code>, <code>std::map</code>ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆ<code>std::bad_alloc</code>ï¼‰</li>
</ol>
</li>
<li><p><strong>ç±»é‡Œæœ‰STLå®¹å™¨æˆå‘˜</strong>ï¼Œ</p>
<ul>
<li><pre><code class="language-c++">class A {
    std::vector&lt;int&gt; data;
};
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. **èµ„æºç®¡ç†ç±» ï¼ˆRAIIï¼‰**</span><br><span class="line"></span><br><span class="line">   1. ç®¡æ–‡ä»¶ã€é”ã€ç½‘ç»œ,æ¯”å¦‚ `std::ifstream`, æ‰“å¼€å¤±è´¥å¯èƒ½æŠ›å¼‚å¸¸</span><br><span class="line"></span><br><span class="line">4. **è‡ªå®šä¹‰ swap æ²¡å†™ noexcept**</span><br><span class="line"></span><br><span class="line">   1. å¦‚æœ swap é‡Œé¢ç”¨äº†å¯èƒ½æŠ›å¼‚å¸¸çš„æ“ä½œï¼ˆå¦‚ vector swapï¼‰ï¼Œå°±ä¸å®‰å…¨</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">### å°ç»“</span><br><span class="line"></span><br><span class="line">`swap()` ä¼šä¸ä¼šæŠ›å¼‚å¸¸ï¼Œå–å†³äºå®ƒæ‰€äº¤æ¢çš„æˆå‘˜å˜é‡æ˜¯å¦åœ¨ `swap` çš„è¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚**åœ¨å®ç° `swapï¼ˆï¼‰`æ—¶ï¼Œåº”å½“å°†å®ƒæ ‡è®°ä¸º `noexcept`ï¼Œ å¹¶ç¡®ä¿å…¶ä¸­æ‰€æœ‰ `swap()`æ“ä½œæœ¬èº«ä¹Ÿæ˜¯`noexcept`çš„ï¼Œ**ä»è€Œä¿è¯ `copy-and-swap` æ¨¡å¼çš„å¼‚å¸¸å®‰å…¨ï¼</span><br><span class="line"></span><br><span class="line">åæ­£å°±ä¸€å¥è¯ï¼Œæœ‰å †å†…å­˜æˆ–`` STL` å®¹å™¨çš„ç±»å‹ï¼Œ`swap` å¯èƒ½æŠ›å¼‚å¸¸ï¼›åŸå§‹ç±»å‹å’Œç®€å• ` struct `ä¸€èˆ¬ä¸ä¼šæŠ›!</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">## æ¡æ¬¾26ï¼šå°½å¯èƒ½å»¶åå˜é‡å®šä¹‰å¼çš„å‡ºç°æ—¶é—´</span><br><span class="line"></span><br><span class="line">&gt; *Postpone variable definitions as long as possible*</span><br><span class="line"></span><br><span class="line">### æ ¸å¿ƒç†å¿µ</span><br><span class="line"></span><br><span class="line">åœ¨`C++`ä¸­ï¼Œä½ æœ€å¥½å°†å˜é‡çš„å®šä¹‰**å»¶ååˆ°çœŸæ­£éœ€è¦å¹¶èƒ½ç«‹å³åˆå§‹åŒ–çš„æ—¶å€™**ã€‚è¿™æ ·å¯ä»¥**é¿å…ä¸å¿…è¦çš„æ„é€ å’Œææ„æ“ä½œï¼Œå‡å°‘èµ„æºæµªè´¹**ï¼›å¦‚æœæ„é€ å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿèƒ½ç¡®ä¿**å¼‚å¸¸å‘ç”Ÿåœ¨  `try `å—å†…éƒ¨ï¼Œå¯ä»¥åŠæ—¶æ•è·**ï¼›å¦ä¸€æ–¹é¢ä½¿ç”¨èµ·æ¥**é€»è¾‘æ›´æ¸…æ™°ï¼Œä»£ç ç´§å‡‘ä¸€ç‚¹ä¹Ÿä¸å®¹æ˜“å‡ºé”™**ã€‚</span><br><span class="line"></span><br><span class="line">### æ·±åº¦è§£æ</span><br><span class="line"></span><br><span class="line">#### 1.é¿å…æ— æ„ä¹‰çš„æ„é€ ã€ææ„</span><br><span class="line"></span><br><span class="line">- å¦‚æœä½ æå‰å®šä¹‰äº†ä¸€ä¸ªå˜é‡ä½†åé¢æ²¡ç”¨åˆ°ï¼Œå®ƒçš„æ„é€ å’Œææ„å°±æ˜¯**çº¯æµªè´¹**ã€‚</span><br><span class="line">- ç‰¹åˆ«æ˜¯åƒ `std::vector`ã€`std::string`ã€æ–‡ä»¶æµç­‰è¿™äº›**èµ„æºæ•æ„Ÿå‹å¯¹è±¡**ï¼Œæ„é€ ä¸€æ¬¡å°±æœ‰å¼€é”€ã€‚</span><br><span class="line">- ç­‰åˆ°çœŸè¦ç”¨çš„æ—¶å€™å†åˆ›å»ºï¼Œæ‰æ˜¯å¯¹èµ„æºè´Ÿè´£çš„åšæ³•ã€‚</span><br><span class="line"></span><br><span class="line">####  2. æå‡å¼‚å¸¸å®‰å…¨æ€§</span><br><span class="line"></span><br><span class="line">- æ„é€ å‡½æ•°ä¸€æ—¦æŠ›å¼‚å¸¸ï¼Œè€Œå˜é‡åˆå®šä¹‰åœ¨ `try` å—å¤–ï¼Œå°±**æ— æ³•è¢«æ•è·**ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚</span><br><span class="line">-  **åº”åœ¨ `try` å†…æ„é€ å¯¹è±¡**ï¼Œè€Œä¸æ˜¯åœ¨ `try` å¤–å…ˆå®šä¹‰</span><br><span class="line"></span><br><span class="line">#### 3. æ›´å°‘çš„ä½œç”¨åŸŸï¼Œ ç®¡ç†æ›´ç®€å•ï¼Œä»£ç æ›´æ¸…æ™°ã€‚	</span><br><span class="line"></span><br><span class="line">- å»¶è¿Ÿå®šä¹‰è‡ªç„¶ç¼©çŸ­å˜é‡ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ä½œç”¨åŸŸæœ€å°åŒ–ï¼Œ**è¢«è¯¯ç”¨æˆ–é‡å¤ä½¿ç”¨çš„å¯èƒ½æ€§è¶Šä½**ã€‚ã€‚</span><br><span class="line">- å»¶è¿Ÿå®šä¹‰èƒ½è®©å˜é‡å’Œå®ƒçš„ç”¨é€”é å¾—å¾ˆè¿‘ï¼Œ**é€»è¾‘æ›´ç´§å‡‘ï¼Œå¯è¯»æ€§æ›´å¥½**ã€‚</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">#### æ€»ç»“</span><br><span class="line"></span><br><span class="line">&gt; åˆç†æ¨è¿Ÿå˜é‡å®šä¹‰æ—¶æœºï¼Œæ˜¯å†™å‡ºèµ„æºé«˜æ•ˆã€å®‰å…¨ä¸”å¯è¯»æ€§å¼ºä»£ç çš„é‡è¦ä¹ æƒ¯ã€‚</span><br><span class="line"></span><br><span class="line">-------</span><br><span class="line"></span><br><span class="line">## æ¡æ¬¾27ï¼šé¿å…è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæˆ–å¼•ç”¨</span><br><span class="line"></span><br><span class="line">&gt; *Avoid returning pointers or references to local objects*</span><br><span class="line"></span><br><span class="line">### æ ¸å¿ƒç†å¿µ</span><br><span class="line"></span><br><span class="line">ç»ä¸èƒ½è¿”å›æŒ‡å‘å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œå› ä¸ºå±€éƒ¨å˜é‡åœ¨å‡½æ•°ç»“æŸæ—¶é”€æ¯ï¼ŒæŒ‡é’ˆæˆ–å¼•ç”¨å°†å˜æˆæ‚¬ç©ºæŒ‡é’ˆï¼Œä¸€æ—¦è¢«è®¿é—®ï¼Œå¯èƒ½ä¼šå¼•å‘æœªå®šä¹‰è¡Œä¸ºã€‚</span><br><span class="line"></span><br><span class="line">### æ·±åº¦è§£æ</span><br><span class="line"></span><br><span class="line">#### 1.å±€éƒ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçŸ­æš‚</span><br><span class="line"></span><br><span class="line">- å‡½æ•°ç»“æŸåï¼Œå±€éƒ¨å¯¹è±¡è¢«é”€æ¯ï¼Œè¿”å›çš„æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘æ— æ•ˆå†…å­˜ã€‚</span><br><span class="line"></span><br><span class="line">####  2. è®¿é—®æ‚¬ç©ºæŒ‡é’ˆå¯¼è‡´æœªå®šä¹‰è¡Œä¸º</span><br><span class="line"></span><br><span class="line">- å±€éƒ¨å˜é‡é€šå¸¸è¢«åˆ†é…åœ¨æ ˆç©ºé—´ä¸Šï¼Œå‡½æ•°è¿”å›æ—¶ï¼Œæ ˆæŒ‡é’ˆå‘ä¸Šç§»åŠ¨ï¼Œå±€éƒ¨å˜é‡æ‰€å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾ã€‚</span><br><span class="line">- å‡½æ•°è¿”å›åï¼Œå±€éƒ¨å˜é‡çš„å†…å­˜ç©ºé—´å¹¶ä¸ä¼šè¢«ç«‹å³æ¸…ç©ºï¼Œè€Œæ˜¯æ ‡è®°ä¸º&quot;å¯é‡ç”¨&quot;ã€‚</span><br><span class="line">- æ‰€ä»¥è®¿é—®å±€éƒ¨å˜é‡çš„æ‚¬ç©ºæŒ‡é’ˆï¼Œç­‰åŒäºè®¿é—®ä¸€ä¸ªå·²ç»è¢«&quot;é‡Šæ”¾&quot;æˆ–è€…è¢«å…¶ä»–æ•°æ®è¦†ç›–çš„æ ˆå†…å­˜åŒºåŸŸï¼ŒCPUæ— æ³•é˜»æ­¢è¿™ç±»ï¼Œäº§ç”Ÿçš„æœªå®šä¹‰è¡Œä¸ºå°±å¾ˆå®¹æ˜“å¼•èµ·ç¨‹åºå´©æºƒç­‰å®‰å…¨é—®é¢˜ï¼</span><br><span class="line"></span><br><span class="line">#### 3. ç¡®ä¿è¿”å›çš„æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘æœ‰æ•ˆå¯¹è±¡</span><br><span class="line"></span><br><span class="line">- æœ‰äº›åœºæ™¯ä¸å¾—ä¸è¿”å›æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œï¼ˆæ¯”å¦‚ä¸ºäº†é¿å…æ‹·è´å¼€é”€ï¼Œæˆ–è€…è®¿é—®å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼‰</span><br><span class="line">- ä½†å¿…é¡»ä¿è¯**è¿”å›çš„åœ°å€æŒ‡å‘çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæ¯”è°ƒç”¨è€…æ›´é•¿**ï¼Œé¿å…æ‚¬æŒ‚æŒ‡é’ˆã€‚</span><br><span class="line"></span><br><span class="line">### æ‹“å±•å»ºè®®</span><br><span class="line"></span><br><span class="line">#### 1. ä¼˜å…ˆæŒ‰å€¼è¿”å›å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">- #### è™½ç„¶ä¼ ç»ŸæŒ‰å€¼è¿”å›ç›¸å½“äºç»™è°ƒç”¨è€…æ‹·è´äº†ä¸€ä»½å±€éƒ¨å¯¹è±¡çš„å‰¯æœ¬ã€‚**ä½†åœ¨ C++ 11ä¸­ï¼Œè¿”å›å¯¹è±¡çš„å€¼ç»“åˆç§»åŠ¨è¯­ä¹‰å’Œè¿”å›å€¼ä¼˜åŒ–ï¼ˆRVOï¼Œï¼‰ç›´æ¥åœ¨è°ƒç”¨è€…å†…å­˜æ„é€ è¿”å›å¯¹è±¡ï¼Œè·³è¿‡æ‹·è´å·²ç»è¶³å¤Ÿé«˜æ•ˆï¼Œæ— éœ€åˆ»æ„è¿”å›å¼•ç”¨æˆ–æŒ‡é’ˆæ¥æé«˜æ€§èƒ½ã€‚**</span><br><span class="line"></span><br><span class="line">- å½“ RVO ä¸èƒ½åº”ç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä½¿ç”¨**ç§»åŠ¨æ„é€ å‡½æ•°**æ›¿ä»£æ‹·è´æ„é€ ï¼Œ**è½¬ç§»èµ„æºæ‰€æœ‰æƒï¼Œæå¤§å‡å°‘æ€§èƒ½å¼€é”€**ã€‚</span><br><span class="line"></span><br><span class="line">  - **æ‹·è´è¯­ä¹‰**æ˜¯æŠŠå¯¹è±¡çš„å†…å®¹ï¼ˆæ¯”å¦‚å †ä¸Šçš„æ•°ç»„ã€å­—ç¬¦ä¸²ç¼“å†²åŒºç­‰ï¼‰å®Œæ•´å¤åˆ¶ä¸€ä»½ï¼Œä¸¤ä¸ªå¯¹è±¡å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºï¼Œå¼€é”€è¾ƒå¤§ã€‚</span><br><span class="line">  - **ç§»åŠ¨è¯­ä¹‰**åˆ™æ˜¯æŠŠåŸå¯¹è±¡å†…éƒ¨çš„æŒ‡é’ˆæˆ–è€…èµ„æºå¥æŸ„ç›´æ¥&quot;æ¬ç»™&quot;æ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡æ¥ç®¡èµ„æºæ‰€æœ‰æƒï¼ŒåŸå¯¹è±¡åˆ™ç½®ä¸ºç©ºæˆ–æ¢å¤åˆ°ä¸€ä¸ª&quot;ç©ºå£³&quot;çŠ¶æ€ï¼Œé¿å…äº†å®é™…æ•°æ®çš„å¤åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">```c++</span><br><span class="line">std::vector&lt;int&gt; v1 = &#123;1, 2, 3, 4&#125;;</span><br><span class="line"></span><br><span class="line">// ä¼ ç»Ÿæ‹·è´ï¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼Œä¸¤ä¸ª vector å„æœ‰ç‹¬ç«‹å†…å­˜</span><br><span class="line">std::vector&lt;int&gt; v2 = v1;  </span><br><span class="line"></span><br><span class="line">// ç§»åŠ¨è¯­ä¹‰ï¼šv2 ç›´æ¥æ‹¿èµ° v1 çš„å†…éƒ¨æ•°ç»„æŒ‡é’ˆï¼Œv1 å˜ä¸ºç©º</span><br><span class="line">std::vector&lt;int&gt; v3 = std::move(v1);</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="2-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†éœ€è¦è¿”å›çš„åŠ¨æ€å¯¹è±¡ã€‚"><a href="#2-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†éœ€è¦è¿”å›çš„åŠ¨æ€å¯¹è±¡ã€‚" class="headerlink" title="2. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†éœ€è¦è¿”å›çš„åŠ¨æ€å¯¹è±¡ã€‚"></a>2. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†éœ€è¦è¿”å›çš„åŠ¨æ€å¯¹è±¡ã€‚</h4><ul>
<li><p>å½“å‡½æ•°åˆ›å»ºä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼ˆç”¨ <code>new</code>ï¼‰ï¼Œä¸”è¯¥å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸéœ€è¦è¶…å‡ºå‡½æ•°æœ¬èº«ï¼ˆå³ä¸èƒ½å±€é™åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯èƒ½è¢«å¤šä¸ªå‡½æ•°æˆ–å¯¹è±¡å…±äº«ä½¿ç”¨ï¼‰ï¼Œè¿™æ—¶ç›´æ¥è¿”å›è£¸æŒ‡é’ˆéå¸¸å±é™©ï¼š</p>
</li>
<li><p>è‹¥è¦è¿”å›æŒ‡é’ˆï¼Œè¯·ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆ<code>std::unique_ptr</code>æˆ–<code>std::shared_ptr</code>ï¼‰ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢æ‚¬ç©ºæŒ‡é’ˆå’Œå†…å­˜æ³„æ¼</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">getUniquePtr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">42</span>);  <span class="comment">// åŠ¨æ€åˆ†é…ï¼Œè¿”å›æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">std::unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">getUniquePtr2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span>* rawPtr = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">42</span>);  <span class="comment">// new åˆ†é…æ™®é€šæŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">unique_ptr</span>&lt;<span class="type">int</span>&gt;(rawPtr);  <span class="comment">// ç”¨ unique_ptr åŒ…è£…è¿”å›</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; p = <span class="built_in">getUniquePtr</span>();</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; p = <span class="built_in">getUniquePtr</span>();</span><br><span class="line">    std::cout &lt;&lt; *p &lt;&lt; std::endl;  <span class="comment">// å®‰å…¨è®¿é—®</span></span><br><span class="line">    <span class="comment">// ä¸ç”¨æ‰‹åŠ¨ deleteï¼Œæ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨é‡Šæ”¾å†…å­˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨è€…ä¸éœ€è¦æ‹…å¿ƒå†…å­˜ä½•æ—¶é‡Šæ”¾ï¼Œæ™ºèƒ½æŒ‡é’ˆä¼šè‡ªåŠ¨å¸®ä½ ç®¡ç†ã€‚</p>
<ul>
<li><p><code>unique_ptr</code> è¡¨ç¤ºåªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œæ˜ç¡®è°è´Ÿè´£é”€æ¯ã€‚</p>
</li>
<li><p><code>shared_ptr</code> è¡¨ç¤ºå¤šä¸ªæ‰€æœ‰è€…å…±äº«ï¼Œç›´åˆ°æœ€åä¸€ä¸ªé”€æ¯æ‰é‡Šæ”¾èµ„æºã€‚</p>
</li>
<li><pre><code class="language-c++">std::unique_ptr&lt;Foo&gt; createUniqueFoo() {
    return std::make_unique&lt;Foo&gt;();  // è¿”å›å”¯ä¸€æ‰€æœ‰æƒï¼Œè°ƒç”¨è€…æ¥ç®¡
}

std::shared_ptr&lt;Foo&gt; createSharedFoo() {
    return std::make_shared&lt;Foo&gt;();  // è¿”å›å…±äº«æ‰€æœ‰æƒï¼Œå¤šä¸ªè°ƒç”¨è€…å¯å…±äº«
}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### æ€»ç»“</span><br><span class="line"></span><br><span class="line">&gt; è¿”å›å±€éƒ¨å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ˜¯å¤§å¿Œï¼Œåˆç†ä½¿ç”¨æŒ‰å€¼è¿”å›å’Œæ™ºèƒ½æŒ‡é’ˆï¼Œæ‰èƒ½å†™å‡ºå®‰å…¨é«˜æ•ˆçš„ç°ä»£ C++ ä»£ç ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## æ¡æ¬¾28ï¼šé¿å…è¿”å›å¥æŸ„åˆ°å¯¹è±¡å†…éƒ¨æˆåˆ†</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### ä¸€ã€ä»€ä¹ˆæ˜¯ &quot;å¥æŸ„&quot; ä¸ &quot;å¯¹è±¡å†…éƒ¨æˆåˆ†&quot;ï¼Ÿ</span><br><span class="line"></span><br><span class="line">- **å¥æŸ„ï¼ˆHandleï¼‰**ï¼šåœ¨ C++ ä¸­é€šå¸¸æŒ‡**æŒ‡é’ˆã€å¼•ç”¨æˆ–è¿­ä»£å™¨**ï¼Œå®ƒä»¬èƒ½ç›´æ¥è®¿é—®å¯¹è±¡çš„å†…éƒ¨æ•°æ®æˆ–æˆå‘˜ã€‚</span><br><span class="line">- **å¯¹è±¡å†…éƒ¨æˆåˆ†**ï¼šæŒ‡ç±»ä¸­è¢«å°è£…çš„ç§æœ‰æˆå‘˜å˜é‡ï¼ˆå¦‚æŒ‡é’ˆã€æ•°ç»„ã€å®¹å™¨ç­‰ï¼‰æˆ–åµŒå¥—å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">### ğŸ”æ ¸å¿ƒè§‚ç‚¹</span><br><span class="line"></span><br><span class="line">&gt; **è¿”å›å¥æŸ„ï¼ˆæŒ‡é’ˆ / å¼•ç”¨ / è¿­ä»£å™¨ï¼‰ä¼šç»•è¿‡æ¥å£å±‚**ï¼Œè®©å¤–éƒ¨ä»£ç ç›´æ¥è§¦ç¢°å†…éƒ¨å®ç°ã€‚è¿™æ ·å°±ç ´åäº†**å°è£…çš„æœ¬è´¨ï¼šéš”ç¦»å˜åŒ–ï¼Œéšè—å®ç°ç»†èŠ‚ã€‚**ä¾‹å¦‚ï¼Œå¦‚æœç±»ä¸­æŸèµ„æºå·²ç»ææ„ï¼Œå´ä¾ç„¶è¢«å¤–éƒ¨å¯¹è±¡æŒæœ‰å¥æŸ„ï¼Œå°±ä¼šä¸å¯æ§ï¼Œè¿™ç§å¤±æ§å¾ˆæœ‰å¯èƒ½å¼•å‘æ‚¬ç©ºæŒ‡é’ˆã€æ•°æ®è¶Šç•Œç­‰è¿è¡Œæ—¶æœªå®šä¹‰è¡Œä¸ºï¼æ— è®ºä»æ•°æ®ä¸€è‡´æ€§çš„ç ´åã€ç”Ÿå‘½å‘¨æœŸçš„é£é™©è¿˜æ˜¯è¿åç±»å†…ä¸å˜å¼ç­‰è§’åº¦æ¥çœ‹ï¼Œéƒ½åº”è¯¥**å°½é‡é¿å…å°†ç±»å†…èµ„æºæ§åˆ¶æƒç›´æ¥äº¤ç»™å¤–éƒ¨ï¼Œå°½é‡å¸®åŠ© `const`æˆå‘˜å‡½æ•°çš„è¡Œä¸ºåƒ `const`,å°†å‘ç”Ÿ `dangling handls` çš„å¯èƒ½æ€§é™åˆ°æœ€ä½ã€‚**è¿™æ ·æ‰èƒ½éµå¾ª&quot;æœ€å°æš´éœ²åŸåˆ™&quot;ï¼Œç”¨è®¿é—®æ¥å£æ›¿ä»£å¥æŸ„è¿”å›ã€‚</span><br><span class="line"></span><br><span class="line">### ğŸ§±å…³é”®è¦ç‚¹è§£æ</span><br><span class="line"></span><br><span class="line">####  1ï¼Œ å°è£…ç ´åï¼šä» &quot;æ¥å£æ§åˆ¶&quot; åˆ° &quot;ç›´æ¥æ“ä½œ&quot; çš„å¤±æ§</span><br><span class="line"></span><br><span class="line">- å°è£…è¦æ±‚é€šè¿‡å…¬æœ‰æ–¹æ³•ï¼ˆå¦‚`setAge()`ï¼‰ç®¡ç†ç§æœ‰æ•°æ®ï¼Œè€Œè¿”å›å¥æŸ„ï¼ˆå¦‚`int&amp; getAge()`ï¼‰å…è®¸å¤–éƒ¨ç›´æ¥ä¿®æ”¹`age`ï¼Œç»•è¿‡æ–¹æ³•å†…çš„æ ¡éªŒé€»è¾‘ï¼ˆå¦‚å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">- ```C++</span><br><span class="line">  class Date &#123;</span><br><span class="line">  private:</span><br><span class="line">      int day, month, year;</span><br><span class="line">  public:</span><br><span class="line">      int&amp; getDay() &#123; return day; &#125;  // é”™è¯¯ï¼šå¤–éƒ¨å¯ç›´æ¥èµ‹å€¼day=-5</span><br><span class="line">      void setDay(int d) &#123; if (d&gt;0 &amp;&amp; d&lt;=31) day = d; &#125;  // æ­£ç¡®çš„æ ¡éªŒé€»è¾‘è¢«ç»•è¿‡</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="2ï¼Œ-æ•°æ®ä¸€è‡´æ€§ï¼šä¸šåŠ¡è§„åˆ™å¤±æ•ˆçš„éšæ‚£"><a href="#2ï¼Œ-æ•°æ®ä¸€è‡´æ€§ï¼šä¸šåŠ¡è§„åˆ™å¤±æ•ˆçš„éšæ‚£" class="headerlink" title="2ï¼Œ æ•°æ®ä¸€è‡´æ€§ï¼šä¸šåŠ¡è§„åˆ™å¤±æ•ˆçš„éšæ‚£"></a>2ï¼Œ æ•°æ®ä¸€è‡´æ€§ï¼šä¸šåŠ¡è§„åˆ™å¤±æ•ˆçš„éšæ‚£</h4><ul>
<li>ç±»çš„å†…éƒ¨æ•°æ®éœ€æ»¡è¶³ç‰¹å®šçº¦æŸï¼ˆå¦‚å®¹å™¨å¤§å°<code>size &gt;= 0</code>ï¼‰ï¼Œå¥æŸ„è¿”å›å…è®¸å¤–éƒ¨ç ´åè¿™äº›çº¦æŸã€‚</li>
<li>é‡‘èç±»<code>Account</code>çš„ä½™é¢<code>balance</code>é€šè¿‡å¥æŸ„è¢«è®¾ä¸ºè´Ÿæ•°ï¼Œç»•è¿‡ â€œä¸èƒ½é€æ”¯â€ çš„ä¸šåŠ¡è§„åˆ™ï¼›</li>
<li>æ•°ç»„ç±»<code>Array</code>çš„é•¿åº¦<code>length</code>è¢«ç›´æ¥ä¿®æ”¹ï¼Œå¯¼è‡´è®¿é—®è¶Šç•Œã€‚</li>
</ul>
<h4 id="3ï¼Œ-ç”Ÿå‘½å‘¨æœŸé£é™©ï¼šæ‚¬å‚å¥æŸ„çš„è‡´å‘½é™·é˜±"><a href="#3ï¼Œ-ç”Ÿå‘½å‘¨æœŸé£é™©ï¼šæ‚¬å‚å¥æŸ„çš„è‡´å‘½é™·é˜±" class="headerlink" title="3ï¼Œ ç”Ÿå‘½å‘¨æœŸé£é™©ï¼šæ‚¬å‚å¥æŸ„çš„è‡´å‘½é™·é˜±"></a>3ï¼Œ ç”Ÿå‘½å‘¨æœŸé£é™©ï¼šæ‚¬å‚å¥æŸ„çš„è‡´å‘½é™·é˜±</h4><ul>
<li>å¥æŸ„æŒ‡å‘çš„å†…éƒ¨å¯¹è±¡å·²ç»è¢«é”€æ¯</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	cahr* data = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">char</span>* <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> data;</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Resource</span>() &#123;</span><br><span class="line">		<span class="keyword">delete</span> [] date;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>*ptr = res.<span class="built_in">getData</span>();	</span><br><span class="line">res.~<span class="built_in">Resource</span>();     <span class="comment">// é”€æ¯å¯¹è±¡	</span></span><br><span class="line">*ptr = <span class="string">&#x27;a&#x27;</span>;			 <span class="comment">// è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜ï¼Œå¼•å‘æ®µé”™è¯¯</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®¹å™¨è¿­ä»£å™¨å› ä¸ºä¿®æ”¹å®¹å™¨å¤±æ•ˆ</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> it = vec.<span class="built_in">begin</span>();</span><br><span class="line">vec.<span class="built_in">erase</span>(vec.<span class="built_in">begin</span>()); <span class="comment">// å®¹å™¨ç»“æ„æ”¹å˜ï¼Œitå¤±æ•ˆ</span></span><br><span class="line">*it = <span class="number">10</span>ï¼›				<span class="comment">//è®¿é—®äº†å¤±æ•ˆè¿­ä»£å™¨</span></span><br></pre></td></tr></table></figure>

<h4 id="4ï¼Œ-ç±»ä¸å˜å¼ï¼ˆInvariantï¼‰çš„ç ´å"><a href="#4ï¼Œ-ç±»ä¸å˜å¼ï¼ˆInvariantï¼‰çš„ç ´å" class="headerlink" title="4ï¼Œ ç±»ä¸å˜å¼ï¼ˆInvariantï¼‰çš„ç ´å"></a>4ï¼Œ ç±»ä¸å˜å¼ï¼ˆInvariantï¼‰çš„ç ´å</h4><ul>
<li><p><strong>ä¸å˜å¼å®šä¹‰</strong>ï¼šç±»åœ¨ä»»ä½•æ“ä½œåå¿…é¡»ä¿æŒçš„çŠ¶æ€çº¦æŸï¼ˆå¦‚<code>Rectangle</code>çš„å®½é«˜å¿…é¡»ä¸ºæ­£ï¼‰ã€‚</p>
</li>
<li><p><strong>å¥æŸ„çš„å¨èƒ</strong>ï¼šå¤–éƒ¨é€šè¿‡å¥æŸ„ä¿®æ”¹æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´ä¸å˜å¼å¤±æ•ˆã€‚</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Rectangle &#123;</span><br><span class="line">private:</span><br><span class="line">	int width, height;</span><br><span class="line">public:</span><br><span class="line">	int&amp; getWidth() &#123;</span><br><span class="line">		return width;</span><br><span class="line">	&#125;	// å…è®¸å¤–éƒ¨è®¾width = -10ï¼›</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5ï¼Œconstæˆå‘˜å‡½æ•°çš„é˜²å¾¡ï¼šè®©-â€œåªè¯»â€-çœŸæ­£åªè¯»"><a href="#5ï¼Œconstæˆå‘˜å‡½æ•°çš„é˜²å¾¡ï¼šè®©-â€œåªè¯»â€-çœŸæ­£åªè¯»" class="headerlink" title="5ï¼Œconstæˆå‘˜å‡½æ•°çš„é˜²å¾¡ï¼šè®© â€œåªè¯»â€ çœŸæ­£åªè¯»"></a>5ï¼Œ<code>const</code>æˆå‘˜å‡½æ•°çš„é˜²å¾¡ï¼šè®© â€œåªè¯»â€ çœŸæ­£åªè¯»</h4><ul>
<li><p><code>const</code>æˆå‘˜å‡½æ•°åº”é¿å…è¿”å›é<code>const</code>å¥æŸ„ï¼Œé˜²æ­¢é€šè¿‡å¥æŸ„ä¿®æ”¹<code>const</code>å¯¹è±¡çš„å†…éƒ¨æ•°æ®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ConstObj</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span>&amp; <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;  <span class="comment">// å…è®¸ä¿®æ”¹constå¯¹è±¡çš„valueï¼</span></span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">int</span>&amp; <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;  <span class="comment">// åªè¯»å¼•ç”¨ï¼Œè¿™æ‰æ˜¯æ­£ç¡®åšæ³•ï¼ï¼ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> ConstObj obj;</span><br><span class="line">obj.<span class="built_in">getValue</span>() = <span class="number">10</span>;  <span class="comment">// ç¼–è¯‘é€šè¿‡ï¼Œä½†ä¿®æ”¹äº†constå¯¹è±¡</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æ€»ç»“ï¼šå°è£…çš„æœ¬è´¨æ˜¯-â€œæ§åˆ¶æƒâ€-çš„ä¿ç•™"><a href="#æ€»ç»“ï¼šå°è£…çš„æœ¬è´¨æ˜¯-â€œæ§åˆ¶æƒâ€-çš„ä¿ç•™" class="headerlink" title="æ€»ç»“ï¼šå°è£…çš„æœ¬è´¨æ˜¯ â€œæ§åˆ¶æƒâ€ çš„ä¿ç•™"></a>æ€»ç»“ï¼šå°è£…çš„æœ¬è´¨æ˜¯ â€œæ§åˆ¶æƒâ€ çš„ä¿ç•™</h3><blockquote>
<p>è¿”å›å¥æŸ„çš„æ ¸å¿ƒé—®é¢˜åœ¨äºå°†å¯¹è±¡å†…éƒ¨æ•°æ®çš„ â€œæ§åˆ¶æƒâ€ è®©æ¸¡ç»™å¤–éƒ¨ï¼Œå¯¼è‡´ç±»æ— æ³•ä¿è¯è‡ªèº«çŠ¶æ€çš„åˆæ³•æ€§ã€‚éµå¾ªæ¡æ¬¾ 28 çš„æœ¬è´¨æ˜¯ï¼š<strong>è®©å¯¹è±¡å¯¹è‡ªå·±çš„çŠ¶æ€å®Œå…¨è´Ÿè´£ï¼Œå¤–éƒ¨ä»…èƒ½é€šè¿‡å®‰å…¨æ¥å£è¿›è¡Œäº¤äº’</strong>ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¸­ â€œå°è£…æ€§â€ çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
</blockquote>
<h2 id="æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„ï¼"><a href="#æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„ï¼" class="headerlink" title="æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„ï¼"></a>æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„ï¼</h2><blockquote>
<p><em>Striving for exception safety is worth it!</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-25"><a href="#æ ¸å¿ƒç†å¿µ-25" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨ C++ ä¸­ï¼Œ<strong>å¼‚å¸¸å®‰å…¨</strong>æ˜¯æŒ‡å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ³„éœ²èµ„æºæˆ–å¯¼è‡´æ•°æ®ç»“æ„çš„æŸåã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¼‚å¸¸å®‰å…¨å‡½æ•°é€šå¸¸ä¼šæä¾›ä»¥ä¸‹ä¸‰ç§å¯èƒ½çš„ä¿è¯ï¼š</p>
<ul>
<li><strong>åŸºæœ¬ä¿è¯</strong>ï¼šå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºå†…çš„èµ„æºå°†å¾—åˆ°æ­£ç¡®é‡Šæ”¾ï¼Œä¸”æ‰€æœ‰å¯¹è±¡ä¿æŒä¸€è‡´æ€§ã€‚è™½ç„¶çŠ¶æ€ä¸ä¼šè¢«ç ´åï¼Œä½†æ•°æ®ç»“æ„å¯èƒ½å¤„äºä¸€ç§ä¸å¯é¢„æ–™çš„çŠ¶æ€ã€‚</li>
<li><strong>å¼ºçƒˆä¿è¯</strong>ï¼šå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºçŠ¶æ€ä¸å‘ç”Ÿæ”¹å˜ã€‚è°ƒç”¨è¿™æ ·çš„å‡½æ•°æ—¶ï¼Œè¦æœ‰ä¸€ä¸ªè®¤è¯†ï¼šè‹¥å‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œç¨‹åºå°†è¾¾åˆ°é¢„æœŸçš„çŠ¶æ€ï¼›è‹¥å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºå°†è¿”å›åˆ°å‡½æ•°è°ƒç”¨å‰çš„çŠ¶æ€ã€‚</li>
<li><strong>ä¸æŠ›å¼‚å¸¸ä¿è¯</strong>ï¼šæ‰¿è¯ºå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ç»å¯¹ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯¹å†…ç½®ç±»å‹ï¼ˆå¦‚ <code>int</code>ã€æŒ‡é’ˆç­‰ï¼‰è¿›è¡Œçš„æ“ä½œéƒ½æä¾› <code>nothrow</code> ä¿è¯ï¼Œè¿™æ˜¯å¼‚å¸¸å®‰å…¨ä»£ç çš„åŸºç¡€ã€‚</li>
</ul>
<h3 id="æ·±åº¦è§£æ-25"><a href="#æ·±åº¦è§£æ-25" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å¼‚å¸¸å®‰å…¨çš„ä¸‰ç§ä¿è¯"><a href="#1-å¼‚å¸¸å®‰å…¨çš„ä¸‰ç§ä¿è¯" class="headerlink" title="1. å¼‚å¸¸å®‰å…¨çš„ä¸‰ç§ä¿è¯"></a>1. <strong>å¼‚å¸¸å®‰å…¨çš„ä¸‰ç§ä¿è¯</strong></h4><ul>
<li><strong>åŸºæœ¬ä¿è¯</strong>ï¼š<ul>
<li>å¦‚æœå‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œèµ„æºä¼šå¾—åˆ°é‡Šæ”¾ï¼Œæ•°æ®ç»“æ„ä¼šä¿æŒä¸€è‡´æ€§ï¼Œä½†çŠ¶æ€æ— æ³•å›æ»šåˆ°åŸå§‹çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œå†…éƒ¨æ•°æ®å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ²¡æœ‰æ³„éœ²èµ„æºæˆ–è¿›å…¥ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</li>
</ul>
</li>
<li><strong>å¼ºçƒˆä¿è¯</strong>ï¼š<ul>
<li><strong>å¼ºçƒˆä¿è¯</strong>çš„æ ¸å¿ƒæ˜¯â€å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºçŠ¶æ€ä¸å‘ç”Ÿæ”¹å˜â€ã€‚å®ƒç¡®ä¿å‡½æ•°è¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥ï¼Œè‹¥å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºå°†æ¢å¤åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™ç§ä¿è¯é€šå¸¸é€šè¿‡ <strong>copy-and-swap</strong> æ¨¡å¼æ¥å®ç°ã€‚</li>
<li><strong>copy-and-swap</strong> æ¨¡å¼é€šè¿‡æ‹·è´æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œæ‰§è¡Œæ“ä½œå¹¶äº¤æ¢å¯¹è±¡çš„çŠ¶æ€ï¼Œä»è€Œä¿è¯å‡½æ•°å³ä½¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ä¹Ÿèƒ½ä¿æŒç¨‹åºçš„çŠ¶æ€ä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
<li><strong>ä¸æŠ›å¼‚å¸¸ä¿è¯</strong>ï¼š<ul>
<li>å‡½æ•°æ‰¿è¯ºæ‰§è¡Œè¿‡ç¨‹ä¸­ç»å¯¹ä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚å†…ç½®ç±»å‹ï¼ˆå¦‚ <code>int</code>ã€<code>char*</code> ç­‰ï¼‰é€šå¸¸ä¼šæä¾› <code>nothrow</code> ä¿è¯ã€‚å¯¹äºå‡½æ•°æ¥è¯´ï¼Œèƒ½å¤Ÿæä¾›ä¸æŠ›å¼‚å¸¸ä¿è¯æ˜¯å¼‚å¸¸å®‰å…¨ä»£ç çš„åŸºç¡€ã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-å¼ºçƒˆä¿è¯çš„å®ç°ï¼šcopy-and-swapæ¨¡å¼"><a href="#2-å¼ºçƒˆä¿è¯çš„å®ç°ï¼šcopy-and-swapæ¨¡å¼" class="headerlink" title="2. å¼ºçƒˆä¿è¯çš„å®ç°ï¼šcopy-and-swapæ¨¡å¼"></a>2. <strong>å¼ºçƒˆä¿è¯çš„å®ç°ï¼šcopy-and-swapæ¨¡å¼</strong></h4><p><strong>copy-and-swap</strong> æ˜¯å®ç°å¼ºçƒˆä¿è¯çš„ç»å…¸æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‡½æ•°çš„æ‰§è¡Œè¢«â€åˆ†ä¸ºä¸¤æ­¥â€ï¼šé¦–å…ˆæ‰§è¡Œæ‹·è´æ„é€ ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶å‰¯æœ¬ï¼›æ¥ç€ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œäº¤æ¢ä¸¤ä¸ªå¯¹è±¡çš„çŠ¶æ€ã€‚è‹¥å‘ç”Ÿå¼‚å¸¸ï¼Œä¸´æ—¶å¯¹è±¡ä¼šè¢«é”€æ¯ï¼ŒåŸå¯¹è±¡ä¿æŒä¸å˜ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(Widget other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="built_in">swap</span>(other);  <span class="comment">// ä½¿ç”¨ copy-and-swap æ¨¡å¼å®ç°å¼ºçƒˆä¿è¯</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&amp; other)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(_data, other._data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; _data;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>operator=</code> ä½¿ç”¨äº†æ‹·è´æ„é€ åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œè¿™æ ·å³ä½¿èµ‹å€¼è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼ŒåŸå¯¹è±¡å’Œä¸´æ—¶å¯¹è±¡çš„çŠ¶æ€ä¹Ÿèƒ½äº’æ¢ï¼Œä¿æŒå¼ºçƒˆä¿è¯ã€‚</p>
<h4 id="3-å¼‚å¸¸å®‰å…¨æ€§ä¼ æ’­è§„åˆ™"><a href="#3-å¼‚å¸¸å®‰å…¨æ€§ä¼ æ’­è§„åˆ™" class="headerlink" title="3. å¼‚å¸¸å®‰å…¨æ€§ä¼ æ’­è§„åˆ™"></a>3. <strong>å¼‚å¸¸å®‰å…¨æ€§ä¼ æ’­è§„åˆ™</strong></h4><p>å‡½æ•°çš„å¼‚å¸¸å®‰å…¨ä¿è¯é€šå¸¸ç­‰äºå®ƒæ‰€è°ƒç”¨çš„å…¶ä»–å‡½æ•°çš„æœ€å¼±ä¿è¯ã€‚å¦‚æœä½ è°ƒç”¨çš„å‡½æ•°æä¾›çš„æ˜¯ <strong>åŸºæœ¬ä¿è¯</strong>ï¼Œé‚£ä¹ˆä½ è‡ªå·±çš„å‡½æ•°ä¹Ÿåªèƒ½æä¾› <strong>åŸºæœ¬ä¿è¯</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å¦‚æœä½ è°ƒç”¨çš„åº•å±‚å‡½æ•°æ— æ³•æä¾›å¼ºçƒˆä¿è¯ï¼Œé‚£ä¹ˆä½ è‡ªå·±çš„å‡½æ•°å³ä½¿å°è¯•å®ç°å¼ºçƒˆä¿è¯ï¼Œä¹Ÿä¼šå—åˆ°é™åˆ¶ï¼Œæœ€ç»ˆåªèƒ½æä¾›åŸºæœ¬ä¿è¯ã€‚</li>
</ul>
<p>è¿™ç§ä¼ æ’­è§„åˆ™æ„å‘³ç€ï¼Œç¼–å†™å¼‚å¸¸å®‰å…¨ä»£ç æ—¶ï¼Œé™¤äº†ä¿è¯è‡ªå·±çš„å‡½æ•°å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§å¤–ï¼Œè¿˜åº”ç¡®ä¿æ‰€è°ƒç”¨çš„å‡½æ•°å…·å¤‡ç›¸åº”çš„å¼‚å¸¸å®‰å…¨ä¿è¯ã€‚</p>
<h4 id="4-å¼‚å¸¸å®‰å…¨ä¸èµ„æºç®¡ç†"><a href="#4-å¼‚å¸¸å®‰å…¨ä¸èµ„æºç®¡ç†" class="headerlink" title="4. å¼‚å¸¸å®‰å…¨ä¸èµ„æºç®¡ç†"></a>4. <strong>å¼‚å¸¸å®‰å…¨ä¸èµ„æºç®¡ç†</strong></h4><p>èµ„æºç®¡ç†ç±»ï¼ˆå¦‚ <code>std::vector</code>ã€<code>std::string</code>ï¼‰å·²ç»å®ç°äº†å¼ºçƒˆä¿è¯ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨è¿™äº›ç±»æ—¶ï¼Œå¯ä»¥ä¾èµ–å…¶æä¾›çš„å¼‚å¸¸å®‰å…¨ä¿éšœã€‚RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰åŸåˆ™åœ¨æ­¤ç±»ç®¡ç†ä¸­èµ·åˆ°äº†å…³é”®ä½œç”¨ï¼Œç¡®ä¿èµ„æºåœ¨ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileHandler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileHandler</span>(<span class="type">const</span> std::string&amp; filename) : <span class="built_in">file_</span>(std::<span class="built_in">fopen</span>(filename.<span class="built_in">c_str</span>(), <span class="string">&quot;r&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!file_) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;File open failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">FileHandler</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (file_) std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›å¼ºçƒˆä¿è¯çš„ç§»åŠ¨æ„é€ å’Œèµ‹å€¼</span></span><br><span class="line">    <span class="built_in">FileHandler</span>(FileHandler&amp;&amp; other) <span class="keyword">noexcept</span> : <span class="built_in">file_</span>(other.file_) &#123;</span><br><span class="line">        other.file_ = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FileHandler&amp; <span class="keyword">operator</span>=(FileHandler&amp;&amp; other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file_) std::<span class="built_in">fclose</span>(file_);</span><br><span class="line">            file_ = other.file_;</span><br><span class="line">            other.file_ = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FILE* file_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="5-é€‰æ‹©é€‚å½“çš„å¼‚å¸¸å®‰å…¨ä¿è¯"><a href="#5-é€‰æ‹©é€‚å½“çš„å¼‚å¸¸å®‰å…¨ä¿è¯" class="headerlink" title="5. é€‰æ‹©é€‚å½“çš„å¼‚å¸¸å®‰å…¨ä¿è¯"></a>5. <strong>é€‰æ‹©é€‚å½“çš„å¼‚å¸¸å®‰å…¨ä¿è¯</strong></h4><p>å¯¹äºæ¯ä¸ªå‡½æ•°ï¼Œé€‰æ‹©é€‚å½“çš„å¼‚å¸¸å®‰å…¨ä¿è¯æ˜¯å¾ˆé‡è¦çš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæä¾› <strong>å¼ºçƒˆä¿è¯</strong> æ˜¯ç†æƒ³çš„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½èƒ½å®ç°æˆ–é€‚ç”¨è¿™ä¸€ä¿è¯ï¼Œå°¤å…¶æ˜¯åœ¨å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæä¾› <strong>åŸºæœ¬ä¿è¯</strong> æˆ– <strong>ä¸æŠ›å¼‚å¸¸ä¿è¯</strong> æ›´åŠ ç°å®ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæä¾› <strong>å¼ºçƒˆä¿è¯</strong> æˆ– <strong>åŸºæœ¬ä¿è¯</strong> æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ã€‚</p>
<h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><strong>ä¸ºå¼‚å¸¸å®‰å…¨è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</strong>ã€‚é€šè¿‡æä¾› <strong>åŸºæœ¬ä¿è¯</strong>ã€<strong>å¼ºçƒˆä¿è¯</strong> å’Œ <strong>ä¸æŠ›å¼‚å¸¸ä¿è¯</strong>ï¼Œä½ å¯ä»¥ç¡®ä¿å‡½æ•°å³ä½¿åœ¨é‡åˆ°å¼‚å¸¸æ—¶ä¹Ÿä¸ä¼šç ´åæ•°æ®ç»“æ„æˆ–æ³„éœ²èµ„æºã€‚è™½ç„¶ <strong>å¼ºçƒˆä¿è¯</strong> æ˜¯æœ€ç†æƒ³çš„ï¼Œä½†å®ƒå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚æˆ‘ä»¬åº”è¯¥æ ¹æ®å®é™…æƒ…å†µï¼Œå°½åŠ›ä¸ºå‡½æ•°æä¾›åˆé€‚çš„å¼‚å¸¸å®‰å…¨ä¿è¯ï¼Œç¡®ä¿ç¨‹åºåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ä¿æŒç¨³å®šå’Œä¸€è‡´ã€‚</p>
<ul>
<li>å¼‚å¸¸å®‰å…¨å‡½æ•°å³ä½¿å‘ç”Ÿå¼‚å¸¸ä¹Ÿä¸ä¼šæ³„éœ²èµ„æºæˆ–å…è®¸ä»»ä½•æ•°æ®ç»“æ„è´¥åã€‚è¿™æ ·çš„å‡½æ•°åŒºåˆ†ä¸ºä¸‰ç§å¯èƒ½çš„ä¿è¯ï¼šåŸºæœ¬å‹ã€å¼ºçƒˆå‹ã€ä¸æŠ›å¼‚å¸¸å‹ã€‚</li>
<li>â€œå¼ºçƒˆä¿è¯â€å¾€å¾€èƒ½å¤Ÿä»¥copy-and-swap å®ç°å‡ºæ¥ï¼Œ ä½†â€å¼ºçƒˆä¿è¯â€å¹¶éå¯¹ç´ æœ‰å‡½æ•°éƒ½å¯å®ç°æˆ–è€…å…·å¤‡ç°å®æ„ä¹‰ã€‚</li>
<li>å‡½æ•°æä¾›çš„â€å¼‚å¸¸å®‰å…¨ä¿è¯â€é€šå¸¸æœ€é«˜å€¼ç­‰äºå…¶æ‰€è°ƒç”¨ä¹‹å„ä¸ªå‡½æ•°çš„â€å¼‚å¸¸å®‰å…¨ä¿è¯â€ä¸­çš„æœ€å¼±è€…ã€‚</li>
</ul>
<h2 id="æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"><a href="#æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–" class="headerlink" title="æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"></a>æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–</h2><blockquote>
<p><em>Understand the ins and outs of inlining</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-26"><a href="#æ ¸å¿ƒç†å¿µ-26" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><code>inline</code>å‡½æ•°æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼šå®ƒèƒ½é€šè¿‡æ¶ˆé™¤å‡½æ•°è°ƒç”¨å¼€é”€æ¥æå‡æ€§èƒ½ï¼Œä½†è¿‡åº¦ä½¿ç”¨ä¼šå¯¼è‡´ä»£ç è†¨èƒ€ã€è°ƒè¯•å›°éš¾å’ŒäºŒè¿›åˆ¶å…¼å®¹æ€§é—®é¢˜ã€‚ç†è§£<code>inline</code>çš„å·¥ä½œæœºåˆ¶ã€é€‚ç”¨åœºæ™¯å’Œæ½œåœ¨é™·é˜±ï¼Œæ˜¯å†™å‡ºé«˜æ•ˆC++ä»£ç çš„å…³é”®ã€‚</p>
<p><strong>å…³é”®åŸåˆ™ï¼šå°†å¤§å¤šæ•°inliningé™åˆ¶åœ¨å°å‹ã€è¢«é¢‘ç¹è°ƒç”¨çš„å‡½æ•°èº«ä¸Šï¼Œè¿™å¯ä½¿æ—¥åçš„è°ƒè¯•è¿‡ç¨‹å’ŒäºŒè¿›åˆ¶å‡çº§æ›´å®¹æ˜“ï¼Œä¹Ÿå¯ä»¥ä½¿æ½œåœ¨çš„ä»£ç è†¨èƒ€é—®é¢˜æœ€å°åŒ–ã€‚</strong></p>
<h3 id="æ·±åº¦è§£æ-26"><a href="#æ·±åº¦è§£æ-26" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-inlineçš„æœ¬è´¨ï¼šå»ºè®®è€Œéå¼ºåˆ¶"><a href="#1-inlineçš„æœ¬è´¨ï¼šå»ºè®®è€Œéå¼ºåˆ¶" class="headerlink" title="1. inlineçš„æœ¬è´¨ï¼šå»ºè®®è€Œéå¼ºåˆ¶"></a>1. <strong>inlineçš„æœ¬è´¨ï¼šå»ºè®®è€Œéå¼ºåˆ¶</strong></h4><ul>
<li><strong>ç¼–è¯‘å™¨çš„è‡ªä¸»æƒ</strong>ï¼š<code>inline</code>åªæ˜¯å¯¹ç¼–è¯‘å™¨çš„å»ºè®®ï¼Œç¼–è¯‘å™¨æœ‰å®Œå…¨çš„è‡ªä¸»æƒå†³å®šæ˜¯å¦è¿›è¡Œå†…è”å±•å¼€ã€‚</li>
<li><strong>éšå¼inline</strong>ï¼šç±»å†…å®šä¹‰çš„æˆå‘˜å‡½æ•°ï¼ˆåŒ…æ‹¬<code>friend</code>å‡½æ•°ï¼‰é»˜è®¤è¢«è§†ä¸º<code>inline</code>å€™é€‰ã€‚</li>
<li><strong>æ˜¾å¼inline</strong>ï¼šé€šè¿‡<code>inline</code>å…³é”®å­—æ˜ç¡®å£°æ˜çš„å‡½æ•°ã€‚</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value; &#125;  <span class="comment">// éšå¼inlineå€™é€‰</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// friendå‡½æ•°åœ¨ç±»å†…å®šä¹‰ä¹Ÿæ˜¯éšå¼inlineå€™é€‰</span></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Widget&amp; w) &#123;</span><br><span class="line">        <span class="keyword">return</span> os &lt;&lt; w.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¾å¼inlineå£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">square</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ç¼–è¯‘å™¨æ‹’ç»å†…è”çš„å¸¸è§æƒ…å†µ"><a href="#2-ç¼–è¯‘å™¨æ‹’ç»å†…è”çš„å¸¸è§æƒ…å†µ" class="headerlink" title="2. ç¼–è¯‘å™¨æ‹’ç»å†…è”çš„å¸¸è§æƒ…å†µ"></a>2. <strong>ç¼–è¯‘å™¨æ‹’ç»å†…è”çš„å¸¸è§æƒ…å†µ</strong></h4><p>ç¼–è¯‘å™¨é€šå¸¸ä¼šæ‹’ç»å†…è”ä»¥ä¸‹ç±»å‹çš„å‡½æ•°ï¼š</p>
<ul>
<li><strong>å¤æ‚å‡½æ•°</strong>ï¼šåŒ…å«å¾ªç¯ã€é€’å½’ã€å¤æ‚æ§åˆ¶ç»“æ„çš„å‡½æ•°</li>
<li><strong>è™šå‡½æ•°</strong>ï¼šè¿è¡Œæ—¶æ‰èƒ½ç¡®å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å†…è”</li>
<li><strong>é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨</strong>ï¼šè°ƒç”¨åœ°å€åœ¨è¿è¡Œæ—¶ç¡®å®š</li>
<li><strong>è¿‡å¤§çš„å‡½æ•°</strong>ï¼šä¼šå¯¼è‡´æ˜¾è‘—çš„ä»£ç è†¨èƒ€</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">process</span><span class="params">()</span> </span>&#123; <span class="comment">/* å¤æ‚å¤„ç†é€»è¾‘ */</span> &#125;  <span class="comment">// è™šå‡½æ•°ï¼Œé€šå¸¸ä¸ä¼šå†…è”</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">complexFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŒ…å«å¾ªç¯çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¯èƒ½æ‹’ç»å†…è”</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚å¤„ç†...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">someFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">void</span> (*funcPtr)() = complexFunction;</span><br><span class="line">    <span class="built_in">funcPtr</span>();  <span class="comment">// é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼Œæ— æ³•å†…è”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-ä»£ç è†¨èƒ€é—®é¢˜"><a href="#3-ä»£ç è†¨èƒ€é—®é¢˜" class="headerlink" title="3. ä»£ç è†¨èƒ€é—®é¢˜"></a>3. <strong>ä»£ç è†¨èƒ€é—®é¢˜</strong></h4><p><strong>å†…è”å±•å¼€çš„ä»£ä»·</strong>ï¼šæ¯ä¸ªå‡½æ•°è°ƒç”¨å¤„éƒ½ä¼šæ’å…¥å‡½æ•°çš„å®Œæ•´ä»£ç å‰¯æœ¬ï¼Œå¯¼è‡´ç›®æ ‡ä»£ç ä½“ç§¯å¢å¤§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> std::string <span class="title">debugInfo</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;[DEBUG] &quot;</span> + <span class="built_in">getCurrentTime</span>() + <span class="string">&quot;: &quot;</span> + msg + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">function1</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">debugInfo</span>(<span class="string">&quot;Function 1 called&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">function2</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">debugInfo</span>(<span class="string">&quot;Function 2 called&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">function3</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">debugInfo</span>(<span class="string">&quot;Function 3 called&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœå†…è”ï¼ŒdebugInfoçš„ä»£ç ä¼šåœ¨æ¯ä¸ªè°ƒç”¨ç‚¹éƒ½å¤åˆ¶ä¸€ä»½</span></span><br><span class="line"><span class="comment">// å¯èƒ½å¯¼è‡´æ˜¾è‘—çš„ä»£ç è†¨èƒ€</span></span><br></pre></td></tr></table></figure>

<p><strong>å¹³è¡¡ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>å°å‡½æ•°ä¼˜å…ˆ</strong>ï¼š1-3è¡Œçš„ç®€å•å‡½æ•°æ˜¯æœ€ä½³å€™é€‰</li>
<li><strong>é¢‘ç¹è°ƒç”¨</strong>ï¼šè¢«é«˜é¢‘è°ƒç”¨çš„å‡½æ•°å†…è”æ”¶ç›Šæ›´å¤§</li>
<li><strong>æ€§èƒ½å…³é”®è·¯å¾„</strong>ï¼šåœ¨æ€§èƒ½ç“¶é¢ˆå¤„è°¨æ…ä½¿ç”¨</li>
</ul>
<h4 id="4-è°ƒè¯•å›°éš¾"><a href="#4-è°ƒè¯•å›°éš¾" class="headerlink" title="4. è°ƒè¯•å›°éš¾"></a>4. <strong>è°ƒè¯•å›°éš¾</strong></h4><p>å†…è”å‡½æ•°åœ¨è°ƒè¯•æ—¶æ— æ³•è®¾ç½®æ–­ç‚¹ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç¼–è¯‘åå·²ç»â€æ¶ˆå¤±â€äº†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> temp = a * <span class="number">2</span>;      <span class="comment">// è°ƒè¯•æ—¶æ— æ³•åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> temp + b;       <span class="comment">// æˆ–è€…è¿™é‡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = <span class="built_in">calculate</span>(<span class="number">10</span>, <span class="number">20</span>);  <span class="comment">// æ–­ç‚¹åªèƒ½è®¾åœ¨è°ƒç”¨å¤„</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è°ƒè¯•å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¼€å‘æœŸé—´æš‚æ—¶ç§»é™¤<code>inline</code></li>
<li>ä½¿ç”¨ç¼–è¯‘å™¨çš„è°ƒè¯•å‹å¥½é€‰é¡¹</li>
<li>Releaseç‰ˆæœ¬æ‰å¯ç”¨æ¿€è¿›çš„å†…è”ä¼˜åŒ–</li>
</ul>
<h4 id="5-äºŒè¿›åˆ¶å…¼å®¹æ€§é—®é¢˜"><a href="#5-äºŒè¿›åˆ¶å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="5. äºŒè¿›åˆ¶å…¼å®¹æ€§é—®é¢˜"></a>5. <strong>äºŒè¿›åˆ¶å…¼å®¹æ€§é—®é¢˜</strong></h4><p>å†…è”å‡½æ•°çš„ä¿®æ”¹ä¼šå½±å“æ‰€æœ‰ä½¿ç”¨å®ƒçš„ç¼–è¯‘å•å…ƒï¼Œç ´åäºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library.h (ç‰ˆæœ¬1.0)</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;  <span class="comment">// ç‰ˆæœ¬1.0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// library.h (ç‰ˆæœ¬1.1) </span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">110</span>;  <span class="comment">// ç‰ˆæœ¬1.1ï¼Œä¿®æ”¹äº†å®ç°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// client.cpp ç”¨ç‰ˆæœ¬1.0ç¼–è¯‘ï¼Œä½†é“¾æ¥äº†ç‰ˆæœ¬1.1çš„åº“</span></span><br><span class="line"><span class="comment">// å¯èƒ½ä¼šå‡ºç°ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜</span></span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>åº“çš„å…¬å…±æ¥å£é¿å…ä½¿ç”¨å†…è”å‡½æ•°</li>
<li>ä½¿ç”¨ç¼–è¯‘æ—¶ç‰ˆæœ¬æ£€æŸ¥</li>
<li>æä¾›ç¨³å®šçš„ABIï¼ˆåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼‰</li>
</ul>
<h4 id="6-æ¨¡æ¿å‡½æ•°çš„ç‰¹æ®Šè€ƒè™‘"><a href="#6-æ¨¡æ¿å‡½æ•°çš„ç‰¹æ®Šè€ƒè™‘" class="headerlink" title="6. æ¨¡æ¿å‡½æ•°çš„ç‰¹æ®Šè€ƒè™‘"></a>6. <strong>æ¨¡æ¿å‡½æ•°çš„ç‰¹æ®Šè€ƒè™‘</strong></h4><p><strong>å¸¸è§è¯¯åŒº</strong>ï¼šè®¤ä¸ºæ¨¡æ¿å‡½æ•°åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å°±åº”è¯¥å£°æ˜ä¸º<code>inline</code>ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯æ€ç»´ï¼šæ¨¡æ¿åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå°±å£°æ˜ä¸ºinline</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">processContainer</span><span class="params">(<span class="type">const</span> std::vector&lt;T&gt;&amp; container)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; item : container) &#123;</span><br><span class="line">        <span class="comment">// å¤æ‚å¤„ç†é€»è¾‘...</span></span><br><span class="line">        <span class="built_in">complexProcessing</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®åšæ³•ï¼šåªå¯¹ç®€å•æ¨¡æ¿å‡½æ•°ä½¿ç”¨inline</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> T <span class="title">square</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value * value;  <span class="comment">// ç®€å•ã€é€‚åˆå†…è”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">complexTemplateFunction</span><span class="params">(<span class="type">const</span> T&amp; data)</span> </span>&#123;  <span class="comment">// ä¸å£°æ˜inline</span></span><br><span class="line">    <span class="comment">// å¤æ‚é€»è¾‘...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­£ç¡®åŸåˆ™</strong>ï¼š</p>
<ul>
<li>æ¨¡æ¿å‡½æ•°æ˜¯å¦å†…è”åº”åŸºäºå‡½æ•°å¤æ‚åº¦ï¼Œè€Œéæ˜¯å¦åœ¨å¤´æ–‡ä»¶ä¸­</li>
<li>ç®€å•çš„æ¨¡æ¿å‡½æ•°ï¼ˆå¦‚è®¿é—®å™¨ã€ç®€å•è®¡ç®—ï¼‰é€‚åˆå†…è”</li>
<li>å¤æ‚çš„æ¨¡æ¿å‡½æ•°åº”é¿å…å†…è”</li>
</ul>
<h4 id="7-æœ€ä½³å®è·µæŒ‡å—"><a href="#7-æœ€ä½³å®è·µæŒ‡å—" class="headerlink" title="7. æœ€ä½³å®è·µæŒ‡å—"></a>7. <strong>æœ€ä½³å®è·µæŒ‡å—</strong></h4><p><strong>é€‚åˆå†…è”çš„å‡½æ•°</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> x_, y_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… ç®€å•è®¿é—®å™¨ï¼Œé€‚åˆå†…è”</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">x</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">y</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> y_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç®€å•è®¾ç½®å™¨ï¼Œé€‚åˆå†…è”</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123; x_ = x; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setY</span><span class="params">(<span class="type">double</span> y)</span> </span>&#123; y_ = y; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… ç®€å•è®¡ç®—ï¼Œé€‚åˆå†…è”</span></span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">distanceFromOrigin</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">sqrt</span>(x_ * x_ + y_ * y_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸é€‚åˆå†…è”çš„å‡½æ•°</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ å¤æ‚é€»è¾‘ï¼Œä¸é€‚åˆå†…è”</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processLargeDataset</span><span class="params">(<span class="type">const</span> std::vector&lt;Data&gt;&amp; dataset)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; data : dataset) &#123;</span><br><span class="line">            <span class="built_in">validateData</span>(data);</span><br><span class="line">            <span class="built_in">transformData</span>(data);</span><br><span class="line">            <span class="built_in">persistData</span>(data);</span><br><span class="line">            <span class="built_in">generateReport</span>(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ è™šå‡½æ•°ï¼Œé€šå¸¸ä¸ä¼šè¢«å†…è”</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handleEvent</span><span class="params">(<span class="type">const</span> Event&amp; event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// äº‹ä»¶å¤„ç†é€»è¾‘...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-21"><a href="#æ€»ç»“-21" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>inline</code>å‡½æ•°æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é‡è¦å·¥å…·ï¼Œä½†éœ€è¦è°¨æ…ä½¿ç”¨ï¼š</p>
<p><strong>ä½•æ—¶ä½¿ç”¨inlineï¼š</strong></p>
<ul>
<li>å°å‹å‡½æ•°ï¼ˆ1-5è¡Œä»£ç ï¼‰</li>
<li>è¢«é¢‘ç¹è°ƒç”¨çš„å‡½æ•°</li>
<li>ç®€å•çš„è®¿é—®å™¨å’Œè®¾ç½®å™¨</li>
<li>æ€§èƒ½å…³é”®è·¯å¾„ä¸Šçš„ç®€å•è®¡ç®—</li>
</ul>
<p><strong>ä½•æ—¶é¿å…inlineï¼š</strong></p>
<ul>
<li>åŒ…å«å¾ªç¯ã€é€’å½’çš„å¤æ‚å‡½æ•°</li>
<li>è™šå‡½æ•°ï¼ˆç¼–è¯‘å™¨é€šå¸¸ä¼šå¿½ç•¥ï¼‰</li>
<li>åº“çš„å…¬å…±æ¥å£å‡½æ•°</li>
<li>è°ƒè¯•é˜¶æ®µçš„å‡½æ•°</li>
</ul>
<p><strong>å…³é”®åŸåˆ™ï¼š</strong></p>
<ul>
<li>å°†å¤§å¤šæ•°inliningé™åˆ¶åœ¨å°å‹ã€è¢«è°ƒç”¨é¢‘ç¹çš„å‡½æ•°èº«ä¸Š</li>
<li>ä¸è¦åªå› ä¸ºfunction templateså‡ºç°åœ¨å¤´æ–‡ä»¶ï¼Œå°±å°†å®ƒä»¬å£°æ˜ä¸ºinline</li>
<li>åœ¨æ€§èƒ½å’Œä»£ç è†¨èƒ€ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹</li>
<li>ä¼˜å…ˆè€ƒè™‘ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œè°ƒè¯•ä¾¿åˆ©æ€§</li>
</ul>
<p>friend å‡½æ•°ä¸ºä½•ä¹Ÿé»˜è®¤ inlineï¼Ÿç±»å¤–å®šä¹‰ friend å‡½æ•°ï¼Œä¸æ˜¯ inline</p>
<ul>
<li>å°†å¤§å¤šæ•°inliningé™åˆ¶åœ¨å°å‹ã€è¢«è°ƒç”¨é¢‘ç¹çš„å‡½æ•°èº«ä¸Šã€‚è¿™å¯ä½¿æ—¥åçš„è°ƒè¯•è¿‡ç¨‹å’ŒäºŒè¿›åˆ¶å‡çº§æ›´å®¹æ˜“ï¼Œä¹Ÿå¯ä»¥ä½¿æ½œåœ¨çš„ä»£ç è†¨èƒ€é—®é¢˜æœ€å°åŒ–ï¼Œä½¿å¾—ç¨‹åºçš„é€Ÿåº¦æå‡æœºä¼šæœ€å°åŒ–ã€‚</li>
<li>ä¸è¦åªå› ä¸º function templates å‡ºç°åœ¨å¤´æ–‡ä»¶ï¼Œå°±å°†å®ƒä»¬å£°æ˜ä¸ºinlineã€‚</li>
</ul>
<hr>
<h2 id="æ¡æ¬¾31ï¼šå°†æ–‡ä»¶ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"><a href="#æ¡æ¬¾31ï¼šå°†æ–‡ä»¶ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½" class="headerlink" title="æ¡æ¬¾31ï¼šå°†æ–‡ä»¶ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"></a>æ¡æ¬¾31ï¼šå°†æ–‡ä»¶ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½</h2><blockquote>
<p><em>Minimize compilation dependencies between files</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-27"><a href="#æ ¸å¿ƒç†å¿µ-27" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><blockquote>
<p>åœ¨å¤§å‹ C++ é¡¹ç›®ä¸­ï¼Œåº”å°½é‡å‡å°‘ä¸€ä¸ªæ¨¡å—å¯¹å¦ä¸€ä¸ªæ¨¡å—çš„å®ç°ç»†èŠ‚çš„ä¾èµ–ã€‚<br> <strong>ç›¸ä¾äºå£°æ˜å¼ï¼Œä¸è¦ç›¸ä¾äºå®šä¹‰å¼</strong>ï¼Œæ˜¯æœ€åŸºæœ¬çš„åŸåˆ™ã€‚</p>
</blockquote>
<p>ä¸ºæ­¤ï¼Œæ¨èä½¿ç”¨ <strong>Handle Classes</strong> å’Œ <strong>Interface Classes</strong> ç­‰è®¾è®¡æ‰‹æ®µï¼ŒåŒæ—¶ä¿æŒå¤´æ–‡ä»¶ç»“æ„ <strong>å®Œæ•´ä¸”ä»…åŒ…å«å£°æ˜ï¼ˆFull and Declaration-Onlyï¼‰</strong>ï¼Œä»¥é™ä½ç¼–è¯‘ä¾èµ–ï¼Œæé«˜å°è£…æ€§ä¸ç¼–è¯‘æ•ˆç‡ã€‚</p>
<h3 id="æ·±åº¦è§£æ-27"><a href="#æ·±åº¦è§£æ-27" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1ï¼Œ-ä¾èµ–å£°æ˜å¼ï¼Œä¸ä¾èµ–å®šä¹‰å¼"><a href="#1ï¼Œ-ä¾èµ–å£°æ˜å¼ï¼Œä¸ä¾èµ–å®šä¹‰å¼" class="headerlink" title="1ï¼Œ ä¾èµ–å£°æ˜å¼ï¼Œä¸ä¾èµ–å®šä¹‰å¼"></a>1ï¼Œ ä¾èµ–å£°æ˜å¼ï¼Œä¸ä¾èµ–å®šä¹‰å¼</h4><ul>
<li><strong>å£°æ˜å¼ä¾èµ–</strong>ï¼šåªéœ€å‰å‘å£°æ˜å³å¯å®Œæˆç¼–è¯‘ï¼Œä¸å¼•å…¥å¤´æ–‡ä»¶ã€‚</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Engine</span>;  <span class="comment">// å‰å‘å£°æ˜ï¼Œé¿å…å¼•å…¥#includeå¤–éƒ¨æ¬§æ–‡ä»¶ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘ä¾èµ–ä¼ æ’­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    Engine* engine;  <span class="comment">// å£°æ˜ä¾èµ–å³å¯ï¼Œæ— éœ€åŒ…å« Engine.h</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>å®šä¹‰å¼ä¾èµ–</strong>ï¼šéœ€è¦åŒ…å«å®Œæ•´ç±»å‹å®šä¹‰ï¼Œå¯¼è‡´ç¼–è¯‘ä¾èµ–ä¼ æ’­ã€‚</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Engine.h&quot;</span>  <span class="comment">// å¼•å…¥å®šä¹‰ï¼Œå¼•å…¥äº†æ‰€æœ‰ Engine çš„å®ç°ç»†èŠ‚</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    Engine engine;   <span class="comment">// ä¾èµ–å®ç°ç»†èŠ‚ï¼Œéœ€è¦å®Œæ•´ç±»å‹å®šä¹‰</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h4 id="2ï¼Œ-ä½¿ç”¨-Handle-Classï¼ˆPimpl-æƒ¯ç”¨æ³•ï¼‰"><a href="#2ï¼Œ-ä½¿ç”¨-Handle-Classï¼ˆPimpl-æƒ¯ç”¨æ³•ï¼‰" class="headerlink" title="2ï¼Œ ä½¿ç”¨ Handle Classï¼ˆPimpl æƒ¯ç”¨æ³•ï¼‰"></a>2ï¼Œ ä½¿ç”¨ Handle Classï¼ˆPimpl æƒ¯ç”¨æ³•ï¼‰</h4><ul>
<li>Pimplï¼ˆPointer to Implementationï¼‰æ˜¯ä¸€ç§å°†å®ç°ç»†èŠ‚<strong>å°è£…åœ¨å¦ä¸€ä¸ªç±»ä¸­</strong>çš„æŠ€æœ¯ï¼Œåªåœ¨å¤´æ–‡ä»¶ä¸­æš´éœ²æŒ‡å‘å®ç°ç±»çš„æŒ‡é’ˆï¼Œé¿å…å¤´æ–‡ä»¶æš´éœ²ä»»ä½•å®ç°ç»†èŠ‚ã€‚</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Widget.h</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WidgetImpl</span>;  <span class="comment">// å‰å‘å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    WidgetImpl* pImpl;  <span class="comment">// å®ç°è¢«éšè—</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<ul>
<li>æ”¯æŒâ€ç¼–è¯‘ä¾å­˜æ€§æœ€å°åŒ–â€çš„ä¸€èˆ¬æ„æƒ³æ˜¯ï¼š ç›¸ä¾ä¸å£°æ˜å¼ï¼Œä¸è¦ç›¸ä¾äºå®šä¹‰å¼ã€‚åŸºäºæ­¤æ„æƒ³çš„ä¿©ä¸ªæ‰‹æ®µæ˜¯ Handle classes å’Œ Interfaceclassesã€‚</li>
<li>ç¨‹åºåº“å¤´æ–‡ä»¶åº”è¯¥ä»¥ â€œå®Œæˆä»…æœ‰å£°æ˜å¼â€ ï¼ˆfull and declaration-only formsï¼‰çš„å½¢å¼å­˜åœ¨ã€‚è¿™ç§åšæ³•ä¸è®ºæ˜¯å¦æ¶‰åŠtemplates éƒ½é€‚ç”¨ã€‚</li>
</ul>
<h2 id="æ¡æ¬¾32ï¼šç¡®å®šä½ çš„-public-ç»§æ‰¿å¡‘æ¨¡å‡º-is-a-å…³ç³»"><a href="#æ¡æ¬¾32ï¼šç¡®å®šä½ çš„-public-ç»§æ‰¿å¡‘æ¨¡å‡º-is-a-å…³ç³»" class="headerlink" title="æ¡æ¬¾32ï¼šç¡®å®šä½ çš„ public ç»§æ‰¿å¡‘æ¨¡å‡º is-a å…³ç³»"></a>æ¡æ¬¾32ï¼šç¡®å®šä½ çš„ public ç»§æ‰¿å¡‘æ¨¡å‡º is-a å…³ç³»</h2><blockquote>
<p><em>Make sure public inheritance models â€œis-aâ€</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-28"><a href="#æ ¸å¿ƒç†å¿µ-28" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><code>public</code>ç»§æ‰¿æ„å‘³ç€**â€is-aâ€<strong>å…³ç³»ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç¼–ç¨‹æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ä¸ª</strong>è¯­ä¹‰å¥‘çº¦**ï¼šæ´¾ç”Ÿç±»å¯¹è±¡å°±æ˜¯ä¸€ä¸ªåŸºç±»å¯¹è±¡ï¼ŒåŸºç±»çš„æ‰€æœ‰æ€§è´¨éƒ½å¿…é¡»é€‚ç”¨äºæ´¾ç”Ÿç±»ã€‚è¿åè¿™ä¸ªåŸåˆ™ä¼šå¯¼è‡´è®¾è®¡ç¼ºé™·ï¼Œåœ¨ç¼–è¯‘æœŸå¯èƒ½é€šè¿‡ï¼Œä½†åœ¨é€»è¾‘ä¸Šæ˜¯é”™è¯¯çš„ã€‚</p>
<p><strong>æ ¸å¿ƒåŸåˆ™ï¼šé€‚ç”¨äº<code>base classes</code>èº«ä¸Šçš„æ¯ä¸€ä»¶äº‹æƒ…ä¸€å®šä¹Ÿé€‚ç”¨äº<code>derived classes</code>èº«ä¸Šï¼Œå› ä¸ºæ¯ä¸€ä¸ª<code>derived class</code>å¯¹è±¡ä¹Ÿéƒ½æ˜¯ä¸€ä¸ª<code>base class</code>å¯¹è±¡ã€‚</strong></p>
<h3 id="æ·±åº¦è§£æ-28"><a href="#æ·±åº¦è§£æ-28" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-is-aå…³ç³»çš„æœ¬è´¨"><a href="#1-is-aå…³ç³»çš„æœ¬è´¨" class="headerlink" title="1. is-aå…³ç³»çš„æœ¬è´¨"></a>1. <strong>is-aå…³ç³»çš„æœ¬è´¨</strong></h4><p><strong>is-aå…³ç³»ä¸æ˜¯ç»§æ‰¿çš„å‰¯äº§å“ï¼Œè€Œæ˜¯ç»§æ‰¿çš„ç›®çš„</strong>ã€‚å½“æˆ‘ä»¬è¯´ <code>Student</code> ç»§æ‰¿ <code>Person</code> æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨è¯´ï¼šâ€æ¯ä¸€ä¸ªå­¦ç”Ÿéƒ½æ˜¯ä¸€ä¸ªäººâ€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">walk</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sleep</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">introduce</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">study</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">introduce</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;  <span class="comment">// é‡å†™ï¼Œä½†ä»ç„¶æ˜¯Personçš„è¡Œä¸º</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processPersons</span><span class="params">(<span class="type">const</span> std::vector&lt;Person*&gt;&amp; people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span>&amp; person : people) &#123;</span><br><span class="line">        person-&gt;<span class="built_in">walk</span>();      <span class="comment">// âœ… æ¯ä¸ªStudentéƒ½èƒ½walk</span></span><br><span class="line">        person-&gt;<span class="built_in">eat</span>();       <span class="comment">// âœ… æ¯ä¸ªStudentéƒ½èƒ½eat</span></span><br><span class="line">        person-&gt;<span class="built_in">introduce</span>(); <span class="comment">// âœ… æ¯ä¸ªStudentéƒ½èƒ½introduce</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;Person*&gt; people;</span><br><span class="line">    people.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Student</span>());   <span class="comment">// âœ… å­¦ç”Ÿæ˜¯äºº</span></span><br><span class="line">    people.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Person</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">processPersons</span>(people);  <span class="comment">// æ‰€æœ‰Personçš„è¡Œä¸ºéƒ½é€‚ç”¨äºStudent</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-å¸¸è§çš„is-aå…³ç³»è¿åæ¡ˆä¾‹"><a href="#2-å¸¸è§çš„is-aå…³ç³»è¿åæ¡ˆä¾‹" class="headerlink" title="2. å¸¸è§çš„is-aå…³ç³»è¿åæ¡ˆä¾‹"></a>2. <strong>å¸¸è§çš„is-aå…³ç³»è¿åæ¡ˆä¾‹</strong></h4><p><strong>æ¡ˆä¾‹1ï¼šä¼é¹…ä¸ä¼šé£çš„ç»å…¸é—®é¢˜</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯è®¾è®¡ï¼šè¿åäº†is-aå…³ç³»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;I&#x27;m flying!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> : <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼é¹…ä¸ä¼šé£ï¼Œè¿™é‡Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</span></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Penguins can&#x27;t fly!&quot;</span>);  <span class="comment">// è¿è¡Œæ—¶é”™è¯¯</span></span><br><span class="line">        <span class="comment">// æˆ–è€…ä»€ä¹ˆéƒ½ä¸åšï¼Ÿè¿™è¿åäº†æ¥å£å¥‘çº¦</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeBirdFly</span><span class="params">(Bird&amp; bird)</span> </span>&#123;</span><br><span class="line">    bird.<span class="built_in">fly</span>();  <span class="comment">// å¦‚æœä¼ å…¥ä¼é¹…ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­£ç¡®è®¾è®¡ï¼šé‡æ–°å®¡è§†ç»§æ‰¿å±‚æ¬¡</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®è®¾è®¡ï¼šæ˜ç¡®åŒºåˆ†èƒ½é£å’Œä¸èƒ½é£çš„é¸Ÿ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">makeSound</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="comment">// ä¸åœ¨è¿™é‡Œå®šä¹‰flyï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰é¸Ÿéƒ½ä¼šé£</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingBird</span> : <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;I&#x27;m flying!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> : <span class="keyword">public</span> Bird &#123;  <span class="comment">// ä¼é¹…æ˜¯é¸Ÿï¼Œä½†ä¸æ˜¯ä¼šé£çš„é¸Ÿ</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;I&#x27;m swimming!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Eagle</span> : <span class="keyword">public</span> FlyingBird &#123;  <span class="comment">// è€é¹°æ˜¯ä¼šé£çš„é¸Ÿ</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">soar</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Soaring high!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ¡ˆä¾‹2ï¼šæ­£æ–¹å½¢å’Œé•¿æ–¹å½¢çš„é™·é˜±</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ çœ‹ä¼¼åˆç†ä½†æœ‰é—®é¢˜çš„è®¾è®¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">setWidth</span><span class="params">(<span class="type">int</span> width)</span> </span>&#123; width_ = width; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">setHeight</span><span class="params">(<span class="type">int</span> height)</span> </span>&#123; height_ = height; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getWidth</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> width_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getHeight</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> height_; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> width_ * height_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> width_, height_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> : <span class="keyword">public</span> Rectangle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setWidth</span><span class="params">(<span class="type">int</span> width)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        width_ = height_ = width;  <span class="comment">// æ­£æ–¹å½¢çš„å®½é«˜å¿…é¡»ç›¸ç­‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setHeight</span><span class="params">(<span class="type">int</span> height)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        width_ = height_ = height; <span class="comment">// æ­£æ–¹å½¢çš„å®½é«˜å¿…é¡»ç›¸ç­‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> width_;  <span class="comment">// å®é™…ä¸Šåªéœ€è¦ä¸€ä¸ªç»´åº¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°æœŸæœ›Rectangleçš„è¡Œä¸º</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processRectangle</span><span class="params">(Rectangle&amp; rect)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> oldHeight = rect.<span class="built_in">getHeight</span>();</span><br><span class="line">    rect.<span class="built_in">setWidth</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// æœŸæœ›ï¼šé«˜åº¦ä¸å˜ï¼Œåªæœ‰å®½åº¦æ”¹å˜</span></span><br><span class="line">    <span class="built_in">assert</span>(rect.<span class="built_in">getHeight</span>() == oldHeight);  <span class="comment">// å¦‚æœä¼ å…¥Squareä¼šå¤±è´¥ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>æ•°å­¦ä¸Šæ­£æ–¹å½¢æ˜¯ç‰¹æ®Šçš„é•¿æ–¹å½¢</li>
<li>ä½†åœ¨é¢å‘å¯¹è±¡è®¾è®¡ä¸­ï¼Œæ­£æ–¹å½¢è¿åäº†é•¿æ–¹å½¢çš„è¡Œä¸ºå¥‘çº¦</li>
<li>é•¿æ–¹å½¢çš„è¡Œä¸ºæœŸæœ›ï¼šè®¾ç½®å®½åº¦ä¸ä¼šå½±å“é«˜åº¦</li>
<li>æ­£æ–¹å½¢å¿…é¡»è¿åè¿™ä¸ªæœŸæœ›</li>
</ul>
<h4 id="3-is-aå…³ç³»çš„éªŒè¯æ–¹æ³•"><a href="#3-is-aå…³ç³»çš„éªŒè¯æ–¹æ³•" class="headerlink" title="3. is-aå…³ç³»çš„éªŒè¯æ–¹æ³•"></a>3. <strong>is-aå…³ç³»çš„éªŒè¯æ–¹æ³•</strong></h4><p><strong>è¯­è¨€æµ‹è¯•æ³•</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èƒ½è¯´&quot;æ¯ä¸ªStudentéƒ½æ˜¯Person&quot;å—ï¼Ÿ âœ…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person &#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èƒ½è¯´&quot;æ¯ä¸ªRectangleéƒ½æ˜¯Point&quot;å—ï¼Ÿ âŒ </span></span><br><span class="line"><span class="comment">// class Rectangle : public Point &#123; &#125;;  // é”™è¯¯ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// èƒ½è¯´&quot;æ¯ä¸ªCaréƒ½æ˜¯Vehicle&quot;å—ï¼Ÿ âœ…</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> : <span class="keyword">public</span> Vehicle &#123; &#125;;</span><br></pre></td></tr></table></figure>

<p><strong>è¡Œä¸ºä¸€è‡´æ€§æµ‹è¯•</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»çš„æ‰€æœ‰publicè¡Œä¸ºæ˜¯å¦éƒ½é€‚ç”¨äºæ´¾ç”Ÿç±»ï¼Ÿ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span> <span class="type">const</span></span>;        <span class="comment">// æ‰€æœ‰è½¦è¾†éƒ½èƒ½å¯åŠ¨å—ï¼Ÿ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accelerate</span><span class="params">()</span> <span class="type">const</span></span>;   <span class="comment">// æ‰€æœ‰è½¦è¾†éƒ½èƒ½åŠ é€Ÿå—ï¼Ÿ</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">brake</span><span class="params">()</span> <span class="type">const</span></span>;        <span class="comment">// æ‰€æœ‰è½¦è¾†éƒ½èƒ½åˆ¹è½¦å—ï¼Ÿ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElectricCar</span> : <span class="keyword">public</span> Vehicle &#123;</span><br><span class="line">    <span class="comment">// âœ… ç”µåŠ¨è½¦å¯ä»¥å¯åŠ¨ã€åŠ é€Ÿã€åˆ¹è½¦</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bicycle</span> : <span class="keyword">public</span> Vehicle &#123;</span><br><span class="line">    <span class="comment">// â“ è‡ªè¡Œè½¦èƒ½&quot;å¯åŠ¨&quot;å—ï¼Ÿå¯èƒ½éœ€è¦é‡æ–°è®¾è®¡å±‚æ¬¡</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-è®¾è®¡å»ºè®®ï¼šæ­£ç¡®å»ºç«‹is-aå…³ç³»"><a href="#4-è®¾è®¡å»ºè®®ï¼šæ­£ç¡®å»ºç«‹is-aå…³ç³»" class="headerlink" title="4. è®¾è®¡å»ºè®®ï¼šæ­£ç¡®å»ºç«‹is-aå…³ç³»"></a>4. <strong>è®¾è®¡å»ºè®®ï¼šæ­£ç¡®å»ºç«‹is-aå…³ç³»</strong></h4><p><strong>å»ºè®®1ï¼šä¼˜å…ˆç»„åˆè€Œéç»§æ‰¿</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸å…¶è®©Carç»§æ‰¿Engineï¼Œä¸å¦‚è®©CaråŒ…å«Engine</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Engine</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;  <span class="comment">// Carä¸æ˜¯Engineï¼ŒCaræœ‰Engine</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Engine engine_;  <span class="comment">// ç»„åˆå…³ç³»</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startCar</span><span class="params">()</span> </span>&#123; engine_.<span class="built_in">start</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stopCar</span><span class="params">()</span> </span>&#123; engine_.<span class="built_in">stop</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å»ºè®®2ï¼šä½¿ç”¨æ¥å£åˆ†ç¦»åŸåˆ™</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰è¡Œä¸ºæ¥å£è€Œä¸æ˜¯å…·ä½“ç±»ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Flyable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Flyable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Swimmable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Swimmable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span> : <span class="keyword">public</span> Bird, <span class="keyword">public</span> Flyable, <span class="keyword">public</span> Swimmable &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* é¸­å­é£è¡Œ */</span> &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* é¸­å­æ¸¸æ³³ */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> : <span class="keyword">public</span> Bird, <span class="keyword">public</span> Swimmable &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="comment">/* ä¼é¹…æ¸¸æ³³ */</span> &#125;</span><br><span class="line">    <span class="comment">// ä¼é¹…ä¸å®ç°Flyableï¼Œå› ä¸ºä¼é¹…ä¸ä¼šé£</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å»ºè®®3ï¼šè¿ç”¨Liskovæ›¿æ¢åŸåˆ™</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Liskovæ›¿æ¢åŸåˆ™ï¼šæ´¾ç”Ÿç±»å¯¹è±¡åº”è¯¥èƒ½å¤Ÿæ›¿æ¢åŸºç±»å¯¹è±¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Circle</span>(<span class="type">double</span> radius) : <span class="built_in">radius_</span>(radius) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14159</span> * radius_ * radius_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing circle with radius &quot;</span> &lt;&lt; radius_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> radius_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä»»ä½•æœŸæœ›Shapeçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Circle</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processShape</span><span class="params">(<span class="type">const</span> Shape&amp; shape)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Area: &quot;</span> &lt;&lt; shape.<span class="built_in">area</span>() &lt;&lt; std::endl;</span><br><span class="line">    shape.<span class="built_in">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-å®é™…åº”ç”¨ä¸­çš„æƒè¡¡"><a href="#5-å®é™…åº”ç”¨ä¸­çš„æƒè¡¡" class="headerlink" title="5. å®é™…åº”ç”¨ä¸­çš„æƒè¡¡"></a>5. <strong>å®é™…åº”ç”¨ä¸­çš„æƒè¡¡</strong></h4><p>æœ‰æ—¶ç°å®ä¸–ç•Œçš„å…³ç³»å’Œè½¯ä»¶è®¾è®¡ä¸­çš„å…³ç³»ä¸å®Œå…¨ä¸€è‡´ï¼Œéœ€è¦æ ¹æ®<strong>è½¯ä»¶çš„éœ€æ±‚</strong>æ¥å†³å®šç»§æ‰¿å…³ç³»ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç°å®ä¸­ï¼šæ­£æ–¹å½¢æ˜¯é•¿æ–¹å½¢</span></span><br><span class="line"><span class="comment">// è½¯ä»¶ä¸­ï¼šå¯èƒ½éœ€è¦ä¸åŒçš„è®¾è®¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©1ï¼šåˆ†ç¦»è®¾è®¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Quadrilateral</span> &#123;  <span class="comment">// å››è¾¹å½¢åŸºç±»</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Quadrilateral &#123;</span><br><span class="line">    <span class="comment">// é•¿æ–¹å½¢ç‰¹æœ‰çš„è¡Œä¸º</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> : <span class="keyword">public</span> Quadrilateral &#123;</span><br><span class="line">    <span class="comment">// æ­£æ–¹å½¢ç‰¹æœ‰çš„è¡Œä¸º</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€‰æ‹©2ï¼šå¦‚æœç¡®å®éœ€è¦ç»§æ‰¿ï¼Œç¡®ä¿è¡Œä¸ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// åªå®šä¹‰æ‰€æœ‰å­ç±»éƒ½éµå¾ªçš„è¡Œä¸º</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-22"><a href="#æ€»ç»“-22" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>publicç»§æ‰¿çš„æ ¸å¿ƒè¦ç‚¹ï¼š</strong></p>
<ol>
<li><strong>è¯­ä¹‰å¥‘çº¦</strong>ï¼špublicç»§æ‰¿è¡¨è¾¾çš„æ˜¯â€is-aâ€å…³ç³»ï¼Œä¸æ˜¯ä»£ç å¤ç”¨æœºåˆ¶</li>
<li><strong>è¡Œä¸ºä¸€è‡´æ€§</strong>ï¼šæ´¾ç”Ÿç±»å¿…é¡»èƒ½åœ¨æ‰€æœ‰åŸºç±»èƒ½å·¥ä½œçš„åœ°æ–¹æ­£å¸¸å·¥ä½œ</li>
<li><strong>æ¥å£å®Œæ•´æ€§</strong>ï¼šåŸºç±»çš„æ‰€æœ‰publicæ¥å£éƒ½å¿…é¡»å¯¹æ´¾ç”Ÿç±»æœ‰æ„ä¹‰</li>
<li><strong>è®¾è®¡éªŒè¯</strong>ï¼šé€šè¿‡è¯­è¨€æµ‹è¯•å’Œè¡Œä¸ºæµ‹è¯•éªŒè¯ç»§æ‰¿å…³ç³»çš„åˆç†æ€§</li>
</ol>
<p><strong>è®¾è®¡å»ºè®®ï¼š</strong></p>
<ul>
<li>ä¼˜å…ˆè€ƒè™‘ç»„åˆè€Œéç»§æ‰¿</li>
<li>ä½¿ç”¨æ¥å£åˆ†ç¦»ï¼Œé¿å…å¼ºè¿«æ´¾ç”Ÿç±»å®ç°ä¸ç›¸å…³çš„åŠŸèƒ½</li>
<li>éµå¾ªLiskovæ›¿æ¢åŸåˆ™</li>
<li>æ ¹æ®è½¯ä»¶éœ€æ±‚è€Œéç°å®å…³ç³»è®¾è®¡ç»§æ‰¿å±‚æ¬¡</li>
</ul>
<p><strong>è®°ä½ï¼š<code>public</code>ç»§æ‰¿æ„å‘³ç€â€is-aâ€ã€‚é€‚ç”¨äº<code>base classes</code>èº«ä¸Šçš„æ¯ä¸€ä»¶äº‹æƒ…ä¸€å®šä¹Ÿé€‚ç”¨äº<code>derived classes</code>èº«ä¸Šï¼Œå› ä¸ºæ¯ä¸€ä¸ª<code>derived class</code>å¯¹è±¡ä¹Ÿéƒ½æ˜¯ä¸€ä¸ª<code>base class</code>å¯¹è±¡ã€‚</strong></p>
<h2 id="æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"><a href="#æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°" class="headerlink" title="æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"></a>æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</h2><blockquote>
<p><em>Avoid hiding inherited names</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-29"><a href="#æ ¸å¿ƒç†å¿µ-29" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨ C++ ç»§æ‰¿ä½“ç³»ä¸­ï¼Œæ´¾ç”Ÿç±»ä¸­çš„åç§°ä¼š<strong>è‡ªåŠ¨é®æ©</strong>åŸºç±»ä¸­çš„åŒåæˆå‘˜ï¼Œå³ä½¿å®ƒä»¬çš„å‡½æ•°ç­¾åå®Œå…¨ä¸åŒã€‚è¿™ç§åç§°æŸ¥æ‰¾æœºåˆ¶åŸºäº<strong>ä½œç”¨åŸŸè§„åˆ™</strong>è€Œéé‡è½½è§„åˆ™ï¼Œå¯èƒ½å¯¼è‡´åŸºç±»çš„æŸäº›é‡è½½ç‰ˆæœ¬æ„å¤–â€æ¶ˆå¤±â€ã€‚åœ¨ <code>public</code> ç»§æ‰¿ä¸­ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸ºï¼Œéœ€è¦é€šè¿‡ <strong><code>using</code> å£°æ˜</strong>æˆ–<strong>è½¬äº¤å‡½æ•°</strong>æ¥æ¢å¤è¢«é®æ©çš„åç§°ã€‚</p>
<h3 id="æ·±åº¦è§£æ-29"><a href="#æ·±åº¦è§£æ-29" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-åç§°é®æ©çš„æœºåˆ¶åŸç†"><a href="#1-åç§°é®æ©çš„æœºåˆ¶åŸç†" class="headerlink" title="1. åç§°é®æ©çš„æœºåˆ¶åŸç†"></a>1. <strong>åç§°é®æ©çš„æœºåˆ¶åŸç†</strong></h4><p>C++ çš„åç§°æŸ¥æ‰¾éµå¾ª<strong>ä½œç”¨åŸŸä¼˜å…ˆ</strong>åŸåˆ™ï¼Œè€Œä¸æ˜¯é‡è½½åŒ¹é…åŸåˆ™ã€‚å½“ç¼–è¯‘å™¨åœ¨æ´¾ç”Ÿç±»ä¸­æ‰¾åˆ°åŒ¹é…çš„åç§°æ—¶ï¼Œå°±ä¼šåœæ­¢å‘ä¸ŠæŸ¥æ‰¾ï¼Œå³ä½¿åŸºç±»ä¸­æœ‰æ›´åˆé€‚çš„é‡è½½ç‰ˆæœ¬ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿåç§°é®æ©ï¼Ÿ</strong></p>
<ul>
<li><strong>ä½œç”¨åŸŸè§„åˆ™</strong>ï¼šæ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸåµŒå¥—åœ¨åŸºç±»ä½œç”¨åŸŸå†…ï¼Œå†…å±‚ä½œç”¨åŸŸçš„åç§°ä¼šé®æ©å¤–å±‚ä½œç”¨åŸŸçš„åŒåæ ‡è¯†ç¬¦</li>
<li><strong>æŸ¥æ‰¾é¡ºåº</strong>ï¼šç¼–è¯‘å™¨é¦–å…ˆåœ¨æ´¾ç”Ÿç±»ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åç§°ï¼Œæ‰¾åˆ°åå°±åœæ­¢ï¼Œä¸å†æŸ¥æ‰¾åŸºç±»ä½œç”¨åŸŸ</li>
<li><strong>ä¸é‡è½½æ— å…³</strong>ï¼šå³ä½¿å‡½æ•°ç­¾åå®Œå…¨ä¸åŒï¼Œåªè¦åç§°ç›¸åŒå°±ä¼šå‘ç”Ÿé®æ©</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;           <span class="comment">// åŸºç±»çš„é‡è½½ç‰ˆæœ¬</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">double</span>)</span></span>;                <span class="comment">// åŸºç±»çš„é‡è½½ç‰ˆæœ¬</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span></span>;              <span class="comment">// é®æ©äº† Base::mf1(int)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span></span>;                      <span class="comment">// é®æ©äº† Base::mf3() å’Œ Base::mf3(double)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    d.<span class="built_in">mf1</span>();        <span class="comment">// âœ… æ­£ç¡®ï¼šè°ƒç”¨ Derived::mf1()</span></span><br><span class="line">    d.<span class="built_in">mf1</span>(x);       <span class="comment">// âŒ é”™è¯¯ï¼šBase::mf1(int) è¢«é®æ©ï¼Œæ— æ³•è°ƒç”¨</span></span><br><span class="line">    d.<span class="built_in">mf2</span>();        <span class="comment">// âœ… æ­£ç¡®ï¼šè°ƒç”¨ç»§æ‰¿çš„ Base::mf2()</span></span><br><span class="line">    d.<span class="built_in">mf3</span>();        <span class="comment">// âœ… æ­£ç¡®ï¼šè°ƒç”¨ Derived::mf3()</span></span><br><span class="line">    d.<span class="built_in">mf3</span>(x);       <span class="comment">// âŒ é”™è¯¯ï¼šBase::mf3(double) è¢«é®æ©ï¼Œæ— æ³•è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-publicç»§æ‰¿ä¸­åç§°é®æ©çš„é—®é¢˜"><a href="#2-publicç»§æ‰¿ä¸­åç§°é®æ©çš„é—®é¢˜" class="headerlink" title="2. publicç»§æ‰¿ä¸­åç§°é®æ©çš„é—®é¢˜"></a>2. <strong>publicç»§æ‰¿ä¸­åç§°é®æ©çš„é—®é¢˜</strong></h4><p>åœ¨ <code>public</code> ç»§æ‰¿ä¸­ï¼Œåç§°é®æ©è¿åäº† <strong>is-a</strong> å…³ç³»çš„åŸºæœ¬åŸåˆ™ã€‚å¦‚æœ <code>Derived</code> æ˜¯ä¸€ç§ <code>Base</code>ï¼Œé‚£ä¹ˆä»»ä½•é€‚ç”¨äº <code>Base</code> å¯¹è±¡çš„æ“ä½œéƒ½åº”è¯¥é€‚ç”¨äº <code>Derived</code> å¯¹è±¡ã€‚</p>
<p><strong>è¿å is-a å…³ç³»çš„ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">speak</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">speak</span><span class="params">(<span class="type">const</span> std::string&amp; language)</span></span>;    <span class="comment">// é‡è½½ï¼šæŒ‡å®šè¯­è¨€è¯´è¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">speak</span><span class="params">()</span></span>;    <span class="comment">// åªé‡å†™äº†æ— å‚ç‰ˆæœ¬ï¼Œä½†é®æ©äº†æœ‰å‚ç‰ˆæœ¬</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person p;</span><br><span class="line">    Student s;</span><br><span class="line">    </span><br><span class="line">    p.<span class="built_in">speak</span>();                    <span class="comment">// âœ… æ­£ç¡®</span></span><br><span class="line">    p.<span class="built_in">speak</span>(<span class="string">&quot;English&quot;</span>);           <span class="comment">// âœ… æ­£ç¡®</span></span><br><span class="line">    </span><br><span class="line">    s.<span class="built_in">speak</span>();                    <span class="comment">// âœ… æ­£ç¡®</span></span><br><span class="line">    s.<span class="built_in">speak</span>(<span class="string">&quot;English&quot;</span>);           <span class="comment">// âŒ é”™è¯¯ï¼è¿åäº† is-a å…³ç³»</span></span><br><span class="line">    <span class="comment">// Student åº”è¯¥èƒ½åš Person èƒ½åšçš„ä¸€åˆ‡äº‹æƒ…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-è§£å†³æ–¹æ¡ˆä¸€ï¼šusing-å£°æ˜"><a href="#3-è§£å†³æ–¹æ¡ˆä¸€ï¼šusing-å£°æ˜" class="headerlink" title="3. è§£å†³æ–¹æ¡ˆä¸€ï¼šusing å£°æ˜"></a>3. <strong>è§£å†³æ–¹æ¡ˆä¸€ï¼šusing å£°æ˜</strong></h4><p><code>using</code> å£°æ˜å¯ä»¥å°†åŸºç±»çš„åç§°å¼•å…¥æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸï¼Œä½¿æ‰€æœ‰åŒåçš„åŸºç±»æˆå‘˜éƒ½å˜å¾—å¯è§ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ç®€æ´é«˜æ•ˆ</strong>ï¼šä¸€æ¡ <code>using</code> å£°æ˜å°±èƒ½å¼•å…¥æ‰€æœ‰é‡è½½ç‰ˆæœ¬</li>
<li><strong>è‡ªåŠ¨æ›´æ–°</strong>ï¼šå¦‚æœåŸºç±»å¢åŠ æ–°çš„é‡è½½ï¼Œæ´¾ç”Ÿç±»è‡ªåŠ¨è·å¾—</li>
<li><strong>æ€§èƒ½æ— å¼€é”€</strong>ï¼šç¼–è¯‘æ—¶è§£æï¼Œæ— è¿è¡Œæ—¶æˆæœ¬</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Base::mf1;          <span class="comment">// å¼•å…¥ Base::mf1 çš„æ‰€æœ‰é‡è½½ç‰ˆæœ¬</span></span><br><span class="line">    <span class="keyword">using</span> Base::mf3;          <span class="comment">// å¼•å…¥ Base::mf3 çš„æ‰€æœ‰é‡è½½ç‰ˆæœ¬</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span></span>;       <span class="comment">// é‡å†™ Base::mf1()ï¼Œä½†ä¸é®æ© Base::mf1(int)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span></span>;               <span class="comment">// é‡å†™ Base::mf3()ï¼Œä½†ä¸é®æ© Base::mf3(double)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    d.<span class="built_in">mf1</span>();        <span class="comment">// âœ… è°ƒç”¨ Derived::mf1()</span></span><br><span class="line">    d.<span class="built_in">mf1</span>(x);       <span class="comment">// âœ… è°ƒç”¨ Base::mf1(int) - using å£°æ˜ä½¿å…¶å¯è§</span></span><br><span class="line">    d.<span class="built_in">mf3</span>();        <span class="comment">// âœ… è°ƒç”¨ Derived::mf3()</span></span><br><span class="line">    d.<span class="built_in">mf3</span>(x);       <span class="comment">// âœ… è°ƒç”¨ Base::mf3(double) - using å£°æ˜ä½¿å…¶å¯è§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-è§£å†³æ–¹æ¡ˆäºŒï¼šè½¬äº¤å‡½æ•°ï¼ˆForwarding-Functionsï¼‰"><a href="#4-è§£å†³æ–¹æ¡ˆäºŒï¼šè½¬äº¤å‡½æ•°ï¼ˆForwarding-Functionsï¼‰" class="headerlink" title="4. è§£å†³æ–¹æ¡ˆäºŒï¼šè½¬äº¤å‡½æ•°ï¼ˆForwarding Functionsï¼‰"></a>4. <strong>è§£å†³æ–¹æ¡ˆäºŒï¼šè½¬äº¤å‡½æ•°ï¼ˆForwarding Functionsï¼‰</strong></h4><p>å½“ä½ ä¸æƒ³ç»§æ‰¿åŸºç±»çš„<strong>æ‰€æœ‰</strong>é‡è½½ç‰ˆæœ¬ï¼Œè€Œåªæƒ³è®©ç‰¹å®šç‰ˆæœ¬å¯è§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è½¬äº¤å‡½æ•°ã€‚è¿™åœ¨<strong>ç§æœ‰ç»§æ‰¿</strong>ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ç²¾ç¡®æ§åˆ¶</strong>ï¼šå¯ä»¥é€‰æ‹©æ€§åœ°æš´éœ²ç‰¹å®šçš„é‡è½½ç‰ˆæœ¬</li>
<li><strong>é€‚ç”¨äºç§æœ‰ç»§æ‰¿</strong>ï¼š<code>using</code> å£°æ˜åœ¨ç§æœ‰ç»§æ‰¿ä¸­ä¼šæ”¹å˜è®¿é—®çº§åˆ«ï¼Œè€Œè½¬äº¤å‡½æ•°ä¸ä¼š</li>
<li><strong>å¯ä»¥è¿›è¡Œè½¬æ¢</strong>ï¼šåœ¨è½¬äº¤è¿‡ç¨‹ä¸­å¯ä»¥è¿›è¡Œå‚æ•°ç±»å‹è½¬æ¢æˆ–æ·»åŠ é»˜è®¤å‚æ•°</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">private</span> Base &#123;    <span class="comment">// ç§æœ‰ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// è½¬äº¤å‡½æ•°ï¼šé€‰æ‹©æ€§åœ°æš´éœ²åŸºç±»å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span> </span>&#123; Base::<span class="built_in">mf1</span>(); &#125;           <span class="comment">// åªæš´éœ²æ— å‚ç‰ˆæœ¬</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨è½¬äº¤æ—¶è¿›è¡Œç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">()</span> </span>&#123; Base::<span class="built_in">mf3</span>(); &#125;                   <span class="comment">// æš´éœ² Base::mf3()</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; Base::<span class="built_in">mf3</span>(<span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(x)); &#125;  <span class="comment">// è½¬æ¢å‚æ•°ç±»å‹</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    </span><br><span class="line">    d.<span class="built_in">mf1</span>();        <span class="comment">// âœ… é€šè¿‡è½¬äº¤å‡½æ•°è°ƒç”¨ Base::mf1()</span></span><br><span class="line">    <span class="comment">// d.mf1(10);   // âŒ é”™è¯¯ï¼šæ²¡æœ‰ä¸º mf1(int) æä¾›è½¬äº¤å‡½æ•°</span></span><br><span class="line">    d.<span class="built_in">mf3</span>();        <span class="comment">// âœ… é€šè¿‡è½¬äº¤å‡½æ•°è°ƒç”¨ Base::mf3()</span></span><br><span class="line">    d.<span class="built_in">mf3</span>(<span class="number">10</span>);      <span class="comment">// âœ… é€šè¿‡è½¬äº¤å‡½æ•°è°ƒç”¨ï¼Œå‚æ•°è¢«è½¬æ¢ä¸º double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-æ¨¡æ¿ç±»ä¸­çš„åç§°é®æ©"><a href="#5-æ¨¡æ¿ç±»ä¸­çš„åç§°é®æ©" class="headerlink" title="5. æ¨¡æ¿ç±»ä¸­çš„åç§°é®æ©"></a>5. <strong>æ¨¡æ¿ç±»ä¸­çš„åç§°é®æ©</strong></h4><p>åœ¨æ¨¡æ¿ç»§æ‰¿ä¸­ï¼Œåç§°é®æ©é—®é¢˜æ›´åŠ å¤æ‚ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸ä¼šåœ¨ä¾èµ–å‹åŸºç±»ä¸­æŸ¥æ‰¾åç§°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span> : <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// éœ€è¦æ˜ç¡®æŒ‡å®šåŸºç±»ä½œç”¨åŸŸæˆ–ä½¿ç”¨ using å£°æ˜</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">sendClear</span>(info);              <span class="comment">// æ–¹æ³•1ï¼šä½¿ç”¨ this-&gt;</span></span><br><span class="line">        MsgSender&lt;Company&gt;::<span class="built_in">sendClear</span>(info);  <span class="comment">// æ–¹æ³•2ï¼šæ˜ç¡®æŒ‡å®šä½œç”¨åŸŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨ using å£°æ˜</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span> : <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> MsgSender&lt;Company&gt;::sendClear;    <span class="comment">// æ–¹æ³•3ï¼šusing å£°æ˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sendClear</span>(info);    <span class="comment">// ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="6-é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ"><a href="#6-é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="6. é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ"></a>6. <strong>é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ</strong></h4><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èæ–¹æ¡ˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody><tr>
<td><strong>public ç»§æ‰¿ï¼Œéœ€è¦æ‰€æœ‰é‡è½½</strong></td>
<td><code>using</code> å£°æ˜</td>
<td>ç®€æ´ï¼Œè‡ªåŠ¨åŒ…å«æ–°å¢é‡è½½</td>
</tr>
<tr>
<td><strong>private ç»§æ‰¿</strong></td>
<td>è½¬äº¤å‡½æ•°</td>
<td>é¿å…æ„å¤–æ”¹å˜è®¿é—®çº§åˆ«</td>
</tr>
<tr>
<td><strong>åªéœ€è¦ç‰¹å®šé‡è½½</strong></td>
<td>è½¬äº¤å‡½æ•°</td>
<td>ç²¾ç¡®æ§åˆ¶æš´éœ²çš„æ¥å£</td>
</tr>
<tr>
<td><strong>éœ€è¦å‚æ•°è½¬æ¢</strong></td>
<td>è½¬äº¤å‡½æ•°</td>
<td>å¯ä»¥åœ¨è½¬äº¤æ—¶ä¿®æ”¹å‚æ•°</td>
</tr>
<tr>
<td><strong>æ¨¡æ¿ç»§æ‰¿</strong></td>
<td><code>using</code> å£°æ˜æˆ–æ˜ç¡®ä½œç”¨åŸŸ</td>
<td>è§£å†³ä¾èµ–å‹åç§°æŸ¥æ‰¾é—®é¢˜</td>
</tr>
</tbody></table>
<h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>åç§°é®æ©æ˜¯ C++ ç»§æ‰¿æœºåˆ¶ä¸­ä¸€ä¸ªé‡è¦ä½†å®¹æ˜“è¢«å¿½è§†çš„é™·é˜±ã€‚ç†è§£å…¶æ ¹æœ¬åŸå› ï¼ˆ<strong>ä½œç”¨åŸŸä¼˜å…ˆäºé‡è½½åŒ¹é…</strong>ï¼‰æ˜¯é¿å…ç›¸å…³é—®é¢˜çš„å…³é”®ã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åç§°é®æ©åŸºäºä½œç”¨åŸŸè§„åˆ™</strong>ï¼Œä¸æ˜¯é‡è½½åŒ¹é…è§„åˆ™</li>
<li><strong>åœ¨ public ç»§æ‰¿ä¸­åº”é¿å…åç§°é®æ©</strong>ï¼Œä»¥ç»´æŠ¤ is-a å…³ç³»</li>
<li><strong><code>using</code> å£°æ˜</strong>é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œç®€æ´é«˜æ•ˆ</li>
<li><strong>è½¬äº¤å‡½æ•°</strong>æä¾›æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œé€‚ç”¨äºç‰¹æ®Šéœ€æ±‚</li>
<li><strong>åœ¨æ¨¡æ¿ç»§æ‰¿ä¸­</strong>éœ€è¦ç‰¹åˆ«æ³¨æ„ä¾èµ–å‹åç§°çš„æŸ¥æ‰¾é—®é¢˜</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œå¯ä»¥ç¡®ä¿ç»§æ‰¿å±‚æ¬¡ä¸­çš„æ¥å£å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œé¿å…å› åç§°é®æ©å¯¼è‡´çš„æ„å¤–è¡Œä¸ºã€‚</p>
<h2 id="æ¡æ¬¾34ï¼šåŒºåˆ†å®ç°ç»§æ‰¿å’Œæ¥å£ç»§æ‰¿"><a href="#æ¡æ¬¾34ï¼šåŒºåˆ†å®ç°ç»§æ‰¿å’Œæ¥å£ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾34ï¼šåŒºåˆ†å®ç°ç»§æ‰¿å’Œæ¥å£ç»§æ‰¿"></a>æ¡æ¬¾34ï¼šåŒºåˆ†å®ç°ç»§æ‰¿å’Œæ¥å£ç»§æ‰¿</h2><blockquote>
<p><em>Differentiate between inheritance of interface and inheritance of implementation</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-30"><a href="#æ ¸å¿ƒç†å¿µ-30" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨ C++ ä¸­ï¼Œ<code>public inheritance</code>ï¼ˆå…¬å¼€ç»§æ‰¿ï¼‰å¹¶éå•çº¯çš„â€ç»§æ‰¿â€ä¸€ä¸ªç±»çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè€Œæ˜¯å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>æ¥å£ç»§æ‰¿</strong>å’Œ<strong>å®ç°ç»§æ‰¿</strong>ã€‚è¿™ä¸¤è€…çš„åŒºåˆ«è‡³å…³é‡è¦ï¼Œå½±å“åˆ°å¦‚ä½•è®¾è®¡ç±»ä½“ç³»ã€é¿å…ä¸å¿…è¦çš„é”™è¯¯ï¼Œå¹¶ç¡®ä¿ä»£ç çš„çµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚</p>
<ul>
<li><strong>æ¥å£ç»§æ‰¿</strong>ï¼šæ´¾ç”Ÿç±»ç»§æ‰¿äº†åŸºç±»ä¸­çš„å‡½æ•°å£°æ˜ï¼ˆå¦‚çº¯è™šå‡½æ•° <code>fly</code>ï¼‰ï¼Œè¿™æ„å‘³ç€æ´¾ç”Ÿç±»å¿…é¡»æä¾›è‡ªå·±å¯¹è¯¥æ¥å£çš„å®ç°ï¼Œæˆ–è€…ä½¿ç”¨åŸºç±»æä¾›çš„é»˜è®¤å®ç°ã€‚</li>
<li><strong>å®ç°ç»§æ‰¿</strong>ï¼šåŸºç±»æä¾›äº†å®ç°ï¼ˆå¦‚ <code>defaultFly</code>ï¼‰ï¼Œæ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©<strong>è°ƒç”¨è¿™ä¸ªé»˜è®¤å®ç°</strong>ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©<strong>è‡ªå·±æä¾›å®ç°</strong>ï¼Œå®Œå…¨ç”±æ´¾ç”Ÿç±»çš„éœ€æ±‚æ¥å†³å®šã€‚</li>
</ul>
<h3 id="æ·±åº¦è§£æ-30"><a href="#æ·±åº¦è§£æ-30" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ä»€ä¹ˆæ˜¯æ¥å£ç»§æ‰¿ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ¥å£ç»§æ‰¿ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ¥å£ç»§æ‰¿ï¼Ÿ"></a>1. <strong>ä»€ä¹ˆæ˜¯æ¥å£ç»§æ‰¿ï¼Ÿ</strong></h4><p>æ¥å£ç»§æ‰¿æ˜¯æŒ‡ç»§æ‰¿ä¸€ä¸ªç±»ä¸­å£°æ˜çš„å‡½æ•°ï¼ˆå³æ¥å£ï¼‰ï¼Œè€Œä¸å…³å¿ƒå‡½æ•°çš„å…·ä½“å®ç°ã€‚æ´¾ç”Ÿç±»éœ€è¦æä¾›è‡ªå·±çš„å®ç°ã€‚é€šå¸¸è¿™ç§ç»§æ‰¿æ–¹å¼é€šè¿‡<strong>çº¯è™šå‡½æ•°</strong>ï¼ˆpure virtual functionï¼‰æ¥å®šä¹‰ã€‚</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¥å£ç»§æ‰¿ï¼Ÿ</strong><ul>
<li>è¿™ç§æ–¹å¼ä½¿å¾—æ´¾ç”Ÿç±»è¢«å¼ºåˆ¶å®ç°æŸäº›å‡½æ•°ï¼Œä½†å…·ä½“çš„å®ç°ç»†èŠ‚æ˜¯ç”±æ´¾ç”Ÿç±»æ¥å†³å®šçš„ã€‚</li>
<li>åŸºç±»åªæä¾›æ¥å£ï¼Œæ´¾ç”Ÿç±»åˆ™è´Ÿè´£å¦‚ä½•å®ç°è¿™äº›åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// çº¯è™šå‡½æ•°ï¼Œåªæœ‰æ¥å£ï¼Œæ²¡æœ‰å®ç°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>Shape</code> ç±»æä¾›äº† <code>draw</code> çš„æ¥å£ï¼Œä½†æ²¡æœ‰æä¾›å®ç°ï¼Œä»»ä½•æ´¾ç”Ÿç±»ï¼ˆå¦‚ <code>Rectangle</code> å’Œ <code>Circle</code>ï¼‰éƒ½å¿…é¡»å®ç° <code>draw</code> å‡½æ•°ï¼Œæä¾›å…·ä½“çš„ç»˜åˆ¶æ–¹å¼ã€‚</p>
<h4 id="2-ä»€ä¹ˆæ˜¯å®ç°ç»§æ‰¿ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯å®ç°ç»§æ‰¿ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯å®ç°ç»§æ‰¿ï¼Ÿ"></a>2. <strong>ä»€ä¹ˆæ˜¯å®ç°ç»§æ‰¿ï¼Ÿ</strong></h4><p>å®ç°ç»§æ‰¿æ˜¯æŒ‡æ´¾ç”Ÿç±»ä¸ä»…ç»§æ‰¿äº†å‡½æ•°çš„æ¥å£ï¼Œè¿˜ç»§æ‰¿äº†å‡½æ•°çš„é»˜è®¤å®ç°ã€‚æ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©æ€§åœ°è¦†ç›–è¿™ä¸ªå®ç°ã€‚é€šå¸¸é€šè¿‡<strong>ç®€å•è™šæ‹Ÿå‡½æ•°</strong>ï¼ˆsimple virtual functionï¼‰æˆ–è€…<strong>éè™šæ‹Ÿå‡½æ•°</strong>æ¥å®ç°ã€‚</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ç°ç»§æ‰¿ï¼Ÿ</strong><ul>
<li>åŸºç±»æä¾›äº†ä¸€äº›å¸¸è§çš„å®ç°ï¼Œæ´¾ç”Ÿç±»å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿åŸºç±»çš„å®ç°ã€‚å¦‚æœéœ€è¦ï¼Œæ´¾ç”Ÿç±»è¿˜å¯ä»¥è¦†ç›–é»˜è®¤çš„å®ç°ã€‚</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Shape &#123;</span><br><span class="line">publicï¼š</span><br><span class="line">	virtual void errorï¼ˆconst string* msg) &#123;</span><br><span class="line">	std::cout &lt;&lt; |&quot;Error:&quot; &lt;&lt; msg &lt;&lt; std::endl; //åŸºç±»æä¾›çš„é»˜è®¤å®ç°;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Shape</code> ç±»æä¾›äº† <code>error</code> å‡½æ•°çš„é»˜è®¤å®ç°ï¼Œæ´¾ç”Ÿç±»å¯ä»¥ç›´æ¥ç»§æ‰¿è¿™ä¸ªå®ç°ï¼Œæˆ–è€…æ ¹æ®éœ€è¦è¦†å†™å®ƒã€‚</p>
<h4 id="3-æ¥å£å’Œå®ç°åˆ†ç¦»çš„è®¾è®¡æ–¹å¼"><a href="#3-æ¥å£å’Œå®ç°åˆ†ç¦»çš„è®¾è®¡æ–¹å¼" class="headerlink" title="3. æ¥å£å’Œå®ç°åˆ†ç¦»çš„è®¾è®¡æ–¹å¼"></a>3. <strong>æ¥å£å’Œå®ç°åˆ†ç¦»çš„è®¾è®¡æ–¹å¼</strong></h4><p>æœ€ä½³å®è·µæ˜¯å°†æ¥å£å’Œå®ç°åˆ†ç¦»ï¼Œä»¥ç¡®ä¿æ´¾ç”Ÿç±»èƒ½å¤Ÿçµæ´»æ§åˆ¶æ˜¯å¦ç»§æ‰¿å®ç°ï¼Œæˆ–æ˜¯å¦éœ€è¦æä¾›è‡ªå·±çš„å®ç°ã€‚</p>
<ul>
<li><strong>å¦‚ä½•å®ç°åˆ†ç¦»ï¼Ÿ</strong><ul>
<li>åŸºç±»ä¸­çš„çº¯è™šå‡½æ•°ï¼ˆæ¥å£ï¼‰åªå£°æ˜è¡Œä¸ºï¼Œä¸åŒ…å«å®ç°ã€‚åŸºç±»ä¸­çš„å…¶ä»–æˆå‘˜å‡½æ•°åˆ™æä¾›é»˜è®¤å®ç°ï¼Œæ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©ç»§æ‰¿è¿™äº›å®ç°æˆ–è¦†ç›–å®ƒä»¬ã€‚</li>
<li>å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰åˆé€‚çš„å®ç°ï¼Œå®ƒå¯ä»¥ç»§æ‰¿åŸºç±»çš„é»˜è®¤å®ç°ï¼›å¦‚æœéœ€è¦ç‰¹æ®Šè¡Œä¸ºï¼Œå®ƒå¯ä»¥è¦†ç›–åŸºç±»çš„å®ç°ã€‚</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Airplane &#123;</span><br><span class="line">public:</span><br><span class="line">  virtual void fly(const Airport&amp; destination) = 0;  // çº¯è™šå‡½æ•°ï¼Œåªæœ‰æ¥å£</span><br><span class="line">  void defaultFly(const Airport&amp; destination) &#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;Flying the default way&quot; &lt;&lt; std::endl;  // é»˜è®¤å®ç°</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-å¦‚ä½•é¿å…é”™è¯¯çš„ç»§æ‰¿ï¼Ÿ"><a href="#4-å¦‚ä½•é¿å…é”™è¯¯çš„ç»§æ‰¿ï¼Ÿ" class="headerlink" title="4. å¦‚ä½•é¿å…é”™è¯¯çš„ç»§æ‰¿ï¼Ÿ"></a>4. <strong>å¦‚ä½•é¿å…é”™è¯¯çš„ç»§æ‰¿ï¼Ÿ</strong></h4><p>é€šè¿‡å°†æ¥å£ä¸å®ç°åˆ†å¼€ï¼Œå¯ä»¥é¿å…æ´¾ç”Ÿç±»æ— æ„é—´ç»§æ‰¿é”™è¯¯çš„å®ç°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ´¾ç”Ÿç±» <code>ModelC</code> æ²¡æœ‰è¦†ç›– <code>fly</code> å‡½æ•°ï¼Œ<code>Airplane</code> æä¾›çš„é»˜è®¤è¡Œä¸ºï¼ˆ<code>defaultFly</code>ï¼‰å°±å¯èƒ½ä¼šè¢«æ„å¤–ç»§æ‰¿ï¼Œä»è€Œå¯¼è‡´ä¸åˆé€‚çš„è¡Œä¸ºã€‚</p>
<p>ä¸€ç§æ”¹è¿›çš„æ–¹æ³•æ˜¯ï¼šå°†é»˜è®¤å®ç°æå–åˆ°ç‹¬ç«‹çš„éè™šæ‹Ÿå‡½æ•°ä¸­ï¼Œå¹¶å°†æ¥å£å‡½æ•°å£°æ˜ä¸ºçº¯è™šæ‹Ÿå‡½æ•°ï¼Œä»è€Œå¼ºåˆ¶æ´¾ç”Ÿç±»æ˜¾å¼æä¾›å®ç°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡è®¾æœ‰ä¸€ä¸ª Airport ç±»ï¼Œç”¨äºè¡¨ç¤ºç›®çš„åœ°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Airport</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="string">&quot;Airport&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç±»ï¼šAirplane</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Airplane</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// çº¯è™šæ‹Ÿå‡½æ•°ï¼šä»…ç»§æ‰¿æ¥å£ï¼Œæ´¾ç”Ÿç±»å¿…é¡»æä¾›è‡ªå·±çš„å®ç°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">(<span class="type">const</span> Airport&amp; destination)</span> </span>= <span class="number">0</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç®€å•è™šæ‹Ÿå‡½æ•°ï¼šç»§æ‰¿æ¥å£å’Œé»˜è®¤å®ç°ï¼Œæ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©é‡å†™é»˜è®¤å®ç°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">defaultFly</span><span class="params">(<span class="type">const</span> Airport&amp; destination)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Flying the default way to &quot;</span> &lt;&lt; destination.<span class="built_in">getName</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éè™šæ‹Ÿå‡½æ•°ï¼šç»§æ‰¿æ¥å£å’Œå¼ºåˆ¶å®ç°ï¼Œæ´¾ç”Ÿç±»ä¸èƒ½æ›´æ”¹å®ç°</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">objectID</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="number">12345</span>; &#125;  <span class="comment">// å¼ºåˆ¶å®ç°ï¼Œæ´¾ç”Ÿç±»ä¸èƒ½é‡å†™</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ´¾ç”Ÿç±»ï¼šModelA</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelA</span> : <span class="keyword">public</span> Airplane &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">(<span class="type">const</span> Airport&amp; destination)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">defaultFly</span>(destination);  <span class="comment">// ä½¿ç”¨åŸºç±»æä¾›çš„é»˜è®¤å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ´¾ç”Ÿç±»ï¼šModelB</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelB</span> : <span class="keyword">public</span> Airplane &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">(<span class="type">const</span> Airport&amp; destination)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Flying ModelB to &quot;</span> &lt;&lt; destination.<span class="built_in">getName</span>() &lt;&lt; std::endl;  <span class="comment">// è‡ªå®šä¹‰å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ´¾ç”Ÿç±»ï¼šModelC</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelC</span> : <span class="keyword">public</span> Airplane &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ModelC éœ€è¦è‡ªå·±å®ç° fly å‡½æ•°ï¼Œå› ä¸ºæ˜¯çº¯è™šæ‹Ÿå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">(<span class="type">const</span> Airport&amp; destination)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Flying ModelC to &quot;</span> &lt;&lt; destination.<span class="built_in">getName</span>() &lt;&lt; <span class="string">&quot; with custom flight path.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Airport destination;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• ModelAï¼ˆä½¿ç”¨é»˜è®¤å®ç°ï¼‰</span></span><br><span class="line">    Airplane* planeA = <span class="keyword">new</span> <span class="built_in">ModelA</span>();</span><br><span class="line">    planeA-&gt;<span class="built_in">fly</span>(destination);  <span class="comment">// Output: Flying the default way to Airport</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• ModelBï¼ˆè‡ªå®šä¹‰å®ç°ï¼‰</span></span><br><span class="line">    Airplane* planeB = <span class="keyword">new</span> <span class="built_in">ModelB</span>();</span><br><span class="line">    planeB-&gt;<span class="built_in">fly</span>(destination);  <span class="comment">// Output: Flying ModelB to Airport</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• ModelCï¼ˆè‡ªå®šä¹‰å®ç°ï¼‰</span></span><br><span class="line">    Airplane* planeC = <span class="keyword">new</span> <span class="built_in">ModelC</span>();</span><br><span class="line">    planeC-&gt;<span class="built_in">fly</span>(destination);  <span class="comment">// Output: Flying ModelC to Airport with custom flight path.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯• non-virtual function objectID</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Plane A ID: &quot;</span> &lt;&lt; planeA-&gt;<span class="built_in">objectID</span>() &lt;&lt; std::endl;  <span class="comment">// Output: Plane A ID: 12345</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> planeA;</span><br><span class="line">    <span class="keyword">delete</span> planeB;</span><br><span class="line">    <span class="keyword">delete</span> planeC;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Flying the <span class="keyword">default</span> way to Airport</span><br><span class="line">Flying ModelB to Airport</span><br><span class="line">Flying ModelC to Airport with custom flight path.</span><br><span class="line">Plane A ID: <span class="number">12345</span></span><br></pre></td></tr></table></figure>

<h4 id="5-å¦‚ä½•é€‰æ‹©ç»§æ‰¿çš„æ–¹å¼ï¼Ÿ"><a href="#5-å¦‚ä½•é€‰æ‹©ç»§æ‰¿çš„æ–¹å¼ï¼Ÿ" class="headerlink" title="5. å¦‚ä½•é€‰æ‹©ç»§æ‰¿çš„æ–¹å¼ï¼Ÿ"></a>5. <strong>å¦‚ä½•é€‰æ‹©ç»§æ‰¿çš„æ–¹å¼ï¼Ÿ</strong></h4><p>æ¯ä¸ªå‡½æ•°å£°æ˜çš„æ–¹å¼å†³å®šäº†å®ƒå°†å¦‚ä½•è¢«ç»§æ‰¿ï¼š</p>
<ul>
<li><strong>çº¯è™šå‡½æ•°ï¼ˆPure Virtual Functionï¼‰</strong>ï¼šä»…ç»§æ‰¿æ¥å£ï¼Œæ´¾ç”Ÿç±»å¿…é¡»æä¾›è‡ªå·±çš„å®ç°ã€‚</li>
<li><strong>ç®€å•è™šæ‹Ÿå‡½æ•°ï¼ˆSimple Virtual Functionï¼‰</strong>ï¼šç»§æ‰¿æ¥å£å’Œé»˜è®¤å®ç°ï¼Œæ´¾ç”Ÿç±»å¯ä»¥é€‰æ‹©é‡å†™é»˜è®¤å®ç°ã€‚</li>
<li><strong>éè™šæ‹Ÿå‡½æ•°ï¼ˆNon-Virtual Functionï¼‰</strong>ï¼šç»§æ‰¿æ¥å£å’Œå¼ºåˆ¶å®ç°ï¼Œæ´¾ç”Ÿç±»ä¸èƒ½æ›´æ”¹å®ç°ã€‚</li>
</ul>
<h3 id="å°ç»“-3"><a href="#å°ç»“-3" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ç†è§£å¹¶åŒºåˆ†<strong>æ¥å£ç»§æ‰¿</strong>å’Œ<strong>å®ç°ç»§æ‰¿</strong>æ˜¯è‰¯å¥½è®¾è®¡ç±»å±‚æ¬¡ç»“æ„çš„åŸºç¡€ã€‚é€šè¿‡æ­£ç¡®åœ°ä½¿ç”¨çº¯è™šå‡½æ•°ã€ç®€å•è™šæ‹Ÿå‡½æ•°å’Œéè™šæ‹Ÿå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®æ§åˆ¶æ´¾ç”Ÿç±»åº”ç»§æ‰¿ä»€ä¹ˆï¼Œé¿å…ä¸å¿…è¦çš„é”™è¯¯ï¼Œç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ã€‚</p>
<ul>
<li><strong>æ¥å£ç»§æ‰¿</strong>ï¼šåªç»§æ‰¿æ¥å£ï¼Œæ´¾ç”Ÿç±»å¿…é¡»å®ç°ã€‚</li>
<li><strong>å®ç°ç»§æ‰¿</strong>ï¼šç»§æ‰¿æ¥å£å’Œé»˜è®¤å®ç°ï¼Œæ´¾ç”Ÿç±»å¯ä»¥é‡å†™ã€‚</li>
<li><strong>å¼ºåˆ¶å®ç°ç»§æ‰¿</strong>ï¼šç»§æ‰¿æ¥å£å’Œå¼ºåˆ¶å®ç°ï¼Œæ´¾ç”Ÿç±»ä¸èƒ½ä¿®æ”¹ã€‚</li>
</ul>
<h2 id="æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„é€‰æ‹©"><a href="#æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„é€‰æ‹©" class="headerlink" title="æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„é€‰æ‹©"></a>æ¡æ¬¾35ï¼šè€ƒè™‘<code>virtual</code>å‡½æ•°ä»¥å¤–çš„é€‰æ‹©</h2><blockquote>
<p><em>Consider alternative to virtual functions</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-31"><a href="#æ ¸å¿ƒç†å¿µ-31" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>åœ¨ C++ è®¾è®¡ä¸­ï¼Œ è™šå‡½æ•°å¹¶ä¸æ˜¯å®ç°å¤šæ€çš„å”¯ä¸€æ–¹å¼ã€‚åœ¨è®¾è®¡å¤æ‚ç³»ç»Ÿæ—¶ï¼Œå°¤å…¶æ˜¯éœ€è¦æé«˜æ€§èƒ½æˆ–è€…é¿å…è¿‡åº¦ç»§æ‰¿æ—¶ã€‚å¯ä»¥é€šè¿‡Non-Virtual Interfaceï¼ˆNVIï¼‰æ‰‹æ³•å’ŒStrategyæ¨¡å¼æ¥å®ç°æ›´åŠ çµæ´»å’Œé«˜æ•ˆçš„è®¾è®¡ã€‚</p>
<p>è¿™äº›æ–¹æ³•èƒ½å¤Ÿå¸®åŠ©å‡å°‘ä¸å¿…è¦çš„ä¾èµ–å’Œæå‡ä»£ç çš„æ‰©å±•æ€§ã€‚</p>
<h3 id="æ·±åº¦è§£æ-31"><a href="#æ·±åº¦è§£æ-31" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-Non-Virtual-Interface-NVI-æ‰‹æ³•"><a href="#1-Non-Virtual-Interface-NVI-æ‰‹æ³•" class="headerlink" title="1. Non-Virtual Interface (NVI) æ‰‹æ³•"></a>1. <strong>Non-Virtual Interface (NVI) æ‰‹æ³•</strong></h4><p>NVIæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œä»–å°†<code>virtual</code>å‡½æ•°å°è£…åœ¨ä¸€ä¸ª<code>non-virtual</code>å‡½æ•°ä¸­ï¼Œè¿™æ ·ç”¨æˆ·åªèƒ½é€šè¿‡éè™šå‡½æ•°è®¿é—®æ¥å£ï¼Œè€Œè™šå‡½æ•°åˆ™æ˜¯ç§æœ‰çš„ã€‚ä½¿ç”¨NVIè®¾è®¡å¯ä»¥åœ¨è°ƒç”¨è™šå‡½æ•°ä¹‹å‰æˆ–è€…ä¹‹ååšä¸€äº›é¢å¤–çš„è®°å½•ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€èµ„æºç®¡ç†ç­‰ã€‚</p>
<p><strong>NVI æœ‰å“ªäº›ä¼˜ç‚¹?</strong></p>
<ul>
<li><strong>æé«˜å°è£…æ€§</strong>ï¼šç”¨æˆ·ä¸èƒ½ç›´æ¥è°ƒç”¨è™šæ‹Ÿå‡½æ•°ï¼Œåªèƒ½é€šè¿‡å…¬å¼€çš„éè™šå‡½æ•°è¿›è¡Œæ“ä½œï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¾èµ–ã€‚</li>
<li><strong>äº‹å‰äº‹åæ“ä½œ</strong>ï¼šæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨è™šæ‹Ÿå‡½æ•°ä¹‹å‰åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œåœ¨è°ƒç”¨ä¹‹ååšä¸€äº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚åŠ é”&#x2F;è§£é”ã€éªŒè¯æ¡ä»¶ç­‰ã€‚</li>
<li><strong>æ›´æ¸…æ™°çš„è´£ä»»åˆ’åˆ†</strong>ï¼šé€šè¿‡ NVIï¼Œæˆ‘ä»¬æ¸…æ™°åœ°åŒºåˆ†äº†å‡½æ•°çš„æ¥å£ï¼ˆç”±éè™šå‡½æ•°æä¾›ï¼‰å’Œå®ç°ï¼ˆç”±è™šæ‹Ÿå‡½æ•°æä¾›ï¼‰ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åšä¸€äº›äº‹å‰å·¥ä½œï¼Œå¦‚åŠ é”ã€è®°å½•æ—¥å¿—ç­‰</span></span><br><span class="line">        <span class="type">int</span> retVal = <span class="built_in">doHealthValue</span>();</span><br><span class="line">        <span class="comment">// åšä¸€äº›äº‹åå·¥ä½œï¼Œå¦‚è§£é”ã€éªŒè¯å¥åº·çŠ¶æ€ç­‰</span></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">doHealthValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é»˜è®¤çš„å¥åº·å€¼è®¡ç®—é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//healthValueæ˜¯å…¬å¼€çš„éè™šå‡½æ•°ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡å®ƒæ¥è·å–å¥åº·å€¼ï¼Œè€Œ doHealthValue æ˜¯ç§æœ‰è™šå‡½æ•°ï¼Œåªæœ‰åœ¨ healthValue å†…éƒ¨è°ƒç”¨ã€‚</span></span><br></pre></td></tr></table></figure>





<h4 id="2-Strategyæ¨¡å¼"><a href="#2-Strategyæ¨¡å¼" class="headerlink" title="2. Strategyæ¨¡å¼"></a>2. Strategyæ¨¡å¼</h4><p>Strategyæ¨¡å¼æä¾›äº†ä¸€ç§å°†è¡Œä¸ºï¼ˆæ¯”å¦‚è®¡ç®—å¥åº·å€¼ï¼‰ä»å¯¹è±¡å†…éƒ¨è½¬ç§»åˆ°å¤–éƒ¨ç­–ç•¥ç±»çš„æ–¹å¼ã€‚é€šè¿‡ä¼ å…¥ä¸åŒçš„ç­–ç•¥å¯¹è±¡ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºï¼Œæä¾›å¼ºå¤§çµæ´»æ€§ï¼›</p>
<ul>
<li><strong>Strategyæ¨¡å¼æœ‰å“ªäº›ä¼˜ç‚¹ï¼Ÿ</strong><ul>
<li><strong>æé«˜çµæ´»æ€§</strong>ï¼šç­–ç•¥å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªæ•Œäººå¯ä»¥æœ‰ä¸€ç§è®¡ç®—å¥åº·å€¼çš„ç­–ç•¥ï¼Œè€Œå¦ä¸€ä¸ªæ•Œäººå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ <code>GameCharacter</code> ç±»çš„ä»£ç ã€‚</li>
<li><strong>è§£è€¦è¡Œä¸ºä¸å¯¹è±¡</strong>ï¼šé€šè¿‡å°†è¡Œä¸ºæå–åˆ°å¤–éƒ¨ï¼Œå¯ä»¥å‡å°‘ <code>GameCharacter</code> ç±»çš„å¤æ‚åº¦ï¼Œä¹Ÿä½¿å¾—æ–°çš„è®¡ç®—ç­–ç•¥å¯ä»¥å®¹æ˜“åœ°é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­ã€‚</li>
<li><strong>æ”¯æŒå¤šä¸ªç­–ç•¥</strong>ï¼šåŒä¸€ä¸ªç±»çš„ä¸åŒå®ä¾‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œä»è€Œæ”¯æŒå¤šæ ·åŒ–çš„è¡Œä¸º</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> HealthCalcFunc = std::function&lt;<span class="built_in">int</span>(<span class="type">const</span> GameCharacter&amp;)&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GameCharacter</span>(HealthCalcFunc hcf = defaultHealthCalc) : <span class="built_in">healthFunc</span>(hcf) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">healthFunc</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    HealthCalcFunc healthFunc;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">defaultHealthCalc</span><span class="params">(<span class="type">const</span> GameCharacter&amp; gc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>; <span class="comment">// é»˜è®¤è®¡ç®—å¥åº·å€¼çš„ç­–ç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//GameCharacter ç±»é€šè¿‡ HealthCalcFuncï¼ˆä¸€ä¸ª std::functionï¼‰æ¥å§”æ‰˜å¥åº·å€¼çš„è®¡ç®—ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›´æ¢è®¡ç®—ç­–ç•¥ã€‚</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="tr1-function-æ›¿ä»£å‡½æ•°æŒ‡é’ˆ"><a href="#tr1-function-æ›¿ä»£å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="tr1::function æ›¿ä»£å‡½æ•°æŒ‡é’ˆ"></a>tr1::function æ›¿ä»£å‡½æ•°æŒ‡é’ˆ</h4><p><code>tr1::function</code> æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œå®ƒå¯ä»¥ä¿å­˜ä»»ä½•ç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚æ™®é€šå‡½æ•°ã€æˆå‘˜å‡½æ•°ã€å‡½æ•°å¯¹è±¡ç­‰ï¼‰ã€‚é€šè¿‡ä½¿ç”¨ <code>tr1::function</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¡Œä¸ºå°è£…å¾—æ›´åŠ çµæ´»ï¼ŒåŒæ—¶é¿å…ä½¿ç”¨è£¸éœ²çš„å‡½æ•°æŒ‡é’ˆã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong><ul>
<li><strong>æ”¯æŒå¤šç§å¯è°ƒç”¨ç±»å‹</strong>ï¼š<code>tr1::function</code> å¯ä»¥ä¿å­˜æ™®é€šå‡½æ•°ã€æˆå‘˜å‡½æ•°ã€å‡½æ•°å¯¹è±¡ç­‰ï¼Œæä¾›äº†æ›´å¼ºçš„çµæ´»æ€§ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå®ƒæ¯”ä¼ ç»Ÿçš„å‡½æ•°æŒ‡é’ˆæ›´åŠ å®‰å…¨ï¼Œå¯ä»¥è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œé¿å…ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ã€‚</li>
<li><strong>ç®€åŒ–ç®¡ç†</strong>ï¼šç›¸æ¯”å‡½æ•°æŒ‡é’ˆï¼Œ<code>tr1::function</code> åœ¨ç®¡ç†ä¸Šæ›´åŠ ç®€ä¾¿ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å›è°ƒå’ŒåŠ¨æ€è¡Œä¸ºæ—¶ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> HealthCalcFunc = std::function&lt;<span class="built_in">int</span>(<span class="type">const</span> GameCharacter&amp;)&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GameCharacter</span>(HealthCalcFunc hcf = defaultHealthCalc) : <span class="built_in">healthFunc</span>(hcf) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">healthFunc</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    HealthCalcFunc healthFunc;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">defaultHealthCalc</span><span class="params">(<span class="type">const</span> GameCharacter&amp; gc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>; <span class="comment">// é»˜è®¤å¥åº·è®¡ç®—é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//HealthCalcFunc ç±»å‹å¯ä»¥æ¥æ”¶ä»»ä½•ç¬¦åˆç­¾åçš„å¯è°ƒç”¨å¯¹è±¡ï¼Œä½¿å¾— healthValue å‡½æ•°èƒ½å¤Ÿæ›´åŠ çµæ´»åœ°æ¥å—ä¸åŒçš„è®¡ç®—ç­–ç•¥ã€‚</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4-è™šæ‹Ÿå‡½æ•°æ›¿ä»£ä¸ºå¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°"><a href="#4-è™šæ‹Ÿå‡½æ•°æ›¿ä»£ä¸ºå¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°" class="headerlink" title="4. è™šæ‹Ÿå‡½æ•°æ›¿ä»£ä¸ºå¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°"></a>4. <strong>è™šæ‹Ÿå‡½æ•°æ›¿ä»£ä¸ºå¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°</strong></h4><p>è¿™é‡Œæ‰€è¯´çš„â€è™šæ‹Ÿå‡½æ•°æ›¿ä»£ä¸ºå¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°â€ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸å†æŠŠæ‰€æœ‰çš„åŠŸèƒ½éƒ½èšé›†åœ¨ <code>GameCharacter</code> ç±»æˆ–å…¶ç›´æ¥æ´¾ç”Ÿç±»ä¸­ï¼Œè€Œæ˜¯å°†æŸäº›åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒçš„ç±»å±‚æ¬¡ä¸­ï¼Œä»¥å‡å°‘ç±»çš„èŒè´£å¤æ‚æ€§ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹å—ï¼Œç±»çš„ç»§æ‰¿ä½“ç³»ä¸»è¦ä¾èµ–äºå•ä¸€çš„è™šæ‹Ÿå‡½æ•°æ¥å£æ¥æä¾›å¤šæ€æ€§ã€‚ä½†æœ‰æ—¶ï¼Œä¸€ä¸ªç±»å¯èƒ½æ‰¿æ‹…äº†è¿‡å¤šæŒ‡è´£ï¼Œå¯¼è‡´å…¶ç»§æ‰¿å±‚è¿‡äºåºå¤§ã€å¤æ‚ã€‚å› æ­¤ï¼Œå°†æŸäº›è¡Œä¸ºæå–åˆ°ä¸åŒçš„ã€ç‹¬ç«‹çš„ç»§æ‰¿ä½“ç³»ä¸­æ˜¯ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼›</p>
<ul>
<li><p><strong>æœ‰å“ªäº›ä¼˜ç‚¹å‘¢ï¼Ÿ</strong></p>
<ul>
<li><strong>æ¸…æ™°çš„èŒè´£åˆ’åˆ†</strong>ï¼šé€šè¿‡å°†å¥åº·è®¡ç®—é€»è¾‘ä» <code>GameCharacter</code> ç±»ä¸­æ‹†åˆ†åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç»§æ‰¿ä½“ç³»ä¸­ï¼Œ<code>GameCharacter</code> åªä¸“æ³¨äºè§’è‰²çš„å…¶ä»–åŠŸèƒ½ï¼Œå¦‚å±æ€§ç®¡ç†ã€çŠ¶æ€è·Ÿè¸ªç­‰ï¼Œè€Œå°†å¥åº·è®¡ç®—çš„èŒè´£äº¤ç»™ <code>HealthCalcFunc</code> åŠå…¶æ´¾ç”Ÿç±»ã€‚</li>
<li><strong>æ›´å¥½çš„å¯æ‰©å±•æ€§</strong>ï¼šå¦‚æœä»¥åéœ€è¦å¢åŠ æ–°çš„å¥åº·è®¡ç®—æ–¹å¼ï¼ˆå¦‚ä¸åŒè§’è‰²çš„å¥åº·è®¡ç®—ç­–ç•¥ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ–°çš„ <code>HealthCalcFunc</code> æ´¾ç”Ÿç±»ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ <code>GameCharacter</code> ç±»ã€‚</li>
<li><strong>å‡å°‘ä¸å¿…è¦çš„ä¾èµ–</strong>ï¼šé€šè¿‡å°†å¥åº·è®¡ç®—ä» <code>GameCharacter</code> ç±»ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå…¶ä»–ç±»ï¼ˆä¾‹å¦‚æ•Œäººã€NPCã€ç©å®¶ç­‰ï¼‰ä¹Ÿå¯ä»¥çµæ´»åœ°ä½¿ç”¨ä¸åŒçš„å¥åº·è®¡ç®—ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ç»§æ‰¿å¤æ‚çš„ <code>GameCharacter</code> ç±»ç»“æ„ã€‚</li>
<li><strong>é¿å…è™šæ‹Ÿå‡½æ•°é“¾çš„å¤æ‚æ€§</strong>ï¼šä¼ ç»Ÿçš„åšæ³•å¯èƒ½ä¼šè®©æ‰€æœ‰è®¡ç®—é€»è¾‘éƒ½ä¾èµ–äºè™šæ‹Ÿå‡½æ•°ï¼ˆå¦‚ <code>healthValue</code>ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ç»§æ‰¿é“¾è¿‡é•¿ï¼Œå¢åŠ ç±»çš„å¤æ‚åº¦ã€‚è€Œé€šè¿‡æ›¿ä»£ä¸ºå¦ä¸€å¥—ç»§æ‰¿ä½“ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ç±»çš„è®¾è®¡ï¼Œä½¿å¾—æ¯ä¸ªç±»åªè´Ÿè´£è‡ªå·±çš„èŒè´£ã€‚</li>
</ul>
</li>
<li><p>å¦‚ä½•é¿å…è®¾è®¡ä¸­çš„æ½œåœ¨é—®é¢˜</p>
<ul>
<li><p><strong>é¿å…è¿‡åº¦åˆ†æ•£åŠŸèƒ½</strong>ï¼šå°†åŠŸèƒ½æ‹†åˆ†åˆ°ç‹¬ç«‹çš„ç»§æ‰¿ä½“ç³»ä¸­è™½ç„¶å¸¦æ¥çµæ´»æ€§ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´ç±»å’ŒåŠŸèƒ½åˆ†æ•£ã€‚éœ€è¦åœ¨è®¾è®¡æ—¶ä»”ç»†æƒè¡¡ï¼Œé¿å…æ‹†åˆ†è¿‡åº¦ï¼Œå¯¼è‡´è®¾è®¡è¿‡äºå¤æ‚æˆ–éš¾ä»¥ç†è§£ã€‚</p>
</li>
<li><p><strong>æ¥å£ä¸å®ç°åˆ†ç¦»</strong>ï¼šæ‹†åˆ†åˆ°ç‹¬ç«‹ç»§æ‰¿ä½“ç³»æ—¶ï¼Œåº”è¯¥ç¡®ä¿æ¥å£ä¸å®ç°çš„åˆ†ç¦»ã€‚<code>HealthCalcFunc</code> åªæä¾›æ¥å£ï¼Œå…·ä½“å®ç°ï¼ˆå¦‚ <code>DefaultHealthCalc</code> å’Œ <code>FastHealthCalc</code>ï¼‰åˆ™ç”±æ´¾ç”Ÿç±»æä¾›ã€‚</p>
</li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹ä»£ç </strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºç±»ï¼šå¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HealthCalcFunc</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">const</span> <span class="keyword">class</span> GameCharacter&amp; gc)</span> <span class="type">const</span> </span>= <span class="number">0</span>;  <span class="comment">// çº¯è™šå‡½æ•°ï¼Œæ‰€æœ‰å¥åº·è®¡ç®—ç­–ç•¥éƒ½å¿…é¡»å®ç°è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">HealthCalcFunc</span>() = <span class="keyword">default</span>;  <span class="comment">// æ·»åŠ è™šææ„å‡½æ•°ï¼Œç¡®ä¿æ´¾ç”Ÿç±»èƒ½æ­£ç¡®ææ„</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤å¥åº·è®¡ç®—ç­–ç•¥ï¼ˆä¾‹å¦‚åŸºç¡€çš„å¥åº·å€¼è®¡ç®—ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultHealthCalc</span> : <span class="keyword">public</span> HealthCalcFunc &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">const</span> <span class="keyword">class</span> GameCharacter&amp; gc)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‡è®¾é»˜è®¤å¥åº·å€¼ä¸º100</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ˜å£«å¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WarriorHealthCalc</span> : <span class="keyword">public</span> HealthCalcFunc &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">const</span> <span class="keyword">class</span> GameCharacter&amp; gc)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‡è®¾æˆ˜å£«çš„å¥åº·å€¼è®¡ç®—å…¬å¼ï¼šåŸºç¡€å€¼ + 50</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">150</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³•å¸ˆå¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MageHealthCalc</span> : <span class="keyword">public</span> HealthCalcFunc &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">const</span> <span class="keyword">class</span> GameCharacter&amp; gc)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‡è®¾æ³•å¸ˆçš„å¥åº·å€¼è®¡ç®—å…¬å¼ï¼šåŸºç¡€å€¼ + 30</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">130</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸¸æˆè§’è‰²ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°æ¥å—å¥åº·è®¡ç®—ç­–ç•¥æŒ‡é’ˆï¼Œé»˜è®¤ä¸ºé»˜è®¤ç­–ç•¥</span></span><br><span class="line">    <span class="built_in">GameCharacter</span>(HealthCalcFunc* hcf = &amp;defaultHealthCalc) : <span class="built_in">pHealthCalc</span>(hcf) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å¥åº·å€¼</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pHealthCalc-&gt;<span class="built_in">calc</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    HealthCalcFunc* pHealthCalc;  <span class="comment">// ä¿å­˜å¥åº·è®¡ç®—ç­–ç•¥çš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">static</span> DefaultHealthCalc defaultHealthCalc;  <span class="comment">// é»˜è®¤çš„å¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰é»˜è®¤çš„å¥åº·è®¡ç®—ç­–ç•¥ï¼ˆé™æ€æˆå‘˜ï¼‰</span></span><br><span class="line">DefaultHealthCalc GameCharacter::defaultHealthCalc;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸åŒçš„å¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line">    WarriorHealthCalc warriorCalc;</span><br><span class="line">    MageHealthCalc mageCalc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸åŒçš„æ¸¸æˆè§’è‰²</span></span><br><span class="line">    GameCharacter defaultChar;  <span class="comment">// ä½¿ç”¨é»˜è®¤å¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line">    <span class="function">GameCharacter <span class="title">warriorChar</span><span class="params">(&amp;warriorCalc)</span></span>;  <span class="comment">// ä½¿ç”¨æˆ˜å£«å¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line">    <span class="function">GameCharacter <span class="title">mageChar</span><span class="params">(&amp;mageCalc)</span></span>;  <span class="comment">// ä½¿ç”¨æ³•å¸ˆå¥åº·è®¡ç®—ç­–ç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºæ¯ä¸ªè§’è‰²çš„å¥åº·å€¼</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Default Character Health: &quot;</span> &lt;&lt; defaultChar.<span class="built_in">healthValue</span>() &lt;&lt; std::endl;  <span class="comment">// 100</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-23"><a href="#æ€»ç»“-23" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½¿ç”¨è™šæ‹Ÿå‡½æ•°è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†åœ¨æ€§èƒ½å’Œè®¾è®¡ä¸Šå¯èƒ½å¸¦æ¥ä¸€äº›é—®é¢˜ã€‚é€šè¿‡ <strong>Non-Virtual Interface (NVI)</strong> æ‰‹æ³•ã€<strong>Strategy æ¨¡å¼</strong> å’Œ <strong>tr1::function</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ç›´æ¥ä¾èµ–è™šæ‹Ÿå‡½æ•°ï¼Œæå‡ä»£ç çš„çµæ´»æ€§ã€å°è£…æ€§å’Œæ€§èƒ½ã€‚</p>
<ul>
<li><strong>NVI æ‰‹æ³•</strong>ï¼šé€šè¿‡éè™šå‡½æ•°å°è£…è™šæ‹Ÿå‡½æ•°ï¼Œå®ç°æ¸…æ™°çš„è´£ä»»åˆ’åˆ†å’Œäº‹å‰äº‹åæ“ä½œã€‚</li>
<li><strong>Strategy æ¨¡å¼</strong>ï¼šé€šè¿‡ç­–ç•¥å¯¹è±¡åŠ¨æ€æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºï¼Œä½¿å¾—è¡Œä¸ºå¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ï¼Œæå‡çµæ´»æ€§ã€‚</li>
<li><strong>tr1::function</strong>ï¼šæ¯”å‡½æ•°æŒ‡é’ˆæ›´å¼ºå¤§ï¼Œæ”¯æŒå¤šç§å¯è°ƒç”¨å¯¹è±¡ï¼Œç±»å‹å®‰å…¨ï¼Œç®€åŒ–ç®¡ç†ã€‚</li>
<li><strong>ç»§æ‰¿ä½“ç³»ä¸­çš„è™šæ‹Ÿå‡½æ•°æ›¿ä»£</strong>ï¼šé€šè¿‡æ‹†åˆ†åŠŸèƒ½åˆ°ä¸åŒçš„ç»§æ‰¿ä½“ç³»ä¸­ï¼Œæé«˜æ‰©å±•æ€§å¹¶å‡å°‘å®ç°è€¦åˆã€‚</li>
</ul>
<h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><h4 id="ä¸ºä»€ä¹ˆ-tr1-function-æ¯”æ™®é€šæŒ‡é’ˆæ›´å®‰å…¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-tr1-function-æ¯”æ™®é€šæŒ‡é’ˆæ›´å®‰å…¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ tr1::function æ¯”æ™®é€šæŒ‡é’ˆæ›´å®‰å…¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>tr1::function</code> æ¯”æ™®é€šæŒ‡é’ˆæ›´å®‰å…¨ï¼Ÿ</h4><ol>
<li><p><strong>ç±»å‹å®‰å…¨</strong>ï¼š</p>
<ul>
<li><code>tr1::function</code> æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æ—¶ç¡®ä¿ä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡ä¸å£°æ˜çš„ç±»å‹ä¸€è‡´ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå‡½æ•°æŒ‡é’ˆåœ¨ä¼ é€’æ—¶æ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç±»å‹ä¸åŒ¹é…ï¼Œä»è€Œå¼•å‘è¿è¡Œæ—¶é”™è¯¯ã€‚</li>
<li><code>tr1::function</code> å†…éƒ¨å°è£…äº†ä¸€ä¸ªæŒ‡å‘åŸºç±»çš„æŒ‡é’ˆï¼Œè€Œè¿™ä¸ªåŸºç±»ç”¨ä¸€ä¸ªçº¯è™šå‡½æ•°ç»Ÿä¸€æ¥å£ï¼Œç”¨äºæ‰§è¡Œå®é™…è°ƒç”¨ï¼Œé€šè¿‡ç»§æ‰¿åŸºç±»å®ç° <code>invoke</code>ã€‚ç¼–è¯‘æ—¶ï¼Œ<code>std::function</code> èƒ½å¤ŸéªŒè¯ä¼ å…¥çš„å‡½æ•°ç­¾åæ˜¯å¦åŒ¹é…ï¼Œå¦‚æœä¸€ä¸ªä¸åŒ¹é…çš„å‡½æ•°æŒ‡é’ˆè¢«å¤åˆ¶ç»™<code>stdï¼šï¼šfunction</code>ï¼Œç¼–è¯‘å™¨å°±èƒ½ç«‹å³æ£€æµ‹åˆ°å¹¶æŠ¥é”™ã€‚</li>
</ul>
</li>
<li><p><strong>è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<ul>
<li><code>tr1::function</code> å†…éƒ¨ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œç¡®ä¿å°è£…çš„å¯¹è±¡èƒ½å¤ŸåŠæ—¶é”€æ¯ï¼›è€Œæ™®é€šå‡½æ•°æŒ‡é’ˆå¿…é¡»ç”±å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ï¼›</li>
<li>å½“ä½ å°†æŸä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚ä¸€ä¸ª lambda æˆ–å‡½æ•°æŒ‡é’ˆï¼‰èµ‹å€¼ç»™ <code>std::function</code> æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç®¡ç†è¯¥å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿å¯¹è±¡çš„ä½œç”¨åŸŸè¶…å‡ºï¼Œ<code>std::function</code> ä»ä¼šç¡®ä¿å¯¹è±¡ä¸ä¼šåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è¢«é”€æ¯ã€‚è€Œæ™®é€šå‡½æ•°åªæ˜¯ä¸ªè£¸æŒ‡é’ˆï¼Œå®¹æ˜“å†…å­˜æ³„æ¼æˆ–äº§ç”Ÿæ‚¬ç©ºæŒ‡é’ˆï¼›</li>
</ul>
</li>
<li><p><strong>æ”¯æŒå¤šç§å¯è°ƒç”¨å¯¹è±¡</strong>ï¼š</p>
<ul>
<li><code>tr1::function</code> é€šè¿‡ç±»å‹æ“¦é™¤æŠ€æœ¯å°è£…äº†ä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå…è®¸å°†ä¸åŒç±»å‹çš„å‡½æ•°ç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨ï¼Œé¿å…äº†ä¸ºæ¯ç§ç±»å‹ç¼–å†™ä¸åŒçš„å¤„ç†é€»è¾‘ã€‚</li>
<li><code>std::function</code> åˆ©ç”¨è™šå‡½æ•°å’ŒåŠ¨æ€ç»‘å®šï¼Œèƒ½å°†æ™®é€šå‡½æ•°æŒ‡é’ˆã€æˆå‘˜å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ï¼ˆå®ç°äº†operatorçš„ç±»ï¼‰ã€lambda è¡¨è¾¾å¼ç­‰ä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡å°è£…ä¸ºç»Ÿä¸€çš„ç±»å‹ã€‚åº•å±‚å®ç°é€šè¿‡ç»§æ‰¿å’Œå¤šæ€ç®¡ç†ä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œè€Œæ™®é€šå‡½æ•°æŒ‡é’ˆä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚</li>
</ul>
</li>
<li><p><strong>æ”¯æŒ <code>nullptr</code></strong></p>
<ul>
<li><p><code>tr1::function</code> æ”¯æŒé€šè¿‡ <code>nullptr</code> è¡¨ç¤ºæ²¡æœ‰å‡½æ•°å¯¹è±¡ï¼Œè°ƒç”¨å‰å¯ä»¥å®‰å…¨åœ°æ£€æŸ¥æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…è®¿é—®ç©ºæŒ‡é’ˆã€‚</p>
</li>
<li><p><code>std::function</code> çš„å†…éƒ¨å®ç°å…è®¸å…¶å­˜å‚¨ä¸€ä¸ªç©ºçŠ¶æ€ï¼ˆå³ <code>nullptr</code>ï¼‰ã€‚ä½¿ç”¨å‰ï¼Œä½ å¯ä»¥é€šè¿‡æ˜¾å¼æ£€æŸ¥ <code>std::function</code> æ˜¯å¦ä¸ºç©ºæ¥é¿å…è°ƒç”¨ç©ºæŒ‡é’ˆã€‚è€Œæ™®é€šå‡½æ•°æŒ‡é’ˆæ²¡æœ‰è¿™ç§ç©ºçŠ¶æ€æ”¯æŒï¼Œå¿…é¡»æ‰‹åŠ¨æ£€æŸ¥æ˜¯å¦ä¸º <code>nullptr</code>ï¼Œå®¹æ˜“é—æ¼ï¼Œå¯¼è‡´å´©æºƒæˆ–æœªå®šä¹‰è¡Œä¸ºã€‚</p>
</li>
</ul>
</li>
<li><p><strong>é”™è¯¯å¤„ç†å’Œå¼‚å¸¸å®‰å…¨</strong></p>
<ul>
<li><p><code>tr1::function</code> åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨å¤„ç†å¼‚å¸¸ï¼Œç¡®ä¿å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œå†…éƒ¨çš„èµ„æºä¹Ÿä¼šè¢«å®‰å…¨é‡Šæ”¾ã€‚</p>
</li>
<li><p>å®ƒçš„å†…éƒ¨é€šè¿‡æ™ºèƒ½æŒ‡é’ˆï¼ˆstd::unique_ptrï¼‰å’ŒRAIIåŸåˆ™æ¥ä¿è¯è°ƒç”¨å°è£…çš„å¯è°ƒç”¨å¯¹è±¡å‘ç”Ÿå¼‚å¸¸æ—¶çš„èµ„æºæ­£ç¡®é‡Šæ”¾ï¼›å½“ <code>std::function</code> å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é‡Šæ”¾å­˜å‚¨çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œç¡®ä¿å³ä½¿åœ¨è°ƒç”¨æœŸé—´å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"><a href="#æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°" class="headerlink" title="æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"></a>æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</h2><blockquote>
<p><em>Never redefine an inherited non-virtual function</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-32"><a href="#æ ¸å¿ƒç†å¿µ-32" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ç»ä¸åº”è¯¥é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</strong>ï¼Œå› ä¸ºnon-virtualå‡½æ•°æ˜¯é™æ€ç»‘å®šçš„ï¼Œé‡æ–°å®šä¹‰ä¼šå¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´ï¼Œè¿èƒŒäº†publicç»§æ‰¿çš„â€is-aâ€å…³ç³»ã€‚å¦‚æœæ´¾ç”Ÿç±»éœ€è¦ä¸åŒçš„è¡Œä¸ºï¼Œè¦ä¹ˆä½¿å‡½æ•°ä¸ºè™šå‡½æ•°ï¼Œè¦ä¹ˆé‡æ–°è€ƒè™‘ç»§æ‰¿å…³ç³»çš„è®¾è®¡ã€‚</p>
<h3 id="æ·±åº¦è§£æ-32"><a href="#æ·±åº¦è§£æ-32" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-non-virtualå‡½æ•°çš„é™æ€ç»‘å®šç‰¹æ€§"><a href="#1-non-virtualå‡½æ•°çš„é™æ€ç»‘å®šç‰¹æ€§" class="headerlink" title="1. non-virtualå‡½æ•°çš„é™æ€ç»‘å®šç‰¹æ€§"></a>1. <strong>non-virtualå‡½æ•°çš„é™æ€ç»‘å®šç‰¹æ€§</strong></h4><p><strong>ğŸ¤” ç–‘é—®ç‚¹ï¼šä¸ºä»€ä¹ˆé‡æ–°å®šä¹‰non-virtualå‡½æ•°ä¼šå¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´ï¼Ÿ</strong></p>
<p>è¿™æ˜¯å› ä¸ºnon-virtualå‡½æ•°é‡‡ç”¨é™æ€ç»‘å®šæœºåˆ¶ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±æ ¹æ®æŒ‡é’ˆæˆ–å¼•ç”¨çš„å£°æ˜ç±»å‹æ¥å†³å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ªå¯¹è±¡é€šè¿‡ä¸åŒç±»å‹çš„æŒ‡é’ˆè°ƒç”¨åŒä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå¯èƒ½ä¼šæ‰§è¡Œå®Œå…¨ä¸åŒçš„ä»£ç ï¼Œè¿èƒŒäº†é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­â€å¯¹è±¡è¡Œä¸ºåº”è¯¥ä¸€è‡´â€çš„åŸºæœ¬åŸåˆ™ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">nonVirtualFunc</span><span class="params">()</span> </span>&#123;  <span class="comment">// non-virtualå‡½æ•°</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::nonVirtualFunc()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">virtualFunc</span><span class="params">()</span> </span>&#123;  <span class="comment">// virtualå‡½æ•°å¯¹æ¯”</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Base::virtualFunc()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šé‡æ–°å®šä¹‰non-virtualå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">nonVirtualFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::nonVirtualFunc()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šé‡å†™virtualå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">virtualFunc</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::virtualFunc()&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateBindingDifference</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    Base* pB = &amp;d;</span><br><span class="line">    Derived* pD = &amp;d;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// non-virtualå‡½æ•°ï¼šé™æ€ç»‘å®šï¼Œè¡Œä¸ºä¸ä¸€è‡´</span></span><br><span class="line">    pB-&gt;<span class="built_in">nonVirtualFunc</span>();  <span class="comment">// è¾“å‡ºï¼šBase::nonVirtualFunc()</span></span><br><span class="line">    pD-&gt;<span class="built_in">nonVirtualFunc</span>();  <span class="comment">// è¾“å‡ºï¼šDerived::nonVirtualFunc()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// virtualå‡½æ•°ï¼šåŠ¨æ€ç»‘å®šï¼Œè¡Œä¸ºä¸€è‡´</span></span><br><span class="line">    pB-&gt;<span class="built_in">virtualFunc</span>();     <span class="comment">// è¾“å‡ºï¼šDerived::virtualFunc()</span></span><br><span class="line">    pD-&gt;<span class="built_in">virtualFunc</span>();     <span class="comment">// è¾“å‡ºï¼šDerived::virtualFunc()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è¿èƒŒis-aå…³ç³»çš„è¯­ä¹‰"><a href="#2-è¿èƒŒis-aå…³ç³»çš„è¯­ä¹‰" class="headerlink" title="2. è¿èƒŒis-aå…³ç³»çš„è¯­ä¹‰"></a>2. <strong>è¿èƒŒis-aå…³ç³»çš„è¯­ä¹‰</strong></h4><p><strong>ğŸ¤” ç–‘é—®ç‚¹ï¼šé‡æ–°å®šä¹‰non-virtualå‡½æ•°ä¸ºä»€ä¹ˆä¼šç ´åis-aå…³ç³»ï¼Ÿ</strong></p>
<p>publicç»§æ‰¿è¡¨è¾¾çš„æ˜¯â€is-aâ€å…³ç³»ï¼Œæ„å‘³ç€æ´¾ç”Ÿç±»å¯¹è±¡åº”è¯¥èƒ½å¤Ÿåœ¨ä»»ä½•éœ€è¦åŸºç±»å¯¹è±¡çš„åœ°æ–¹å®Œç¾æ›¿ä»£åŸºç±»å¯¹è±¡ã€‚å½“ä½ é‡æ–°å®šä¹‰non-virtualå‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å‘Šè¯‰ç¼–è¯‘å™¨â€æ´¾ç”Ÿç±»åœ¨æŸäº›æƒ…å†µä¸‹çš„è¡Œä¸ºä¸åŸºç±»ä¸åŒâ€ï¼Œè¿™ç›´æ¥è¿èƒŒäº†Liskovæ›¿æ¢åŸåˆ™ï¼Œä½¿å¾—æ´¾ç”Ÿç±»å¯¹è±¡æ— æ³•å®Œå…¨æ›¿ä»£åŸºç±»å¯¹è±¡ï¼Œç ´åäº†ç»§æ‰¿å…³ç³»çš„è¯­ä¹‰å®Œæ•´æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;  <span class="comment">// non-virtualï¼šæ‰€æœ‰è½¦è¾†éƒ½è¿™æ ·å¯åŠ¨</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Engine starting...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        engineRunning_ = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;  <span class="comment">// virtualï¼šä¸åŒè½¦è¾†åŠ é€Ÿæ–¹å¼ä¸åŒ</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Vehicle accelerating&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isRunning</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> engineRunning_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">bool</span> engineRunning_ = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElectricCar</span> : <span class="keyword">public</span> Vehicle &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šé‡æ–°å®šä¹‰non-virtualå‡½æ•°ç ´åäº†is-aå…³ç³»</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Electric motor starting silently...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// è¿™ç ´åäº†Vehicleçš„invariantï¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šé‡å†™virtualå‡½æ•°æä¾›ç‰¹å®šå®ç°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accelerate</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Electric car accelerating smoothly&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ"><a href="#3-æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="3. æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ"></a>3. <strong>æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ</strong></h4><p><strong>ğŸ¤” ç–‘é—®ç‚¹ï¼šå¦‚æœæ´¾ç”Ÿç±»ç¡®å®éœ€è¦ä¸åŒçš„è¡Œä¸ºï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p>å½“æ´¾ç”Ÿç±»éœ€è¦ä¸åŒäºåŸºç±»çš„è¡Œä¸ºæ—¶ï¼Œæ­£ç¡®çš„åšæ³•ä¸æ˜¯é‡æ–°å®šä¹‰non-virtualå‡½æ•°ï¼Œè€Œæ˜¯é‡æ–°å®¡è§†è®¾è®¡ã€‚ä½ æœ‰å‡ ä¸ªé€‰æ‹©ï¼šè®©åŸºç±»å‡½æ•°æˆä¸ºvirtualä»¥æ”¯æŒå¤šæ€è¡Œä¸ºï¼Œé‡æ–°ç»„ç»‡ç»§æ‰¿å±‚æ¬¡ç¡®ä¿æ¯ä¸ªç±»éƒ½ç¬¦åˆå…¶åŸºç±»å¥‘çº¦ï¼Œæˆ–è€…ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ã€‚å…³é”®æ˜¯è¦ä¿æŒè®¾è®¡çš„ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§ã€‚</p>
<p><strong>æ–¹æ¡ˆ1ï¼šä½¿å‡½æ•°æˆä¸ºvirtual</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… å¦‚æœéœ€è¦æ´¾ç”Ÿç±»ç‰¹å®šè¡Œä¸ºï¼Œä½¿ç”¨virtual</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">makeSound</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Some generic animal sound&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">move</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Animal moving&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// non-virtualå‡½æ•°åº”è¯¥è¡¨ç¤ºæ‰€æœ‰æ´¾ç”Ÿç±»å…±åŒçš„ä¸å˜è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">breathe</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Breathing...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">makeSound</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Woof!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Dog running&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// breathe()ä¸éœ€è¦é‡å†™ï¼Œæ‰€æœ‰åŠ¨ç‰©éƒ½ä¸€æ ·å‘¼å¸</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ¡ˆ2ï¼šé‡æ–°è®¾è®¡ç»§æ‰¿å±‚æ¬¡</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„è®¾è®¡ï¼šé‡æ–°ç»„ç»‡ç»§æ‰¿å±‚æ¬¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">sleep</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Bird</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingBird</span> : <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Flying...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlightlessBird</span> : <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">walk</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Walking...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Eagle</span> : <span class="keyword">public</span> FlyingBird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Eagle hunting&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sleep</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Eagle sleeping in nest&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Eagle soaring high&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span> : <span class="keyword">public</span> FlightlessBird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Penguin catching fish&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sleep</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Penguin huddling for warmth&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">walk</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Penguin waddling&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Penguin swimming gracefully&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-24"><a href="#æ€»ç»“-24" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°çš„åŸå› ï¼š</strong></p>
<ol>
<li><strong>é™æ€ç»‘å®šå¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´</strong>ï¼šé€šè¿‡ä¸åŒç±»å‹æŒ‡é’ˆè°ƒç”¨ä¼šæœ‰ä¸åŒè¡Œä¸º</li>
<li><strong>è¿èƒŒis-aå…³ç³»</strong>ï¼šç ´åäº†publicç»§æ‰¿çš„è¯­ä¹‰å¥‘çº¦</li>
<li><strong>è¿åLiskovæ›¿æ¢åŸåˆ™</strong>ï¼šæ´¾ç”Ÿç±»å¯¹è±¡ä¸èƒ½å®Œå…¨æ›¿ä»£åŸºç±»å¯¹è±¡</li>
<li><strong>æ··æ·†å®¢æˆ·ä»£ç </strong>ï¼šç›¸åŒæ¥å£äº§ç”Ÿä¸åŒè¡Œä¸º</li>
</ol>
<p><strong>æ­£ç¡®çš„è®¾è®¡é€‰æ‹©ï¼š</strong></p>
<ul>
<li><strong>éœ€è¦å¤šæ€è¡Œä¸º</strong>ï¼šä½¿ç”¨virtualå‡½æ•°</li>
<li><strong>éœ€è¦ä¸€è‡´è¡Œä¸º</strong>ï¼šä¿æŒnon-virtualå‡½æ•°ä¸å˜</li>
<li><strong>éœ€è¦ä¸åŒè¡Œä¸º</strong>ï¼šé‡æ–°è®¾è®¡ç»§æ‰¿å±‚æ¬¡æˆ–ä½¿ç”¨ç»„åˆ</li>
<li><strong>æ€§èƒ½å…³é”®</strong>ï¼šè€ƒè™‘CRTPæˆ–å…¶ä»–ç¼–è¯‘æ—¶å¤šæ€æŠ€æœ¯</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>non-virtualå‡½æ•°è¡¨ç¤ºä¸å˜æ€§</strong>ï¼šæ‰€æœ‰æ´¾ç”Ÿç±»éƒ½åº”è¯¥æœ‰ç›¸åŒè¡Œä¸º</li>
<li><strong>virtualå‡½æ•°è¡¨ç¤ºå¯å˜æ€§</strong>ï¼šæ´¾ç”Ÿç±»å¯ä»¥æä¾›ç‰¹å®šå®ç°</li>
<li><strong>publicç»§æ‰¿è¡¨ç¤ºis-aå…³ç³»</strong>ï¼šæ´¾ç”Ÿç±»åº”è¯¥èƒ½å¤Ÿå®Œå…¨æ›¿ä»£åŸºç±»</li>
</ul>
<p><strong>è®°ä½ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´å¹¶è¿èƒŒpublicç»§æ‰¿çš„is-aå…³ç³»ã€‚å¦‚æœéœ€è¦ä¸åŒçš„è¡Œä¸ºï¼Œè¦ä¹ˆä½¿å‡½æ•°æˆä¸ºvirtualï¼Œè¦ä¹ˆé‡æ–°è€ƒè™‘è®¾è®¡ã€‚</strong></p>
<h2 id="æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼"><a href="#æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼" class="headerlink" title="æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼"></a>æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼</h2><blockquote>
<p><em>Never redefine a functionâ€™s inherited default parameter value</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-33"><a href="#æ ¸å¿ƒç†å¿µ-33" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>ç»ä¸åº”è¯¥é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„è™šå‡½æ•°çš„ç¼ºçœå‚æ•°å€¼</strong>ï¼Œå› ä¸ºè™šå‡½æ•°æ˜¯åŠ¨æ€ç»‘å®šçš„ï¼Œä½†ç¼ºçœå‚æ•°å€¼å´æ˜¯é™æ€ç»‘å®šçš„ã€‚è¿™ç§ä¸ä¸€è‡´ä¼šå¯¼è‡´è°ƒç”¨æ´¾ç”Ÿç±»å‡½æ•°æ—¶ä½¿ç”¨åŸºç±»çš„ç¼ºçœå‚æ•°å€¼ï¼Œäº§ç”Ÿä»¤äººå›°æƒ‘çš„è¡Œä¸ºã€‚æ­£ç¡®çš„åšæ³•æ˜¯åœ¨åŸºç±»ä¸­å®šä¹‰åˆé€‚çš„ç¼ºçœå‚æ•°å€¼ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–è®¾è®¡æ¨¡å¼é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="æ·±åº¦è§£æ-33"><a href="#æ·±åº¦è§£æ-33" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-ç¼ºçœå‚æ•°å€¼çš„é™æ€ç»‘å®šç‰¹æ€§"><a href="#1-ç¼ºçœå‚æ•°å€¼çš„é™æ€ç»‘å®šç‰¹æ€§" class="headerlink" title="1. ç¼ºçœå‚æ•°å€¼çš„é™æ€ç»‘å®šç‰¹æ€§"></a>1. <strong>ç¼ºçœå‚æ•°å€¼çš„é™æ€ç»‘å®šç‰¹æ€§</strong></h4><p><strong>ğŸ¤” ç–‘é—®ç‚¹ï¼šä¸ºä»€ä¹ˆè™šå‡½æ•°çš„ç¼ºçœå‚æ•°å€¼ä¸èƒ½è¢«æ­£ç¡®é‡æ–°å®šä¹‰ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜æºäºC++çš„è®¾è®¡ç»†èŠ‚ï¼šè™šå‡½æ•°é‡‡ç”¨åŠ¨æ€ç»‘å®šï¼ˆè¿è¡Œæ—¶æ ¹æ®å¯¹è±¡å®é™…ç±»å‹å†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ï¼‰ï¼Œä½†ç¼ºçœå‚æ•°å€¼å´é‡‡ç”¨é™æ€ç»‘å®šï¼ˆç¼–è¯‘æ—¶æ ¹æ®æŒ‡é’ˆç±»å‹å†³å®šä½¿ç”¨å“ªä¸ªç¼ºçœå€¼ï¼‰ã€‚è¿™ç§â€æ··åˆç»‘å®šâ€æœºåˆ¶å¯¼è‡´äº†ä¸€ç§å¥‡ç‰¹ç°è±¡ï¼šä½ å¯èƒ½è°ƒç”¨çš„æ˜¯æ´¾ç”Ÿç±»çš„å‡½æ•°å®ç°ï¼Œä½†ä½¿ç”¨çš„å´æ˜¯åŸºç±»çš„ç¼ºçœå‚æ•°å€¼ï¼Œé€ æˆè¡Œä¸ºçš„ä¸ä¸€è‡´å’Œå›°æƒ‘ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Color</span> &#123; Red, Green, Blue &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è™šå‡½æ•°withç¼ºçœå‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">(Color color = Red)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Shape with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šé‡æ–°å®šä¹‰ç¼ºçœå‚æ•°å€¼</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(Color color = Green)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Rectangle with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šä¸é‡æ–°å®šä¹‰ç¼ºçœå‚æ•°å€¼</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(Color color = Red)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Circle with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">demonstrateDefaultParameterProblem</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Shape* shapes[] = &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Rectangle</span>(),</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">Circle</span>()</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡åŸºç±»æŒ‡é’ˆè°ƒç”¨ï¼Œä½¿ç”¨ç¼ºçœå‚æ•°</span></span><br><span class="line">    shapes[<span class="number">0</span>]-&gt;<span class="built_in">draw</span>();  <span class="comment">// è¾“å‡ºï¼šDrawing Rectangle with color 0 (Red)</span></span><br><span class="line">                        <span class="comment">// è°ƒç”¨äº†Rectangle::draw()ä½†ä½¿ç”¨äº†Shapeçš„ç¼ºçœå‚æ•°ï¼</span></span><br><span class="line">    </span><br><span class="line">    shapes[<span class="number">1</span>]-&gt;<span class="built_in">draw</span>();  <span class="comment">// è¾“å‡ºï¼šDrawing Circle with color 0 (Red)</span></span><br><span class="line">                        <span class="comment">// æ­£å¸¸è¡Œä¸º</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> shapes[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">delete</span> shapes[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ"><a href="#2-æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="2. æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ"></a>2. <strong>æ­£ç¡®çš„è®¾è®¡æ–¹æ¡ˆ</strong></h4><p><strong>ğŸ¤” ç–‘é—®ç‚¹ï¼šå¦‚ä½•é¿å…ç¼ºçœå‚æ•°å€¼é‡æ–°å®šä¹‰å¸¦æ¥çš„é—®é¢˜ï¼Ÿ</strong></p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ€è·¯æ˜¯â€åˆ†ç¦»å…³æ³¨ç‚¹â€â€”â€”å°†ç¼ºçœå‚æ•°çš„ç®¡ç†è´£ä»»ä»virtualå‡½æ•°ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä½ å¯ä»¥ä¿æŒæ‰€æœ‰é‡å†™å‡½æ•°ä½¿ç”¨ç›¸åŒçš„ç¼ºçœå‚æ•°å€¼ï¼Œæˆ–è€…ä½¿ç”¨NVIï¼ˆNon-Virtual Interfaceï¼‰æ¨¡å¼å°†ç¼ºçœå‚æ•°æ”¾åœ¨non-virtualå‡½æ•°ä¸­ï¼Œè®©virtualå‡½æ•°ä¸“æ³¨äºå®ç°å¤šæ€è¡Œä¸ºã€‚è¿™æ ·æ—¢ä¿æŒäº†æ¥å£çš„ä¸€è‡´æ€§ï¼Œåˆå®ç°äº†è¡Œä¸ºçš„å¤šæ ·æ€§ã€‚</p>
<p><strong>æ–¹æ¡ˆ1ï¼šä¸é‡æ–°å®šä¹‰ç¼ºçœå‚æ•°å€¼</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">FeedingTime</span> &#123; Morning, Afternoon, Evening &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">feed</span><span class="params">(FeedingTime time = Morning)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Feeding animal at time &quot;</span> &lt;&lt; time &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Animal</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šä¿æŒç›¸åŒçš„ç¼ºçœå‚æ•°å€¼</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">feed</span><span class="params">(FeedingTime time = Morning)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Feeding dog at time &quot;</span> &lt;&lt; time &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> : <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âœ… æ›´ç®€å•ï¼šä¸å†™ç¼ºçœå‚æ•°ï¼Œè‡ªåŠ¨ç»§æ‰¿åŸºç±»çš„</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">feed</span><span class="params">(FeedingTime time)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Feeding cat at time &quot;</span> &lt;&lt; time &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ¡ˆ2ï¼šä½¿ç”¨Non-Virtual Interface (NVI)æ¨¡å¼</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Color</span> &#123; Red, Green, Blue &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// non-virtualå…¬å…±æ¥å£ï¼Œæä¾›ç¼ºçœå‚æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(Color color = Red)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">doDraw</span>(color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// virtualå®ç°å‡½æ•°ï¼Œä¸æä¾›ç¼ºçœå‚æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doDraw</span><span class="params">(Color color)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Shape with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// âœ… åªé‡å†™å®ç°å‡½æ•°ï¼Œæ— ç¼ºçœå‚æ•°é—®é¢˜</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doDraw</span><span class="params">(Color color)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Rectangle with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> : <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doDraw</span><span class="params">(Color color)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Drawing Circle with color &quot;</span> &lt;&lt; color &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-25"><a href="#æ€»ç»“-25" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>ç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼çš„åŸå› ï¼š</strong></p>
<ol>
<li><strong>é™æ€ç»‘å®š vs åŠ¨æ€ç»‘å®š</strong>ï¼šç¼ºçœå‚æ•°é™æ€ç»‘å®šï¼Œè™šå‡½æ•°åŠ¨æ€ç»‘å®š</li>
<li><strong>è¡Œä¸ºä¸ä¸€è‡´</strong>ï¼šåŒä¸€å¯¹è±¡é€šè¿‡ä¸åŒæŒ‡é’ˆç±»å‹è°ƒç”¨ä¼šæœ‰ä¸åŒçš„ç¼ºçœå‚æ•°</li>
<li><strong>è¿èƒŒç›´è§‰</strong>ï¼šç¨‹åºå‘˜æœŸæœ›çš„è¡Œä¸ºä¸å®é™…è¡Œä¸ºä¸ç¬¦</li>
<li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šé”™è¯¯ä¸æ˜“å‘ç°ï¼Œè¿è¡Œæ—¶è¡Œä¸ºéš¾ä»¥é¢„æµ‹</li>
</ol>
<p><strong>æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>ä¿æŒä¸€è‡´çš„ç¼ºçœå‚æ•°</strong>ï¼šåœ¨æ‰€æœ‰é‡å†™å‡½æ•°ä¸­ä½¿ç”¨ç›¸åŒçš„ç¼ºçœå‚æ•°</li>
<li><strong>ä½¿ç”¨NVIæ¨¡å¼</strong>ï¼šå°†ç¼ºçœå‚æ•°æ”¾åœ¨non-virtualå‡½æ•°ä¸­</li>
<li><strong>ä½¿ç”¨é‡è½½</strong>ï¼šæä¾›å¤šä¸ªå‡½æ•°ç‰ˆæœ¬è€Œä¸æ˜¯ç¼ºçœå‚æ•°</li>
<li><strong>ä½¿ç”¨é…ç½®å¯¹è±¡</strong>ï¼šå°†å‚æ•°å°è£…åœ¨ç»“æ„ä½“ä¸­</li>
</ul>
<p><strong>è®¾è®¡æŒ‡å¯¼åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>virtualå‡½æ•°åº”è¯¥ä¸“æ³¨äºè¡Œä¸ºå¤šæ€</strong>ï¼šä¸è¦æ··åˆå‚æ•°é»˜è®¤å€¼çš„å¤æ‚æ€§</li>
<li><strong>ç¼ºçœå‚æ•°åº”è¯¥åœ¨æ¥å£å±‚é¢ç»Ÿä¸€</strong>ï¼šé¿å…åœ¨ç»§æ‰¿å±‚æ¬¡ä¸­å˜åŒ–</li>
<li><strong>ä¼˜å…ˆè€ƒè™‘æ˜¾å¼å‚æ•°</strong>ï¼šæ˜ç¡®æ€§èƒœè¿‡ä¾¿åˆ©æ€§</li>
</ul>
<p><strong>è®°ä½ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼ï¼Œå› ä¸ºç¼ºçœå‚æ•°å€¼æ˜¯é™æ€ç»‘å®šçš„ï¼Œè€Œè™šå‡½æ•°æ˜¯åŠ¨æ€ç»‘å®šçš„ï¼Œè¿™ä¼šå¯¼è‡´è°ƒç”¨æ´¾ç”Ÿç±»å‡½æ•°æ—¶ä½¿ç”¨åŸºç±»çš„ç¼ºçœå‚æ•°å€¼ã€‚</strong></p>
<h2 id="æ¡æ¬¾38ï¼š-é€šè¿‡å¤åˆå¡‘æ¨¡å‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€"><a href="#æ¡æ¬¾38ï¼š-é€šè¿‡å¤åˆå¡‘æ¨¡å‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€" class="headerlink" title="æ¡æ¬¾38ï¼š é€šè¿‡å¤åˆå¡‘æ¨¡å‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€"></a>æ¡æ¬¾38ï¼š é€šè¿‡å¤åˆå¡‘æ¨¡å‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€</h2><blockquote>
<p><em>Model â€œhas-aâ€ or â€œis-implemented-in-terms-ofâ€ through composition</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-34"><a href="#æ ¸å¿ƒç†å¿µ-34" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>å¤åˆï¼ˆcompositionï¼‰<strong>æ„å‘³ç€æŸç§ç±»å‹çš„å¯¹è±¡å†…å«å…¶ä»–ç±»å‹çš„å¯¹è±¡ã€‚å¤åˆå¯ä»¥æ„å‘³ç€</strong>has-a</strong>ï¼ˆæœ‰ä¸€ä¸ªï¼‰æˆ–<strong>is-implemented-in-terms-of</strong>ï¼ˆæ ¹æ®æŸç‰©å®ç°å‡ºï¼‰å…³ç³»ã€‚åœ¨åº”ç”¨åŸŸä¸­ï¼Œå¤åˆæ„å‘³ç€has-aï¼›åœ¨å®ç°åŸŸä¸­ï¼Œå¤åˆæ„å‘³ç€is-implemented-in-terms-ofã€‚ç†è§£è¿™ä¸¤ç§å…³ç³»çš„åŒºåˆ«ï¼Œå¹¶æ­£ç¡®ä½¿ç”¨å¤åˆè€Œéç»§æ‰¿ï¼Œæ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„é‡è¦æŠ€èƒ½ã€‚</p>
<h3 id="æ·±åº¦è§£æ-34"><a href="#æ·±åº¦è§£æ-34" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å¤åˆçš„ä¸¤ç§è¯­ä¹‰"><a href="#1-å¤åˆçš„ä¸¤ç§è¯­ä¹‰" class="headerlink" title="1. å¤åˆçš„ä¸¤ç§è¯­ä¹‰"></a>1. <strong>å¤åˆçš„ä¸¤ç§è¯­ä¹‰</strong></h4><p><strong>has-aå…³ç³»ï¼ˆåº”ç”¨åŸŸï¼‰</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name_;        <span class="comment">// Personæœ‰ä¸€ä¸ªåå­—</span></span><br><span class="line">    Address address_;         <span class="comment">// Personæœ‰ä¸€ä¸ªåœ°å€</span></span><br><span class="line">    PhoneNumber phone_;       <span class="comment">// Personæœ‰ä¸€ä¸ªç”µè¯å·ç </span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Address&amp; addr, <span class="type">const</span> PhoneNumber&amp; phone)</span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">address_</span>(addr), <span class="built_in">phone_</span>(phone) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> Address&amp; <span class="title">getAddress</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> address_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> PhoneNumber&amp; <span class="title">getPhone</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> phone_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string street_;</span><br><span class="line">    std::string city_;</span><br><span class="line">    std::string zipCode_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Address</span>(<span class="type">const</span> std::string&amp; street, <span class="type">const</span> std::string&amp; city, <span class="type">const</span> std::string&amp; zip)</span><br><span class="line">        : <span class="built_in">street_</span>(street), <span class="built_in">city_</span>(city), <span class="built_in">zipCode_</span>(zip) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">getFullAddress</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> street_ + <span class="string">&quot;, &quot;</span> + city_ + <span class="string">&quot; &quot;</span> + zipCode_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>is-implemented-in-terms-ofå…³ç³»ï¼ˆå®ç°åŸŸï¼‰</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯è®¾è®¡ï¼šSetä¸æ˜¯Listï¼Œä¸åº”è¯¥ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span> : <span class="keyword">public</span> std::list&lt;T&gt; &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®è®¾è®¡ï¼šSetæ ¹æ®Listå®ç°</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::list&lt;T&gt; rep_;  <span class="comment">// Setæ ¹æ®listå®ç°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">member</span><span class="params">(<span class="type">const</span> T&amp; item)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">find</span>(rep_.<span class="built_in">begin</span>(), rep_.<span class="built_in">end</span>(), item) != rep_.<span class="built_in">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> T&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">member</span>(item)) &#123;</span><br><span class="line">            rep_.<span class="built_in">push_back</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">const</span> T&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = std::<span class="built_in">find</span>(rep_.<span class="built_in">begin</span>(), rep_.<span class="built_in">end</span>(), item);</span><br><span class="line">        <span class="keyword">if</span> (it != rep_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            rep_.<span class="built_in">erase</span>(it);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> rep_.<span class="built_in">size</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> rep_.<span class="built_in">empty</span>(); &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-ç»§æ‰¿-vs-å¤åˆçš„é€‰æ‹©æŒ‡å—"><a href="#2-ç»§æ‰¿-vs-å¤åˆçš„é€‰æ‹©æŒ‡å—" class="headerlink" title="2. ç»§æ‰¿ vs å¤åˆçš„é€‰æ‹©æŒ‡å—"></a>2. <strong>ç»§æ‰¿ vs å¤åˆçš„é€‰æ‹©æŒ‡å—</strong></h4><p><strong>ä½•æ—¶ä½¿ç”¨publicç»§æ‰¿ï¼ˆis-aå…³ç³»ï¼‰</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šå­¦ç”Ÿæ˜¯äºº</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string studentId_;</span><br><span class="line">    std::vector&lt;Course&gt; courses_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Student</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Address&amp; addr, </span><br><span class="line">            <span class="type">const</span> PhoneNumber&amp; phone, <span class="type">const</span> std::string&amp; id)</span><br><span class="line">        : <span class="built_in">Person</span>(name, addr, phone), <span class="built_in">studentId_</span>(id) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enrollCourse</span><span class="params">(<span class="type">const</span> Course&amp; course)</span> </span>&#123;</span><br><span class="line">        courses_.<span class="built_in">push_back</span>(course);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Studentå¯ä»¥åšPersonèƒ½åšçš„ä¸€åˆ‡äº‹æƒ…</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ä½•æ—¶ä½¿ç”¨å¤åˆï¼ˆhas-aå…³ç³»ï¼‰</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šæ±½è½¦æœ‰å¼•æ“ï¼Œä¸æ˜¯å¼•æ“</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Engine engine_;           <span class="comment">// Caræœ‰ä¸€ä¸ªEngine</span></span><br><span class="line">    Transmission transmission_; <span class="comment">// Caræœ‰ä¸€ä¸ªTransmission</span></span><br><span class="line">    std::vector&lt;Wheel&gt; wheels_; <span class="comment">// Caræœ‰å¤šä¸ªWheel</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Car</span>(<span class="type">const</span> Engine&amp; engine, <span class="type">const</span> Transmission&amp; trans, </span><br><span class="line">        <span class="type">const</span> std::vector&lt;Wheel&gt;&amp; wheels)</span><br><span class="line">        : <span class="built_in">engine_</span>(engine), <span class="built_in">transmission_</span>(trans), <span class="built_in">wheels_</span>(wheels) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        engine_.<span class="built_in">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accelerate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        engine_.<span class="built_in">increaseRPM</span>();</span><br><span class="line">        transmission_.<span class="built_in">shiftGear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-å¤åˆçš„ä¼˜åŠ¿"><a href="#3-å¤åˆçš„ä¼˜åŠ¿" class="headerlink" title="3. å¤åˆçš„ä¼˜åŠ¿"></a>3. <strong>å¤åˆçš„ä¼˜åŠ¿</strong></h4><p><strong>æ›´å¥½çš„å°è£…æ€§</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseConnection</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    TCPSocket socket_;        <span class="comment">// å®ç°ç»†èŠ‚è¢«å®Œå…¨éšè—</span></span><br><span class="line">    MessageBuffer buffer_;    <span class="comment">// å®¢æˆ·æ— æ³•ç›´æ¥è®¿é—®</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect</span><span class="params">(<span class="type">const</span> std::string&amp; host, <span class="type">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> socket_.<span class="built_in">connect</span>(host, port);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">sendQuery</span><span class="params">(<span class="type">const</span> std::string&amp; sql)</span> </span>&#123;</span><br><span class="line">        <span class="function">Message <span class="title">msg</span><span class="params">(sql)</span></span>;</span><br><span class="line">        <span class="keyword">return</span> socket_.<span class="built_in">send</span>(buffer_.<span class="built_in">serialize</span>(msg));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®¢æˆ·æ— æ³•è°ƒç”¨socket_çš„å…¶ä»–æ–¹æ³•ï¼Œåªèƒ½ä½¿ç”¨è®¾è®¡çš„æ¥å£</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-26"><a href="#æ€»ç»“-26" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>å¤åˆçš„æ ¸å¿ƒä»·å€¼ï¼š</strong></p>
<ol>
<li><strong>è¡¨è¾¾æ­£ç¡®çš„å…³ç³»</strong>ï¼šhas-aæˆ–is-implemented-in-terms-of</li>
<li><strong>æ›´å¥½çš„å°è£…</strong>ï¼šéšè—å®ç°ç»†èŠ‚</li>
<li><strong>é¿å…æ¥å£æ±¡æŸ“</strong>ï¼šåªæš´éœ²å¿…è¦çš„æ“ä½œ</li>
<li><strong>çµæ´»çš„è®¾è®¡</strong>ï¼šè¿è¡Œæ—¶å¯æ›¿æ¢ç»„ä»¶</li>
</ol>
<p><strong>è®°ä½ï¼šå¤åˆçš„æ„ä¹‰å’Œpublicç»§æ‰¿å®Œå…¨ä¸åŒã€‚åœ¨åº”ç”¨åŸŸï¼Œå¤åˆæ„å‘³ç€has-aï¼ˆæœ‰ä¸€ä¸ªï¼‰ï¼›åœ¨å®ç°åŸŸï¼Œå¤åˆæ„å‘³ç€is-implemented-in-terms-ofï¼ˆæ ¹æ®æŸç‰©å®ç°å‡ºï¼‰ã€‚</strong></p>
<h2 id="æ¡æ¬¾39ï¼š-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿"><a href="#æ¡æ¬¾39ï¼š-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿" class="headerlink" title="æ¡æ¬¾39ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿"></a>æ¡æ¬¾39ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</h2><blockquote>
<p><em>Use private inheritance judiciously</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-35"><a href="#æ ¸å¿ƒç†å¿µ-35" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p><strong>privateç»§æ‰¿æ„å‘³ç€â€is-implemented-in-terms-ofâ€ï¼ˆæ ¹æ®æŸç‰©å®ç°å‡ºï¼‰å…³ç³»</strong>ã€‚å½“æ´¾ç”Ÿç±»privateç»§æ‰¿åŸºç±»æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨å°†æ´¾ç”Ÿç±»å¯¹è±¡è½¬æ¢ä¸ºåŸºç±»å¯¹è±¡ã€‚privateç»§æ‰¿çº¯ç²¹åªæ˜¯ä¸€ç§å®ç°æŠ€æœ¯ï¼Œé€šå¸¸æ„å‘³ç€â€åªæœ‰å®ç°éƒ¨åˆ†è¢«ç»§æ‰¿ï¼Œæ¥å£éƒ¨åˆ†åº”ç•¥å»â€ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤åˆæ¯”privateç»§æ‰¿æ›´å¥½ï¼Œä½†å½“éœ€è¦è®¿é—®protectedæˆå‘˜æˆ–é‡å†™è™šå‡½æ•°æ—¶ï¼Œprivateç»§æ‰¿æ˜¯å¿…è¦çš„ã€‚</p>
<h3 id="æ·±åº¦è§£æ-35"><a href="#æ·±åº¦è§£æ-35" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-privateç»§æ‰¿çš„åŸºæœ¬ç‰¹æ€§"><a href="#1-privateç»§æ‰¿çš„åŸºæœ¬ç‰¹æ€§" class="headerlink" title="1. privateç»§æ‰¿çš„åŸºæœ¬ç‰¹æ€§"></a>1. <strong>privateç»§æ‰¿çš„åŸºæœ¬ç‰¹æ€§</strong></h4><p>privateç»§æ‰¿ä¸publicç»§æ‰¿åœ¨è¯­ä¹‰å’Œè¡Œä¸ºä¸Šéƒ½æœ‰æ˜¾è‘—å·®å¼‚ï¼Œç†è§£è¿™äº›æ ¹æœ¬åŒºåˆ«æ˜¯æ­£ç¡®ä½¿ç”¨privateç»§æ‰¿çš„å‰æã€‚</p>
<p><strong>ä¸publicç»§æ‰¿çš„åŒºåˆ«</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Timer</span><span class="params">(<span class="type">int</span> tickFrequency)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">()</span> <span class="type">const</span></span>;  <span class="comment">// å®šæ—¶å™¨æ¯éš”ä¸€å®šæ—¶é—´è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">int</span> frequency_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ publicç»§æ‰¿ï¼šWidget is-a Timerï¼ˆè¯­ä¹‰é”™è¯¯ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">public</span> Timer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… privateç»§æ‰¿ï¼šWidgetæ ¹æ®Timerå®ç°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> : <span class="keyword">private</span> Timer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="comment">// Timerçš„publicæ¥å£åœ¨è¿™é‡Œå˜æˆprivate</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testInheritance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Widget w;</span><br><span class="line">    Timer* pt = &amp;w;  <span class="comment">// âŒ é”™è¯¯ï¼privateç»§æ‰¿ä¸å…è®¸è‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ä½•æ—¶ä½¿ç”¨privateç»§æ‰¿"><a href="#2-ä½•æ—¶ä½¿ç”¨privateç»§æ‰¿" class="headerlink" title="2. ä½•æ—¶ä½¿ç”¨privateç»§æ‰¿"></a>2. <strong>ä½•æ—¶ä½¿ç”¨privateç»§æ‰¿</strong></h4><p>è™½ç„¶å¤åˆé€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œä½†æœ‰ä¸¤ç§ç‰¹å®šåœºæ™¯ä¸‹privateç»§æ‰¿ä¸ä»…åˆç†ï¼Œè€Œä¸”æ˜¯å¿…è¦çš„ã€‚</p>
<p><strong>åœºæ™¯1ï¼šéœ€è¦è®¿é—®protectedæˆå‘˜</strong>ï¼š</p>
<p>å½“éœ€è¦ä½¿ç”¨åŸºç±»çš„protectedæˆå‘˜è€Œåˆä¸å¸Œæœ›æš´éœ²â€is-aâ€å…³ç³»æ—¶ï¼Œprivateç»§æ‰¿æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseEngine</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">logOperation</span><span class="params">(<span class="type">const</span> std::string&amp; operation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å†™å…¥æ•°æ®åº“æ“ä½œæ—¥å¿—</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">validateCredentials</span><span class="params">(<span class="type">const</span> std::string&amp; user, <span class="type">const</span> std::string&amp; password)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// éªŒè¯ç”¨æˆ·å‡­è¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">connect</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… privateç»§æ‰¿å¯ä»¥è®¿é—®protectedæˆå‘˜</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDatabase</span> : <span class="keyword">private</span> DatabaseEngine &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°è¿æ¥é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addUser</span><span class="params">(<span class="type">const</span> std::string&amp; user, <span class="type">const</span> std::string&amp; password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">validateCredentials</span>(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin123&quot;</span>)) &#123;  <span class="comment">// âœ… å¯ä»¥è®¿é—®protected</span></span><br><span class="line">            <span class="built_in">logOperation</span>(<span class="string">&quot;ADD_USER&quot;</span>);                     <span class="comment">// âœ… å¯ä»¥è®¿é—®protected</span></span><br><span class="line">            <span class="comment">// æ·»åŠ ç”¨æˆ·é€»è¾‘</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>åœºæ™¯2ï¼šéœ€è¦é‡å†™è™šå‡½æ•°</strong>ï¼š</p>
<p>å½“éœ€è¦é‡å†™åŸºç±»çš„è™šå‡½æ•°ä½†ä¸æƒ³å»ºç«‹â€is-aâ€å…³ç³»æ—¶ï¼Œprivateç»§æ‰¿æä¾›äº†æœ€ç›´æ¥çš„å®ç°æ–¹å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventHandler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onMouseClick</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onKeyPress</span><span class="params">(<span class="type">char</span> key)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onWindowResize</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… privateç»§æ‰¿å¯ä»¥é‡å†™è™šå‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> : <span class="keyword">private</span> EventHandler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onMouseClick</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Button clicked at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æŒ‰é’®ç‚¹å‡»å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">registerWithWindow</span><span class="params">(Window* window)</span> </span>&#123;</span><br><span class="line">        window-&gt;<span class="built_in">setEventHandler</span>(<span class="keyword">this</span>);  <span class="comment">// ä¼ é€’ç»™çª—å£ç³»ç»Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-27"><a href="#æ€»ç»“-27" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>privateç»§æ‰¿çš„æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>è¡¨è¾¾â€is-implemented-in-terms-ofâ€å…³ç³»</strong></li>
<li><strong>ç¦æ­¢å¤–éƒ¨çš„ç±»å‹è½¬æ¢</strong></li>
<li><strong>å¯ä»¥è®¿é—®protectedæˆå‘˜</strong></li>
<li><strong>å¯ä»¥é‡å†™è™šå‡½æ•°</strong></li>
</ol>
<p><strong>è®°ä½ï¼šprivateç»§æ‰¿æ„å‘³ç€â€is-implemented-in-terms-ofâ€ã€‚å®ƒé€šå¸¸æ¯”å¤åˆçº§åˆ«ä½ï¼Œä½†æ˜¯å½“derived classéœ€è¦è®¿é—®protected base classçš„æˆå‘˜ï¼Œæˆ–éœ€è¦é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„è™šå‡½æ•°æ—¶ï¼Œè¿™ä¹ˆè®¾è®¡æ˜¯åˆç†çš„ã€‚</strong></p>
<h2 id="æ¡æ¬¾40ï¼š-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"><a href="#æ¡æ¬¾40ï¼š-æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾40ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"></a>æ¡æ¬¾40ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</h2><blockquote>
<p><em>Use multiple inheritance judiciously</em></p>
</blockquote>
<h3 id="æ ¸å¿ƒç†å¿µ-36"><a href="#æ ¸å¿ƒç†å¿µ-36" class="headerlink" title="æ ¸å¿ƒç†å¿µ"></a>æ ¸å¿ƒç†å¿µ</h3><p>**å¤šé‡ç»§æ‰¿ï¼ˆMultiple Inheritance, MIï¼‰**æ¯”å•ä¸€ç»§æ‰¿å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´æ­§ä¹‰æ€§ï¼Œä»¥åŠå¯¹è™šåŸºç±»çš„éœ€è¦ã€‚ä½†å¤šé‡ç»§æ‰¿ä¹Ÿæœ‰åˆç†çš„ç”¨é€”ï¼šæ¯”å¦‚â€æ¥å£ç±»â€å’Œâ€è¾…åŠ©å®ç°ç±»â€çš„ç»“åˆã€‚è™šç»§æ‰¿ä¼šå¢åŠ å¤§å°ã€é€Ÿåº¦ã€åˆå§‹åŒ–ï¼ˆåŠèµ‹å€¼ï¼‰å¤æ‚åº¦ç­‰ç­‰æˆæœ¬ï¼Œå¦‚æœè™šåŸºç±»ä¸å¸¦ä»»ä½•æ•°æ®ï¼Œå°†æ˜¯æœ€å…·å®ç”¨ä»·å€¼çš„æƒ…å†µã€‚å¤šé‡ç»§æ‰¿çš„ç¡®æœ‰æ­£å½“ç”¨é€”ï¼Œå…¶ä¸­ä¸€ç§æƒ…èŠ‚æ¶‰åŠâ€publicç»§æ‰¿æŸä¸ªæ¥å£ç±»â€å’Œâ€privateç»§æ‰¿æŸä¸ªååŠ©å®ç°çš„ç±»â€çš„ä¸¤ç›¸ç»„åˆã€‚</p>
<h3 id="æ·±åº¦è§£æ-36"><a href="#æ·±åº¦è§£æ-36" class="headerlink" title="æ·±åº¦è§£æ"></a>æ·±åº¦è§£æ</h3><h4 id="1-å¤šé‡ç»§æ‰¿çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-å¤šé‡ç»§æ‰¿çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. å¤šé‡ç»§æ‰¿çš„åŸºæœ¬æ¦‚å¿µ"></a>1. <strong>å¤šé‡ç»§æ‰¿çš„åŸºæœ¬æ¦‚å¿µ</strong></h4><p>å¤šé‡ç»§æ‰¿å…è®¸ä¸€ä¸ªç±»ä»å¤šä¸ªåŸºç±»ç»§æ‰¿ï¼Œè¿™ä¸ºå®ç°å¤æ‚çš„æ¥å£ç»„åˆæä¾›äº†å¯èƒ½ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ–°çš„å¤æ‚æ€§ã€‚</p>
<p><strong>å¤šé‡ç»§æ‰¿çš„è¯­æ³•</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">open</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">close</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">read</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">write</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">File</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">serialize</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">deserialize</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Serializable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šé‡ç»§æ‰¿ï¼šç»§æ‰¿ä¸¤ä¸ªæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigFile</span> : <span class="keyword">public</span> File, <span class="keyword">public</span> Serializable &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string filename_;</span><br><span class="line">    std::map&lt;std::string, std::string&gt; config_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ConfigFile</span>(<span class="type">const</span> std::string&amp; filename) : <span class="built_in">filename_</span>(filename) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°Fileæ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">open</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Opening config file: &quot;</span> &lt;&lt; filename_ &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Closing config file&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Reading configuration&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Writing configuration&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°Serializableæ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">serialize</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Serializing config to JSON&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deserialize</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Deserializing config from JSON&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-é’»çŸ³ç»§æ‰¿é—®é¢˜ï¼ˆDiamond-Problemï¼‰"><a href="#2-é’»çŸ³ç»§æ‰¿é—®é¢˜ï¼ˆDiamond-Problemï¼‰" class="headerlink" title="2. é’»çŸ³ç»§æ‰¿é—®é¢˜ï¼ˆDiamond Problemï¼‰"></a>2. <strong>é’»çŸ³ç»§æ‰¿é—®é¢˜ï¼ˆDiamond Problemï¼‰</strong></h4><p>å½“å¤šä¸ªåŸºç±»å…±äº«åŒä¸€ä¸ªç¥–å…ˆç±»æ—¶ï¼Œå°±ä¼šå‡ºç°é’»çŸ³ç»§æ‰¿é—®é¢˜ï¼Œéœ€è¦é€šè¿‡è™šç»§æ‰¿æ¥è§£å†³äºŒä¹‰æ€§å’Œé‡å¤ç»§æ‰¿çš„é—®é¢˜ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šè™šç»§æ‰¿</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    std::string name_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Animal</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">eat</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; is eating&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… ä½¿ç”¨è™šç»§æ‰¿</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mammal</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Mammal</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">Animal</span>(name) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">giveBirth</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; is giving birth&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WingedAnimal</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">WingedAnimal</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">Animal</span>(name) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; is flying&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bat</span> : <span class="keyword">public</span> Mammal, <span class="keyword">public</span> WingedAnimal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// âš ï¸ æ³¨æ„ï¼šæœ€æ´¾ç”Ÿç±»è´Ÿè´£åˆå§‹åŒ–è™šåŸºç±»</span></span><br><span class="line">    <span class="built_in">Bat</span>(<span class="type">const</span> std::string&amp; name) </span><br><span class="line">        : <span class="built_in">Animal</span>(name),           <span class="comment">// å¿…é¡»ç›´æ¥åˆå§‹åŒ–è™šåŸºç±»</span></span><br><span class="line">          <span class="built_in">Mammal</span>(name), </span><br><span class="line">          <span class="built_in">WingedAnimal</span>(name) &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="3-å¤šé‡ç»§æ‰¿çš„åˆç†åº”ç”¨åœºæ™¯"><a href="#3-å¤šé‡ç»§æ‰¿çš„åˆç†åº”ç”¨åœºæ™¯" class="headerlink" title="3. å¤šé‡ç»§æ‰¿çš„åˆç†åº”ç”¨åœºæ™¯"></a>3. <strong>å¤šé‡ç»§æ‰¿çš„åˆç†åº”ç”¨åœºæ™¯</strong></h4><p>è™½ç„¶å¤šé‡ç»§æ‰¿å¤æ‚ï¼Œä½†åœ¨æŸäº›è®¾è®¡æ¨¡å¼ä¸­ç¡®å®æœ‰å…¶åˆç†ç”¨é€”ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¥å£è®¾è®¡å’ŒåŠŸèƒ½ç»„åˆæ–¹é¢ã€‚</p>
<p><strong>åœºæ™¯1ï¼šæ¥å£åˆ†ç¦»åŸåˆ™</strong>ï¼š</p>
<p>å½“ä¸€ä¸ªç±»éœ€è¦å®ç°å¤šä¸ªä¸ç›¸å…³çš„æ¥å£æ—¶ï¼Œå¤šé‡ç»§æ‰¿å¯ä»¥ä¿æŒæ¥å£çš„ç‹¬ç«‹æ€§å’Œæ¸…æ™°æ€§ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Readable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">read</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">canRead</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Readable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Writable</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">canWrite</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Writable</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°å¤šä¸ªæ¥å£çš„æ–‡ä»¶æµ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileStream</span> : <span class="keyword">public</span> Readable, <span class="keyword">public</span> Writable &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::fstream file_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileStream</span>(<span class="type">const</span> std::string&amp; filename) </span><br><span class="line">        : <span class="built_in">file_</span>(filename, std::ios::in | std::ios::out) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°Readableæ¥å£</span></span><br><span class="line">    <span class="function">std::string <span class="title">read</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::string line;</span><br><span class="line">        std::<span class="built_in">getline</span>(file_, line);</span><br><span class="line">        <span class="keyword">return</span> line;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canRead</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_.<span class="built_in">good</span>() &amp;&amp; file_.<span class="built_in">is_open</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°Writableæ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">const</span> std::string&amp; data)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        file_ &lt;&lt; data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canWrite</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_.<span class="built_in">good</span>() &amp;&amp; file_.<span class="built_in">is_open</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“-28"><a href="#æ€»ç»“-28" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>å¤šé‡ç»§æ‰¿çš„æ ¸å¿ƒä»·å€¼ï¼š</strong></p>
<ol>
<li><strong>æ¥å£åˆ†ç¦»</strong>ï¼šå®ç°å¤šä¸ªç‹¬ç«‹çš„æ¥å£</li>
<li><strong>ä»£ç å¤ç”¨</strong>ï¼šç»„åˆæ¥å£ç±»å’Œå®ç°ç±»</li>
<li><strong>è®¾è®¡çµæ´»æ€§</strong>ï¼šæ”¯æŒå¤æ‚çš„ç»§æ‰¿å…³ç³»</li>
</ol>
<p><strong>ä½¿ç”¨å¤šé‡ç»§æ‰¿çš„å‡†åˆ™ï¼š</strong></p>
<ol>
<li><strong>é¿å…é’»çŸ³ç»§æ‰¿</strong>ï¼šå°½é‡ä½¿ç”¨è™šç»§æ‰¿æ¥å¤„ç†</li>
<li><strong>ä¼˜å…ˆæ¥å£ç»§æ‰¿</strong>ï¼šå¤šé‡ç»§æ‰¿æœ€å¥½ç”¨äºçº¯æ¥å£ç±»</li>
<li><strong>è°¨æ…ä½¿ç”¨è™šåŸºç±»</strong>ï¼šåªæœ‰åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ï¼Œå¹¶ä¿æŒè™šåŸºç±»ç®€å•</li>
</ol>
<p><strong>è®°ä½ï¼šå¤šé‡ç»§æ‰¿æ¯”å•ä¸€ç»§æ‰¿å¤æ‚ï¼Œå®ƒå¯èƒ½å¯¼è‡´æ–°çš„æ­§ä¹‰æ€§ï¼Œä»¥åŠå¯¹è™šç»§æ‰¿çš„éœ€è¦ã€‚è™šç»§æ‰¿ä¼šå¢åŠ å¤§å°ã€é€Ÿåº¦ã€åˆå§‹åŒ–å¤æ‚åº¦ç­‰æˆæœ¬ã€‚å¦‚æœè™šåŸºç±»ä¸å¸¦ä»»ä½•æ•°æ®ï¼Œå°†æ˜¯æœ€å…·å®ç”¨ä»·å€¼çš„æƒ…å†µã€‚å¤šé‡ç»§æ‰¿çš„ç¡®æœ‰æ­£å½“ç”¨é€”ï¼Œå…¶ä¸­ä¸€ç§æƒ…èŠ‚æ¶‰åŠâ€publicç»§æ‰¿æŸä¸ªæ¥å£ç±»â€å’Œâ€privateç»§æ‰¿æŸä¸ªååŠ©å®ç°çš„ç±»â€çš„ä¸¤ç›¸ç»„åˆã€‚</strong></p>

    </div>

    <div style="margin-top: 3rem; padding-top: 1rem; border-top: 2px dashed #eee;">
      
      
      <div style="clear: both;"></div>
    </div>
  </article>

  <aside class="sidebar">
    <div class="sidebar-inner">

  <!-- Author Card - Redesigned without Avatar -->
  <div class="card-widget card-author">
    
    <!-- Pokemon Pixel Sprites Header -->
    <div style="text-align: center; margin-bottom: 1rem; display: flex; justify-content: center; gap: 5px;">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-iii/emerald/255.png" alt="ç«ç¨šé¸¡" title="ç«ç¨šé¸¡" style="width: 40px; image-rendering: pixelated;">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-iii/emerald/133.png" alt="ä¼Šå¸ƒ" title="ä¼Šå¸ƒ" style="width: 40px; image-rendering: pixelated;">
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-iii/emerald/25.png" alt="çš®å¡ä¸˜" title="çš®å¡ä¸˜" style="width: 40px; image-rendering: pixelated;">
    </div>
    
    <div class="author-name" style="font-size: 1.2rem; margin-bottom: 0.3rem;">çœŸæ–°é•‡ä¹‹å°æ™º</div>
    <div style="width: 60px; height: 2px; background: linear-gradient(to right, #FF6B9D, #FFD93D); margin: 0 auto 0.8rem;"></div>
    
    <div class="author-title" style="color: #FF6B9D; font-weight: 700; font-size: 0.8rem; margin-bottom: 1rem;">ğŸš€ Linux C++ / HPC æ¢ç´¢è€…</div>
    
    <p class="author-bio" style="text-align: center; font-size: 0.85rem; line-height: 1.5; color: #666; font-style: italic; padding: 0 5px;">
      "åœ¨ä»£ç çš„ä¸–ç•Œé‡Œä¿®è¡Œï¼Œ<br>
      åœ¨ç®—æ³•çš„æµ·æ´‹ä¸­é¨æ¸¸ã€‚"
    </p>
    
    <div style="text-align: left; padding: 0 10px; font-size: 0.8rem; color: #888; margin-top: 1rem;">
      ğŸ“ æ¹–åŒ—Â·æ­¦æ±‰<br>
      ğŸ“ è½¯ä»¶å·¥ç¨‹<br>
      ğŸ’» C++ / Go / Vue3
    </div>
    
    <div class="social-icons" style="margin-top: 1rem;">
      <a href="https://github.com/AshRW24" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
      <a href="mailto:ashrw24@example.com" title="Email"><i class="fas fa-envelope"></i></a>
      <a href="/atom.xml" title="RSS"><i class="fas fa-rss"></i></a>
    </div>
    
    <div class="site-data">
      <div class="data-item">
        <div class="data-name">æ–‡ç« </div>
        <div class="data-num">1</div>
      </div>
      <div class="data-item">
        <div class="data-name">æ ‡ç­¾</div>
        <div class="data-num">3</div>
      </div>
      <div class="data-item">
        <div class="data-name">åˆ†ç±»</div>
        <div class="data-num">4</div>
      </div>
    </div>
  </div>

  <!-- TOC (Only on Post) -->
  
    <div class="card-widget card-toc">
      <div class="card-title" style="display: flex; align-items: center;">
        <i class="fas fa-list-ol" style="color: #FFD93D; margin-right: 5px;"></i> 
        <span>æ–‡ç« ç›®å½•</span>
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-iii/emerald/172.png" alt="çš®ä¸˜" style="width: 25px; margin-left: auto; image-rendering: pixelated;">
      </div>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE01%EF%BC%9A-%E8%A7%86C-%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%AF%AD%E8%A8%80%E8%81%94%E9%82%A6"><span class="toc-text">æ¡æ¬¾01ï¼š è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE02%EF%BC%9A-%E5%B0%BD%E9%87%8F%E4%BB%A5const%EF%BC%8C-enum-inline-%E6%9B%BF%E6%8D%A2-define"><span class="toc-text">æ¡æ¬¾02ï¼š å°½é‡ä»¥constï¼Œ enum, inline æ›¿æ¢ #define</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE03-%E5%B0%BD%E9%87%8F%E4%BD%BF%E7%94%A8const"><span class="toc-text">æ¡æ¬¾03:  å°½é‡ä½¿ç”¨const</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE04%EF%BC%9A-%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E5%89%8D%E5%85%88%E8%A2%AB%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">æ¡æ¬¾04ï¼š ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆè¢«åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE05%EF%BC%9A-%E4%BA%86%E8%A7%A3C-%E9%BB%98%E8%AE%A4%E7%BC%96%E5%86%99%E5%B9%B6%E8%B0%83%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾05ï¼š äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨äº†å“ªäº›å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE06%EF%BC%9A-%E8%8B%A5%E4%B8%8D%E6%83%B3%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%99%A8%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C-%E5%B0%B1%E8%AF%A5%E6%98%8E%E7%A1%AE%E6%8B%92%E7%BB%9D%EF%BC%81"><span class="toc-text">æ¡æ¬¾06ï¼š è‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œ å°±è¯¥æ˜ç¡®æ‹’ç»ï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE07%EF%BC%9A-%E4%B8%BA%E5%A4%9A%E6%80%81%E5%9F%BA%E7%B1%BB%E5%A3%B0%E6%98%8Evirtual%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾07ï¼š ä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE08%EF%BC%9A-%E5%88%AB%E8%AE%A9%E5%BC%82%E5%B8%B8%E9%80%83%E7%A6%BB%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾08ï¼š åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE09-%EF%BC%9A-%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%9E%84%E9%80%A0%E5%92%8C%E6%9E%90%E6%9E%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8virtual%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾09 ï¼š ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨virtualå‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE10%EF%BC%9A-%E4%BB%A4-operator-%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AAreference-to-this"><span class="toc-text">æ¡æ¬¾10ï¼š ä»¤ operator&#x3D; è¿”å›ä¸€ä¸ªreference to *this</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE11%EF%BC%9A-%E5%9C%A8operator-%E4%B8%AD%E5%A4%84%E7%90%86%E2%80%9D%E8%87%AA%E6%88%91%E8%B5%8B%E5%80%BC%E2%80%9D"><span class="toc-text">æ¡æ¬¾11ï¼š åœ¨operator&#x3D;ä¸­å¤„ç†â€è‡ªæˆ‘èµ‹å€¼â€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE12%EF%BC%9A-%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%8B%BF%E5%BF%98%E5%85%B6%E6%AF%8F%E4%B8%80%E4%B8%AA%E6%88%90%E5%88%86"><span class="toc-text">æ¡æ¬¾12ï¼š å¤åˆ¶å¯¹è±¡æ—¶å‹¿å¿˜å…¶æ¯ä¸€ä¸ªæˆåˆ†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE13%EF%BC%9A-%E4%BB%A5%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90"><span class="toc-text">æ¡æ¬¾13ï¼š ä»¥å¯¹è±¡ç®¡ç†èµ„æº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE14%EF%BC%9A-%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83copying%E8%A1%8C%E4%B8%BA"><span class="toc-text">æ¡æ¬¾14ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE15%EF%BC%9A-%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-text">æ¡æ¬¾15ï¼š åœ¨èµ„æºç®¡ç†ç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE16%EF%BC%9A-%E6%88%90%E5%AF%B9%E4%BD%BF%E7%94%A8new%E5%92%8Cdelete%E6%97%B6%E8%A6%81%E9%87%87%E5%8F%96%E7%9B%B8%E5%90%8C%E5%BD%A2%E5%BC%8F"><span class="toc-text">æ¡æ¬¾16ï¼š æˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡å–ç›¸åŒå½¢å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE17-%E4%BB%A5%E7%8B%AC%E7%AB%8B%E8%AF%AD%E5%8F%A5%E5%B0%86-new%EF%BC%88ed%EF%BC%89-%E5%AF%B9%E8%B1%A1%E7%BD%AE%E5%85%A5%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%EF%BC%81"><span class="toc-text">æ¡æ¬¾17 : ä»¥ç‹¬ç«‹è¯­å¥å°† newï¼ˆedï¼‰ å¯¹è±¡ç½®å…¥æ™ºèƒ½æŒ‡é’ˆï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE18%EF%BC%9A-%E8%AE%A9%E6%8E%A5%E5%8F%A3%E5%AE%B9%E6%98%93%E8%A2%AB%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%EF%BC%8C%E4%B8%8D%E6%98%93%E8%A2%AB%E8%AF%AF%E7%94%A8"><span class="toc-text">æ¡æ¬¾18ï¼š è®©æ¥å£å®¹æ˜“è¢«æ­£ç¡®ä½¿ç”¨ï¼Œä¸æ˜“è¢«è¯¯ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE19%EF%BC%9A-%E8%AE%BE%E8%AE%A1class%E7%8A%B9%E5%A6%82%E8%AE%BE%E8%AE%A1type"><span class="toc-text">æ¡æ¬¾19ï¼š è®¾è®¡classçŠ¹å¦‚è®¾è®¡type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE20%EF%BC%9A-%E5%AE%81%E4%BB%A5pass-by-reference-to-const%E6%9B%BF%E6%8D%A2pass-by-value"><span class="toc-text">æ¡æ¬¾20ï¼š å®ä»¥pass-by-reference-to-constæ›¿æ¢pass-by-value</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE21%EF%BC%9A-%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6%EF%BC%8C%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6-reference"><span class="toc-text">æ¡æ¬¾21ï¼š å¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶ reference</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE22%EF%BC%9A-%E5%B0%86%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E4%B8%BA-private"><span class="toc-text">æ¡æ¬¾22ï¼š å°†æˆå‘˜å˜é‡å£°æ˜ä¸º private</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE23%EF%BC%9A-%E5%AE%81%E4%BB%A5non-member%E3%80%81non-friend%E6%9B%BFmember-%E5%87%BD%E6%95%B0%E3%80%82"><span class="toc-text">æ¡æ¬¾23ï¼š å®ä»¥non-memberã€non-friendæ›¿member å‡½æ•°ã€‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE24%EF%BC%9A-%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%EF%BC%8C%E8%AF%B7%E4%B8%BA%E6%AD%A4%E9%87%87%E7%94%A8non-member%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢ï¼Œè¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE25%EF%BC%9A%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%BC%82%E5%B8%B8%E7%9A%84-swap-%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„ swap å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE29%EF%BC%9A%E4%B8%BA%E2%80%9D%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E2%80%9D%E8%80%8C%E5%8A%AA%E5%8A%9B%E6%98%AF%E5%80%BC%E5%BE%97%E7%9A%84%EF%BC%81"><span class="toc-text">æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€è€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„ï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE30%EF%BC%9A%E9%80%8F%E5%BD%BB%E4%BA%86%E8%A7%A3inlining%E7%9A%84%E9%87%8C%E9%87%8C%E5%A4%96%E5%A4%96"><span class="toc-text">æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE31%EF%BC%9A%E5%B0%86%E6%96%87%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E5%85%B3%E7%B3%BB%E9%99%8D%E8%87%B3%E6%9C%80%E4%BD%8E"><span class="toc-text">æ¡æ¬¾31ï¼šå°†æ–‡ä»¶ä¹‹é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE32%EF%BC%9A%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84-public-%E7%BB%A7%E6%89%BF%E5%A1%91%E6%A8%A1%E5%87%BA-is-a-%E5%85%B3%E7%B3%BB"><span class="toc-text">æ¡æ¬¾32ï¼šç¡®å®šä½ çš„ public ç»§æ‰¿å¡‘æ¨¡å‡º is-a å…³ç³»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE33%EF%BC%9A%E9%81%BF%E5%85%8D%E9%81%AE%E6%8E%A9%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-text">æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE34%EF%BC%9A%E5%8C%BA%E5%88%86%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF%E5%92%8C%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾34ï¼šåŒºåˆ†å®ç°ç»§æ‰¿å’Œæ¥å£ç»§æ‰¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE35%EF%BC%9A%E8%80%83%E8%99%91virtual%E5%87%BD%E6%95%B0%E4%BB%A5%E5%A4%96%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE36%EF%BC%9A%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84non-virtual%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE37%EF%BC%9A%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E7%BC%BA%E7%9C%81%E5%8F%82%E6%95%B0%E5%80%BC"><span class="toc-text">æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„ç¼ºçœå‚æ•°å€¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE38%EF%BC%9A-%E9%80%9A%E8%BF%87%E5%A4%8D%E5%90%88%E5%A1%91%E6%A8%A1%E5%87%BAhas-a%E6%88%96%E2%80%9D%E6%A0%B9%E6%8D%AE%E6%9F%90%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%87%BA%E2%80%9D"><span class="toc-text">æ¡æ¬¾38ï¼š é€šè¿‡å¤åˆå¡‘æ¨¡å‡ºhas-aæˆ–â€æ ¹æ®æŸç‰©å®ç°å‡ºâ€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE39%EF%BC%9A-%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8private%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾39ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨privateç»§æ‰¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE40%EF%BC%9A-%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾40ï¼š æ˜æ™ºè€Œå®¡æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</span></a></li></ol>
    </div>
  

  <!-- Tags -->
  <div class="card-widget card-tags">
    <div class="card-title" style="display: flex; align-items: center;">
      <i class="fas fa-tags" style="color: #4ECDC4; margin-right: 5px;"></i> 
      <span>æ ‡ç­¾äº‘</span>
      <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-iii/emerald/280.png" alt="æ‹‰é²æ‹‰æ–¯" style="width: 25px; margin-left: auto; image-rendering: pixelated;">
    </div>
    <div class="tag-cloud">
      <a class="tag-none-link" href="/tags/C/" rel="tag">C++</a><a class="tag-none-link" href="/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="tag">æœ€ä½³å®è·µ</a><a class="tag-none-link" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag">è¯»ä¹¦ç¬”è®°</a>
    </div>
  </div>

</div>

  </aside>
</div>

  </main>

  <footer>
    <p>&copy; 2025 çœŸæ–°é•‡ä¹‹å°æ™º</p>
    <p>ä¿®èº« Â· é½å®¶ Â· æ²»å›½ Â· å†™ä»£ç  âœ¨</p>
  </footer>

  <div id="back-to-top" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></div>

  <script>
    // Back to Top
    const backToTopBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
      
      // Reading Progress
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      const scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
      const clientHeight = document.documentElement.clientHeight || document.body.clientHeight;
      const scrolled = (scrollTop / (scrollHeight - clientHeight)) * 100;
      document.getElementById('reading-progress-bar').style.width = scrolled + '%';
    });

    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Code Copy
    document.querySelectorAll('figure.highlight').forEach(block => {
      const btn = document.createElement('div');
      btn.className = 'copy-btn';
      btn.innerHTML = '<i class="far fa-copy"></i>';
      block.appendChild(btn);
      
      btn.addEventListener('click', () => {
        const code = block.querySelector('td.code').innerText;
        navigator.clipboard.writeText(code).then(() => {
          btn.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(() => btn.innerHTML = '<i class="far fa-copy"></i>', 2000);
        });
      });
    });
  </script>
</body>
</html>
